/*! Synergy 2018-03-10 */

"use strict";function SampleSubscriber($scope,data,event){window.console.log("Received: "+event)}angular.module("synergy",["ui.codemirror","infinite-scroll","ui.select2","ngCookies","ngProgress","ui.bootstrap","synergy.http","synergy.test","synergy.core","synergy.controllers","synergy.directives","synergy.models","synergy.utils","synergy.handlers","synergy.filters"]).config(function($provide,$routeProvider,$httpProvider){$provide.factory("MyHttpInterceptor",["$q","$rootScope","SynergyApp","$injector","$cookieStore","sessionService",function($q,$rootScope,SynergyApp,$injector,$cookieStore,sessionService){var IGNORE_URLS=["../../server/api/login.php","../../server/api/login.php?&return=1"],refreshPromise=null;function SessionRenewal(){this.originalResponse=null,this.intervalId=-1,this.TOKEN_LENGTH=32,this.token=null,this.counter=0}SessionRenewal.prototype.getToken=function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<this.TOKEN_LENGTH;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text+(new Date).getTime()},SessionRenewal.prototype.reset=function(){window.clearInterval(this.intervalId),this.counter=0,this.token=null,this.intervalId=-1,this.originalResponse=null},SessionRenewal.prototype.checkForNewLogin=function(){this.counter++;var self=this;$injector.get("$http").get(SynergyApp.getApp().server.buildURL("refresh",{token:self.token})).success(function(result){window.clearInterval(self.intervalId),self.reset(),refreshPromise.resolve(self.originalResponse)}).error(function(data,status,headers,config){100<self.counter&&(self.reset(),refreshPromise.reject(self.originalResponse))})},SessionRenewal.prototype.getRedirectUrl=function(){var url=window.location.href.substring(0,window.location.href.indexOf("#"));if(url=url.endsWith(".html")?url.substring(0,url.lastIndexOf("/")+1):url,this.token=this.getToken(),url+="login.html?token="+this.token,SynergyApp.getApp().useSSO){var base=SynergyApp.getApp().getLoginRedirectUrl(SynergyApp.getApp().ssoLoginUrl,url);return base.substring(0,base.indexOf("?revalidate=1"))}throw new Error("Not implemented")},SessionRenewal.prototype.init=function(response){refreshPromise=$q.defer(),this.originalResponse=response,$("#myModalLabel").text("Please login"),$("#modal-body").html("Your session has expired. <br/><a href='"+this.getRedirectUrl()+"' target='_blank'>Click to login</a>"),$("#myModal").hasClass("in")||$("#myModal").modal("toggle");var self=this;return this.intervalId=window.setInterval(function(){self.checkForNewLogin()},2e3),refreshPromise.promise},SessionRenewal.prototype.displayDialog=function(isVisible){$("#myModal").hasClass("in")&&$("#myModal").modal("toggle")},SessionRenewal.prototype.renew=function(response){var self=this;return this.init(response).then(function(){return $injector.get("sessionHttp").infoConditionalPromise(SynergyApp.getApp().server.buildURL("session"))}).then(function(data){return SynergyApp.getApp().session.setSession(data.data),sessionService.setSession(SynergyApp.getApp().session),$cookieStore.put("session",{firstName:data.firstName,lastName:data.lastName,username:data.username,role:data.role,token:data.token,created:1e3*parseInt(data.created,10),session_id:data.session_id}),$rootScope.$broadcast("refreshRole"),self.displayDialog(!1),$injector.get("$http")(response.config)},function(){return $cookieStore.remove("session"),sessionService.clearSession(),SynergyApp.getApp().session.clearSession(),$rootScope.$broadcast("hideUserMenu",!1),$rootScope.$broadcast("refreshRole"),self.displayDialog(!1),$q.reject(response)})};var sessionRenewal=new SessionRenewal;return function(promise){return promise.then(function(response){return $rootScope.$broadcast("busyMode",!1),window.document.body.style.cursor="default",response},function(response){return $rootScope.$broadcast("busyMode",!1),window.document.body.style.cursor="default",0===parseInt(response.status,10)&&$rootScope.$broadcast("possibleTimeout",!1),401===parseInt(response.status,10)&&IGNORE_URLS.indexOf(response.config.url)<0?sessionRenewal.renew(response):$q.reject(response)})}}]),$httpProvider.interceptors?$httpProvider.interceptors.push("MyHttpInterceptor"):$httpProvider.responseInterceptors.push("MyHttpInterceptor"),$provide.factory("utils",function(){var u={escape:function(s){return encodeURIComponent(s)}};return u}),$provide.factory("issue",function($http){return{getIssue:function(id,$scope){$http.get($scope.SYNERGY.server.buildURL("issue",{id:id})).success(function(data){return data}).error(function(data){window.console.log("Issue "+id+" not found: "+data)})}}}),$routeProvider.when("/specifications/:id",{templateUrl:"partials/public/view/specpool.html?v=1520701519774",controller:"SpecPoolCtrl"}),$routeProvider.when("/statistics/:id",{templateUrl:"partials/public/view/statistics.html?v=1520701519774",controller:"StatisticsCtrl"}),$routeProvider.when("/statistics/:id/archive",{templateUrl:"partials/public/view/statistics.html?v=1520701519774",controller:"StatisticsCtrl"}),$routeProvider.when("/search/:search",{templateUrl:"partials/public/view/search.html?v=1520701519774",controller:"SearchCtrl"}),$routeProvider.when("/specifications",{templateUrl:"partials/public/view/specpool.html?v=1520701519774",controller:"SpecPoolCtrl"}),$routeProvider.when("/specification/:id/create",{templateUrl:"partials/public/create/specification.html?v=1520701519774",controller:"SpecificationCtrl"}),$routeProvider.when("/specification/:id/edit",{templateUrl:"partials/public/edit/specification.html?v=1520701519774",controller:"SpecificationCtrl"}),$routeProvider.when("/specification/:id/v/1",{templateUrl:"partials/public/view/specification_view_1.html?v=1520701519774",controller:"SpecificationCtrl"}),$routeProvider.when("/specification/:id/v/2",{templateUrl:"partials/public/view/specification_view_2.html?v=1520701519774",controller:"SpecificationCtrl"}),$routeProvider.when("/specification/:id/v/2/:label",{templateUrl:"partials/public/view/specification_view_2.html?v=1520701519774",controller:"SpecificationCtrl"}),$routeProvider.when("/title/:simpleName/:simpleVersion",{templateUrl:"partials/public/view/specification_view_2.html?v=1520701519774",controller:"SpecificationCtrl"}),$routeProvider.when("/title/:simpleName/",{redirectTo:"/title/:simpleName/latest"}),$routeProvider.when("/specification/:id",{redirectTo:"/specification/:id/v/2"}),$routeProvider.when("/suite/:id/:specification/:version/create",{templateUrl:"partials/public/create/suite.html?v=1520701519774",controller:"SuiteCtrl"}),$routeProvider.when("/suite/:id/edit",{templateUrl:"partials/public/edit/suite.html?v=1520701519774",controller:"SuiteCtrl"}),$routeProvider.when("/suite/:id/v/1",{templateUrl:"partials/public/view/suite.html?v=1520701519774",controller:"SuiteCtrl"}),$routeProvider.when("/suite/:id",{redirectTo:"/suite/:id/v/1"}),$routeProvider.when("/case/:id/suite/:parent/edit",{templateUrl:"partials/public/edit/case.html?v=1520701519774",controller:"CaseCtrl"}),$routeProvider.when("/case/:id/suite/:parent/create",{templateUrl:"partials/public/create/case.html?v=1520701519774",controller:"CaseCtrl"}),$routeProvider.when("/case/:id/suite/:parent/v/1",{templateUrl:"partials/public/view/case.html?v=1520701519774",controller:"CaseCtrl"}),$routeProvider.when("/assignment_comments/:id",{templateUrl:"partials/public/view/assignment_comments.html?v=1520701519774",controller:"AssignmentCommentsCtrl"}),$routeProvider.when("/case/:id/suite/:parent",{redirectTo:"/case/:id/suite/:parent/v/1"}),$routeProvider.when("/case/:id",{redirectTo:"/case/:id/suite/-1/v/1"}),$routeProvider.when("/run/:id/v/1",{templateUrl:"partials/public/view/run_view_1.html?v=1520701519774",controller:"RunCtrl"}),$routeProvider.when("/run/:id/coverage",{templateUrl:"partials/public/view/run_coverage.html?v=1520701519774",controller:"RunCoverageCtrl"}),$routeProvider.when("/run/:id/v/2",{templateUrl:"partials/public/view/run_view_2.html?v=1520701519774",controller:"RunCtrlUser"}),$routeProvider.when("/run/:id/v/3",{templateUrl:"partials/public/view/run_view_3.html?v=1520701519774",controller:"RunCtrlCase"}),$routeProvider.when("/run/:id",{redirectTo:"/run/:id/v/2"}),$routeProvider.when("/runs/page/:page",{templateUrl:"partials/public/view/runs.html?v=1520701519774",controller:"RunsCtrl"}),$routeProvider.when("/runs",{redirectTo:"/runs/page/1"}),$routeProvider.when("/user",{templateUrl:"partials/public/view/profile.html?v=1520701519774",controller:"ProfileCtrl"}),$routeProvider.when("/user/:user",{templateUrl:"partials/public/view/profile.html?v=1520701519774",controller:"ProfileCtrl"}),$routeProvider.when("/label/:label/page/:page",{templateUrl:"partials/public/view/label.html?v=1520701519774",controller:"LabelFilterCtrl"}),$routeProvider.when("/label/:label",{redirectTo:"/label/:label/page/1"}),$routeProvider.when("/tribe/:id/edit",{templateUrl:"partials/public/edit/tribe.html?v=1520701519774",controller:"TribeCtrl"}),$routeProvider.when("/tribe/:id/view",{templateUrl:"partials/public/view/tribe.html?v=1520701519774",controller:"TribeCtrl"}),$routeProvider.when("/tribes",{templateUrl:"partials/public/view/tribes.html?v=1520701519774",controller:"TribesCtrl"}),$routeProvider.when("/calendar",{templateUrl:"partials/public/view/calendar.html?v=1520701519774",controller:"CalendarCtrl"}),$routeProvider.when("/tribe/:id",{redirectTo:"/tribe/:id/view"}),$routeProvider.when("/",{templateUrl:"partials/public/view/home.html?v=1520701519774",controller:"HomeCtrl"}),$routeProvider.when("/assignment/:id/v/:mode",{templateUrl:"partials/public/view/assignment.html?v=1520701519774",controller:"AssignmentCtrl"}),$routeProvider.when("/assignment/create/run/:id",{templateUrl:"partials/public/create/assignment.html?v=1520701519774",controller:"AssignmentVolunteerCtrl"}),$routeProvider.when("/assignment/create/tribe/run/:id",{templateUrl:"partials/public/create/assignment_tribe.html?v=1520701519774",controller:"AssignmentTribeCtrl"}),$routeProvider.when("/about",{templateUrl:"partials/public/view/about.html?v=1520701519774",controller:"AboutCtrl"}),$routeProvider.when("/revisions/:id",{templateUrl:"partials/public/view/revisions.html?v=1520701519774",controller:"RevisionCtrl"}),$routeProvider.when("/review/:id/view",{templateUrl:"partials/public/view/review.html?v=1520701519774",controller:"ReviewCtrl"}),$routeProvider.when("/review/:id/:action",{templateUrl:"partials/public/edit/review.html?v=1520701519774",controller:"ReviewCtrl"}),$routeProvider.when("/register",{templateUrl:"partials/public/view/register.html?v=1520701519774",controller:"RegisterCtrl"}),$routeProvider.when("/login",{templateUrl:"partials/public/view/login.html?v=1520701519774",controller:"LoginCtrl"}),$routeProvider.when("/recover",{templateUrl:"partials/public/view/recover.html?v=1520701519774",controller:"RecoverCtrl"}),$routeProvider.when("/administration",{templateUrl:"partials/admin/view/home.html?v=1520701519774",controller:"AdminHomeCtrl"}),$routeProvider.when("/administration/versions",{templateUrl:"partials/admin/view/versions.html?v=1520701519774",controller:"AdminVersionCtrl"}),$routeProvider.when("/administration/runs/page/:page",{templateUrl:"partials/admin/view/runs.html?v=1520701519774",controller:"AdminRunsCtrl"}),$routeProvider.when("/administration/run/-1/create",{templateUrl:"partials/admin/create/run.html?v=1520701519774",controller:"AdminRunCtrl"}),$routeProvider.when("/administration/assignment/create/run/:id",{templateUrl:"partials/admin/create/assignment.html?v=1520701519774",controller:"AdminAssignmentCtrl"}),$routeProvider.when("/administration/assignment/creatematrix/run/:id",{templateUrl:"partials/admin/create/matrix_assignment.html?v=1520701519774",controller:"AdminMatrixAssignmentCtrl"}),$routeProvider.when("/administration/run/:id/edit",{templateUrl:"partials/admin/edit/run.html?v=1520701519774",controller:"AdminRunCtrl"}),$routeProvider.when("/administration/runs",{redirectTo:"/administration/runs/page/1"}),$routeProvider.when("/administration/tribes/create",{templateUrl:"partials/admin/create/tribe.html?v=1520701519774",controller:"AdminTribesCtrl"}),$routeProvider.when("/administration/tribes",{templateUrl:"partials/admin/view/tribes.html?v=1520701519774",controller:"AdminTribesCtrl"}),$routeProvider.when("/administration/platforms",{templateUrl:"partials/admin/view/platforms.html?v=1520701519774",controller:"AdminPlatformsCtrl"}),$routeProvider.when("/administration/users/page/:page",{templateUrl:"partials/admin/view/users.html?v=1520701519774",controller:"AdminUsersCtrl"}),$routeProvider.when("/administration/user/:username/edit",{templateUrl:"partials/admin/edit/user.html?v=1520701519774",controller:"AdminUserCtrl"}),$routeProvider.when("/administration/user/:username/create",{templateUrl:"partials/admin/create/user.html?v=1520701519774",controller:"AdminUserCtrl"}),$routeProvider.when("/administration/users",{redirectTo:"/administration/users/page/1"}),$routeProvider.when("/administration/setting",{templateUrl:"partials/admin/view/settings.html?v=1520701519774",controller:"AdminSettingCtrl"}),$routeProvider.when("/administration/log",{templateUrl:"partials/admin/view/log.html?v=1520701519774",controller:"AdminLogCtrl"}),$routeProvider.when("/administration/database",{templateUrl:"partials/admin/view/database.html?v=1520701519774",controller:"AdminDatabaseCtrl"}),$routeProvider.when("/administration/reviews",{templateUrl:"partials/admin/view/reviews.html?v=1520701519774",controller:"AdminReviewsCtrl"}),$routeProvider.when("/administration/projects",{templateUrl:"partials/admin/view/projects.html?v=1520701519774",controller:"AdminProjectsCtrl"}),$routeProvider.when("/administration/project/:id/edit",{templateUrl:"partials/admin/edit/project.html?v=1520701519774",controller:"AdminProjectCtrl"}),$routeProvider.otherwise({redirectTo:"/"})}).run(["$rootScope","$injector","sessionService",function($rootScope,$injector,sessionService){$injector.get("$http").defaults.transformRequest=function(data,headersGetter){var _t=sessionService.getToken();return _t&&(headersGetter()["Synergy-Authorization"]=_t),data},$rootScope.$on("handleEmit",function(event,args){$rootScope.$broadcast("handleBroadcast",args)})}]),angular.module("synergy.core",["synergy.handlers"]).factory("SynergyCore",["SynergyHandlers",function(SynergyHandlers){var _appCore=null;return{init:function(){if(null!==_appCore)throw new Error("Application already initialized");return _appCore=new function(SynergyHandlers){var synergy=this;this.version="1.0.10",this.hostname=window.location.hostname,this.baseURL=this.hostname+"/synergy",this.bugtrackingSystems={},this.issues=new function(){this.singleIssueLink=function(project,issue,includeText){return synergy.bugtrackingSystems.hasOwnProperty(project)&&"function"==typeof synergy.bugtrackingSystems[project].getDisplayLink?synergy.bugtrackingSystems[project].getDisplayLink(issue,includeText):""},this.viewLinkObjects=function(project,issues,includeText){if(issues instanceof Array)return this.viewLink(project,issues);var _all=[];for(var i in issues)issues.hasOwnProperty(i)&&_all.push(issues[i]);return this.viewLink(project,_all,includeText)},this.viewLink=function(project,issues,includeText){return synergy.bugtrackingSystems.hasOwnProperty(project)&&"function"==typeof synergy.bugtrackingSystems[project].getMultiDisplayLink?synergy.bugtrackingSystems[project].getMultiDisplayLink(issues,includeText):""},this.reportLink=function(project,product,component,version,summary,caseId,suiteId){return synergy.bugtrackingSystems.hasOwnProperty(project)&&"function"==typeof synergy.bugtrackingSystems[project].getReportLink?synergy.bugtrackingSystems[project].getReportLink(product,component,version,summary,caseId,suiteId):""}},this.assignmentPage=20,this.commentsPage=30,this.adminRoles=["admin","manager"],this.publisher=new SynergyHandlers.SynergyObserver,this.logger=new SynergyHandlers.SynergyLogger,this.httpTimeout=6e4,this.product="NetBeans",this.trackCaseDuration=!0,this.defaultCookiesExpiration=432e5,this.uploadFileLimit=2e7,this.modal={modal:"#myModal",modalBody:"#modal-body",modalHeader:"#myModalLabel",update:function(header,body){$(this.modalHeader).text(header),$(this.modalBody).text(body)},show:function(){$(this.modal).modal("toggle")}},this.server=new SynergyHandlers.SynergyServer({db:"../../server/api/db.php",specifications:"../../server/api/specifications.php",specification:"../../server/api/specification.php",session:"../../server/api/login.php",assignment:"../../server/api/assignment.php",assignments:"../../server/api/assignments.php",assignment_bugs:"../../server/api/assignment_bugs.php",tribe_assignments:"../../server/api/tribe_assignments.php",attachment:"../../server/api/attachment.php",attachments:"../../server/api/attachments.php",run_attachment:"../../server/api/run_attachment.php",favorites:"../../server/api/favorites.php",favorite:"../../server/api/favorite.php",suite:"../../server/api/suite.php",case:"../../server/api/case.php",cases:"../../server/api/cases.php",job:"../../server/api/job.php",label:"../../server/api/label.php",labels:"../../server/api/labels.php",log:"../../server/api/log.php",user:"../../server/api/user.php",profile_img:"../../server/api/profile_img.php",users:"../../server/api/users.php",tribe:"../../server/api/tribe.php",tribe_specification:"../../server/api/tribe_specification.php",tribes:"../../server/api/tribes.php",versions:"../../server/api/versions.php",version:"../../server/api/version.php",platform:"../../server/api/platform.php",platforms:"../../server/api/platforms.php",runs:"../../server/api/runs.php",image:"../../server/api/image.php",images:"../../server/api/images.php",issue:"../../server/api/issue.php",proxy:"../../server/api/proxy.php",run:"../../server/api/run.php",run_notifications:"../../server/api/run_notifications.php",events:"../../server/api/events.php",configuration:"../../server/api/configuration.php",about:"../../server/api/about.php",sanitizer:"../../server/api/sanitizer.php",search:"../../server/api/search.php",products:"../../server/api/products.php",revisions:"../../server/api/revisions.php",statistics:"../../server/api/statistics.php",statistics_archived:"../../server/data/test_runs/",statistics_fallback:"../../server/archive/test_runs_data/",statistics_filter:"../../server/api/statistics_filter.php",comments:"../../server/api/comments.php",assignment_comments:"../../server/api/assignment_comments.php",specification_request:"../../server/api/specification_request.php",versionLength:"../../server/api/specification_length.php",assignment_exists:"../../server/api/assignment_exists.php",review:"../../server/api/review.php",review_assignment:"../../server/api/review_assignment.php",reviews:"../../server/api/reviews.php",projects:"../../server/api/projects.php",project:"../../server/api/project.php",register:"../../server/api/register.php",run_specifications:"../../server/api/run_specifications.php",run_tribes:"../../server/api/run_tribes.php",refresh:"../../server/api/refresh.php"}),this.session={isLoggedIn:!1,username:"",firstName:"",lastName:"",role:"",created:"",session_id:"",token:"",cookieIsValid:function(creationTime){return(new Date).getTime()-parseInt(creationTime,10)<synergy.defaultCookiesExpiration},hideLoginForm:function(){$("#synergy_login_form").css("display","none"),$("#synergy_login_form_log").css("display","none")},clearSession:function(){synergy.session.isLoggedIn=!1,synergy.session.username="",synergy.session.lastName="",synergy.session.firstName="",synergy.session.role="",synergy.session.created=-1,synergy.session.session_id="",synergy.session.token="",synergy.session.showLoginForm(),synergy.session.hideUserMenu()},setSession:function(data){synergy.session.hideLoginForm(),synergy.session.showUserMenu(data.username),synergy.session.isLoggedIn=!0,synergy.session.username=data.username,synergy.session.lastName=data.lastName,synergy.session.firstName=data.firstName,synergy.session.role=data.role,synergy.session.session_id=data.session_id,synergy.session.token=data.session_id,synergy.session.created=data.created},showUserMenu:function(username){$("#usermenu_user").html(username+'&nbsp;<b class="caret" id="userCaret"></b>'),$("#synergy_usermenu").css("display","block")},showLoginForm:function(){$("#synergy_login_form").css("display","block")},hideUserMenu:function(){$("#synergy_usermenu").css("display","none")},hasAdminRights:function(){return void 0!==synergy.session&&void 0!==synergy.session.role&&-1<synergy.adminRoles.indexOf(synergy.session.role)},createUserMenu:function(){$("#synergy_session").append('<ul class="nav pull-right"><li class="dropdown"><a href="#" class="dropdown-toggle btn-primary" data-toggle="dropdown" style="color: white">'+synergy.session.username+' <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="#favorites">Favorites</a></li><li><span ng-click="logout();">Logout</span></li></ul></li></ul>')}},this.util={toIndexedArray:function(data){var _a=[];for(var i in data)data.hasOwnProperty(i)&&_a.push(data[i]);return _a},setCookie:function(name,value){var date=new Date;date.setTime(date.getTime()+synergy.defaultCookiesExpiration);var expires="; expires="+date.toGMTString();window.document.cookie=name+"="+value+expires+"; path=/"},scrollTo:function(elementID){for(var positionX=0,positionY=0,navbar=window.document.getElementById("navbar-top"),element=window.document.getElementById(elementID);null!==element;)positionX+=element.offsetLeft,positionY+=element.offsetTop,element=element.offsetParent;window.scrollTo(positionX,positionY-navbar.offsetHeight)},getCookie:function(name){name+="=";for(var ca=window.document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(name))return c.substring(name.length,c.length)}},deleteCookie:function(name){window.document.cookie=name+"=;; path=/"},encodeHTML:function(){var pre=$("pre");pre.html($("<div/>").text(pre.html).html())}},this.cache={put:function(key,value){if(window.localStorage){window.localStorage.removeItem(key);try{window.localStorage.setItem(key,JSON.stringify(value))}catch(e){22!==e.code&&21!==e.code&&20!==e.code||(this.drop(),window.localStorage.setItem(key,JSON.stringify(value)))}}},drop:function(){for(var i=0,max=window.localStorage.length;i<max;i++)window.localStorage.removeItem(window.localStorage.key(0))},clear:function(key){window.localStorage&&window.localStorage.removeItem(key)},get:function(key){return window.localStorage?JSON.parse(window.localStorage.getItem(key)):null}},this.ssoLoginUrl="https://netbeans.org/people/login?original_uri=",this.ssoLogoutUrl="https://netbeans.org/people/logout?original_uri=",this.getLoginRedirectUrl=function(loginUrl,redirectUrl){return(loginUrl+=encodeURI(redirectUrl))+"?revalidate=1"},this.getLogoutRedirectUrl=function(logoutUrl,redirectUrl){return(logoutUrl+=encodeURI(redirectUrl))+"?revalidate=1"},this.useSSO=!1}(SynergyHandlers)}}}]),function(){function SampleSubscriber($scope,data,event){}function SynergyCtrl($scope,$location,sessionHttp,$cookieStore,$timeout,ngProgress,$templateCache,searchHttp,projectsHttp,sessionService,SynergyApp,specificationCache,SynergyUtils,SynergyCore){function splitMergeBreadCrumbs(currentTitle,currentTitleIndex,breadCrumbs){var p1=breadCrumbs.slice(0,currentTitleIndex),p2=breadCrumbs.slice(currentTitleIndex+1);return p2.push(currentTitle),p1.concat(p2)}$scope.SYNERGY=SynergyCore.init(),SynergyApp.setApp($scope.SYNERGY),specificationCache.resetCurrentSpecification(),$scope.suggestions=[],$scope.SYNERGY.publisher.subscribe(function($scope,data,event){new SampleSubscriber($scope,data,event)},"specListLoaded"),$scope.location=$location,$scope.$on("$routeChangeStart",function(scope,next,current){$scope.SYNERGY.logger.print=!1}),$scope.username="",$scope.password="",$scope.searchedItem="",$scope.role="",$scope.cookieChecked=!1,$scope.isLoggedIn=!1,$scope.breadcrumbs=[],$scope.busyBrand="",$scope.showWaitDialog=function(){$scope.SYNERGY.modal.update("Processing data...","Please wait"),$scope.SYNERGY.modal.show()},$scope.toggleBusyBrand=function(){$scope.busyBrand=0<$scope.busyBrand.length?"":"brand_busy"},$scope.getLocalTime=function(dateString,useShortMonth){return SynergyUtils.UTCToLocal(dateString,useShortMonth)},$scope.getDate=function(dateString){return SynergyUtils.UTCToDate(dateString)},$scope.getLocalDateTime=function(dateString){return SynergyUtils.UTCToLocalDateTime(dateString)},$scope.getUTCTime=function(dateString){return SynergyUtils.localToUTC(dateString)},$scope.generalHttpFactoryError=function(data,status){$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error")},$scope.busyModeOn=function(){$scope.busyBrand="brand_busy",ngProgress.set(0),$timeout(function(){ngProgress.status()<90&&ngProgress.set(ngProgress.status()+Math.round(6*Math.random()+5))},50),window.document.body.style.cursor="wait"},$scope.$on("possibleTimeout",function(){$scope.SYNERGY.logger.error("Uknown response","Seems like timeout occurred, please try to reload page","DEBUG")}),$scope.$on("hideUserMenu",function(){$scope.SYNERGY.session.hideUserMenu()}),$scope.$on("refreshRole",function(){$scope.role=$scope.SYNERGY.session.role}),$scope.$on("busyMode",function(event,args){args?$scope.busyBrand="brand_busy":(window.document.body.style.cursor="default",$scope.busyBrand="",ngProgress.complete(100))}),$scope.init=function(callback){var _c=$cookieStore.get("session");if($scope.cookieChecked&&_c&&$scope.SYNERGY.session.cookieIsValid(_c.created)&&void 0!==_c.token){var session=_c;$scope.SYNERGY.session.hideLoginForm(),$scope.SYNERGY.session.showUserMenu(session.username),$scope.SYNERGY.session.isLoggedIn=!0,$scope.SYNERGY.session.username=session.username,$scope.SYNERGY.session.role=session.role,$scope.SYNERGY.session.lastName=session.hasOwnProperty("lastName")&&0<session.lastName.length?session.lastName:"",$scope.SYNERGY.session.firstName=session.hasOwnProperty("firstName")&&0<session.firstName.length?session.firstName:"",$scope.role=session.role,$scope.SYNERGY.session.session_id=session.session_id,$scope.SYNERGY.session.created=session.created,$scope.SYNERGY.session.token=session.session_id,sessionService.setSession($scope.SYNERGY.session),$timeout(callback,0)}else sessionHttp.infoConditional($scope,function(data){$scope.cookieChecked=!0,$scope.SYNERGY.session.hideLoginForm(),$scope.SYNERGY.session.showUserMenu(data.username),$scope.SYNERGY.session.isLoggedIn=!0,$scope.SYNERGY.session.username=data.username,$scope.SYNERGY.session.lastName=data.lastName,$scope.SYNERGY.session.firstName=data.firstName,$scope.SYNERGY.session.role=data.role,$scope.role=data.role,$scope.SYNERGY.session.session_id=data.session_id,$scope.SYNERGY.session.token=data.session_id,$scope.SYNERGY.session.created=data.created,sessionService.setSession($scope.SYNERGY.session),$cookieStore.put("session",{firstName:data.firstName,lastName:data.lastName,username:data.username,role:data.role,token:data.token,created:1e3*parseInt(data.created,10),session_id:data.session_id}),callback()},function(data){$cookieStore.remove("session"),sessionService.clearSession(),$scope.cookieChecked=!1,$scope.SYNERGY.session.hideUserMenu(),callback()})},$scope.login=function(){$scope.SYNERGY.useSSO?sessionHttp.get($scope,function(data){$scope.SYNERGY.session.isLoggedIn=!0,$scope.SYNERGY.session.username=data.username,$scope.SYNERGY.session.role=data.role,$scope.role=data.role,$scope.SYNERGY.session.lastName=data.lastName,$scope.SYNERGY.session.firstName=data.firstName,$scope.SYNERGY.session.created=1e3*parseInt(data.created,10),$scope.SYNERGY.session.session_id=data.session_id,$scope.SYNERGY.session.token=data.session_id,$scope.SYNERGY.session.hideLoginForm(),$scope.SYNERGY.session.showUserMenu(data.username),sessionService.setSession($scope.SYNERGY.session),$cookieStore.put("session",{username:data.username,role:data.role,token:data.token,created:1e3*parseInt(data.created,10),session_id:data.session_id}),window.location.reload()},function(data,status){switch($scope.SYNERGY.logger.log("Action failed",data+":"+status,"DEBUG","alert-error"),sessionService.clearSession(),status=parseInt(status,10)){case 307:window.location.href=$scope.SYNERGY.getLoginRedirectUrl($scope.SYNERGY.ssoLoginUrl,window.location.href);break;case 400:$scope.SYNERGY.logger.log("Login failed",data,"INFO","alert-error");break;default:$scope.SYNERGY.logger.log("Login failed","Incorrect credentials, please try again ","INFO","alert-error")}}):$location.path("login")},$scope.logout=function(){$cookieStore.remove("session"),$scope.SYNERGY.session.clearSession(),$scope.role="",sessionService.clearSession(),sessionHttp.logout($scope,function(data){$scope.SYNERGY.useSSO?window.location.href=$scope.SYNERGY.getLogoutRedirectUrl($scope.SYNERGY.ssoLogoutUrl,window.location.href):window.location.reload()},function(data){$scope.SYNERGY.logger.log("Logout failed",data.toString(),"INFO","alert-error")})},$scope.$on("updateNavbar",function(event,args){try{$("ul#navbar li").each(function(){"active"===$(this).attr("class")&&$(this).attr("class","")})}catch(e){}try{$("ul#navbar li#"+args.item).attr("class","active")}catch(e){}}),$scope.$on("updateBreadcrumbs",function(event,args){var i=0;if(5===$scope.breadcrumbs.length){for(i=0;i<5;i++)if(void 0!==$scope.breadcrumbs[i]&&$scope.breadcrumbs[i].title===args.title)return void($scope.breadcrumbs=splitMergeBreadCrumbs(args,i,$scope.breadcrumbs));for(i=0;i<4;i++)$scope.breadcrumbs[i]=$scope.breadcrumbs[i+1];$scope.breadcrumbs[4]=args}else{for(i=0;i<4;i++)if(void 0!==$scope.breadcrumbs[i]&&$scope.breadcrumbs[i].title===args.title)return void($scope.breadcrumbs=splitMergeBreadCrumbs(args,i,$scope.breadcrumbs));void 0!==$scope.breadcrumbs[$scope.breadcrumbs.length]||void 0!==$scope.breadcrumbs[$scope.breadcrumbs.length-1]&&$scope.breadcrumbs[$scope.breadcrumbs.length-1].title===args.title||($scope.breadcrumbs[$scope.breadcrumbs.length]=args)}}),$scope.synergySearch=function(){$location.path("search/"+$scope.searchedItem)},$scope.goToSearch=function(suggestedItem){$location.path(suggestedItem.link)},$scope.searchAhead=function(){$scope.searchedItem.length<2||searchHttp.getFewSpecifications($scope,$scope.searchedItem,function(data){for(var a=[],i=0,max=data.length;i<max;i++)null===data[i].project||data[i].project.length<1?a.push({title:data[i].title+" ("+$scope.SYNERGY.product+" "+data[i].version+")",link:data[i].type+"/"+data[i].id}):a.push({title:data[i].title+" ("+data[i].project+" "+data[i].version+")",link:data[i].type+"/"+data[i].id});$scope.suggestions=a},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.encodeURIComponent=function(s){return encodeURIComponent(s)},projectsHttp.getAll($scope,function(data){for(var i=0,max=data.length;i<max;i++)if(null!==data[i].reportLink||null!==data[i].viewLink){var fnca,fncb,fncc;try{fnca=eval("(function(){ var a="+data[i].viewLink+"; return a;})(); ")}catch(e){fnca=null}try{fncb=eval("(function(){ var a="+data[i].multiViewLink+"; return a;})(); ")}catch(e){fncb=null}try{fncc=eval("(function(){ var a="+data[i].reportLink+"; return a;})(); ")}catch(e){fncc=null}$scope.SYNERGY.bugtrackingSystems[data[i].name]={getDisplayLink:fnca,getMultiDisplayLink:fncb,getReportLink:fncc}}},function(){})}function SearchCtrl($scope,$routeParams,searchHttp){$scope.searched=$routeParams.search,$scope.results=[],$scope.escapedSearched=decodeURIComponent($scope.searched),$scope.fetch=function(){searchHttp.get($scope,$scope.searched,function(data){$scope.results=data},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.printResult=function(item){switch(item.type){case"specification":return'<a href="#specification/'+item.id+'">'+item.title+" ("+$scope.SYNERGY.product+" "+item.version+")</a>";case"suite":return'<a href="#suite/'+item.id+'">'+item.title+"</a>"}};var self=$scope;$scope.init(function(){self.fetch()})}function SpecPoolCtrl($scope,$routeParams,specificationsHttp,versionsHttp){$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.specs=[],$scope.version=$routeParams.id||null,$scope.versions=[],$scope.projects=[],$scope.orderProp="title",$scope.rights=0,$scope.isLoggedIn=void 0!==$scope.SYNERGY.session.session_id&&1<$scope.SYNERGY.session.session_id.length?1:0;var cache={};$scope.init(function(){$scope.isLoggedIn=void 0!==$scope.SYNERGY.session.session_id&&1<$scope.SYNERGY.session.session_id.length?1:0,void 0!==$scope.SYNERGY.session.session_id&&1<$scope.SYNERGY.session.session_id.length&&($scope.rights=1),versionsHttp.get($scope,!0,function(data){data.unshift({id:-1,name:"all"}),$scope.versions=data,$scope.version=$scope.version||data[0].name,specificationsHttp.get($scope,$scope.version,function(data){for(var _projects=[],i=0,imax=data.length;i<imax;i++)0<data[i].projects.length?(data[i]._project=data[i].projects[0].name,_projects.indexOf(data[i].projects[0].name)<0&&_projects.push(data[i].projects[0].name)):(data[i]._project=$scope.SYNERGY.product,data[i].projects=[{name:$scope.SYNERGY.product,id:-2}],_projects.indexOf($scope.SYNERGY.product)<0&&_projects.push($scope.SYNERGY.product));_projects.push("All"),$scope.projects=_projects,cache[$scope.version+"projects"]=_projects,$scope.specs=data,cache[$scope.version]=data,$scope.$emit("updateBreadcrumbs",{link:"specifications",title:"Test Specifications"})},function(data,status){404!==parseInt(status,10)?$scope.SYNERGY.logger.log("Action failed",data.toString(),"INFO","alert-error"):$scope.SYNERGY.logger.log("","No results","INFO")})},$scope.generalHttpFactoryError)}),$scope.filter=function(){if(cache.hasOwnProperty($scope.version))return $scope.specs=cache[$scope.version],void($scope.projects=cache[$scope.version+"projects"]);specificationsHttp.get($scope,$scope.version,function(data){for(var _projects=[],i=0,imax=data.length;i<imax;i++)data[i].ext.hasOwnProperty("projects")&&0<data[i].ext.projects.length?(data[i]._project=data[i].ext.projects[0].name,_projects.indexOf(data[i].ext.projects[0].name)<0&&_projects.push(data[i].ext.projects[0].name)):(data[i]._project=$scope.SYNERGY.product,_projects.indexOf($scope.SYNERGY.product)<0&&_projects.push($scope.SYNERGY.product));_projects.push("All"),$scope.projects=_projects,$scope.specs=data,cache[$scope.version]=data,cache[$scope.version+"projects"]=_projects,$scope.$emit("updateBreadcrumbs",{link:"specifications",title:"Test Specifications"})},function(data,status){404!==parseInt(status,10)?$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"):$scope.SYNERGY.logger.log("","No results","INFO")})}}function HomeCtrl($scope,specificationsHttp,runsHttp,calendarHttp){$scope.runs={testRuns:[]},$scope.specs=[],$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.fetch=function(){runsHttp.getLatest($scope,7,function(data){void 0!==data.testRuns&&(data.testRuns.forEach(function(trun){null!==trun.projectName&&""!==trun.projectName||(trun.projectName=$scope.SYNERGY.product)}),$scope.runs=data)},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}),specificationsHttp.latest($scope,function(result){$scope.specs=result,$scope.SYNERGY.publisher.publish(1,$scope,"specListLoaded")},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})};var self=$scope;$scope.init(function(){self.fetch(),calendarHttp.getEvents($scope,function(data){for(var items=[],i=0,max=data.length;i<max;i+=1)items.push({url:"#/run/"+data[i].id,title:data[i].title,start:new Date(data[i].start.substr(0,4),parseInt(data[i].start.substr(4,2),10)-1,data[i].start.substr(6,2)),end:new Date(data[i].end.substr(0,4),parseInt(data[i].end.substr(4,2),10)-1,data[i].end.substr(6,2))});$("#cal").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},editable:!0,events:items,eventMouseover:function(event,jsEvent,view){"agendaDay"!==view.name&&$(jsEvent.target).attr("title",event.title)}})},function(){window.console.log("Failed to load calendar events")})})}function RunCtrl($scope,utils,$location,$routeParams,runHttp,assignmentHttp,attachmentHttp,reviewHttp,SynergyUtils,SynergyHandlers,SynergyIssue){$scope.$emit("updateNavbar",{item:"nav_runs"}),$scope.$emit("updateBreadcrumbs",{link:"runs",title:"Test Runs"}),$scope.id=$routeParams.id||-1,$scope.run={},$scope.rights=0;var currentActionId=-1,currentAction="";$scope.username=$scope.SYNERGY.session.username||"",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("run_attachment",{}),$scope.isLoading=!1,$scope.tribes=[];var leaderIsRemoving=!1;$scope.explainModal="",$scope.filter={assignee:"All",specification:"All",platform:"All",tribe:"All"};var issueCollector=new SynergyIssue.RunIssuesCollector;$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.specifications=[],$scope.assignees=[],$scope.project={name:"",id:-1},$scope.pageSize=$scope.SYNERGY.assignmentPage;var _coverage={};$scope.coverage={},$scope.sortConfig={property:["id"],descending:[!1]},$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1},platform:{desc:!1,asc:!1}},$scope.testRunIsAvailable=!1,$scope.pageReviewsExpanded=!1,$scope.fetch=function(){[],$scope.run={},issueCollector=new SynergyIssue.RunIssuesCollector,$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.specifications=[],$scope.assignees=[],$scope.project={name:"",id:-1},_coverage={},$scope.coverage={},$scope.username=$scope.SYNERGY.session.username||"",runHttp.get($scope,$scope.id,function(data){var testRun,start,stop,today;!function(data){null!==data.projectName?$scope.project={name:data.projectName,id:data.projectId}:$scope.project={name:$scope.SYNERGY.product,id:-2}}(data),function(run){var result={failed:0,passed:0,skipped:0};if(SynergyUtils.definedNotNull(run)&&SynergyUtils.definedNotNull(run.assignments)){for(var i=0,max=run.assignments.length;i<max;i++)_coverage[run.assignments[i].platform]||(_coverage[run.assignments[i].platform]={total:0,completed:0,name:run.assignments[i].platform}),issueCollector.addIssues(run.assignments[i].issues),_coverage[run.assignments[i].platform].total+=parseInt(run.assignments[i].total,10),_coverage[run.assignments[i].platform].completed+=parseInt(run.assignments[i].completed,10),result.failed+=Math.floor(run.assignments[i].failed),result.passed+=Math.floor(run.assignments[i].passed),result.skipped+=Math.floor(run.assignments[i].skipped);var t=(result.failed+result.passed+result.skipped)/100;if(0<t){var f=Math.floor(10*result.failed/t)/10,p=Math.round(10*result.passed/t)/10;SynergyUtils.ProgressChart([p,f,Math.round(10*(100-(f+p)))/10],["#62c462","#ee5f5b","#c67605"],["passed","failed","skipped"],"canvas1")}}for(var j in _coverage)_coverage.hasOwnProperty(j)&&(_coverage[j].progress=Math.round(_coverage[j].completed/_coverage[j].total*1e3)/10);$scope.coverage=_coverage,SynergyUtils.ProgressChart([issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100),100-issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100)],["#ccc","#62c462"],["Unresolved","Resolved"],"issuesResolution"),SynergyUtils.ProgressChart([issueCollector.issuesStats.P1/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P2/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P3/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P4/(issueCollector.issuesStats.total/100)],["#ee5f5b","#f89406","#fbeed5","#ccc"],["P1 ("+issueCollector.issuesStats.P1+")","P2 ("+issueCollector.issuesStats.P2+")","P3 ("+issueCollector.issuesStats.P3+")","P4 ("+issueCollector.issuesStats.P4+")"],"issuesPriority"),$scope.allIssues=issueCollector.issues,$scope.unresolvedIssues=issueCollector.issuesStats.unresolvedIssues,$scope.P1Issues=issueCollector.issuesStats.P1Issues,$scope.P2Issues=issueCollector.issuesStats.P2Issues,$scope.P3Issues=issueCollector.issuesStats.P3Issues}(data),testRun=data,start=$scope.getDate(testRun.start),stop=$scope.getDate(testRun.end),today=new Date,$scope.testRunIsAvailable=start<=today&&today<=stop,function(data){for(var assignees=[],platforms=[],specifications=[],tribes=[],i=0,max=data.assignments.length;i<max;i++){assignees.indexOf(data.assignments[i].userDisplayName)<0&&assignees.push(data.assignments[i].userDisplayName),specifications.indexOf(data.assignments[i].specification)<0&&specifications.push(data.assignments[i].specification),platforms.indexOf(data.assignments[i].platform)<0&&platforms.push(data.assignments[i].platform);for(var j=0,max2=data.assignments[i].tribes.length;j<max2;j++)tribes.indexOf(data.assignments[i].tribes[j])<0&&tribes.push(data.assignments[i].tribes[j])}assignees.push("All"),assignees.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),specifications.push("All"),specifications.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),tribes.push("All"),tribes.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),platforms.push("All"),platforms.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),$scope.assignees=assignees,$scope.platforms=platforms,$scope.specifications=specifications,$scope.tribes=tribes}($scope.run=data),$scope.$emit("updateBreadcrumbs",{link:"run/"+$scope.id+"/v/1",title:$scope.run.title}),SynergyUtils.ProgressChart([data.completed/data.total*100,100-data.completed/data.total*100],["#08c","#ccc"],["completed",""],"canvas2");try{0<data.controls.length&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError)},$scope.toggleReivewSection=function(){$scope.pageReviewsExpanded=!$scope.pageReviewsExpanded,$("#pageReviews").collapse("toggle")},$scope.assignessFilter=function(assignmentRecord){return(!$scope.filter.assignee||"All"===$scope.filter.assignee||assignmentRecord.userDisplayName===$scope.filter.assignee)&&((!$scope.filter.specification||"All"===$scope.filter.specification||assignmentRecord.specification===$scope.filter.specification)&&((!$scope.filter.platform||"All"===$scope.filter.platform||assignmentRecord.platform===$scope.filter.platform)&&!($scope.filter.tribe&&"All"!==$scope.filter.tribe&&assignmentRecord.tribes.indexOf($scope.filter.tribe)<0)))},$scope.createCoverageChart=function(c){try{SynergyUtils.ProgressChart([c.progress,100-c.progress],["#08c","#ccc"],["finished",""],"coverage"+c.name)}catch(e){}},$scope.nextPage=function(){$scope.isLoading=!0,$scope.pageSize+=$scope.SYNERGY.assignmentPage,$scope.isLoading=!1},$scope.changeSorting=function(prop,order){var _p=prop;if(prop=order?prop:"-"+prop,-1<$scope.sortConfig.property.indexOf(_p)||-1<$scope.sortConfig.property.indexOf("-"+_p)){var i=$scope.sortConfig.property.indexOf(_p);if(i<0&&(i=$scope.sortConfig.property.indexOf("-"+_p)),$scope.sortConfig.descending[i]===order)$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(i,1),$scope.orderingProperties[_p].desc=!1,$scope.orderingProperties[_p].asc=!1,0===$scope.sortConfig.property.length&&($scope.sortConfig={property:["id"],descending:[!1]},$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1},platform:{desc:!1,asc:!1}});else{$scope.orderingProperties[_p].desc=!$scope.orderingProperties[_p].desc,$scope.orderingProperties[_p].asc=!$scope.orderingProperties[_p].asc;var _orig={descending:!$scope.sortConfig.descending[i],property:$scope.sortConfig.property[i]};$scope.sortConfig.descending.splice(i,1),$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(0,0,_orig.descending),0===_orig.property.indexOf("-")?$scope.sortConfig.property.splice(0,0,_orig.property.substring(1,_orig.property.length)):$scope.sortConfig.property.splice(0,0,"-"+_orig.property)}}else 1===$scope.sortConfig.property.length&&"id"===$scope.sortConfig.property[0]?$scope.sortConfig={property:[prop],descending:[order]}:($scope.sortConfig.property.splice(0,0,prop),$scope.sortConfig.descending.splice(0,0,order)),$scope.orderingProperties[_p].desc=!order,$scope.orderingProperties[_p].asc=order},$scope.bugs=[],$scope.bugsAssignmentId=-1,$scope.alterBugs=function(assignment){$scope.bugsAssignmentId=assignment.id;for(var a=[],i=0,max=assignment.issues.length;i<max;i++)a.push({id:assignment.issues[i].bugId,stillValid:!0,changeCount:!1});$scope.bugs=a,$("#ticketsModal").modal("toggle")},$scope.performAlterBugs=function(){for(var newIssues=[],countDiff=0,i=0,max=$scope.bugs.length;i<max;i++)$scope.bugs[i].stillValid?newIssues.push($scope.bugs[i].id):$scope.bugs[i].changeCount&&countDiff++;assignmentHttp.alterBugs($scope,$scope.bugsAssignmentId,{issues:newIssues.join(";"),diffCount:countDiff},function(){$scope.SYNERGY.logger.log("Done","Issues updated","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError),$("#ticketsModal").modal("toggle")},$scope.startAssignment=function(mode,assignmentId){2===parseInt(mode,10)?($("#deleteModalLabel").text("Restart assignment?"),$("#deleteModalBody").html("<p>Do you really want to restart this assignment? All saved progress will be lost as if you never started it. If you want to Continue saved assignment, please use 'Play' button instead</p>"),$("#deleteModal").modal("toggle"),currentAction="restartAssignment",currentActionId=assignmentId):$location.path("/assignment/"+assignmentId+"/v/"+mode)},$scope.startReviewAssignment=function(mode,assignmentId){2===parseInt(mode,10)?($("#deleteModalLabel").text("Restart assignment?"),$("#deleteModalBody").html("<p>Do you really want to restart this assignment? All saved comments will be lost as if you never started it. If you want to Continue saved assignment, please use 'Play' button instead</p>"),$("#deleteModal").modal("toggle"),currentAction="restartReviewAssignment",currentActionId=assignmentId):$location.path("/review/"+assignmentId+"/continue")},$scope.performRun=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete test run?"),$("#deleteModalBody").html("<p>Do you really want to delete test run?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteRun";break;case"notify":$("#deleteModalLabel").text("Send notifications?"),$("#deleteModalBody").html("<p>Do you really want to send email notifications to testers with incomplete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="notify";break;case"freeze":var target=$scope.run.isActive?0:1;runHttp.freezeRun($scope,$scope.id,target,function(data){$scope.run.isActive=target,$scope.SYNERGY.logger.log("Done","Test run "+(1===target?"unfrozen":"frozen"),"INFO","alert-success")},$scope.generalHttpFactoryError);break;default:$location.path("/administration/run/"+$scope.id+"/"+action)}},$scope.performAssignment=function(action,id,createdBy){if("delete"!==action)$location.path("suite/"+id+"/"+action);else switch(action){case"delete":currentAction="deleteAssignment",currentActionId=id,leaderIsRemoving=3===createdBy,$("#deleteModalLabel").text("Delete test assignment?"),$("#deleteModalBody").html("<p>Do you really want to delete test assignment?</p>"),$("#deleteModal").modal("toggle")}},$scope.performReviewAssignment=function(action,id,createdBy){switch(action){case"delete":currentAction="deleteReviewAssignment",currentActionId=id,leaderIsRemoving=3===createdBy,$("#deleteModalLabel").text("Delete review assignment?"),$("#deleteModalBody").html("<p>Do you really want to delete review assignment?</p>"),$("#deleteModal").modal("toggle");break;default:$location.path("/review/"+id+"/"+action)}},$scope.deleteAssignment=function(){if(leaderIsRemoving){if($("#explainModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||$scope.explanation.length<1)return;assignmentHttp.removeByLeader($scope,currentActionId,$scope.explanation,function(data){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}else{if(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;assignmentHttp.remove($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}},$scope.performAction=function(){switch(currentAction){case"restartAssignment":$("#deleteModal").modal("toggle"),$location.path("/assignment/"+currentActionId+"/v/2");break;case"restartReviewAssignment":$("#deleteModal").modal("toggle"),$location.path("/review/"+currentActionId+"/restart");break;case"deleteAssignment":$("#deleteModal").modal("toggle"),leaderIsRemoving?$("#explainModal").modal("toggle"):$scope.deleteAssignment();break;case"deleteReviewAssignment":$("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||reviewHttp.remove($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError);break;case"notify":$("#deleteModal").modal("toggle"),runHttp.sendNotifications($scope,$scope.id,function(data){$scope.SYNERGY.logger.log("Done",data,"INFO","alert-success")},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")});break;case"deleteRun":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;runHttp.remove($scope,$scope.id,function(data){$scope.SYNERGY.modal.update("Test run removed",""),$scope.SYNERGY.modal.show(),$location.path("/runs")},function(data){$scope.SYNERGY.modal.update("Action failed",""),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.SYNERGY.modal.show()});break;case"deleteAttachment":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;attachmentHttp.removeRunAttachment($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success"),$scope.fetch()},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}};var self=$scope;$scope.init(function(){self.fetch()}),new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)})}function RunCtrlCase($scope,utils,$location,$routeParams,runHttp,SynergyUtils,SynergyHandlers,SynergyIssue){$scope.$emit("updateNavbar",{item:"nav_runs"}),$scope.id=$routeParams.id||-1,$scope.run={},$scope.project={name:"",id:-1},$scope.isLoading=!1,$scope.testRunIsAvailable=!1,$scope.specs=[],$scope.overview={totalTc:0,pRate:0,testers:0,duration:"",time:""},$scope.labels=[],$scope.selectedLabels=[],$scope.resultFilter={passed:!0,failed:!0,skipped:!0,passed_with_issues:!0};var allExpanded=!1;$scope.fetch=function(){$scope.project={name:"",id:-1},$scope.isLoading=!0,$scope.run={},runHttp.getBlobs($scope,$scope.id,function(data){(function(data){null!==data.projectName?$scope.project={name:data.projectName,id:data.projectId}:$scope.project={name:$scope.SYNERGY.product,id:-2}})($scope.run=data),$scope.$emit("updateBreadcrumbs",{link:"run/"+$scope.id+"/v/3",title:$scope.run.title}),$scope.isLoading=!1,function(){var _currentSuite,_currentSpec,arrObj={},knownSpecs=[],totalTc=0,passedTc=0,failedTc=0,totalMins=0;$scope.run.durations.forEach(function(x){totalMins+=x.duration});var passedWithIssues=0,_users=[],_allLabels=[];$scope.run.blobs.forEach(function(blob){_users.indexOf(blob.user)<0&&_users.push(blob.user),0<blob.label.length&&_allLabels.indexOf(blob.label)<0&&_allLabels.push(blob.label),knownSpecs.indexOf(blob.specification.id)<0&&(knownSpecs.push(blob.specification.id),arrObj["_"+blob.specification.id]={name:blob.specification.name,id:blob.specification.id,expanded:!1,label:blob.label,version:blob.specification.version,suites:{}}),_currentSpec=arrObj["_"+blob.specification.id],blob.specification.suites.forEach(function(suite){_currentSpec.suites.hasOwnProperty("_"+suite.id)||(_currentSpec.suites["_"+suite.id]={name:suite.name,id:suite.id,expanded:!1,testCases:{}}),_currentSuite=_currentSpec.suites["_"+suite.id],suite.testCases.forEach(function(tc){if(_currentSuite.testCases.hasOwnProperty("_"+tc.id)||(_currentSuite.testCases["_"+tc.id]={name:tc.name,id:tc.id,results:[]}),1===tc.finished){totalTc++;var _s=function(tc){return"passed"===tc.result&&0<tc.issues.length?"passed with issues":tc.result}(tc);"passed"===_s?passedTc++:"passed with issues"===_s?(passedTc++,passedWithIssues++):"failed"===_s?failedTc++:"skipped"===_s&&0,_currentSuite.testCases["_"+tc.id].results.push({result:_s,visible:!0,issuesLbl:1<tc.issues.length?"issues":0===tc.issues.length?"":tc.issues[0],link:"#/case/"+tc.id+"/suite/"+suite.id,resultClass:_s.replace(/\s/g,"_"),platform:blob.platform,user:blob.user,issues:0<tc.issues.length?tc.issues:[]})}})})});var _x,_y,_suites,_cases,arr=[];for(var k in arrObj)if(arrObj.hasOwnProperty(k)){for(var l in _x=arrObj[k],_suites=[],_x.suites)if(_x.suites.hasOwnProperty(l)){for(var m in _y=_x.suites[l],_cases=[],_y.testCases)_y.testCases.hasOwnProperty(m)&&_cases.push(_y.testCases[m]);_y.testCases=_cases,_suites.push(_y)}_x.suites=_suites,arr.push(_x)}var _pRateRound=Math.round(1e3*passedTc/totalTc)/10,_fRateRound=Math.round(1e3*failedTc/totalTc)/10,_pRateRound2=Math.round(1e3*passedWithIssues/totalTc)/10,_sRateRound=Math.round(10*(100-_pRateRound-_fRateRound-_pRateRound2))/10,start=$scope.getDate($scope.run.start),stop=$scope.getDate($scope.run.end);$scope.overview={totalTc:totalTc,pRate:_pRateRound+"% passed, "+_pRateRound2+"% passed with issues, "+_fRateRound+"% failed and "+_sRateRound+"% skipped",testers:_users.length,duration:function(duration){var seconds=Math.floor(duration/1e3),minutes=Math.floor(seconds/60),hours=Math.floor(minutes/60),days=Math.floor(hours/24),result="";0<days&&(result+=days+" days|");0<(hours-=24*days)&&(result+=hours+" hours|");0<(minutes=minutes-24*days*60-60*hours)&&(result+=minutes+" minutes|");0<(seconds=seconds-24*days*60*60-60*hours*60-60*minutes)&&(result+=seconds+" seconds|");0===(result=result.replace(/\|/g," ")).length&&(result="0 seconds");return result}(stop.getTime()-start.getTime()),time:59<totalMins?Math.floor(totalMins/60)+" hours and "+totalMins%60+" minutes":totalMins+" minutes"},$scope.specs=arr,$scope.labels=_allLabels}()},$scope.generalHttpFactoryError)},$scope.toggleExpand=function(item){item.expanded=!item.expanded,item.suites?$("#spec"+item.id).collapse("toggle"):$("#suite"+item.id).collapse("toggle")},$scope.toggleAll=function(){allExpanded?$(".collapse").collapse("hide"):$(".collapse").collapse("show"),allExpanded=!allExpanded},$scope.filter=function(){var _v;$scope.specs.forEach(function(spec){spec.suites.forEach(function(suite){suite.testCases.forEach(function(tcase){tcase.results.forEach(function(result){_v=(_v=function(result){return $scope.resultFilter[result.resultClass]}(result))&&(!(0<$scope.selectedLabels.length)||-1<$scope.selectedLabels.indexOf(spec.label)),result.visible=_v})})})})};var self=$scope;$scope.init(function(){self.fetch()})}function RunCtrlUser($scope,$location,$routeParams,runHttp,assignmentHttp,attachmentHttp,reviewHttp,SynergyUtils,SynergyHandlers,SynergyIssue){$scope.$emit("updateNavbar",{item:"nav_runs"}),$scope.id=$routeParams.id||-1,$scope.platforms=[],$scope.run={},$scope.rights=0;var leaderIsRemoving=!1;$scope.explainModal="";var currentActionId=-1,currentAction="";$scope.username=$scope.SYNERGY.session.username||"",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("run_attachment",{}),$scope.assignees=[],$scope.specifications=[],$scope.tribes=[],$scope.project={name:"",id:-1};var tribes=[];$scope.filter={assignee:"All",specification:"All",tribe:"All"},$scope.coverage=[];var _coverage=[];$scope.isLoading=!1,$scope.pageSize=$scope.SYNERGY.assignmentPage,$scope.sortConfig={property:["id"],descending:[!1]},$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1}},$scope.pageReviewsExpanded=!1,$scope.testRunIsAvailable=!1;var issueCollector=new SynergyIssue.RunIssuesCollector;function getLineForDupliciteAssignment(assignment){var line={assignments:[]};line.userDisplayName=assignment.userDisplayName,line.username=assignment.username,line.specificationId=assignment.specificationId,line.label=assignment.label,line.labelId=assignment.labelId,line.specification=assignment.specification,line.tribes=assignment.tribes,line.assignments[$scope.platforms.indexOf(assignment.platform)]=assignment;for(var p=0,maxp=$scope.platforms.length;p<maxp;p++)line.assignments[p]||(line.assignments[p]={_hidden:new Date});return line}function allIssuesResolved(issues){for(var result=!0,i=0,max=issues.length;i<max;i++)issueCollector.addIssue(issues[i]),"resolved"!==issues[i].status.toLowerCase()&&"closed"!==issues[i].status.toLowerCase()&&"verified"!==issues[i].status.toLowerCase()&&(result=!1);return result}function getTribes(assignment){for(var i=0,max=assignment.tribes.length;i<max;i++)tribes.indexOf(assignment.tribes[i])<0&&tribes.push(assignment.tribes[i])}$scope.fetch=function(){issueCollector=new SynergyIssue.RunIssuesCollector,$scope.P1Issues=[],tribes=[],_coverage=[],$scope.project={name:"",id:-1},$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.isLoading=!0,$scope.coverage=[],$scope.tribes=[],$scope.platforms=[],$scope.assignees=[],$scope.specifications=[],$scope.run={},$scope.username=$scope.SYNERGY.session.username||"",runHttp.getUserCentric($scope,$scope.id,function(data){var testRun,start,stop,today;testRun=data,start=$scope.getDate(testRun.start),stop=$scope.getDate(testRun.end),today=new Date,$scope.testRunIsAvailable=start<=today&&today<=stop,function(data){null!==data.projectName?$scope.project={name:data.projectName,id:data.projectId}:$scope.project={name:$scope.SYNERGY.product,id:-2}}($scope.run=data),$scope.$emit("updateBreadcrumbs",{link:"run/"+$scope.id+"/v/2",title:$scope.run.title}),function(){for(var username in $scope.run.assignments)if($scope.run.assignments.hasOwnProperty(username)){var user=$scope.run.assignments[username];for(var assignment in user.assignments)$scope.platforms.indexOf(user.assignments[assignment].platform)<0&&$scope.platforms.push(user.assignments[assignment].platform)}$scope.platforms.sort()}(),function(){var result={failed:0,passed:0,skipped:0},assignees=[],specs=[];tribes=[];var allResolved,duplicateAssignments=[],prettyAssignments=[];for(var username in $scope.run.assignments)if($scope.run.assignments.hasOwnProperty(username)){for(var user=$scope.run.assignments[username],line={assignments:[]},assign=0,maxAssign=user.assignments.length;assign<maxAssign;assign++){var assignment=user.assignments[assign];line.userDisplayName=assignment.userDisplayName,line.username=assignment.username,line.specificationId=assignment.specificationId,line.label=assignment.label,line.labelId=assignment.labelId,line.specification=assignment.specification,line.tribes=assignment.tribes,assignees.indexOf(line.userDisplayName)<0&&assignees.push(line.userDisplayName),specs.indexOf(line.specification)<0&&specs.push(line.specification),getTribes(assignment),assignment.total=parseInt(assignment.total,10),assignment.completed=parseInt(assignment.completed,10),assignment.failedColor="#62c462",allResolved=allIssuesResolved(assignment.issues),0<parseInt(assignment.failed,10)&&!allResolved&&(assignment.failedColor="#ee5f5b"),0<assignment.total?(assignment.progress=Math.round(1e3*assignment.completed/assignment.total)/10,assignment.progressLabel="Completed "+assignment.progress+"%"):(assignment.progressLabel="No cases to test",assignment.progress=100),assignment.info=allResolved&&100===assignment.progress&&0===parseInt(assignment.failed,10)?"finished":assignment.info;var _t=0<assignment.started.length?"Started: "+assignment.started:"";_t+=0<assignment.lastUpdated.length?"; Last updated: "+assignment.lastUpdated:"",assignment.tooltip=0<assignment.total?_t:"At the time of assignment creation, there were no matching cases. You can try to start this assignment to see if situation has changed",1===assignment.issues.length?assignment.issuesLink=0<assignment.issues.length?"<a style='color: "+assignment.failedColor+"; font-weight: bold' href='"+$scope.SYNERGY.issues.viewLink($scope.project.name,assignment.issues)+"'>"+assignment.issues.length+" issue</a>&nbsp;":"&nbsp;":1<assignment.issues.length&&(assignment.issuesLink=0<assignment.issues.length?"<a style='color: "+assignment.failedColor+"; font-weight: bold' href='"+$scope.SYNERGY.issues.viewLink($scope.project.name,assignment.issues)+"'>"+assignment.issues.length+" issues</a>&nbsp;":"&nbsp;"),void 0!==line.assignments[$scope.platforms.indexOf(assignment.platform)]?(line.assignments[$scope.platforms.indexOf(assignment.platform)].duplicates=!0,assignment.duplicates=!0,duplicateAssignments.push(assignment)):(assignment.duplicates=!1,line.assignments[$scope.platforms.indexOf(assignment.platform)]=assignment),_coverage[$scope.platforms.indexOf(assignment.platform)]||(_coverage[$scope.platforms.indexOf(assignment.platform)]={total:0,completed:0,name:assignment.platform}),_coverage[$scope.platforms.indexOf(assignment.platform)].total+=parseInt(assignment.total,10),_coverage[$scope.platforms.indexOf(assignment.platform)].completed+=parseInt(assignment.completed,10),result.failed+=Math.floor(assignment.failed),result.passed+=Math.floor(assignment.passed),result.skipped+=Math.floor(assignment.skipped)}for(var p=0,maxp=$scope.platforms.length;p<maxp;p++)line.assignments[p]||(line.assignments[p]={_hidden:new Date});prettyAssignments.push(line)}for(var dupl=0,maxa=duplicateAssignments.length;dupl<maxa;dupl++)prettyAssignments.push(getLineForDupliciteAssignment(duplicateAssignments[dupl]));assignees.push("All"),assignees.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),specs.push("All"),specs.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),tribes.push("All"),tribes.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),$scope.assignees=assignees,$scope.specifications=specs,$scope.tribes=tribes,function(result){var t=(result.failed+result.passed+result.skipped)/100;if(0<t){var f=Math.floor(10*result.failed/t)/10,p=Math.round(10*result.passed/t)/10;SynergyUtils.ProgressChart([p,f,Math.round(10*(100-(f+p)))/10],["#62c462","#ee5f5b","#c67605"],["passed","failed","skipped"],"canvas1")}for(var i=0,max=_coverage.length;i<max;i++)_coverage[i].progress=Math.round(_coverage[i].completed/_coverage[i].total*1e3)/10;$scope.coverage=_coverage}(result),$scope.prettyAssignments=prettyAssignments,SynergyUtils.ProgressChart([issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100),100-issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100)],["#ccc","#62c462"],["Unresolved","Resolved"],"issuesResolution"),SynergyUtils.ProgressChart([issueCollector.issuesStats.unknown/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P1/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P2/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P3/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P4/(issueCollector.issuesStats.total/100)],["#E8EBAB","#ee5f5b","#f89406","#fbeed5","#ccc"],["Unknown ("+issueCollector.issuesStats.unknown+")","P1 ("+issueCollector.issuesStats.P1+")","P2 ("+issueCollector.issuesStats.P2+")","P3 ("+issueCollector.issuesStats.P3+")","P4 ("+issueCollector.issuesStats.P4+")"],"issuesPriority"),$scope.allIssues=issueCollector.issues,$scope.unresolvedIssues=issueCollector.issuesStats.unresolvedIssues,$scope.P1Issues=issueCollector.issuesStats.P1Issues,$scope.P2Issues=issueCollector.issuesStats.P2Issues,$scope.P3Issues=issueCollector.issuesStats.P3Issues}(),SynergyUtils.ProgressChart([data.completed/data.total*100,100-data.completed/data.total*100],["#08c","#ccc"],["completed",""],"canvas2");try{0<data.controls.length&&($scope.rights=1)}catch(e){}$scope.isLoading=!1},$scope.generalHttpFactoryError)},$scope.toggleReivewSection=function(){$scope.pageReviewsExpanded=!$scope.pageReviewsExpanded,$("#pageReviews").collapse("toggle")},$scope.assignessFilter=function(assignmentRecord){return(!$scope.filter.assignee||"All"===$scope.filter.assignee||assignmentRecord.userDisplayName===$scope.filter.assignee)&&((!$scope.filter.specification||"All"===$scope.filter.specification||assignmentRecord.specification===$scope.filter.specification)&&!($scope.filter.tribe&&"All"!==$scope.filter.tribe&&assignmentRecord.tribes.indexOf($scope.filter.tribe)<0))},$scope.nextPage=function(){$scope.isLoading=!0,$scope.pageSize+=$scope.SYNERGY.assignmentPage,$scope.isLoading=!1},$scope.bugs=[],$scope.bugsAssignmentId=-1,$scope.alterBugs=function(assignment){$scope.bugsAssignmentId=assignment.id;for(var a=[],i=0,max=assignment.issues.length;i<max;i++)a.push({id:assignment.issues[i].bugId,stillValid:!0,changeCount:!1});$scope.bugs=a,$("#ticketsModal").modal("toggle")},$scope.performAlterBugs=function(){for(var newIssues=[],countDiff=0,i=0,max=$scope.bugs.length;i<max;i++)$scope.bugs[i].stillValid?newIssues.push($scope.bugs[i].id):$scope.bugs[i].changeCount&&countDiff++;assignmentHttp.alterBugs($scope,$scope.bugsAssignmentId,{issues:newIssues.join(";"),diffCount:countDiff},function(){$scope.SYNERGY.logger.log("Done","Issues updated","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError),$("#ticketsModal").modal("toggle")},$scope.changeSorting=function(prop,order){var _p=prop;if(prop=order?prop:"-"+prop,-1<$scope.sortConfig.property.indexOf(_p)||-1<$scope.sortConfig.property.indexOf("-"+_p)){var i=$scope.sortConfig.property.indexOf(_p);if(i<0&&(i=$scope.sortConfig.property.indexOf("-"+_p)),$scope.sortConfig.descending[i]===order)$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(i,1),$scope.orderingProperties[_p].desc=!1,$scope.orderingProperties[_p].asc=!1,0===$scope.sortConfig.property.length&&($scope.sortConfig={property:["id"],descending:[!1]},$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1}});else{$scope.orderingProperties[_p].desc=!$scope.orderingProperties[_p].desc,$scope.orderingProperties[_p].asc=!$scope.orderingProperties[_p].asc;var _orig={descending:!$scope.sortConfig.descending[i],property:$scope.sortConfig.property[i]};$scope.sortConfig.descending.splice(i,1),$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(0,0,_orig.descending),0===_orig.property.indexOf("-")?$scope.sortConfig.property.splice(0,0,_orig.property.substring(1,_orig.property.length)):$scope.sortConfig.property.splice(0,0,"-"+_orig.property)}}else 1===$scope.sortConfig.property.length&&"id"===$scope.sortConfig.property[0]?$scope.sortConfig={property:[prop],descending:[order]}:($scope.sortConfig.property.splice(0,0,prop),$scope.sortConfig.descending.splice(0,0,order)),$scope.orderingProperties[_p].desc=!order,$scope.orderingProperties[_p].asc=order},$scope.createCoverageChart=function(c){try{SynergyUtils.ProgressChart([c.progress,100-c.progress],["#08c","#ccc"],["finished",""],"coverage"+c.name)}catch(e){}},$scope.startAssignment=function(mode,assignmentId){2===parseInt(mode,10)?($("#deleteModalLabel").text("Restart assignment?"),$("#deleteModalBody").html("<p>Do you really want to restart this assignment? All saved progress will be lost as if you never started it. If you want to Continue saved assignment, please use 'Play' button instead</p>"),$("#deleteModal").modal("toggle"),currentAction="restartAssignment",currentActionId=assignmentId):$location.path("/assignment/"+assignmentId+"/v/"+mode)},$scope.performRun=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete test run?"),$("#deleteModalBody").html("<p>Do you really want to delete test run?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteRun";break;case"notify":$("#deleteModalLabel").text("Send notifications?"),$("#deleteModalBody").html("<p>Do you really want to send email notifications to testers with incomplete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="notify";break;case"freeze":var target=$scope.run.isActive?0:1;runHttp.freezeRun($scope,$scope.id,target,function(data){1===($scope.run.isActive=target)?$scope.SYNERGY.logger.log("Done","Test run unfrozen","INFO","alert-success"):$scope.SYNERGY.logger.log("Done","Test run frozen","INFO","alert-success")},$scope.generalHttpFactoryError);break;default:$location.path("/administration/run/"+$scope.id+"/"+action)}},$scope.performAttachment=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete attachment?"),$("#deleteModalBody").html("<p>Do you really want to delete attachment?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteAttachment",currentActionId=id}},$scope.forwardToCreateAssignment=function(){$location.path("/administration/assignment/create/run/"+$scope.id)},$scope.forwardToCreateMatrixAssignment=function(){$location.path("/administration/assignment/creatematrix/run/"+$scope.id)},$scope.performAssignment=function(action,id,createdBy){if("delete"!==action)$location.path("suite/"+id+"/"+action);else switch(action){case"delete":leaderIsRemoving=3===createdBy,$("#deleteModalLabel").text("Delete test assignment?"),$("#deleteModalBody").html("<p>Do you really want to delete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteAssignment",currentActionId=id}},$scope.deleteAssignment=function(){if(leaderIsRemoving){if($("#explainModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||$scope.explanation.length<1)return;assignmentHttp.removeByLeader($scope,currentActionId,$scope.explanation,function(data){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}else{if(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;assignmentHttp.remove($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}},$scope.startReviewAssignment=function(mode,assignmentId){2===parseInt(mode,10)?($("#deleteModalLabel").text("Restart assignment?"),$("#deleteModalBody").html("<p>Do you really want to restart this assignment? All saved comments will be lost as if you never started it. If you want to Continue saved assignment, please use 'Play' button instead</p>"),$("#deleteModal").modal("toggle"),currentAction="restartReviewAssignment",currentActionId=assignmentId):$location.path("/review/"+assignmentId+"/continue")},$scope.performReviewAssignment=function(action,id,createdBy){switch(action){case"delete":currentAction="deleteReviewAssignment",currentActionId=id,leaderIsRemoving=3===createdBy,$("#deleteModalLabel").text("Delete review assignment?"),$("#deleteModalBody").html("<p>Do you really want to delete review assignment?</p>"),$("#deleteModal").modal("toggle");break;default:$location.path("/review/"+id+"/"+action)}},$scope.performAction=function(){switch(currentAction){case"restartAssignment":$("#deleteModal").modal("toggle"),$location.path("/assignment/"+currentActionId+"/v/2");break;case"deleteAssignment":$("#deleteModal").modal("toggle"),leaderIsRemoving?$("#explainModal").modal("toggle"):$scope.deleteAssignment();break;case"restartReviewAssignment":$("#deleteModal").modal("toggle"),$location.path("/review/"+currentActionId+"/restart");break;case"deleteReviewAssignment":$("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||reviewHttp.remove($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError);break;case"notify":$("#deleteModal").modal("toggle"),runHttp.sendNotifications($scope,$scope.id,function(data){$scope.SYNERGY.logger.log("Done",data,"INFO","alert-success")},$scope.generalHttpFactoryError);break;case"deleteRun":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;runHttp.remove($scope,$scope.id,function(data){$scope.SYNERGY.modal.update("Test run removed",""),$scope.SYNERGY.modal.show(),$location.path("/runs")},function(data){$scope.SYNERGY.modal.update("Action failed",""),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.SYNERGY.modal.show()});break;case"deleteAttachment":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;attachmentHttp.removeRunAttachment($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success"),$scope.fetch()},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}};var self=$scope;$scope.init(function(){self.fetch()}),new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)})}function SpecificationCtrl($scope,utils,$location,$routeParams,versionsHttp,specificationHttp,suiteHttp,attachmentHttp,usersHttp,jobHttp,userHttp,sanitizerHttp,labelsHttp,projectsHttp,specificationCache,SynergyUtils,SynergyModels,SynergyHandlers){var self=this;$scope.project=null,$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.specification={},$scope.refreshCodemirror=!1,$scope.id=$routeParams.id||-1,$scope.rights=0,$scope.readOnlyJobs=[],$scope.users=[],$scope.filename="",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("attachment",{}),$scope.versions=[],$scope.version="",$scope.newLabel="",$scope.removeLabel="",self.simpleName=$routeParams.simpleName||"",self.simpleVersion=$routeParams.simpleVersion||"",self.originalSimpleName="",$scope.keepSimpleNameTrack=!0,$scope.filterLabel=$routeParams.label||"All",$scope.labels=[],$scope.realLabels=[],$scope.removalUsers="",$scope.requestMsg="",$scope.projects=[];var specificationDurationCache={},currentAction="",currentActionId=-1,currentSuiteId=-1;function displaySimpleSpecification(data){$scope.specification=data,$scope.newname=data.title,setProject(data),resolveContinuousJobs(data.ext.continuous_integration),getRemovalUsers(),$scope.$emit("updateBreadcrumbs",{link:"specification/"+$scope.id+"/v/1",title:data.title});try{0<data.controls.length&&($scope.rights=1)}catch(e){}}function setProject(data){data.hasOwnProperty("ext")&&data.ext.hasOwnProperty("projects")&&0<data.ext.projects.length?$scope.project=data.ext.projects[0]:$scope.project={name:$scope.SYNERGY.product,id:-2}}function getRemovalUsers(){for(var _l="",i=0,max=$scope.specification.ext.removalRequests.length;i<max;i++)_l+=$scope.specification.ext.removalRequests[i].username+", ";$scope.removalUsers=1===_l.length?"":_l.substr(0,_l.length-2)}function getLabels(data){for(var labels=[],realLabels=[],i=0,max=data.testSuites.length;i<max;i++)for(var j=0,max2=data.testSuites[i].testCases.length;j<max2;j++)for(var k=0,max3=data.testSuites[i].testCases[j].keywords.length;k<max3;k++)labels.indexOf(data.testSuites[i].testCases[j].keywords[k])<0&&(labels.push(data.testSuites[i].testCases[j].keywords[k]),realLabels.push(data.testSuites[i].testCases[j].keywords[k]));return labels.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),realLabels.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),$scope.realLabels=realLabels,0<$scope.realLabels.length&&($scope.removeLabel=$scope.realLabels[0]),labels.push("All"),labels}function resolveContinuousJobs(jobs){function doResolve(data){$scope.readOnlyJobs.push(data)}function logError(data){$scope.SYNERGY.logger.log("Failed to load data",data,"DEBUG","alert-error")}if($scope.readOnlyJobs=[],SynergyUtils.definedNotNull(jobs))for(var i=0,max=jobs.length;i<max;i++)jobHttp.resolve($scope,jobs[i],doResolve,logError)}$scope.fetch=function(useCache){if(0<self.simpleName.length)return self.simpleName=decodeURIComponent(decodeURIComponent(self.simpleName)),void specificationHttp.getFullAlias($scope,!1,self.simpleName,self.simpleVersion,function(data){$scope.specification=data,$scope.labels=getLabels(data),specificationDurationCache.All=data.estimation,setProject(data),specificationCache.setCurrentSpecification(data,$scope.project),$scope.newname=data.title,$scope.id=data.id,resolveContinuousJobs(data.ext.continuous_integration),$scope.$emit("updateBreadcrumbs",{link:"specification/"+data.id+"/v/2",title:data.title});try{0<data.controls.length&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);if(-1<window.location.href.indexOf("/title/"))$location.path("");else switch(function(){var url=window.location.href,stringId=$scope.id+"",_s=url.lastIndexOf("/"+$scope.id+"/")+stringId.length+2,_e=url.indexOf("/",_s),action=-1<_e?url.substring(_s,_e):url.substring(_s,url.length);if("v"===action)return-1<url.indexOf($scope.id+"/v/1")?"1":"2";return action}()){case"create":versionsHttp.get($scope,!0,function(data){$scope.versions=data,$scope.version=data[0].name||"",$scope.refreshCodemirror=!0},$scope.generalHttpFactoryError),projectsHttp.getAll($scope,function(data){$scope.projects=data,$scope.project=$scope.projects[0]},$scope.generalHttpFactoryError);break;case"1":if($scope.id<0)return;specificationCache.getCurrentSpecificationId()===parseInt($scope.id,10)?displaySimpleSpecification(specificationCache.getCurrentSpecification()):(specificationCache.resetCurrentSpecification(),specificationHttp.get($scope,useCache,$scope.id,function(data){displaySimpleSpecification(data)},$scope.generalHttpFactoryError));break;case"2":if($scope.id<0)return;specificationHttp.getFull($scope,useCache,$scope.id,function(data){setProject($scope.specification=data),specificationDurationCache.All=data.estimation,specificationCache.setCurrentSpecification(data,$scope.project),getRemovalUsers(),$scope.labels=getLabels(data),$scope.newname=data.title,resolveContinuousJobs(data.ext.continuous_integration),$scope.$emit("updateBreadcrumbs",{link:"specification/"+$scope.id+"/v/2",title:data.title});try{0<data.controls.length&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;default:if($scope.id<0)return;if(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)break;specificationHttp.get($scope,!1,$scope.id,function(data){if(self.originalSimpleName=data.simpleName,setProject(data),$scope.refreshCodemirror=!0,SynergyUtils.definedNotNull(data.ext.continuous_integration))for(var j=0,max=data.ext.continuous_integration.length;j<max;j++)data.ext.continuous_integration[j].jobUrl=data.ext.continuous_integration[j].jobUrl.substring(0,data.ext.continuous_integration[j].jobUrl.indexOf("/lastCompletedBuild"));$scope.$emit("updateBreadcrumbs",{link:"specification/"+$scope.id,title:data.title});try{0<data.controls.length&&($scope.rights=1)}catch(e){}$scope.specification=data,$scope.specification.originalOwner=data.owner,projectsHttp.getAll($scope,function(data){for(var defaultProject=!0,p=0,maxp=data.length;p<maxp;p++)if(data[p].name===$scope.project.name){$scope.project.id=data[p].id,defaultProject=!1;break}defaultProject&&data.push($scope.project),$scope.projects=data},$scope.generalHttpFactoryError),usersHttp.getAll($scope,function(data){$scope.users=data.users},$scope.generalHttpFactoryError)},$scope.generalHttpFactoryError)}},$scope.getSpecificationDuration=function(){if(!$scope.filterLabel||"All"===$scope.filterLabel)return $scope.specification.estimation;if(void 0!==specificationDurationCache[$scope.filterLabel])return specificationDurationCache[$scope.filterLabel];for(var time=0,i=0,max=$scope.specification.testSuites.length;i<max;i++)for(var j=0,max2=$scope.specification.testSuites[i].testCases.length;j<max2;j++)for(var k=0,max3=$scope.specification.testSuites[i].testCases[j].keywords.length;k<max3;k++)$scope.specification.testSuites[i].testCases[j].keywords[k]===$scope.filterLabel&&(time+=$scope.specification.testSuites[i].testCases[j].duration);return specificationDurationCache[$scope.filterLabel]=time},$scope.hasLabel=function(testCase,a){if(!$scope.filterLabel||"All"===$scope.filterLabel)return!0;for(var i=0,max=testCase.keywords.length;i<max;i++)if(testCase.keywords[i]===$scope.filterLabel)return!0;return!1},$scope.loadPreview=function(){var _t="<h1>"+($scope.specification.title||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.specification.desc||"")+"</div>";sanitizerHttp.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.toggleFavorite=function(){var target=0<parseInt($scope.specification.isFavorite,10)?0:1,spec=new SynergyModels.Specification("","","","",$scope.id);spec.isFavorite=target,userHttp.toggleFavorite($scope,spec,function(data){0===($scope.specification.isFavorite=target)?$scope.SYNERGY.logger.log("Done","Specification removed from favorites","INFO","alert-success"):$scope.SYNERGY.logger.log("Done","Specification added to favorites","INFO","alert-success")},$scope.generalHttpFactoryError)},$scope.performAttachment=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete attachment?"),$("#deleteModalBody").html("<p>Do you really want to delete attachment?</p>"),$("#modal_confirm_ok").attr("ng-click","deleteAttachment()"),$("#deleteModal").modal("toggle"),currentAction="deleteAttachment",currentActionId=id;break;default:$location.path("specification_attachment/"+id+"/"+action)}},$scope.showJobsModal=function(){$("#jobsModal").modal("toggle")},$scope.removeJob=function(jobId){jobHttp.remove($scope,jobId,$scope.specification.id,function(data){for(var i=0,max=$scope.specification.ext.continuous_integration.length;i<max;i++)if($scope.specification.ext.continuous_integration[i].id===jobId){$scope.specification.ext.continuous_integration.splice(i,1);break}$scope.SYNERGY.modal.update("Job removed",""),$scope.SYNERGY.modal.show()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.addJob=function(){var job=new SynergyModels.Job($scope.jobToBeAdded,$scope.id,-1);jobHttp.create($scope,job,function(data){$scope.specification.ext.continuous_integration.push(job),$scope.SYNERGY.modal.update("Job added",""),$scope.SYNERGY.modal.show()},$scope.generalHttpFactoryError)},$scope.clone=function(){void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||($scope.newname||($scope.newname=$scope.specification.title),$scope.newname.length<1||$scope.cloneVersion.length<1?($scope.SYNERGY.modal.update("Missing parameters","Please add a new name and version"),$scope.SYNERGY.modal.show()):specificationHttp.clone($scope,currentActionId,$scope.newname,$scope.cloneVersion,function(newLink){var id=newLink.substring(newLink.indexOf("=")+1);$scope.SYNERGY.logger.log("Done","Specification created, see "+window.location.hostname+window.location.pathname+"#/specification/"+id,"INFO","alert-success")},$scope.generalHttpFactoryError))},$scope.performSuite=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete test suite?"),$("#deleteModalBody").html("<p>Do you really want to delete test suite?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteSuite",currentActionId=id;break;case"labels":$("#addLabelsModal").modal("toggle"),currentAction="labels",currentActionId=id;break;default:$location.path("suite/"+id+"/"+action)}},$scope.performCase=function(action,id,suiteId){switch(action){case"delete":$("#deleteModalLabel").text("Delete test case?"),$("#deleteModalBody").html("<p>This will only remove reference to this test case in this suite. Continue?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteCase",currentActionId=id,currentSuiteId=suiteId}},$scope.deleteCase=function(){if($("#deleteModal").modal("toggle"),!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){specificationCache.resetCurrentSpecification();var toBeRemovedCaseId=parseInt(currentActionId,10),toBeRemovedSuiteId=parseInt(currentSuiteId,10);suiteHttp.removeCase($scope,currentSuiteId,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Test Case removed from test suite","INFO","alert-success");for(var i=0,max=$scope.specification.testSuites.length;i<max;i++)if($scope.specification.testSuites[i].id===toBeRemovedSuiteId)for(var s=$scope.specification.testSuites[i],j=0,max2=s.testCases.length;j<max2;j++)if(s.testCases[j].id===toBeRemovedCaseId)return void s.testCases.splice(j,1)},$scope.generalHttpFactoryError)}},$scope.performAction=function(labelMode){switch(currentAction){case"deleteAttachment":$scope.deleteAttachment();break;case"cloneSpecification":$scope.clone();break;case"ownershipRequest":specificationHttp.requestOwnership($scope,new SynergyModels.OwnershipRequest($scope.id,$scope.SYNERGY.session.username,$scope.requestMsg),function(){$scope.SYNERGY.logger.log("Done","Request has been sent to owner","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError);break;case"deleteSpecification":$scope.deleteSpecification();break;case"deleteSuite":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;specificationCache.resetCurrentSpecification();var toBeRemovedSuiteId=parseInt(currentActionId,10);suiteHttp.remove($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Test suite deleted","INFO","alert-success");for(var i=0,max=$scope.specification.testSuites.length;i<max;i++)if($scope.specification.testSuites[i].id===toBeRemovedSuiteId)return void $scope.specification.testSuites.splice(i,1)},$scope.generalHttpFactoryError);break;case"deleteCase":$scope.deleteCase();break;case"labels":"add"===labelMode?function(){if($scope.newLabel.length<1)return;var id=parseInt(currentActionId,10);specificationCache.resetCurrentSpecification(),labelsHttp.createForSuite($scope,currentActionId,$scope.newLabel,function(){$scope.SYNERGY.logger.log("Done","Labels added","INFO","alert-success");for(var i=0,max=$scope.specification.testSuites.length;i<max;i++)if(parseInt($scope.specification.testSuites[i].id,10)===id){for(var j=0,max2=$scope.specification.testSuites[i].testCases.length;j<max2;j++)$scope.specification.testSuites[i].testCases[j].keywords.indexOf($scope.newLabel)<0&&$scope.specification.testSuites[i].testCases[j].keywords.push($scope.newLabel);break}$scope.labels=getLabels($scope.specification)},$scope.generalHttpFactoryError),$("#addLabelsModal").modal("toggle")}():function(){if($scope.removeLabel.length<1)return;var id=parseInt(currentActionId,10);specificationCache.resetCurrentSpecification(),labelsHttp.removeFromSuite($scope,currentActionId,$scope.removeLabel,function(){$scope.SYNERGY.logger.log("Done","Labels removed","INFO","alert-success");for(var i=0,max=$scope.specification.testSuites.length;i<max;i++)if(parseInt($scope.specification.testSuites[i].id,10)===id){for(var j=0,max2=$scope.specification.testSuites[i].testCases.length;j<max2;j++){var index=$scope.specification.testSuites[i].testCases[j].keywords.indexOf($scope.removeLabel);-1<index&&$scope.specification.testSuites[i].testCases[j].keywords.splice(index,1)}break}$scope.labels=getLabels($scope.specification)},$scope.generalHttpFactoryError),$("#addLabelsModal").modal("toggle")}()}},$scope.deleteAttachment=function(){if($("#deleteModal").modal("toggle"),!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){var toBeRemoved=currentActionId;attachmentHttp.removeSpecAttachment($scope,currentActionId,$scope.specification.id,function(data){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success");for(var i=0,max=$scope.specification.attachments.length;i<max;i++)if($scope.specification.attachments[i].id===toBeRemoved)return void $scope.specification.attachments.splice(i,1)},function(data){$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}},$scope.performSpecification=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete specification?"),$("#deleteModalBody").html("<p>Do you really want to delete specification?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteSpecification";break;case"clone":currentActionId=$scope.id,currentAction="cloneSpecification",versionsHttp.get($scope,!0,function(data){$scope.versions=data,$("#dupliciteSpecModal").modal("toggle")},$scope.generalHttpFactoryError);break;case"ownershipRequest":if($scope.SYNERGY.session.username.length<1)return;$("#ownershipRequestModal").modal("toggle"),currentActionId=$scope.id,currentAction="ownershipRequest";break;default:$location.path("specification/"+$scope.specification.id+"/"+action)}},$scope.cancel=function(){window.history.back()},$scope.deleteSpecification=function(){$("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||(specificationCache.resetCurrentSpecification(),specificationHttp.remove($scope,$scope.specification.id,function(data,status){202===status?($scope.SYNERGY.logger.log("Done","Request to remove this specification has been sent to owner","INFO","alert-success"),$scope.specification.ext.removalRequests.push({username:$scope.SYNERGY.session.username}),getRemovalUsers()):($scope.SYNERGY.modal.update("Specification deleted",""),$scope.SYNERGY.modal.show(),$location.path("specifications"))},$scope.generalHttpFactoryError))},$scope.save=function(){if(!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){var spec=new SynergyModels.Specification($scope.specification.title,$scope.specification.desc,"",$scope.specification.owner,$scope.specification.id),intProjectId=parseInt($scope.project.id,10);if(spec.ext.projects=[{name:$scope.projects.filter(function(item,index){if(parseInt(item.id,10)===intProjectId)return item.name})[0].name,id:intProjectId}],spec.setSimpleName($scope.specification.simpleName),$scope.myForm.$invalid||void 0===spec.desc||spec.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();specificationCache.resetCurrentSpecification(),specificationHttp.edit($scope,spec,!!$scope.minorEdit,$scope.keepSimpleNameTrack,function(data){$scope.SYNERGY.modal.update("Specification updated",""),$scope.SYNERGY.modal.show(),$location.path("specification/"+$scope.specification.id)},$scope.generalHttpFactoryError)}},$scope.create=function(){if(!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){if($scope.myForm.$invalid||void 0===$scope.specification.desc||$scope.specification.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();specificationCache.resetCurrentSpecification();var spec=new SynergyModels.Specification($scope.specification.title,$scope.specification.desc,$scope.version,"",-1),intProjectId=parseInt($scope.project.id,10);spec.ext.projects=[{name:$scope.projects.filter(function(item,index){if(parseInt(item.id,10)===intProjectId)return item.name})[0].name,id:intProjectId}],spec.setSimpleName($scope.specification.title),specificationHttp.create($scope,spec,function(data){$scope.SYNERGY.modal.update("Specification created","");var id=data.substring(data.indexOf("=")+1,data.length-1);$location.path("specification/"+id),$scope.SYNERGY.modal.show()},$scope.generalHttpFactoryError)}},new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("attachment",{id:$scope.id,type:"specification"}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,specificationCache.resetCurrentSpecification(),attachmentHttp.getAttachmentsForSpecification($scope,$scope.specification.id,function(data){$scope.specification.attachments=data},function(data){$scope.SYNERGY.logger.log("Failed to refresh list of attachments",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error");try{$scope.$$phase||$scope.$apply()}catch(e){}})},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error"),$scope.SYNERGY.logger.log(title,msg,level,style);try{$scope.$$phase||$scope.$apply()}catch(e){}}),$scope.uploadFile=function(){new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("attachment",{id:$scope.id,type:"specification"}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,specificationCache.resetCurrentSpecification(),attachmentHttp.getAttachmentsForSpecification($scope,$scope.specification.id,function(data){$scope.specification.attachments=data},function(data){$scope.SYNERGY.logger.log("Failed to refresh list of attachments",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error");try{$scope.$$phase||$scope.$apply()}catch(e){}})},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error"),$scope.SYNERGY.logger.log(title,msg,level,style);try{$scope.$$phase||$scope.$apply()}catch(e){}}).uploadFileFromFileChooser("fileToUpload")};var scope=$scope;$scope.init(function(){scope.fetch(!0)})}function SuiteCtrl($scope,utils,$location,$routeParams,$timeout,specificationHttp,suiteHttp,casesHttp,productsHttp,sanitizerHttp,specificationCache,SynergyModels){$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.suite={},$scope.project="",$scope.refreshCodemirror=!1,$scope.id=$routeParams.id||-1,$scope.rights=0,$scope.c_version=$routeParams.version||"",$scope.c_specificationId=$routeParams.specification||"",$scope.c_specification={},$scope.case_suggestions=[],$scope.caseToBeAdded="",$scope.availableProducts=!1,$scope.products=[],$scope.oldNotification="",$scope.components=[];var currentAction="",currentActionId=-1;function setProject(data){data.hasOwnProperty("ext")&&data.ext.hasOwnProperty("projects")&&0<data.ext.projects.length?$scope.project=data.ext.projects[0].name:$scope.project=$scope.SYNERGY.product}function loadProducts(){productsHttp.get($scope,function(data){if(0<data.length){for(var p=[],j=0,max2=data.length;j<max2;j++)p.push(new SynergyModels.Product(data[j].name,data[j].components));$scope.products=p,$scope.availableProducts=!0;var oldPreferences=$scope.SYNERGY.cache.get("product_component");if(oldPreferences&&("unknown"===$scope.suite.product&&"unknown"===$scope.suite.component||void 0===$scope.suite.product)){for(var i=0,max=$scope.products.length;i<max;i++)if(data[i].name===oldPreferences.product)return $scope.suite.product=$scope.products[i],$scope.suite.component=oldPreferences.component,setComponent(i),void($scope.oldNotification="Selected product/component are based on previously used values and do not match actual settings of this suite")}else for(i=0,max=$scope.products.length;i<max;i++)if(data[i].name===$scope.suite.product||void 0===$scope.suite.product)return $scope.suite.product=$scope.products[i],void setComponent(i);$scope.suite.product=$scope.products[0],setComponent(0)}},function(){})}function setComponent(productIndex){$scope.components=$scope.products[productIndex].components;for(var i=0,max=$scope.components.length;i<max;i++)if($scope.components[i].name===$scope.suite.component||void 0===$scope.suite.component||void 0!==$scope.suite.component.name&&$scope.components[i].name===$scope.suite.component.name)return void($scope.suite.component=$scope.components[i]);$scope.suite.component=$scope.components[0]}$scope.fetch=function(){var action=window.location+"";switch(action=action.substring(action.lastIndexOf("/")+1)){case"create":0<parseInt($scope.c_specificationId,10)&&specificationHttp.get($scope,!0,$scope.c_specificationId,function(data){!function(data){try{$scope.suite.order=data.testSuites[data.testSuites.length-1].order+1||1}catch(e){$scope.suite.order=1}}(data),setProject(data),$scope.c_specification=data,loadProducts()},$scope.generalHttpFactoryError);break;case"1":if($scope.id<0)return;var cachedSuite=specificationCache.getCurrentSuite(parseInt($scope.id,10));if(cachedSuite){$scope.suite=cachedSuite,$scope.project=specificationCache.getCurrentProjectName(),$scope.$emit("updateBreadcrumbs",{link:"suite/"+$scope.id+"/v/1",title:$scope.suite.title});try{0<$scope.suite.controls.length&&($scope.rights=1)}catch(e){}return}suiteHttp.get($scope,!0,$scope.id,function(data){setProject($scope.suite=data),$scope.$emit("updateBreadcrumbs",{link:"suite/"+$scope.id+"/v/1",title:data.title});try{0<data.controls.length&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;default:if($scope.id<0)return;if(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)break;suiteHttp.get($scope,!1,$scope.id,function(data){setProject($scope.suite=data),$scope.refreshCodemirror=!0;try{0<data.controls.length&&($scope.rights=1)}catch(e){}loadProducts()},$scope.generalHttpFactoryError)}},$scope.loadPreview=function(){var _t="<h1>"+($scope.suite.title||"")+"</h1><h3>Setup</h3><div class='well'>"+($scope.suite.desc||"")+"</div>";sanitizerHttp.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.productChanged=function(){for(var i=0,max=$scope.products.length;i<max;i++)if($scope.products[i].name===$scope.suite.product.name){$scope.suite.product=$scope.products[i],setComponent(i);break}},$scope.performCase=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete test case?"),$("#deleteModalBody").html("<p>This will only remove reference to this test case in this suite. Continue?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteCase",currentActionId=id;break;default:$location.path("case/"+id+"/suite/"+$scope.id+"/"+action)}},$scope.performAction=function(){switch(currentAction){case"deleteCase":$scope.deleteCase();break;case"deleteSuite":$scope.deleteSuite()}},$scope.deleteCase=function(){if($("#deleteModal").modal("toggle"),!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){specificationCache.resetCurrentSpecification();var caseToBeRemovedId=parseInt(currentActionId,10);suiteHttp.removeCase($scope,$scope.suite.id,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Test Case removed from test suite","INFO","alert-success");for(var i=0,max=$scope.suite.testCases.length;i<max;i++)if($scope.suite.testCases[i].id===caseToBeRemovedId)return void $scope.suite.testCases.splice(i,1)},$scope.generalHttpFactoryError)}},$scope.addCase=function(caseId){$("#addCaseModal").modal("toggle"),specificationCache.resetCurrentSpecification(),suiteHttp.addCase($scope,$scope.id,caseId,function(data){$scope.SYNERGY.logger.log("Done","Test Case added to test suite","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.performSuite=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete test suite?"),$("#deleteModalBody").html("<p>Do you really want to delete test suite?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteSuite";break;default:$location.path("suite/"+$scope.suite.id+"/"+action)}},$scope.cancel=function(){window.history.back()},$scope.deleteSuite=function(){$("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||(specificationCache.resetCurrentSpecification(),suiteHttp.remove($scope,$scope.suite.id,function(data){$scope.SYNERGY.modal.update("Test Suite deleted",""),$scope.SYNERGY.modal.show(),$location.path("specification/"+$scope.suite.specificationId)},$scope.generalHttpFactoryError))},$scope.save=function(){if(!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){if($scope.myForm.$invalid||$scope.myForm2.$invalid||void 0===$scope.suite.desc||$scope.suite.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();specificationCache.resetCurrentSpecification();var product=$scope.availableProducts?$scope.suite.product.name:$scope.suite.product,component=$scope.availableProducts?$scope.suite.component.name:$scope.suite.component,suite=new SynergyModels.Suite($scope.suite.title,$scope.suite.desc,product,component,$scope.suite.id);suite.order=$scope.suite.order,suiteHttp.edit($scope,suite,!!$scope.minorEdit,function(data){$scope.SYNERGY.modal.update("Test Suite updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError),$scope.availableProducts&&$scope.SYNERGY.cache.put("product_component",{product:$scope.suite.product.name,component:$scope.suite.component.name})}},$scope.create=function(){if($scope.suite.specificationId=$scope.c_specificationId,$scope.myForm.$invalid||$scope.myForm2.$invalid||void 0===$scope.suite.desc||$scope.suite.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();if(!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){specificationCache.resetCurrentSpecification();var product=$scope.availableProducts?$scope.suite.product.name:$scope.suite.product,component=$scope.availableProducts?$scope.suite.component.name:$scope.suite.component,suite=new SynergyModels.Suite($scope.suite.title,$scope.suite.desc,product,component,-1);suite.order=$scope.suite.order,suite.specificationId=$scope.suite.specificationId,suiteHttp.create($scope,suite,function(data){$scope.SYNERGY.modal.update("Test Suite created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError),$scope.availableProducts&&$scope.SYNERGY.cache.put("product_component",{product:$scope.suite.product.name,component:$scope.suite.component})}},$scope.showAddCaseModal=function(){$scope.case_suggestions=[],$scope.caseToBeAdded="",$("#addCaseModal").modal("toggle")},$scope.filterCases=function(){$timeout(function(){casesHttp.getMatching($scope,$scope.caseToBeAdded,function(data){$scope.case_suggestions=data},$scope.generalHttpFactoryError)},600)};var self=$scope;$scope.init(function(){self.fetch()})}function CaseCtrl($scope,utils,$location,$routeParams,suiteHttp,caseHttp,imageHttp,issueHttp,labelHttp,sanitizerHttp,specificationCache,SynergyModels,SynergyHandlers){$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.testCase={},$scope.project="",$scope.refreshCodemirror=!1,$scope.id=$routeParams.id||-1,$scope.parentSuite=$routeParams.parent||-1,$scope.rights=0;var currentAction="",currentActionId=-1;$scope.labelToBeAdded="",$scope.preview=$scope.parentSuite<0?1:0,$scope.c_suite={};var originalDuration=0;function setProject(data){data.hasOwnProperty("ext")&&data.ext.hasOwnProperty("projects")&&0<data.ext.projects.length?$scope.project=data.ext.projects[0].name:$scope.project=$scope.SYNERGY.product}$scope.loadPreview=function(){var _t="<h1>"+($scope.testCase.title||"")+"</h1><h3>Steps</h3><div>"+($scope.testCase.steps||"")+"</div><h3>Expected result:</h3><div class='result well'>"+($scope.testCase.result||"")+"</div>";sanitizerHttp.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.fetch=function(useCache){var action=window.location+"";switch(action=action.substring(action.lastIndexOf("/")+1)){case"create":$scope.testCase.steps="<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<ol>",$scope.testCase.duration=1,0<parseInt($scope.parentSuite,10)&&suiteHttp.get($scope,useCache,$scope.parentSuite,function(data){setProject(data),function(data){try{$scope.testCase.order=data.testCases[data.testCases.length-1].order+1||1}catch(e){$scope.testCase.order=1}}(data),$scope.c_suite=data},$scope.generalHttpFactoryError);break;case"1":if($scope.id<0)return;var cachedCase=specificationCache.getCurrentCase(parseInt($scope.id,10),parseInt($scope.parentSuite,10));if(cachedCase){$scope.testCase=cachedCase,$scope.project=specificationCache.getCurrentProjectName(),$scope.$emit("updateBreadcrumbs",{link:"case/"+$scope.id+"/suite/"+$scope.parentSuite+"/v/1",title:$scope.testCase.title});try{0<$scope.testCase.controls.length&&($scope.rights=1)}catch(e){}return}caseHttp.get($scope,useCache,$scope.id,$scope.parentSuite,function(data){setProject($scope.testCase=data),$scope.$emit("updateBreadcrumbs",{link:"case/"+$scope.id+"/suite/"+$scope.parentSuite+"/v/1",title:data.title});try{0<data.controls.length&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;default:if($scope.id<0)return;if(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)break;caseHttp.get($scope,!1,$scope.id,$scope.parentSuite,function(data){setProject($scope.testCase=data),$scope.refreshCodemirror=!0,$scope.testCase.suiteId=$scope.parentSuite,originalDuration=parseInt(data.duration,10);try{0<data.controls.length&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError)}},$scope.create=function(){if(!(parseInt($scope.parentSuite,10)<1)){if($scope.myForm.$invalid||$scope.myForm2.$invalid||void 0===$scope.testCase.steps||typeof $scope.testCase.steps.length<0||void 0===$scope.testCase.result||typeof $scope.testCase.result.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();specificationCache.resetCurrentSpecification();var testCase=new SynergyModels.TestCase($scope.testCase.title,$scope.testCase.steps,$scope.testCase.result,$scope.testCase.duration,-1);testCase.suiteId=$scope.parentSuite,testCase.order=$scope.testCase.order,void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||caseHttp.create($scope,testCase,function(data){$scope.SYNERGY.modal.update("Test Case created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)}},$scope.performAction=function(){switch(currentAction){case"deleteCase":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||$scope.parentSuite<1)return;specificationCache.resetCurrentSpecification(),suiteHttp.removeCase($scope,$scope.parentSuite,$scope.id,function(data){$scope.SYNERGY.modal.update("Test Case removed from test suite",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError);break;case"deleteImage":var idToBeRemoved=currentActionId;specificationCache.resetCurrentSpecification(),$("#deleteImageModal").modal("toggle"),imageHttp.remove($scope,currentActionId,$scope.parentSuite,function(data){$scope.SYNERGY.logger.log("Done","Image removed","INFO","alert-success");for(var i=0,max=$scope.testCase.images.length;i<max;i++)if($scope.testCase.images[i].id===idToBeRemoved)return void $scope.testCase.images.splice(i,1)},$scope.generalHttpFactoryError)}},$scope.performCase=function(action){if(!($scope.parentSuite<0))switch(action){case"delete":$("#deleteModalLabel").text("Delete test case?"),$("#deleteModalBody").html("<p>This will only remove reference to this test case in this suite. Continue?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteCase";break;default:$location.path("case/"+$scope.testCase.id+"/suite/"+$scope.parentSuite+"/"+action)}},$scope.performImage=function(action,id){if(!($scope.parentSuite<0))switch(action){case"delete":$("#deleteImageModalLabel").text("Delete image?"),$("#deleteImageModalBody").html("<p>This will delete image from this test case. Continue?</p>"),$("#deleteImageModal").modal("toggle"),currentAction="deleteImage",currentActionId=id;break;default:$location.path("image/"+id+"/"+action)}},$scope.cancel=function(){window.history.back()},$scope.save=function(mode){if(!(void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){if($scope.myForm.$invalid||$scope.myForm2.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();specificationCache.resetCurrentSpecification();var t_case=new SynergyModels.TestCase($scope.testCase.title,$scope.testCase.steps,$scope.testCase.result,$scope.testCase.duration,$scope.testCase.id);t_case.suiteId=$scope.parentSuite,t_case.order=$scope.testCase.order,t_case.orginalDuration=originalDuration,caseHttp.edit($scope,mode,t_case,!!$scope.minorEdit,function(data){$scope.SYNERGY.modal.update("Test Case updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)}},$scope.showAddIssueModal=function(){$scope.issueToBeAdded="",$("#addIssueModal").modal("toggle")},$scope.addIssue=function(){specificationCache.resetCurrentSpecification(),issueHttp.create($scope,{testCaseId:$scope.testCase.id,id:$scope.issueToBeAdded},function(data){$scope.SYNERGY.logger.log("Issue added","","INFO","alert-success"),$scope.testCase.issues.push({bugId:$scope.issueToBeAdded,title:"",resolution:"",id:-1})},$scope.generalHttpFactoryError)},$scope.removeIssue=function(id){specificationCache.resetCurrentSpecification(),issueHttp.remove($scope,{testCaseId:$scope.testCase.id,id:id},function(data){$scope.SYNERGY.logger.log("Issue removed","","INFO","alert-success");for(var i=0,max=$scope.testCase.issues.length;i<max;i++)if($scope.testCase.issues[i].bugId===id)return void $scope.testCase.issues.splice(i,1)},$scope.generalHttpFactoryError)},$scope.showAddLabelModal=function(){$scope.labelToBeAdded="",$("#addLabelModal").modal("toggle")},$scope.addLabel=function(){specificationCache.resetCurrentSpecification(),labelHttp.create($scope,{label:$scope.labelToBeAdded,testCaseId:$scope.testCase.id,suiteId:$scope.parentSuite},function(data){$scope.SYNERGY.logger.log("Label added","","INFO","alert-success"),$scope.testCase.keywords.push($scope.labelToBeAdded.toLowerCase())},$scope.generalHttpFactoryError)},$scope.removeLabel=function(label){specificationCache.resetCurrentSpecification(),labelHttp.remove($scope,{label:label,testCaseId:$scope.testCase.id,suiteId:$scope.parentSuite},function(data){$scope.SYNERGY.logger.log("Label removed","","INFO","alert-success"),$scope.testCase.keywords.splice($scope.testCase.keywords.indexOf(label),1)},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch(!0)});var fu=new SynergyHandlers.FileUploader([],"fakeID",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("image",{id:$scope.id,suiteId:$scope.parentSuite,title:encodeURIComponent($scope.imageTitle)}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,specificationCache.resetCurrentSpecification(),imageHttp.getImagesForCase($scope,$scope.testCase.id,$scope.parentSuite,function(data){$scope.testCase.images=data},function(data){$scope.SYNERGY.logger.log("Unable to refresh list of images","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error"),$scope.SYNERGY.logger.log(title,msg,level,style);try{$scope.$$phase||$scope.$apply()}catch(e){}});fu.initForImages("dropbox"),$scope.uploadFile=function(){fu.uploadImage($scope.SYNERGY.server.buildURL("image",{id:$scope.id,suiteId:$scope.parentSuite,title:encodeURIComponent($scope.imageTitle)}))}}function ProfileCtrl($scope,$routeParams,userHttp,$location,SynergyModels,SynergyHandlers){function setProject(specifications){for(var i=0,max=specifications.length;i<max;i++)specifications[i]._project=specifications[i].ext.hasOwnProperty("projects")&&0<specifications[i].ext.projects.length?specifications[i].ext.projects[0].name:$scope.SYNERGY.product}$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.user={authorOf:[],membership:[],favorites:[],assignments:[]},$scope.username=$routeParams.user||"",$scope.rights=0,$scope.passwordChangeAllowed=!$scope.SYNERGY.useSSO,$scope.updatePassword=!1,$scope.isLoggedIn=void 0!==$scope.SYNERGY.session.session_id&&1<$scope.SYNERGY.session.session_id.length?1:0,$scope.fetch=function(){$scope.isLoggedIn=void 0!==$scope.SYNERGY.session.session_id&&1<$scope.SYNERGY.session.session_id.length?1:0;var action=window.location+"";action=action.substring(action.lastIndexOf("/")+1),$scope.username.length<1&&(void 0!==$scope.SYNERGY.session.session_id||1<$scope.SYNERGY.session.session_id.length)&&($scope.username=$scope.SYNERGY.session.username),$scope.username.length<1||userHttp.get($scope,$scope.username,function(data){data.assignments.forEach(function(trun){null!==trun.projectName&&""!==trun.projectName||(trun.projectName=$scope.SYNERGY.product)}),setProject(data.authorOf),setProject(data.ownerOf),setProject(data.favorites),$scope.user=data,$scope.username===$scope.SYNERGY.session.username&&($scope.rights=1),$scope.$emit("updateBreadcrumbs",{link:"user/"+$scope.username,title:$scope.username})},$scope.generalHttpFactoryError)},$scope.editName=function(){if(1===$scope.rights){var invalidPassword=void 0===$scope.user.password||null===$scope.user.password||$scope.user.password.length<1;if($scope.profileForm.$invalid||$scope.updatePassword&&invalidPassword)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var _u=new SynergyModels.User($scope.user.firstName,$scope.user.lastName,$scope.user.username,"",-1);_u.emailNotifications=$scope.user.emailNotifications,_u.email=$scope.user.email,$scope.updatePassword&&(_u.password=$scope.user.password),userHttp.edit($scope,_u,function(data){$scope.SYNERGY.logger.log("Done","updated","INFO","alert-success")},$scope.generalHttpFactoryError)}},$scope.toggleFavorite=function(id){var spec={id:id,isFavorite:0};userHttp.toggleFavorite($scope,spec,function(data){$scope.SYNERGY.logger.log("Done","Specification removed from favorites","INFO","alert-success");for(var k=0,max=$scope.user.favorites.length;k<max;k+=1)if(parseInt($scope.user.favorites[k].id,10)===parseInt(id,10))return void $scope.user.favorites.splice(k,1)},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()}),$scope.uploadFile=function(){new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("profile_img",{id:$scope.user.id}),function(title,msg,level,style,fileName,newSrc){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.user.profileImg=newSrc;try{$scope.$$phase||$scope.$apply()}catch(e){}},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error");try{$scope.$$phase||$scope.$apply()}catch(e){}}).uploadFileFromFileChooser("fileToUpload")},$scope.resetFile=function(){userHttp.resetProfileImg($scope,$scope.user.id,function(data){$scope.user.profileImg=data},$scope.generalHttpFactoryError)}}function LabelFilterCtrl($scope,$routeParams,labelHttp){$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.result={},$scope.label=$routeParams.label||"",$scope.page=$routeParams.page||1,$scope.next=0,$scope.prev=0,$scope.nextPage=1,$scope.prevPage=1,$scope.fetch=function(){0<$scope.label.length&&labelHttp.findCases($scope,$scope.label,$scope.page,function(data){$scope.result=data,$scope.$emit("updateBreadcrumbs",{link:"label/"+$scope.label+"/page/1",title:$scope.label}),$scope.next=1<data.nextUrl.length?1:0,$scope.prev=1<data.prevUrl.length?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function TribeCtrl($scope,$location,$routeParams,$timeout,usersHttp,tribeHttp,sanitizerHttp,specificationsHttp,SynergyUtils,SynergyModels){$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.tribe={},$scope.id=$routeParams.id||-1,$scope.rights=0,$scope.refreshCodemirror=!1;var currentAction="",currentId="";function loadUsers(){0<$scope.users.length||($scope.loadingUsers=!0,usersHttp.getAll($scope,function(data){if(SynergyUtils.definedNotNull(data)&&SynergyUtils.definedNotNull(data.users))for(var i=0,max=data.users.length;i<max;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.loadingUsers=!1,$scope.users=data.users},function(data){$scope.SYNERGY.logger.log("Action failed","Unable to load list of users","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}))}$scope.suggestions=[],$scope.users_suggestions=[],$scope.userToBeAdded="pepa",$scope.specifications=[],$scope.newSpecification=-1,$scope.users=[],$scope.loadingUsers=!1,$scope.toggleMembers=!1,$scope.fetch=function(){var action=window.location+"";action=action.substring(action.lastIndexOf("/")+1),0<$scope.id&&tribeHttp.get($scope,!1,$scope.id,function(data){!function(ext){if(!ext.hasOwnProperty("specifications"))return;for(var i=0,max=ext.specifications.length;i<max;i++)ext.specifications[i]._project=ext.specifications[i].hasOwnProperty("projects")&&0<ext.specifications[i].projects.length?ext.specifications[i].projects[0].name:$scope.SYNERGY.product}(data.ext),$scope.tribe=data,$scope.refreshCodemirror=!0,$scope.$emit("updateBreadcrumbs",{link:"tribe/"+$scope.id,title:data.name}),0<$scope.tribe.controls.length&&($scope.rights=1),"edit"===action&&(specificationsHttp.get($scope,"allRaw",function(data){for(var p,d=[],i=0,max=data.length;i<max;i+=1)p=data[i].ext.hasOwnProperty("projects")&&0<data[i].ext.projects.length?data[i].ext.projects[0].name:$scope.SYNERGY.product,d[i]={title:data[i].title,version:data[i].version,value:data[i].title+" ("+p+" "+data[i].version+")",id:data[i].id};$scope.specifications=d},$scope.generalHttpFactoryError),loadUsers())},$scope.generalHttpFactoryError)},$scope.loadPreview=function(){var _t="<h1>"+($scope.tribe.name||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.tribe.description||"")+"</div>";sanitizerHttp.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.addSpecification=function(){for(var _index=parseInt($scope.newSpecification),i=0,max=$scope.tribe.ext.specifications.length;i<max;i++)if(parseInt($scope.tribe.ext.specifications[i].id)===_index)return void $scope.SYNERGY.logger.log("Oops","Specification already added to tribe","INFO","alert-info");tribeHttp.addSpecification($scope,$scope.id,$scope.newSpecification,function(data,specificationId){$scope.SYNERGY.logger.log("Done","Specification added to tribe","INFO","alert-success");var matchingIndex=function(id){for(var i=0,max=$scope.specifications.length;i<max;i++)if($scope.specifications[i].id===id)return i;return-1}(parseInt(specificationId,10));0<matchingIndex&&$scope.tribe.ext.specifications.push($scope.specifications[matchingIndex])},$scope.generalHttpFactoryError)},$scope.removeSpecification=function(specificationId){tribeHttp.removeSpecification($scope,$scope.id,specificationId,function(data,specificationId){$scope.SYNERGY.logger.log("Done","Specification removed from tribe","INFO","alert-success");for(var i=0,max=$scope.tribe.ext.specifications.length;i<max;i++)if(parseInt($scope.tribe.ext.specifications[i].id,10)===specificationId)return void $scope.tribe.ext.specifications.splice(i,1)},$scope.generalHttpFactoryError)},$scope.removeFromTribe=function(username){$("#deleteModalLabel").text("Remove user from tribe?"),$("#deleteModalBody").html("<p>Do you really want to revoke user's membership?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteUser",currentId=username},$scope.performRemoveFromTribe=function(username){$("#deleteModal").modal("toggle");var memberToBeRemoved=username;tribeHttp.revokeMembership($scope,username,$scope.id,function(data){$scope.SYNERGY.logger.log("Done","User removed from tribe","INFO","alert-success");for(var i=0,max=$scope.tribe.members.length;i<max;i++)if($scope.tribe.members[i].username===memberToBeRemoved)return void $scope.tribe.members.splice(i,1)},$scope.generalHttpFactoryError)},$scope.performAction=function(){switch(currentAction){case"deleteUser":$scope.performRemoveFromTribe(currentId)}},$scope.performTribeAction=function(action){"delete"!==action&&$location.path("tribe/"+$scope.id+"/"+action)},$scope.cancel=function(){window.history.back()},$scope.save=function(){if($scope.myForm.$invalid||$scope.myForm2.$invalid||void 0===$scope.tribe.description||$scope.tribe.description.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var tribe=new SynergyModels.Tribe($scope.tribe.name,$scope.tribe.description,$scope.tribe.leaderUsername,$scope.tribe.id);tribeHttp.edit($scope,tribe,function(data){$scope.SYNERGY.modal.update("Tribe updated",""),$scope.SYNERGY.modal.show(),$location.path("tribe/"+$scope.tribe.id)},$scope.generalHttpFactoryError)},$scope.addUser=function(){tribeHttp.newMembership($scope,{username:$scope.userToBeAdded},$scope.tribe.id,function(data){$scope.SYNERGY.logger.log("Done","User added to tribe","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.showAddUserModal=function(){$scope.toggleMembers=!$scope.toggleMembers,loadUsers()};var self=$scope;$scope.init(function(){self.fetch()})}function RunsCtrl($scope,$routeParams,runsHttp){$scope.runs=[],$scope.page=$routeParams.page||1,$scope.next=0,$scope.prev=0,$scope.nextPage=1,$scope.prevPage=1,$scope.fetch=function(){$scope.$emit("updateBreadcrumbs",{link:"runs",title:"Test Runs"}),$scope.$emit("updateNavbar",{item:"nav_runs"}),runsHttp.get($scope,$scope.page,function(data){data.testRuns.forEach(function(trun){null!==trun.projectName&&""!==trun.projectName||(trun.projectName=$scope.SYNERGY.product)}),$scope.runs=data,$scope.next=1<data.nextUrl.length?1:0,$scope.prev=1<data.prevUrl.length?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError,!0)};var self=$scope;$scope.init(function(){self.fetch()})}function AssignmentCtrl($scope,$routeParams,assignmentHttp){$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.assignment={},$scope.currentCase={},$scope.currentCaseId=-1,$scope.currentSuiteId=-1,$scope.id=$routeParams.id||-1,$scope.mode=$routeParams.mode||2,$scope.project={},$scope.timeLeft=0,$scope.suiteIndex=0,$scope.caseIndex=0,$scope.casesFinished=0,$scope.newIssue="",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("attachment",{});var timeFinished=0;$scope.failedAttempt=!1;var started=0,cachedData={};function setProject(data){data.hasOwnProperty("ext")&&data.ext.hasOwnProperty("projects")&&0<data.ext.projects.length?$scope.project=data.ext.projects[0]:$scope.project={name:$scope.SYNERGY.product,id:-2}}function collectCases(){for(var cases=[],i=0,max=$scope.assignment.specificationData.testSuites.length;i<max;i+=1)for(var j=0,max2=$scope.assignment.specificationData.testSuites[i].testCases.length;j<max2;j+=1){var p=getProgressForCase($scope.assignment.specificationData.testSuites[i].testCases[j].id,$scope.assignment.specificationData.testSuites[i].id);cases.push({name:$scope.assignment.specificationData.testSuites[i].testCases[j].title+" ("+$scope.assignment.specificationData.testSuites[i].title+")"+(1===parseInt(p.finished,10)?" - ["+p.result+"]":""),caseId:$scope.assignment.specificationData.testSuites[i].testCases[j].id,suiteId:$scope.assignment.specificationData.testSuites[i].id,progress:p,result:p.result})}$scope.allCases=cases}function parseData(caseStartIndex,suiteStartIndex,timeOffset){for(var _s,i=suiteStartIndex,max=$scope.assignment.progress.specification.testSuites.length;i<max;i+=1){for(var j=caseStartIndex,max2=(_s=$scope.assignment.progress.specification.testSuites[i]).testCases.length;j<max2;j+=1)if(0===parseInt(_s.testCases[j].finished,10))return $scope.currentCaseId=parseInt(_s.testCases[j].id,10),$scope.currentSuiteId=parseInt(_s.id,10),printCase($scope.currentCaseId,$scope.currentSuiteId),$scope.suiteIndex=i,$scope.caseIndex=j,void((i!==suiteStartIndex||0===caseStartIndex&&0===suiteStartIndex)&&($scope.suiteSetupDisplayed=!0,$scope.toggleAction="hide"));caseStartIndex=0}$scope.timeLeft=0,$scope.sendResults()}function printCase(caseId,suiteId){if($scope.newIssue="",-1!==caseId){for(i=0,max=$scope.assignment.specificationData.testSuites.length;i<max;i+=1)if(suiteId===parseInt($scope.assignment.specificationData.testSuites[i].id,10))for(j=0,max2=$scope.assignment.specificationData.testSuites[i].testCases.length;j<max2;j+=1)if(caseId===parseInt($scope.assignment.specificationData.testSuites[i].testCases[j].id,10))return $scope.currentCase={title:$scope.assignment.specificationData.testSuites[i].testCases[j].title,caseId:$scope.assignment.specificationData.testSuites[i].testCases[j].id,suiteId:$scope.assignment.specificationData.testSuites[i].id,images:$scope.assignment.specificationData.testSuites[i].testCases[j].images,duration:parseInt($scope.assignment.specificationData.testSuites[i].testCases[j].duration,10),steps:$scope.assignment.specificationData.testSuites[i].testCases[j].steps,suiteTitle:$scope.assignment.specificationData.testSuites[i].title,result:$scope.assignment.specificationData.testSuites[i].testCases[j].result,issues:$scope.assignment.specificationData.testSuites[i].testCases[j].issues,suiteSetup:$scope.assignment.specificationData.testSuites[i].desc,product:$scope.assignment.specificationData.testSuites[i].product,comment:-1,commentFreeText:"",progress:getProgressForCase(caseId,suiteId),component:$scope.assignment.specificationData.testSuites[i].component},initValuesFromProgress(),void(started=(new Date).getTime())}else for(var i=0,max=$scope.assignment.specificationData.testSuites.length;i<max;i+=1)for(var j=0,max2=$scope.assignment.specificationData.testSuites[i].testCases.length;j<max2;j+=1)return $scope.suiteIndex=i,$scope.caseIndex=j,started=(new Date).getTime(),void($scope.currentCase={title:$scope.assignment.specificationData.testSuites[i].testCases[j].title,caseId:$scope.assignment.specificationData.testSuites[i].testCases[j].id,suiteId:$scope.assignment.specificationData.testSuites[i].id,images:$scope.assignment.specificationData.testSuites[i].testCases[j].images,duration:parseInt($scope.assignment.specificationData.testSuites[i].testCases[j].duration,10),steps:$scope.assignment.specificationData.testSuites[i].testCases[j].steps,suiteTitle:$scope.assignment.specificationData.testSuites[i].title,result:$scope.assignment.specificationData.testSuites[i].testCases[j].result,issues:$scope.assignment.specificationData.testSuites[i].testCases[j].issues,suiteSetup:$scope.assignment.specificationData.testSuites[i].desc,product:$scope.assignment.specificationData.testSuites[i].product,comment:-1,commentFreeText:"",progress:{finished:0,id:caseId,result:"",duration:0,issue:[],comment:-1,commentFreeText:""},component:$scope.assignment.specificationData.testSuites[i].component})}function initValuesFromProgress(){$scope.currentCase.progress.issue&&0<$scope.currentCase.progress.issue.length&&($scope.newIssue=$scope.currentCase.progress.issue.join(" ")),$scope.currentCase.progress.comment&&0<$scope.currentCase.progress.comment&&($scope.currentCase.comment=$scope.currentCase.progress.comment,$scope.currentCase.commentFreeText=$scope.currentCase.progress.hasOwnProperty("commentFreeText")?$scope.currentCase.progress.commentFreeText:"")}function getProgressForCase(caseId,suiteId){for(var i=0,max=$scope.assignment.progress.specification.testSuites.length;i<max;i++)if(parseInt($scope.assignment.progress.specification.testSuites[i].id,10)===parseInt(suiteId,10))for(var j=0,max2=$scope.assignment.progress.specification.testSuites[i].testCases.length;j<max2;j++)if(parseInt($scope.assignment.progress.specification.testSuites[i].testCases[j].id,10)===parseInt(caseId,10))return $scope.assignment.progress.specification.testSuites[i].testCases[j];return{finished:0,id:caseId,result:"",duration:0,issue:[],comment:-1}}$scope.cacheDate={},$scope.comments=[],$scope.allCases=[],$scope.suiteSetupDisplayed=!1,$scope.toggleAction="display",$scope.caseToPrint={},$scope.errorMsg="",$scope.somethingCompleted=!1,$scope.pauseButtonTitle="No test case has been completed yet or nothing has changed since resuming testing",$scope.fetch=function(){if(0<$scope.id){if((cachedData=$scope.SYNERGY.cache.get("assignment_progress_"+$scope.id))&&cachedData.date&&cachedData.progress)return $scope.cacheDate=cachedData.date,void $("#attemptModal").modal("toggle");switch(assignmentHttp.getCommentTypes($scope,function(data){data.push({name:"No comment",id:-1}),$scope.comments=data},$scope.generalHttpFactoryError),$scope.mode){case"1":assignmentHttp.start($scope,$scope.id,function(data){setProject(($scope.assignment=data).specificationData),function(){for(var _s,i=0,max=$scope.assignment.progress.specification.testSuites.length;i<max;i+=1){_s=$scope.assignment.progress.specification.testSuites[i];for(var j=0,max2=_s.testCases.length;j<max2;j+=1)0!==parseInt(_s.testCases[j].finished,10)&&(_s.testCases[j].hasOwnProperty("originalDuration")?timeFinished+=parseInt(Math.round(_s.testCases[j].originalDuration),10):timeFinished+=parseInt(Math.round(_s.testCases[j].duration),10))}$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished}(),collectCases(),$scope.casesFinished=parseInt(parseInt(data.completed,10)/parseInt(data.total,10)*100,10)||0,parseData(0,0,0),$scope.caseToPrint=$scope.allCases.filter(function(e){return e.caseId===$scope.currentCase.caseId&&e.suiteId===$scope.currentCase.suiteId})[0]},$scope.generalHttpFactoryError);break;case"2":assignmentHttp.restart($scope,$scope.id,function(data){setProject(($scope.assignment=data).specificationData),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10),collectCases(),$scope.casesFinished=parseInt(parseInt(data.completed,10)/parseInt(data.total,10)*100,10)||0,parseData(0,0,0),$scope.caseToPrint=$scope.allCases.filter(function(e){return e.caseId===$scope.currentCase.caseId&&e.suiteId===$scope.currentCase.suiteId})[0]},$scope.generalHttpFactoryError)}}},$scope.traverseCase=function(){var _s,oldSuiteId=$scope.currentSuiteId;$scope.currentCaseId=parseInt($scope.caseToPrint.caseId,10),$scope.currentSuiteId=parseInt($scope.caseToPrint.suiteId,10);for(var i=0,max=$scope.assignment.progress.specification.testSuites.length;i<max;i+=1)if(_s=$scope.assignment.progress.specification.testSuites[i],parseInt(_s.id,10)===parseInt($scope.caseToPrint.suiteId,10))for(var j=0,max2=_s.testCases.length;j<max2;j+=1)parseInt(_s.testCases[j].id,10)===parseInt($scope.caseToPrint.caseId,10)&&($scope.suiteIndex=i,$scope.caseIndex=j);oldSuiteId!==$scope.currentSuiteId&&($scope.suiteSetupDisplayed=!0,$scope.toggleAction="hide"),printCase($scope.currentCaseId,$scope.currentSuiteId)},$scope.toggleSetup=function(){$scope.suiteSetupDisplayed?$scope.toggleAction="display":$scope.toggleAction="hide",$scope.suiteSetupDisplayed=!$scope.suiteSetupDisplayed},$scope.sendCached=function(send){send?($("#attemptModal").modal("toggle"),$scope.assignment.progress=cachedData.progress,$scope.sendResults()):($scope.SYNERGY.cache.clear("assignment_progress_"+$scope.id),$scope.fetch())},$scope.sendResults=function(){$scope.failedAttempt&&$("#deleteModal").modal("toggle"),$scope.showWaitDialog(),assignmentHttp.submitResults($scope,$scope.id,$scope.assignment.progress,function(data){$scope.SYNERGY.modal.update("Results submitted","Thank you for testing"),$scope.SYNERGY.modal.show(),$scope.SYNERGY.cache.clear("assignment_progress_"+$scope.id),$scope.assignment={},$scope.currentCase={},$scope.currentCaseId=-1,$scope.currentSuiteId=-1,$scope.id=$routeParams.id||-1,$scope.mode=$routeParams.mode||2,$scope.timeLeft=0,$scope.suiteIndex=0,$scope.caseIndex=0,$scope.casesFinished=0,$scope.newIssue="",$scope.failedAttempt=!1,window.history.back()},function(data){$scope.errorMsg=data||"",$scope.SYNERGY.modal.show(),$scope.failedAttempt||($scope.failedAttempt=!0,$("#deleteModal").modal("toggle")),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.next=function(result){if(parseInt($scope.assignment.completed,10)===parseInt($scope.assignment.total,10))return $scope.SYNERGY.modal.update("Testing finished",""),void $scope.SYNERGY.modal.show();var alreadyTested=1===parseInt($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished,10);switch(result){case"passed":alreadyTested||($scope.assignment.completed++,$scope.casesFinished=parseInt(parseInt($scope.assignment.completed,10)/parseInt($scope.assignment.total,10)*100,10),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].hasOwnProperty("originalDuration")?timeFinished+=parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration),10):timeFinished+=parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration),10),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished);var timeTaken=(new Date).getTime()-started;$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished=1,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].result=result,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].comment=$scope.currentCase.comment,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].commentFreeText=-1!==$scope.currentCase.comment?$scope.currentCase.commentFreeText.substr(0,100):"",$scope.SYNERGY.trackCaseDuration||(timeTaken=6e4*$scope.currentCase.duration),0<$scope.newIssue.length?$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue=$scope.newIssue.split(" "):$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue="",$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration=timeTaken,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration=$scope.currentCase.duration,parseData($scope.caseIndex+1,$scope.suiteIndex,$scope.currentCase.duration);break;case"failed":if(!(0<$scope.newIssue.length))return $scope.SYNERGY.modal.update("Missing issue number",""),void $scope.SYNERGY.modal.show();alreadyTested||($scope.assignment.completed++,$scope.casesFinished=parseInt(parseInt($scope.assignment.completed,10)/parseInt($scope.assignment.total,10)*100,10),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].hasOwnProperty("originalDuration")?timeFinished+=parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration),10):timeFinished+=parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration),10),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished);timeTaken=(new Date).getTime()-started;$scope.SYNERGY.trackCaseDuration||(timeTaken=6e4*$scope.currentCase.duration),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue=$scope.newIssue.split(" "),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished=1,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].result=result,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration=timeTaken,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration=$scope.currentCase.duration,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].comment=$scope.currentCase.comment,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].commentFreeText=-1!==$scope.currentCase.comment?$scope.currentCase.commentFreeText.substr(0,100):"",parseData($scope.caseIndex+1,$scope.suiteIndex,$scope.currentCase.duration);break;case"skipped":if(-1===$scope.currentCase.comment)return $scope.SYNERGY.modal.update("Missing reason for skipping","Please select comment using the combo box below Skip button"),void $scope.SYNERGY.modal.show();alreadyTested||($scope.assignment.completed++,$scope.casesFinished=parseInt(parseInt($scope.assignment.completed,10)/parseInt($scope.assignment.total,10)*100,10),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].hasOwnProperty("originalDuration")?timeFinished+=parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration),10):timeFinished+=parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration),10),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue="",$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished=1,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].result=result,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration=$scope.currentCase.duration,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].comment=$scope.currentCase.comment,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].commentFreeText=-1!==$scope.currentCase.comment?$scope.currentCase.commentFreeText.substr(0,100):"",parseData($scope.caseIndex+1,$scope.suiteIndex,$scope.currentCase.duration)}$scope.somethingCompleted=!0,$scope.pauseButtonTitle="Save current progress and continue later",$scope.SYNERGY.cache.put("assignment_progress_"+$scope.id,{date:(new Date).toString(),progress:$scope.assignment.progress}),collectCases(),$scope.caseToPrint=$scope.allCases.filter(function(e){return e.caseId===$scope.currentCase.caseId&&e.suiteId===$scope.currentCase.suiteId})[0],$scope.SYNERGY.util.scrollTo("caseTitle")};var self=$scope;$scope.init(function(){self.fetch()})}function AdminHomeCtrl($scope){$scope.SYNERGY.session.hasAdminRights()}function AdminVersionCtrl($scope,versionsHttp,versionHttp,SynergyModels){$scope.versions=[],$scope.versionAffectedId=0,$scope.versionAffected="",$scope.newname="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&versionsHttp.getAll($scope,function(data){$scope.versions=data},$scope.generalHttpFactoryError)},$scope.perform=function(action,versionId,version,isObsolete){switch(action){case"edit":$scope.newname=version,$scope.isObsolete=1===parseInt(isObsolete,10),$scope.versionAffectedId=versionId,$scope.versionAffected=version,$("#editVersionModal").modal("toggle");break;case"create":$scope.newname="",$("#createVersionModal").modal("toggle");break;case"delete":$scope.versionAffectedId=versionId,$scope.versionAffected=version,$("#deleteModal").modal("toggle")}},$scope.rename=function(){if($scope.myForm.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();versionHttp.edit($scope,new SynergyModels.Version($scope.newname,$scope.versionAffectedId,$scope.isObsolete),function(){$scope.SYNERGY.logger.log("Done","Version renamed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.remove=function(){$("#deleteModal").modal("toggle"),versionHttp.remove($scope,$scope.versionAffectedId,function(){$scope.SYNERGY.logger.log("Done","Version removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.create=function(){if($scope.myForm2.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();versionHttp.create($scope,new SynergyModels.Version($scope.newname,-1,!1),function(data){$scope.SYNERGY.logger.log("Done","Version created","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminPlatformsCtrl($scope,platformsHttp,platformHttp,SynergyModels){$scope.platforms=[],$scope.platformAffectedId=0,$scope.platformAffected="",$scope.newname="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&platformsHttp.get($scope,function(data){$scope.platforms=data},$scope.generalHttpFactoryError,!1)},$scope.perform=function(action,platformId,platform,isActive){switch(action){case"edit":$scope.platformAffectedId=platformId,$scope.platformAffected=platform,$scope.newname=platform,$scope.isActive=1===parseInt(isActive,10),$("#editPlatformModal").modal("toggle");break;case"create":$("#createPlatformModal").modal("toggle");break;case"delete":$scope.platformAffectedId=platformId,$scope.platformAffected=platform,$("#deleteModal").modal("toggle")}},$scope.remove=function(){$("#deleteModal").modal("toggle"),platformHttp.remove($scope,$scope.platformAffectedId,function(data){$scope.SYNERGY.logger.log("Done","Platform removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.rename=function(){if($scope.myForm.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();platformHttp.edit($scope,new SynergyModels.Platform($scope.newname,$scope.platformAffectedId,$scope.isActive),function(data){$scope.SYNERGY.logger.log("Done","Platform renamed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.create=function(){if($scope.myForm2.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();platformHttp.create($scope,new SynergyModels.Platform($scope.newname,-1),function(data){$scope.SYNERGY.logger.log("Done","Platform created","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminTribesCtrl($scope,$location,$timeout,usersHttp,tribeHttp,tribesHttp,sanitizerHttp,SynergyUtils,SynergyModels){$scope.tribes=[],$scope.tribe={},$scope.tribeAffectedId=0,$scope.tribeAffected="",$scope.newname="",$scope.users=[],$scope.importTribesUrl="http://"+window.location.host+"/dashboard/web/a_tribes.php?export=true",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&(usersHttp.getAll($scope,function(data){if(SynergyUtils.definedNotNull(data)&&SynergyUtils.definedNotNull(data.users))for(var i=0,max=data.users.length;i<max;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.users=data.users,SynergyUtils.definedNotNull(data)&&0<data.users.length&&($scope.tribe.leaderUsername=data.users[0].displayName)},$scope.generalHttpFactoryError),tribesHttp.get($scope,function(data){$scope.tribes=data},$scope.generalHttpFactoryError))},$scope.importTribes=function(){tribesHttp.importTribes($scope,$scope.importTribesUrl,function(data){$scope.SYNERGY.logger.log("Done",data+" tribes imported","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.deleteTribe=function(){$("#deleteModal").modal("toggle"),tribeHttp.remove($scope,$scope.tribeAffectedId,function(data){$scope.SYNERGY.logger.log("Done","Tribe removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.perform=function(action,id,tribe){switch(action){case"create":$location.path("administration/tribes/"+action)}},$scope.deleteModal=function(id,tribe){$scope.tribeAffectedId=id,$scope.tribeAffected=tribe,$("#deleteModal").modal("toggle")},$scope.loadPreview=function(){var _t="<h1>"+($scope.tribe.name||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.tribe.description||"")+"</div>";sanitizerHttp.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.create=function(){if($scope.myForm2.$invalid||$scope.myForm.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var tribe=new SynergyModels.Tribe($scope.tribe.name,$scope.tribe.description,$scope.tribe.leaderUsername,-1);tribeHttp.create($scope,tribe,function(data){$scope.SYNERGY.modal.update("Tribe created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminRunsCtrl($scope,$location,$routeParams,runsHttp,runHttp){$scope.runs=[],$scope.page=$routeParams.page||1,$scope.orderProp="title",$scope.next=0,$scope.prev=0,$scope.nextPage=1;var currentActionId=-($scope.prevPage=1),currentAction="";$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&runsHttp.get($scope,$scope.page,function(data){data.testRuns.forEach(function(trun){null!==trun.projectName&&""!==trun.projectName||(trun.projectName=$scope.SYNERGY.product)}),$scope.runs=data,$scope.next=1<data.nextUrl.length?1:0,$scope.prev=1<data.prevUrl.length?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)},$scope.perform=function(action,id,run){switch(action){case"delete":$("#deleteModalLabel").text("Delete test run?"),$("#deleteModalBody").html("<p>This action will also delete all test assignments for this test run. Do you want to continue?</p>"),$("#deleteModal").modal("toggle"),currentActionId=id,currentAction="delete";break;case"notify":$("#deleteModalLabel").text("Send notifications?"),$("#deleteModalBody").html("<p>Do you really want to send email notifications to testers with incomplete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="notify",currentActionId=id;break;case"freeze":var _run=$scope.runs.testRuns.filter(function(e){return e.id===id})[0],target=_run.isActive?0:1;runHttp.freezeRun($scope,id,target,function(data){(_run=$scope.runs.testRuns.filter(function(e){return e.id===id})[0]).isActive=target,$scope.SYNERGY.logger.log("Done","Test run "+(1===target?"unfrozen":"frozen"),"INFO","alert-success")},$scope.generalHttpFactoryError);break;default:$location.path("administration/run/"+id+"/"+action)}},$scope.performAction=function(){switch(currentAction){case"delete":$("#deleteModal").modal("toggle"),runHttp.remove($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Test run removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError);break;case"notify":$("#deleteModal").modal("toggle"),runHttp.sendNotifications($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done",data,"INFO","alert-success")},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}};var self=$scope;$scope.init(function(){self.fetch()})}function AdminRunCtrl($scope,$routeParams,runHttp,$location,attachmentHttp,sanitizerHttp,projectsHttp,SynergyModels,SynergyHandlers){$scope.attachmentBase=$scope.SYNERGY.server.buildURL("run_attachment",{}),$scope.refreshCodemirror=!1,$scope.projects=[],$scope.testRun=new SynergyModels.TestRun("","","","",""),$scope.id=$routeParams.id||-1;var currentAction="",currentActionId=-1;try{$("#start").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"}),$("#end").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"})}catch(e){}$scope.loadPreview=function(){var _t="<h1>"+($scope.testRun.title||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.testRun.desc||"")+"</div>";sanitizerHttp.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.performAttachment=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete attachment?"),$("#deleteModalBody").html("<p>Do you really want to delete attachment?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteAttachment",currentActionId=id}},$scope.performAction=function(){switch(currentAction){case"deleteAttachment":if($("#deleteModal").modal("toggle"),void 0===$scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;attachmentHttp.removeRunAttachment($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success"),$scope.fetch()},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}},$scope.cancel=function(){window.history.back()},$scope.create=function(){var start=$("#start").val(),stop=$("#end").val();if($scope.myForm.$invalid||start.length<1||stop.length<1)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var _run=new SynergyModels.TestRun($scope.testRun.title,$scope.testRun.desc,$scope.getUTCTime(start),$scope.getUTCTime(stop),$scope.id).setNotifications($scope.testRun.notifications);_run.projectId=$scope.testRun.projectId,runHttp.create($scope,_run,function(data){$scope.SYNERGY.modal.update("Test run created",""),$scope.SYNERGY.modal.show(),$location.path("administration/runs/page/1")},$scope.generalHttpFactoryError)},$scope.edit=function(){var start=$("#start").val(),stop=$("#end").val();if($scope.myForm.$invalid||start.length<1||stop.length<1)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var _run=new SynergyModels.TestRun($scope.testRun.title,$scope.testRun.desc,$scope.getUTCTime(start),$scope.getUTCTime(stop),$scope.id).setNotifications($scope.testRun.notifications);_run.projectId=$scope.testRun.projectId,runHttp.edit($scope,_run,function(data){$scope.SYNERGY.modal.update("Test run updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)},$scope.uploadFile=function(){new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)}).uploadFileFromFileChooser("fileToUpload")},$scope.validDates=function(){return $scope.testRun.start=$("#start").val(),$scope.testRun.stop=$("#end").val(),!($scope.testRun.start.length<1||$scope.testRun.stop.length<1)},$scope.fetch=function(){if($scope.SYNERGY.session.hasAdminRights()){projectsHttp.getAll($scope,function(data){$scope.projects=data,null===$scope.testRun.projectName&&0<$scope.projects.length&&($scope.testRun.projectId=$scope.projects[0].id)},$scope.generalHttpFactoryError);var action=window.location+"";switch(action=action.substring(action.lastIndexOf("/")+1)){case"edit":if($scope.id<0)return;runHttp.getOverview($scope,!1,$scope.id,function(data){$scope.testRun=data,$scope.testRun.start=$scope.getLocalDateTime($scope.testRun.start),$scope.testRun.end=$scope.getLocalDateTime($scope.testRun.end),0<$scope.projects.length&&null===data.projectName&&($scope.testRun.projectId=$scope.projects[0].id),$scope.refreshCodemirror=!0},$scope.generalHttpFactoryError)}}},new SynergyHandlers.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)});var self=$scope;$scope.init(function(){self.fetch()})}function AdminMatrixAssignmentCtrl($scope,$routeParams,assignmentsHttp,usersHttp,labelsHttp,platformsHttp,tribesHttp,versionsHttp,SynergyUtils){$scope.assignment={platforms:[],users:[],tribes:[],runId:$routeParams.id},$scope.selectedPlatforms=[],$scope.platforms=[],$scope.platformId=-1,$scope.ready=0,$scope.fetch=function(){platformsHttp.get($scope,function(data){$scope.platforms=data,$scope.ready++},$scope.generalHttpFactoryError,!1),labelsHttp.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.labels=data},$scope.generalHttpFactoryError),usersHttp.getAll($scope,function(data){if(SynergyUtils.definedNotNull(data)&&SynergyUtils.definedNotNull(data.users))for(var i=0,max=data.users.length;i<max;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.ready++,$scope.users=data.users},$scope.generalHttpFactoryError),versionsHttp.get($scope,!1,function(data){$scope.versions=data,$scope.ready++},$scope.generalHttpFactoryError),tribesHttp.get($scope,function(data){$scope.tribes=data,$scope.ready++},$scope.generalHttpFactoryError)},$scope.create=function(){if($scope.assignment.users.length<1&&$scope.assignment.tribes.length<1||$scope.platforms.length<1)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();$scope.showWaitDialog(),assignmentsHttp.create($scope,$scope.assignment,function(data){$scope.SYNERGY.modal.update("Assignment created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data,status){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed for users ",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.addSelectedPlatform=function(){$scope.platformId&&!function(platformID){for(var i=0,max=$scope.assignment.platforms.length;i<max;i++)if(platformID===$scope.assignment.platforms[i].id)return!0;return!1}(parseInt($scope.platformId,10))&&($scope.assignment.platforms.push({id:parseInt($scope.platformId,10),name:function(platformID){for(var i=0,max=$scope.platforms.length;i<max;i++)if($scope.platforms[i].id===platformID)return $scope.platforms[i].name;return"oops"}(parseInt($scope.platformId,10))}),$scope.platformId=-1)},$scope.addSelectedTribe=function(){$scope.tribeId&&!function(tribeID){for(var i=0,max=$scope.assignment.tribes.length;i<max;i++)if(tribeID===$scope.assignment.tribes[i].id)return!0;return!1}(parseInt($scope.tribeId,10))&&($scope.assignment.tribes.push({id:parseInt($scope.tribeId,10),name:function(tribeID){for(var i=0,max=$scope.tribes.length;i<max;i++)if($scope.tribes[i].id===tribeID)return $scope.tribes[i].name;return"oops"}(parseInt($scope.tribeId,10))}),$scope.tribeId=-1)},$scope.addSelectedUser=function(){$scope.username&&!function(username){for(var i=0,max=$scope.assignment.users.length;i<max;i++)if(username===$scope.assignment.users[i].username)return!0;return!1}($scope.username)&&($scope.assignment.users.push({username:$scope.username,displayName:function(username){for(var i=0,max=$scope.users.length;i<max;i++)if($scope.users[i].username===username)return $scope.users[i].displayName;return"oops"}($scope.username)}),$scope.username="")},$scope.removeSelectedPlatform=function(platformID){for(var i=0,max=$scope.assignment.platforms.length;i<max;i++)if(platformID===$scope.assignment.platforms[i].id)return $scope.assignment.platforms.splice(i,1),void($scope.platformId=-1)},$scope.removeSelectedTribe=function(tribeId){for(var i=0,max=$scope.assignment.tribes.length;i<max;i++)if(tribeId===$scope.assignment.tribes[i].id)return $scope.assignment.tribes.splice(i,1),void($scope.tribesId=-1)},$scope.removeSelectedUser=function(username){for(var i=0,max=$scope.assignment.users.length;i<max;i++)if(username===$scope.assignment.users[i].username)return $scope.assignment.users.splice(i,1),void($scope.username=-1)},$scope.cancel=function(){window.history.back()};var self=$scope;$scope.init(function(){self.fetch()})}function AdminAssignmentCtrl($scope,$timeout,$routeParams,specificationsHttp,assignmentsHttp,usersHttp,labelsHttp,platformsHttp,tribesHttp,versionsHttp,assignmentHttp,runHttp,SynergyUtils,SynergyModels){$scope.testRunId=$routeParams.id,$scope.assignments=[],$scope.platforms=[],$scope.users=[],$scope.ready=0,$scope.value={},$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&(platformsHttp.get($scope,function(data){$scope.platforms=data,$scope.ready++,SynergyUtils.definedNotNull(data)&&0<data.length&&($scope.value.platform=data[0])},$scope.generalHttpFactoryError,!1),usersHttp.getAll($scope,function(data){if(SynergyUtils.definedNotNull(data)&&data.users)for(var i=0,max=data.users.length;i<max;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.ready++,$scope.users=data.users,SynergyUtils.definedNotNull(data)&&0<data.users.length&&($scope.value.user=$scope.users[0])},$scope.generalHttpFactoryError),labelsHttp.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.labels=data,$scope.value.label=data[data.length-1]},$scope.generalHttpFactoryError),runHttp.getSpecifications($scope,$scope.testRunId,function(data){$scope.specifications=[];for(var i=0,max=data.specifications.length;i<max;i+=1)$scope.specifications[i]={value:data.specifications[i].title+" ("+(null===data.projectName||void 0===data.projectName?$scope.SYNERGY.product:data.projectName)+" "+data.specifications[i].version+")",info:"<a href='#/specification/"+data.specifications[i].id+"'>view</a>",id:data.specifications[i].id,type:"specification",version:data.specifications[i].version};$scope.value.specification=$scope.specifications[0],$scope.ready++},$scope.generalHttpFactoryError))};var self=$scope;$scope.init(function(){self.fetch()}),$scope.addAssignment=function(){if($scope.value.specification){var assignment=new SynergyModels.TestAssignment(parseInt($scope.value.platform.id,10),$scope.value.user.username,parseInt($scope.value.label.id,10));assignment.specificationId=parseInt($scope.value.specification.id,10),assignment.testRunId=parseInt($scope.testRunId,10),assignment.display={user:$scope.value.user.firstName+" "+$scope.value.user.lastName,label:$scope.value.label.label,platform:$scope.value.platform.name,duplicates:!1,specification:$scope.value.specification.value},$scope.assignments.push(assignment),assignmentHttp.checkExists($scope,assignment).then(function(data){assignment.display.duplicates=!0},function(response){switch(response.status){case 404:assignment.display.duplicates=!1;break;default:$scope.SYNERGY.logger.log("Action failed","Unable to check for duplicates","INFO","alert-error")}})}else $scope.SYNERGY.logger.showMsg("Oops","No specification selected (maybe tribe does not have any specification?)","alert-error")},$scope.removeAssignment=function(index){$scope.assignments.splice(index,1)},$scope.cancel=function(){window.history.back()},$scope.create=function(){$scope.showWaitDialog(),assignmentsHttp.createForUsers($scope,$scope.assignments,function(data){$scope.SYNERGY.modal.update("Assignments created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed ",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}}function AdminUsersCtrl($scope,$location,$routeParams,userHttp,usersHttp){$scope.users=[],$scope.page=$routeParams.page||1;var currentUser="";$scope.importUsersUrl="http://"+window.location.host+"/dashboard/web/a_netcatusers.php",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&usersHttp.get($scope,$scope.page,function(data){$scope.users=data.users,$scope.next=1<data.nextUrl.length?1:0,$scope.prev=1<data.prevUrl.length?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)},$scope.importUsers=function(){usersHttp.importUsers($scope,$scope.importUsersUrl,function(data){$scope.SYNERGY.logger.log("Done",data+" users imported","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.retireUsers=function(){usersHttp.retireUsersWithRole($scope,"tester",function(){$scope.SYNERGY.logger.log("Done","Removed users with role 'tester' retired","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.perform=function(action,username){if("delete"!==action)$location.path("administration/user/"+username+"/"+action);else switch(action){case"delete":$("#deleteModal").modal("toggle"),currentUser=username}},$scope.newuser=function(){$location.path("administration/user/-1/create")},$scope.deleteUser=function(){$("#deleteModal").modal("toggle"),userHttp.remove($scope,currentUser,function(data){$scope.SYNERGY.logger.log("Done","User removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminUserCtrl($scope,$routeParams,userHttp,SynergyModels){$scope.user={},$scope.username=$routeParams.username||"",$scope.passwordChangeAllowed=!$scope.SYNERGY.useSSO,$scope.updatePassword=!1,this.oldUsername="";var self=this;$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&"-1"!==$scope.username&&userHttp.get($scope,$scope.username,function(data){self.oldUsername=$scope.username,$scope.user=data},$scope.generalHttpFactoryError)},$scope.cancel=function(){window.history.back()},$scope.save=function(){var invalidPassword=void 0===$scope.user.password||null===$scope.user.password||$scope.user.password.length<1;if($scope.myForm.$invalid||$scope.updatePassword&&invalidPassword)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var u=new SynergyModels.User($scope.user.firstName,$scope.user.lastName,$scope.user.username,$scope.user.role,-1);u.email=$scope.user.email,$scope.updatePassword&&(u.password=$scope.user.password),u.emailNotifications=$scope.user.emailNotifications,userHttp.create($scope,u,function(data){$scope.SYNERGY.modal.update("User created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)},$scope.edit=function(){var invalidPassword=void 0===$scope.user.password||null===$scope.user.password||$scope.user.password.length<1;if($scope.myForm.$invalid||$scope.updatePassword&&invalidPassword)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var u=new SynergyModels.User($scope.user.firstName,$scope.user.lastName,$scope.user.username,$scope.user.role,-1,self.oldUsername);u.email=$scope.user.email,$scope.updatePassword&&(u.password=$scope.user.password),u.emailNotifications=$scope.user.emailNotifications,userHttp.edit($scope,u,function(data){$scope.SYNERGY.modal.update("User updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)};var self2=$scope;$scope.init(function(){self2.fetch()})}function AdminSettingCtrl($scope,settingsHttp){$scope.settings=[],$scope.newValue="",$scope.newDesc="",$scope.newKey="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&settingsHttp.get($scope,function(data){$scope.settings=data},$scope.generalHttpFactoryError)},$scope.save=function(){for(var i=0,limit=$scope.settings.length;i<limit;i+=1)if($scope.settings[i].value.length<1)return void $scope.SYNERGY.logger.log("Missing value: ",$scope.settings[i].key,"INFO","alert-error");settingsHttp.edit($scope,$scope.settings,function(data){$scope.SYNERGY.logger.log("Done","Settings updated","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.addSetting=function(){$scope.settings.push({value:$scope.newValue,label:$scope.newDesc,key:$scope.newKey}),$scope.newValue=$scope.newDesc=$scope.newKey=""};var self=$scope;$scope.init(function(){self.fetch()})}function AboutCtrl($scope,aboutHttp){$scope.$emit("updateNavbar",{item:"nav_empty"}),$scope.statistics=[],$scope.fetch=function(){aboutHttp.get($scope,function(data){$scope.$emit("updateBreadcrumbs",{link:"about",title:"About"}),$scope.statistics=data},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function TribesCtrl($scope,$location,$timeout,tribesHttp){$scope.$emit("updateNavbar",{item:"nav_empty"}),$scope.tribes=[],$scope.fetch=function(){tribesHttp.get($scope,function(data){$scope.tribes=data,$scope.$emit("updateBreadcrumbs",{link:"tribes",title:"Tribes"})},$scope.generalHttpFactoryError,!0)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminLogCtrl($scope,logHttp,sessionRenewalHttp){$scope.logContent="",$scope.fetch=function(){logHttp.get($scope,function(data){$scope.logContent=data},$scope.generalHttpFactoryError)},$scope.deleteLog=function(){logHttp.remove($scope,function(){$scope.logContent="",$scope.SYNERGY.logger.log("Deleted","","INFO","alert-info")},$scope.generalHttpFactoryError)},$scope.sso=function(){sessionRenewalHttp.test($scope,function(d){window.console.log("Done")},function(d){window.console.log("Opps, not done at all")})};var self=$scope;$scope.init(function(){self.fetch()})}function AdminDatabaseCtrl($scope,databaseHttp){$scope.order="ASC",$scope.tables=[],$scope.columns=[],$scope.orderBy="",$scope.data=[],$scope.limit=10,$scope.selectedTable="",$scope.fetch=function(){databaseHttp.getTables($scope,function(data){$scope.tables=data},$scope.generalHttpFactoryError)},$scope.loadTable=function(){databaseHttp.getColumns($scope,$scope.selectedTable,function(data){$scope.columns=data,$scope.orderBy=data[0]},$scope.generalHttpFactoryError)},$scope.show=function(){databaseHttp.listTable($scope,$scope.selectedTable,$scope.limit||10,$scope.order,$scope.orderBy||"id",function(data){$scope.data=data},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AssignmentVolunteerCtrl($scope,$routeParams,specificationsHttp,assignmentHttp,labelsHttp,platformsHttp,versionsHttp,reviewHttp,runHttp,SynergyUtils,SynergyModels){$scope.suggestions=[],$scope.specifications=[],$scope.assignment={testRun:$routeParams.id,username:"",tribe:-1,specification:"",label:"",platform:"",specificationId:"",labelId:"",platformId:""},$scope.platforms=[],$scope.ready=0,$scope.assignmentType="test",$scope.reviewUrl,$scope.availablePages=[],$scope.reviewPage=null,$scope.showOnlyNotUsedPages=!0;var deleteModalDisplayed=!1;$scope.initData=function(){"review"===$scope.assignmentType&&$scope.changeAvailablePages()},$scope.fetch=function(){platformsHttp.get($scope,function(data){$scope.platforms=data,$scope.ready++,SynergyUtils.definedNotNull(data)&&0<data.length&&($scope.assignment.platform=data[0].id)},$scope.generalHttpFactoryError,!0),labelsHttp.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.labels=data,$scope.assignment.label=data[data.length-1].id},$scope.generalHttpFactoryError),versionsHttp.get($scope,!0,function(data){$scope.versions=data,$scope.ready++,SynergyUtils.definedNotNull(data)&&0<data.length&&($scope.selectedVersion=data[0].name,$scope.filter())},$scope.generalHttpFactoryError),runHttp.getSpecifications($scope,$routeParams.id,function(data){$scope.specifications=[];for(var i=0,max=data.specifications.length;i<max;i+=1)$scope.specifications[i]={value:data.specifications[i].title+" ("+(null===data.projectName||void 0===data.projectName?$scope.SYNERGY.product:data.projectName)+" "+data.specifications[i].version+")",info:"<a href='#/specification/"+data.specifications[i].id+"'>view</a>",id:data.specifications[i].id,type:"specification",version:data.specifications[i].version};$scope.filter(),$scope.ready++},$scope.generalHttpFactoryError)},$scope.changeAvailablePages=function(){$scope.showOnlyNotUsedPages?reviewHttp.listNotStarted($scope,$scope.assignment.testRun,function(d){$scope.availablePages=d},$scope.generalHttpFactoryError):reviewHttp.list($scope,function(d){$scope.availablePages=d},$scope.generalHttpFactoryError)},$scope.filter=function(){for(var matching=[],i=0,max=$scope.specifications.length;i<max;i++)$scope.selectedVersion===$scope.specifications[i].version&&matching.push($scope.specifications[i]);$scope.suggestions=matching};var self=$scope;function submitAssignmentData(assignment){$scope.showWaitDialog(),assignmentHttp.createVolunteer($scope,assignment,function(data){$scope.SYNERGY.modal.update("Assignment created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}$scope.init(function(){self.fetch()}),$scope.cancel=function(){window.history.back()},$scope.create=function(skipDuplicateCheck){if("review"!==$scope.assignmentType){var assignment=new SynergyModels.TestAssignment(parseInt($scope.assignment.platform,10),$scope.SYNERGY.session.username,parseInt($scope.assignment.label,10));return assignment.specificationId=parseInt($scope.assignment.specificationId,10),assignment.testRunId=parseInt($scope.assignment.testRun,10),!$scope.assignment.specificationId||assignment.platformId<0?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):$scope.assignedToUser&&assignment.username.length<1||$scope.assignedToTribe&&$scope.assignment.tribe.id<1?($scope.SYNERGY.modal.update("Missing assignee",""),void $scope.SYNERGY.modal.show()):assignment.labelId<0&&0<parseInt($scope.assignment.label,10)?($scope.SYNERGY.modal.update("Label does not exist",""),void $scope.SYNERGY.modal.show()):void(skipDuplicateCheck?(deleteModalDisplayed&&$("#deleteModal").modal("toggle"),submitAssignmentData(assignment)):function(assignment){assignmentHttp.checkExists($scope,assignment).then(function(data){$("#deleteModal").modal("toggle"),deleteModalDisplayed=!0},function(response){switch(response.status){case 404:submitAssignmentData(assignment);break;default:$scope.SYNERGY.logger.log("Action failed","Unable to check for duplicates","INFO","alert-error")}})}(assignment))}!function(){if(null===$scope.reviewPage)return $scope.SYNERGY.modal.update("Missing required fields",""),$scope.SYNERGY.modal.show();var reviewAssignment=new SynergyModels.ReviewAssignment($scope.SYNERGY.session.username,$scope.reviewPage.url);reviewAssignment.owner=$scope.reviewPage.owner,reviewAssignment.title=$scope.reviewPage.title,reviewAssignment.testRunId=parseInt($scope.assignment.testRun,10),reviewHttp.createVolunteer($scope,reviewAssignment,function(data){$scope.SYNERGY.modal.update("Assignment created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}()}}function RevisionCtrl($scope,$routeParams,revisionsHttp){$scope.revisions=[],$scope.specificationId=$routeParams.id,$scope.fetch=function(){revisionsHttp.listRevisions($scope,$scope.specificationId,function(data){$scope.revisions=data},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()}),$scope.compareRevisions=function(){revisionsHttp.getRevisions($scope,$scope.choiceA,$scope.choiceB,$scope.specificationId,function(data){var rev1,rev2,base,newtxt,opcodes,diffoutputdiv;rev1=data[0],rev2=data[1],base=difflib.stringAsLines(rev1.content),newtxt=difflib.stringAsLines(rev2.content),opcodes=new difflib.SequenceMatcher(base,newtxt).get_opcodes(),(diffoutputdiv=$("#diffoutput")).html(""),diffoutputdiv.append(diffview.buildView({baseTextLines:base,newTextLines:newtxt,opcodes:opcodes,baseTextName:$scope.getLocalTime(rev1.date,!0)+"("+rev1.author+")",newTextName:$scope.getLocalTime(rev2.date,!0)+"("+rev2.author+")",contextSize:null,viewType:1}))},$scope.generalHttpFactoryError)}}function CalendarCtrl($scope,calendarHttp){$scope.$emit("updateBreadcrumbs",{link:"calendar",title:"Calendar"}),calendarHttp.getEvents($scope,function(data){for(var items=[],i=0,max=data.length;i<max;i+=1)items.push({url:"#/run/"+data[i].id,title:data[i].title,start:new Date(data[i].start.substr(0,4),parseInt(data[i].start.substr(4,2),10)-1,data[i].start.substr(6,2)),end:new Date(data[i].end.substr(0,4),parseInt(data[i].end.substr(4,2),10)-1,data[i].end.substr(6,2))});$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},editable:!0,events:items,eventMouseover:function(event,jsEvent,view){"agendaDay"!==view.name&&$(jsEvent.target).attr("title",event.title)}})},function(){window.console.log("Failed to load calendar events")})}function AssignmentTribeCtrl($scope,$routeParams,tribesHttp,labelsHttp,platformsHttp,assignmentsHttp,assignmentHttp,SynergyModels){$scope.tribes=[],$scope.platforms=[],$scope.labels=[],$scope.ready=0,$scope.value={},$scope.assignments=[],$scope.runId=$routeParams.id,$scope.fetch=function(){tribesHttp.getTribesForRun($scope,$scope.SYNERGY.session.username,$scope.runId,function(data){!function(data){for(var t=0,max=data.length;t<max;t++)if(data[t].hasOwnProperty("ext")&&data[t].ext.hasOwnProperty("specifications"))for(var s=0,maxs=data[t].ext.specifications.length;s<maxs;s++)data[t].ext.specifications[s].hasOwnProperty("projects")&&0<data[t].ext.specifications[s].projects.length?data[t].ext.specifications[s]._project=data[t].ext.specifications[s].projects[0].name:data[t].ext.specifications[s]._project=$scope.SYNERGY.product}(data),$scope.tribes=data,$scope.selectedTribe=data[0],$scope.value.user=data[0].members[0],data[0].ext.specifications&&($scope.value.specification=data[0].ext.specifications[0]),$scope.ready++},$scope.generalHttpFactoryError),labelsHttp.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.value.label=data[data.length-1],$scope.labels=data},$scope.generalHttpFactoryError),platformsHttp.get($scope,function(data){$scope.platforms=data,$scope.value.platform=data[0],$scope.ready++},$scope.generalHttpFactoryError,!0)},$scope.addAssignment=function(){if($scope.value.specification){var assignment=new SynergyModels.TestAssignment(parseInt($scope.value.platform.id,10),$scope.value.user.username,parseInt($scope.value.label.id,10));assignment.specificationId=parseInt($scope.value.specification.id,10),assignment.testRunId=parseInt($scope.runId,10),assignment.tribeId=parseInt($scope.selectedTribe.id,10),assignment.display={tribe:$scope.selectedTribe.name,user:$scope.value.user.firstName+" "+$scope.value.user.lastName,label:$scope.value.label.label,platform:$scope.value.platform.name,specification:$scope.value.specification.title+" ("+$scope.SYNERGY.product+" "+$scope.value.specification.version+")",duplicates:!1},$scope.assignments.push(assignment),assignmentHttp.checkExists($scope,assignment).then(function(data){assignment.display.duplicates=!0},function(response){switch(response.status){case 404:assignment.display.duplicates=!1;break;default:$scope.SYNERGY.logger.log("Action failed","Unable to check for duplicates","INFO","alert-error")}})}else $scope.SYNERGY.logger.showMsg("Oops","No specification selected (maybe tribe does not have any specification?)","alert-error")},$scope.filterTribe=function(){$scope.value.user=$scope.selectedTribe.members[0],$scope.selectedTribe.ext.specifications&&($scope.value.specification=$scope.selectedTribe.ext.specifications[0])},$scope.removeAssignment=function(index){$scope.assignments.splice(index,1)},$scope.cancel=function(){window.history.back()},$scope.create=function(){assignmentsHttp.createForTribes($scope,$scope.assignments,function(data){$scope.SYNERGY.modal.update("Assignments created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function StatisticsCtrl($scope,statisticsHttp,$routeParams,SynergyUtils,SynergyModels,SynergyHandlers,SynergyIssue){$scope.id=$routeParams.id,$scope.timeView="all",$scope.inArchive=0<window.location.href.indexOf("archive"),$scope.orderProp={prop:"time",descending:!0};try{$("#start").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"}),$("#end").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"})}catch(e){}$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.unknownIssues=[],$scope.allIssues=[],$scope.reviewTotal={},$scope.orderPropU={prop:"time",descending:!0},$scope.orderPropR={prop:"time",descending:!0};var cache={};$scope.tribes=[];var tribesSpecs=[];$scope.data={},$scope.computed={};var totalCounts={},fallback=!1;function evaluateReviews(reviews){for(var total={total:reviews.length,completed:0,time:0,comments:0,reviewers:0},collector=new SynergyModels.UserReviewStats,i=0,max=reviews.length;i<max;i++)reviews[i].isFinished&&total.completed++,total.time+=reviews[i].timeTaken,total.comments+=reviews[i].numberOfComments,collector.addReview(reviews[i]);total.time=Math.floor(total.time/60)+" hours and "+total.time%60+" minutes",$scope.reviews=collector.finish(),total.reviewers=$scope.reviews.length,total.finishRate=Math.round(1e3*total.completed/total.total)/10||0,$scope.reviewTotal=total}function evaluateComputedData(data){var computed={};computed.testers=function(data){if(totalCounts.passed=0,totalCounts.timeToComplete=0,!data.assigneesOverview)return[];var testers=[],_hours=0;for(var i in data.assigneesOverview)if(data.assigneesOverview.hasOwnProperty(i)){for(var t={completedCases:_hours=0,username:i,name:data.assigneesOverview[i].name,time:0,prettyTime:""},k=0,max3=data.assigneesOverview[i].assignments.length;k<max3;k++)totalCounts.timeToComplete+=data.assigneesOverview[i].assignments[k].totalTime,t.time+=data.assigneesOverview[i].assignments[k].totalTime,totalCounts.passed+=parseInt(data.assigneesOverview[i].assignments[k].passedCases,10),t.completedCases+=parseInt(data.assigneesOverview[i].assignments[k].completedCases,10);_hours=Math.floor(t.time/60),t.prettyTime=(0<_hours?_hours+" hours and ":"")+t.time%60+" minutes",testers.push(t)}return testers}(data),computed.testers=computed.testers.filter(function(t){return 0<t.completedCases}),computed.testersCount=computed.testers.length,computed.time=Math.floor(totalCounts.timeToComplete/60)+" hours and "+totalCounts.timeToComplete%60+" minutes",computed.completedRelative=Math.round(1e3*data.testRun.completed/data.testRun.total)/10||0,computed.passRate=Math.round(1e3*totalCounts.passed/data.testRun.completed)/10||0,$scope.tribes=function(data){if(!data.assigneesOverview)return;var _t,assignments=data.assigneesOverview,tribes={};for(var i in assignments)if(assignments.hasOwnProperty(i))for(var j=0,max2=assignments[i].tribes.length;j<max2;j++)_t=assignments[i].tribes[j],tribes[_t.name]||(tribes[_t.name]=new SynergyModels.TribeRunStats(_t.name,_t.id,tribesSpecs)),tribes[_t.name].addAssignment(assignments[i].assignments);return $scope.SYNERGY.util.toIndexedArray(tribes)}(data),$scope.issuesTotal=data.issues.length,$scope.issuesUrl=$scope.SYNERGY.issues.viewLink(data.testRun.projectName,data.issues),$scope.issueColor=function(issues){for(var sums={P1:0,P2:0,P3:0,P4:0},i=0,max=issues.length;i<max;i++)sums[issues[i].priority]++;if(0<sums.P1)return"bugs-error";if(1===sums.P2)return"bugs-warning";if(1<sums.P2)return"bugs-orange";return"bugs-success"}(data.issues);var issueCollector=new SynergyIssue.RunIssuesCollector;issueCollector.addIssues(data.issues),$scope.unresolvedIssues=issueCollector.issuesStats.unresolvedIssues,$scope.P1Issues=issueCollector.issuesStats.P1Issues,$scope.unknownIssues=issueCollector.issuesStats.unknownIssues,$scope.P2Issues=issueCollector.issuesStats.P2Issues,$scope.P3Issues=issueCollector.issuesStats.P3Issues,$scope.computed=computed,SynergyUtils.ProgressChart([issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100),100-issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100)],["#ccc","#62c462"],["Unresolved","Resolved"],"issuesResolution"),SynergyUtils.ProgressChart([issueCollector.issuesStats.P1/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P2/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P3/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P4/(issueCollector.issuesStats.total/100)],["#ee5f5b","#f89406","#fbeed5","#ccc"],["P1 ("+issueCollector.issuesStats.P1+")","P2 ("+issueCollector.issuesStats.P2+")","P3 ("+issueCollector.issuesStats.P3+")","P4 ("+issueCollector.issuesStats.P4+")"],"issuesPriority"),SynergyUtils.ProgressChart([$scope.computed.completedRelative,100-$scope.computed.completedRelative],["#08c","#ccc"],["Executed cases","Pending cases"],"canvas1"),SynergyUtils.ProgressChart([$scope.computed.passRate,100-$scope.computed.passRate],["#62c462","#ccc"],["Passed cases","Other cases"],"canvas2")}$scope.fetch=function(){$scope.inArchive?statisticsHttp.getArchive($scope,$scope.id,fallback,function(data){$scope.data=data,tribesSpecs=(cache=data).tribes,evaluateComputedData(data),data.reviews&&evaluateReviews(data.reviews)},function(data,status){if(404===status&&!fallback)return $scope.SYNERGY.logger.log("Opps","Statistics not found, trying alternative way","INFO","alert-warning"),fallback=!0,void self.fetch();$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}):statisticsHttp.get($scope,$scope.id,function(data){cache=data,$scope.data=data,tribesSpecs=data.tribes,evaluateComputedData(data),data.reviews&&evaluateReviews(data.reviews)},$scope.generalHttpFactoryError)},$scope.getAllTimeData=function(){"all"===$scope.timeView?($scope.data=cache,tribesSpecs=cache.tribes,evaluateComputedData(cache),$scope.data.reviews&&evaluateReviews($scope.data.reviews)):($("#start").val(""),$("#end").val(""))},$scope.filterStatistics=function(){var start=$("#start").val(),stop=$("#end").val();start.length<1||stop.length<1?$scope.SYNERGY.logger.log("Missing data","Please specify both 'from' and 'to' time periods","INFO","alert-error"):$scope.inArchive?function(start,stop){start=SynergyUtils.localToUTCTimestamp(start),stop=SynergyUtils.localToUTCTimestamp(stop),$scope.data=new SynergyHandlers.ArchiveDataFilter(SynergyUtils.shallowClone(cache)).getData(start,stop),tribesSpecs=$scope.data.tribes,evaluateComputedData($scope.data),$scope.data.reviews&&evaluateReviews($scope.data.reviews)}(start,stop):statisticsHttp.getPeriod($scope,$scope.id,{from:$scope.getUTCTime(start),to:$scope.getUTCTime(stop)},function(data){$scope.data=data,tribesSpecs=data.tribes,evaluateComputedData(data),$scope.data.reviews&&evaluateReviews($scope.data.reviews)},$scope.generalHttpFactoryError)},$scope.sortTribes=function(prop){$scope.orderProp.prop===prop?$scope.orderProp.descending=!$scope.orderProp.descending:$scope.orderProp={prop:prop,descending:!0}},$scope.sortUsers=function(prop){$scope.orderPropU.prop===prop?$scope.orderPropU.descending=!$scope.orderPropU.descending:$scope.orderPropU={prop:prop,descending:!0}},$scope.sortReviewers=function(prop){$scope.orderPropR.prop===prop?$scope.orderPropR.descending=!$scope.orderPropR.descending:$scope.orderPropR={prop:prop,descending:!0}};var self=$scope;$scope.init(function(){self.fetch()})}function AssignmentCommentsCtrl($scope,$routeParams,assignmentHttp,SynergyUtils){$scope.id=$routeParams.id||-1,$scope.filters={},$scope.isLoading=!1,$scope.pageSize=$scope.SYNERGY.commentsPage,$scope.filter={case:"All",specification:"All",reporter:"All",resolver:"All",comment:"All",status:"All"},$scope.duplicates=[];var duplicatesFull=[],commentToBeResolved={};$scope.fetch=function(){$scope.id<0||assignmentHttp.getComments($scope,$scope.id,function(data){!function(data){for(var cases=[],specifications=[],reporters=[],comments=[],status=[],resolvers=[],i=0,max=data.comments.length;i<max;i++)cases.indexOf(data.comments[i].caseTitle)<0&&cases.push(data.comments[i].caseTitle),specifications.indexOf(data.comments[i].specificationTitle)<0&&specifications.push(data.comments[i].specificationTitle),reporters.indexOf(data.comments[i].authorDisplayName)<0&&reporters.push(data.comments[i].authorDisplayName),status.indexOf(data.comments[i].resolution)<0&&status.push(data.comments[i].resolution),SynergyUtils.definedNotNull(data.comments[i].resolverDisplayName)&&resolvers.indexOf(data.comments[i].resolverDisplayName)<0&&resolvers.push(data.comments[i].resolverDisplayName),comments.indexOf(data.comments[i].commentText)<0&&comments.push(data.comments[i].commentText);var sortFnc=function(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a===b?0:b<a?1:-1};cases.sort(sortFnc),cases.push("All"),specifications.sort(sortFnc),specifications.push("All"),reporters.sort(sortFnc),reporters.push("All"),comments.sort(sortFnc),comments.push("All"),status.sort(sortFnc),status.push("All"),resolvers.sort(sortFnc),resolvers.push("All"),$scope.filters={cases:cases,specifications:specifications,reporters:reporters,comments:comments,status:status,resolvers:resolvers}}($scope.data=data)},$scope.generalHttpFactoryError)},$scope.nextPage=function(){$scope.isLoading=!0,$scope.pageSize+=$scope.SYNERGY.commentsPage,$scope.isLoading=!1};var self=$scope;$scope.init(function(){self.fetch()}),$scope.commentFilter=function(comment){return(!$scope.filter.case||"All"===$scope.filter.case||comment.caseTitle===$scope.filter.case)&&((!$scope.filter.specification||"All"===$scope.filter.specification||comment.specificationTitle===$scope.filter.specification)&&((!$scope.filter.reporter||"All"===$scope.filter.reporter||comment.authorDisplayName===$scope.filter.reporter)&&((!$scope.filter.comment||"All"===$scope.filter.comment||comment.commentText===$scope.filter.comment)&&((!$scope.filter.status||"All"===$scope.filter.status||comment.resolution===$scope.filter.status)&&(!$scope.filter.resolver||"All"===$scope.filter.resolver||comment.resolverDisplayName===$scope.filter.resolver)))))},$scope.resolveComment=function(comment){commentToBeResolved=comment,$scope.duplicates=function(comment){var similars=[];duplicatesFull=[];for(var i=0,max=$scope.data.comments.length;i<max;i++)$scope.data.comments[i].caseId===comment.caseId&&$scope.data.comments[i].id!==comment.id&&$scope.data.comments[i].suiteId===comment.suiteId&&$scope.data.comments[i].commentText===comment.commentText&&"new"===$scope.data.comments[i].resolution&&(duplicatesFull.push($scope.data.comments[i]),similars.push({id:$scope.data.comments[i].id}));return similars}(comment),duplicatesFull.push(comment),0===$scope.duplicates.length?$scope.resolveContinue(!1):$("#resolveModal").modal("toggle")},$scope.resolveContinue=function(resolveDuplicates){resolveDuplicates&&$scope.duplicates.push({id:commentToBeResolved.id}),$scope.showWaitDialog(),assignmentHttp.resolveComments($scope,resolveDuplicates?$scope.duplicates:[{id:commentToBeResolved.id}],function(data){if($scope.showWaitDialog(),resolveDuplicates){for(var i=0,max=duplicatesFull.length;i<max;i++)duplicatesFull[i].resolution="resolved",duplicatesFull[i].resolverUsername=$scope.SYNERGY.session.username,duplicatesFull[i].resolverDisplayName=$scope.SYNERGY.session.firstName+" "+$scope.SYNERGY.session.lastName;$("#resolveModal").modal("toggle")}else duplicatesFull[duplicatesFull.length-1].resolution="resolved",duplicatesFull[duplicatesFull.length-1].resolverUsername=$scope.SYNERGY.session.username,duplicatesFull[duplicatesFull.length-1].resolverDisplayName=$scope.SYNERGY.session.firstName+" "+$scope.SYNERGY.session.lastName;$scope.SYNERGY.logger.log("Done","Comments resolved","INFO","alert-success")},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}}function ReviewCtrl($scope,$routeParams,reviewHttp,SynergyUtils,SynergyModels){var iframe=window.document.getElementById("tutorialFrame"),action=$routeParams.action||"view";$scope.id=parseInt($routeParams.id,10)||-1,$scope.review={},$scope.currentComment=new SynergyModels.ReviewComment($scope.tutorialUrl),window.addEventListener?window.addEventListener("message",handleIframeSelection):window.attachEvent("onmessage",handleIframeSelection),$scope.frameSrc="",$scope.isEditing=!1,$scope.commentAction="Add";var oldCopy=null,editingIndex=-1,cachedData=null,started=0,sentAs=-1,pageLength=-1;function fetch(){(cachedData=$scope.SYNERGY.cache.get("review_progress_"+$scope.id))&&cachedData.date&&cachedData.progress?$scope.sendCached(!0):reviewHttp.get($scope,$scope.id,action,function(data){$scope.review=data,$scope.frameSrc="../../server/api/review.php?url="+encodeURIComponent($scope.review.reviewUrl),window.document.getElementById("frameContainer").innerHTML='<iframe data-ng-hide="frameSrc.length < 1" id="tutorialFrame" style="width: 100%; height: 1000px" src="'+$scope.frameSrc+'"></iframe>',started=(new Date).getTime(),iframe=window.document.getElementById("tutorialFrame")},$scope.generalHttpFactoryError)}function handleIframeSelection(msg){var _data=msg.data;switch("string"==typeof _data&&(_data=JSON.parse(msg.data)),_data.action){case"added":$scope.currentComment.addElement(_data.xpath,_data.element);break;case"removed":$scope.currentComment.removeElement(_data.xpath);break;default:pageLength=parseInt(_data.words,10)}try{$scope.$$phase||$scope.$apply()}catch(e){}}$scope.cancelEditing=function(){$scope.currentComment=new SynergyModels.ReviewComment($scope.review.reviewUrl),$scope.review.comments[editingIndex]=oldCopy,iframe.contentWindow.postMessage('{"action" : "clear"}',"*"),$scope.isEditing=!1,$scope.commentAction="Add"},$scope.sendCached=function(send){send?($("#attemptModal").modal("toggle"),$scope.review.comments=cachedData.progress,$scope.review.timeTaken=cachedData.timeTaken,$scope.review.weight=cachedData.weight,$scope.submit(sentAs)):($scope.SYNERGY.cache.clear("review_progress_"+$scope.id),fetch())},$scope.submit=function(mode){-1===sentAs&&(sentAs=mode),mode=sentAs;var assignment=new SynergyModels.ReviewAssignment($scope.SYNERGY.session.username,$scope.review.reviewUrl);assignment.comments=$scope.review.comments,assignment.id=$scope.id,assignment.testRunId=$scope.review.testRunId,assignment.isFinished=1===parseInt(mode,10),assignment.timeTaken=(new Date).getTime()-started,assignment.weight=pageLength,$scope.showWaitDialog(),$scope.SYNERGY.cache.put("review_progress_"+$scope.id,{date:(new Date).toString(),timeTaken:assignment.timeTaken,weight:pageLength,progress:assignment.comments}),reviewHttp.submitResults($scope,$scope.id,assignment,function(){$scope.SYNERGY.modal.update("Results submitted","Thank you for review"),$scope.SYNERGY.modal.show(),$scope.SYNERGY.cache.clear("review_progress_"+$scope.id),window.addEventListener?window.removeEventListener("message",handleIframeSelection):window.detachEvent("onmessage",handleIframeSelection),$scope.review={},$scope.failedAttempt=!1,$scope.currentComment=new SynergyModels.ReviewComment($scope.tutorialUrl),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.failedAttempt||($scope.failedAttempt=!0,$("#deleteModal").modal("toggle")),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.addComment=function(){$scope.isEditing||$scope.review.comments.push($scope.currentComment),$scope.isEditing=!1,$scope.commentAction="Add",$scope.SYNERGY.cache.put("review_progress_"+$scope.id,{date:(new Date).toString(),timeTaken:(new Date).getTime()-started,weight:pageLength,progress:$scope.review.comments}),$scope.currentComment=new SynergyModels.ReviewComment($scope.review.reviewUrl),iframe.contentWindow.postMessage('{"action" : "clear"}',"*")},$scope.editComment=function(index){oldCopy=SynergyUtils.shallowClone($scope.review.comments[index]),editingIndex=index,$scope.currentComment=$scope.review.comments[index],$scope.isEditing=!0,$scope.commentAction="Edit",iframe.contentWindow.postMessage(JSON.stringify({action:"highlight",elements:$scope.currentComment.elements}),"*")},$scope.viewComment=function(index){iframe.contentWindow.postMessage(JSON.stringify({action:"highlight",elements:$scope.review.comments[index].elements}),"*")},$scope.removeComment=function(index){$scope.review.comments.splice(index,1),iframe.contentWindow.postMessage('{"action" : "clear"}',"*")},$scope.init(function(){fetch()})}function AdminReviewsCtrl($scope,reviewHttp){function fetch(){$scope.SYNERGY.session.hasAdminRights()&&reviewHttp.list($scope,function(data){$scope.existingReviewPages=data},$scope.generalHttpFactoryError)}$scope.existingReviewPages=[],$scope.importUrl="http://wiki.netbeans.org/NetBeansTutorialsForCommunityReview",$scope.newReview={title:"",owner:"",url:""},$scope.importData=function(){reviewHttp.importFromUrl($scope,$scope.importUrl,function(){$scope.SYNERGY.logger.log("Done","Data imported","INFO","alert-success"),fetch()},$scope.generalHttpFactoryError)},$scope.create=function(){reviewHttp.create($scope,$scope.newReview,function(){$scope.SYNERGY.logger.log("Done","Review page created","INFO","alert-success"),fetch()},$scope.generalHttpFactoryError)},$scope.perform=function(action){switch(action){case"create":$scope.newReview={title:"",owner:"",url:""},$("#createTutorialModal").modal("toggle")}},$scope.init(function(){fetch()})}function AdminProjectsCtrl($scope,projectsHttp,projectHttp,$location,SynergyModels){$scope.projects=[];var projectAffectedId=0;$scope.newname="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&projectsHttp.getAll($scope,function(data){$scope.projects=data},$scope.generalHttpFactoryError)},$scope.perform=function(action,projectId,projectName){switch(action){case"edit":$location.path("administration/project/"+projectId+"/edit");break;case"create":$scope.newname="",$("#createVersionModal").modal("toggle");break;case"delete":projectAffectedId=projectId,$("#deleteModal").modal("toggle")}},$scope.remove=function(){$("#deleteModal").modal("toggle"),projectHttp.remove($scope,projectAffectedId,function(){$scope.SYNERGY.logger.log("Done","Project removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.create=function(){projectHttp.create($scope,new SynergyModels.Version($scope.newname,-1,!1),function(data){$scope.SYNERGY.logger.log("Done","Project created","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function RegisterCtrl($scope,registerHttp,SynergyModels){$scope.username="",$scope.email="",$scope.firstname="",$scope.lastname="",$scope.password="",$scope.password2="",$scope.register=function(){if($scope.registerForm.$valid&&$scope.password===$scope.password2){var reg=new SynergyModels.Registration($scope.username,$scope.email,$scope.firstname,$scope.lastname);reg.password=$scope.password,registerHttp.doRegister($scope,reg,function(){window.history.back()},$scope.generalHttpFactoryError)}else $scope.SYNERGY.logger.log("Oops","Seems like form is not properly filled","INFO","alert-danger")},$scope.init(function(){})}function LoginCtrl($scope,sessionHttp,$location){$scope.username="",$scope.password="",$scope.login=function(){$scope.loginForm.$valid?sessionHttp.login($scope,{username:$scope.username,password:$scope.password},function(){window.history.back()},function(data,status,headers,config){$scope.SYNERGY.logger.log("Oops","Wrong username or password","INFO","alert-danger")}):$scope.SYNERGY.logger.log("Oops","Seems like form is not properly filled","INFO","alert-danger")},$scope.init(function(){})}function RecoverCtrl($scope,sessionHttp){$scope.username="",$scope.reset=function(){$scope.resetForm.$valid?sessionHttp.resetPassword($scope,$scope.username,function(){$scope.SYNERGY.logger.log("Done","New password has been sent to you, check your email.","INFO","alert-success")},function(data,status,headers,config){$scope.SYNERGY.logger.log("Oops",data,"INFO","alert-danger")}):$scope.SYNERGY.logger.log("Oops","Seems like form is not properly filled","INFO","alert-danger")},$scope.init(function(){})}function AdminProjectCtrl($scope,projectHttp,$routeParams,SynergyModels){function fetch(){projectHttp.get($scope,$scope.project.id,function(data){$scope.project=data,$scope.refreshCodemirror=!0},$scope.generalHttpFactoryError)}$scope.project={id:$routeParams.id},$scope.refreshCodemirror=!1,$scope.init(function(){fetch()}),$scope.save=function(){var pr=new SynergyModels.Project($scope.project.id,$scope.project.name);pr.reportLink=$scope.project.reportLink,pr.viewLink=$scope.project.viewLink,pr.bugTrackingSystem=$scope.project.bugTrackingSystem,pr.multiViewLink=$scope.project.multiViewLink,projectHttp.edit($scope,pr,function(){$scope.SYNERGY.logger.log("Done","Project updated","INFO","alert-success"),fetch()},$scope.generalHttpFactoryError)},$scope.cancel=function(){window.history.back()}}function RunCoverageCtrl($scope,$routeParams,versionsHttp,specificationsHttp,testRunCoverageHandler,versionHandler,runHttp,specificationLengthHttp){$scope.allVersions=[],$scope.platforms=[],$scope.versionToCover=null,$scope.selectedVersions=[],$scope.specifications=[],$scope.syncCounter=0,$scope.syncTarget=3,$scope.testRunId=parseInt($routeParams.id,10),$scope.testRunTitle=null,$scope.coverageTotals=null,$scope.totals={finishedCases:0,totalCases:0};var allSpecifications=[],run=null,specificationSizeCache={};function sortVersions(){$scope.selectedVersions.sort(function(a,b){return a.floatValue>b.floatValue?-1:a.floatValue<b.floatValue?1:0})}function fetch(){var callback;versionsHttp.get($scope,!0,function(data){for(var i=0,max=data.length;i<max;i++)data[i].isVisible=!0,data[i].index=i,data[i].floatValue=versionHandler.getVersionFloatValue(data[i].name);$scope.allVersions=data,$scope.syncCounter++},$scope.generalHttpFactoryError),specificationsHttp.get($scope,"all",function(data){allSpecifications=data,$scope.syncCounter++},$scope.generalHttpFactoryError),callback=parsePlatforms,runHttp.get($scope,$scope.testRunId,function(data){run=data,$scope.testRunTitle=run.title,$scope.$emit("updateBreadcrumbs",{link:"run/"+$scope.testRunId+"/coverage",title:run.title+" Coverage"}),callback(),$scope.syncCounter++},$scope.generalHttpFactoryError)}function parsePlatforms(){for(var platformsObj={},i=0,max=run.assignments.length;i<max;i++)platformsObj.hasOwnProperty(run.assignments[i].platform)||(platformsObj[run.assignments[i].platform]={name:run.assignments[i].platform,isVisible:!0});var _p,platforms=[],index=0;for(var p in platformsObj)(_p=platformsObj[p]).index=index,index++,platforms.push(_p);$scope.platforms=platforms}$scope.addVersion=function(){for(var versionToCover=parseInt($scope.versionToCover,10),i=0,max=$scope.selectedVersions.length;i<max;i++)if($scope.selectedVersions[i].id===$scope.allVersions[versionToCover].id)return;$scope.selectedVersions.push($scope.allVersions[versionToCover]),sortVersions(),$scope.allVersions[versionToCover].isVisible=!1},$scope.getPercentage=function(finished,total){return 0===total||void 0===total?new Number(0).toFixed(2):(finished/(total/100)).toFixed(2)},$scope.removeCoveredVersion=function($index){var removedVersion=$scope.selectedVersions.splice($index,1)[0];$scope.allVersions[removedVersion.index].isVisible=!0,sortVersions()},$scope.getProgressClass=function(finished,total){return finished===total&&0<total?"finished":finished===total?"warning":0<finished?"unfinished":"warning"},$scope.loadCoverage=function(){var specifications,callback,query,filteredSpecifications=testRunCoverageHandler.collectSpecificationsTotalsPerPlatform(function(){for(var latestMatchingSpec,filteredSpecifications=[],i=0,max=allSpecifications.length;i<max;i++)(latestMatchingSpec=testRunCoverageHandler.getLatestMatchingSpecification(allSpecifications[i],$scope.selectedVersions,$scope.platforms))&&filteredSpecifications.push(latestMatchingSpec);return filteredSpecifications}(),run.assignments,$scope.platforms,$scope.selectedVersions);specifications=filteredSpecifications,callback=function(){$scope.specifications=filteredSpecifications,$scope.coverageTotals=testRunCoverageHandler.getTotalRow($scope.specifications,$scope.platforms),$scope.specificationTotals=testRunCoverageHandler.getSpecificationTotalAcrossPlatforms($scope.specifications,$scope.platforms),$scope.totals=testRunCoverageHandler.getTotals($scope.specifications,$scope.platforms)},0<(query=testRunCoverageHandler.getEmptySpecifications(specifications,specificationSizeCache)).ids.length?specificationLengthHttp.get($scope,query,function(data){for(var id in data)data.hasOwnProperty(id)&&!specificationSizeCache.hasOwnProperty(id)&&(specificationSizeCache[id]=data[id]);testRunCoverageHandler.addCaseCounts(specifications,specificationSizeCache),callback()},$scope.generalHttpFactoryError):(testRunCoverageHandler.addCaseCounts(specifications,specificationSizeCache),callback())},$scope.isVisible=function(version){return version.isVisible},$scope.toggle=function(){$scope.coverageTotals=testRunCoverageHandler.getTotalRow($scope.specifications,$scope.platforms),$scope.specificationTotals=testRunCoverageHandler.getSpecificationTotalAcrossPlatforms($scope.specifications,$scope.platforms),$scope.totals=testRunCoverageHandler.getTotals($scope.specifications,$scope.platforms)},$scope.init(function(){fetch()})}angular.module("synergy.controllers",["synergy.models","synergy.utils","synergy.models","synergy.core"]).controller("SynergyCtrl",["$scope","$location","sessionHttp","$cookieStore","$timeout","ngProgress","$templateCache","searchHttp","projectsHttp","sessionService","SynergyApp","specificationCache","SynergyUtils","SynergyCore",SynergyCtrl]).controller("SearchCtrl",["$scope","$routeParams","searchHttp",SearchCtrl]).controller("SpecPoolCtrl",["$scope","$routeParams","specificationsHttp","versionsHttp",SpecPoolCtrl]).controller("HomeCtrl",["$scope","specificationsHttp","runsHttp","calendarHttp",HomeCtrl]).controller("RunCtrl",["$scope","utils","$location","$routeParams","runHttp","assignmentHttp","attachmentHttp","reviewHttp","SynergyUtils","SynergyHandlers","SynergyIssue",RunCtrl]).controller("RunCtrlCase",["$scope","utils","$location","$routeParams","runHttp","SynergyUtils","SynergyHandlers","SynergyIssue",RunCtrlCase]).controller("RunCtrlUser",["$scope","$location","$routeParams","runHttp","assignmentHttp","attachmentHttp","reviewHttp","SynergyUtils","SynergyHandlers","SynergyIssue",RunCtrlUser]).controller("SpecificationCtrl",["$scope","utils","$location","$routeParams","versionsHttp","specificationHttp","suiteHttp","attachmentHttp","usersHttp","jobHttp","userHttp","sanitizerHttp","labelsHttp","projectsHttp","specificationCache","SynergyUtils","SynergyModels","SynergyHandlers",SpecificationCtrl]).controller("SuiteCtrl",["$scope","utils","$location","$routeParams","$timeout","specificationHttp","suiteHttp","casesHttp","productsHttp","sanitizerHttp","specificationCache","SynergyModels",SuiteCtrl]).controller("CaseCtrl",["$scope","utils","$location","$routeParams","suiteHttp","caseHttp","imageHttp","issueHttp","labelHttp","sanitizerHttp","specificationCache","SynergyModels","SynergyHandlers",CaseCtrl]).controller("ProfileCtrl",["$scope","$routeParams","userHttp","$location","SynergyModels","SynergyHandlers",ProfileCtrl]).controller("LabelFilterCtrl",["$scope","$routeParams","labelHttp",LabelFilterCtrl]).controller("TribeCtrl",["$scope","$location","$routeParams","$timeout","usersHttp","tribeHttp","sanitizerHttp","specificationsHttp","SynergyUtils","SynergyModels",TribeCtrl]).controller("RunsCtrl",["$scope","$routeParams","runsHttp",RunsCtrl]).controller("AssignmentCtrl",["$scope","$routeParams","assignmentHttp",AssignmentCtrl]).controller("AdminHomeCtrl",["$scope",AdminHomeCtrl]).controller("AdminVersionCtrl",["$scope","versionsHttp","versionHttp","SynergyModels",AdminVersionCtrl]).controller("AdminPlatformsCtrl",["$scope","platformsHttp","platformHttp","SynergyModels",AdminPlatformsCtrl]).controller("AdminTribesCtrl",["$scope","$location","$timeout","usersHttp","tribeHttp","tribesHttp","sanitizerHttp","SynergyUtils","SynergyModels",AdminTribesCtrl]).controller("AdminRunsCtrl",["$scope","$location","$routeParams","runsHttp","runHttp",AdminRunsCtrl]).controller("AdminRunCtrl",["$scope","$routeParams","runHttp","$location","attachmentHttp","sanitizerHttp","projectsHttp","SynergyModels","SynergyHandlers",AdminRunCtrl]).controller("AdminMatrixAssignmentCtrl",["$scope","$routeParams","assignmentsHttp","usersHttp","labelsHttp","platformsHttp","tribesHttp","versionsHttp","SynergyUtils",AdminMatrixAssignmentCtrl]).controller("AdminAssignmentCtrl",["$scope","$timeout","$routeParams","specificationsHttp","assignmentsHttp","usersHttp","labelsHttp","platformsHttp","tribesHttp","versionsHttp","assignmentHttp","runHttp","SynergyUtils","SynergyModels",AdminAssignmentCtrl]).controller("AdminUsersCtrl",["$scope","$location","$routeParams","userHttp","usersHttp",AdminUsersCtrl]).controller("AdminUserCtrl",["$scope","$routeParams","userHttp","SynergyModels",AdminUserCtrl]).controller("AdminSettingCtrl",["$scope","settingsHttp",AdminSettingCtrl]).controller("AboutCtrl",["$scope","aboutHttp",AboutCtrl]).controller("TribesCtrl",["$scope","$location","$timeout","tribesHttp",TribesCtrl]).controller("AdminLogCtrl",["$scope","logHttp","sessionRenewalHttp",AdminLogCtrl]).controller("AdminDatabaseCtrl",["$scope","databaseHttp",AdminDatabaseCtrl]).controller("AssignmentVolunteerCtrl",["$scope","$routeParams","specificationsHttp","assignmentHttp","labelsHttp","platformsHttp","versionsHttp","reviewHttp","runHttp","SynergyUtils","SynergyModels",AssignmentVolunteerCtrl]).controller("RevisionCtrl",["$scope","$routeParams","revisionsHttp",RevisionCtrl]).controller("CalendarCtrl",["$scope","calendarHttp",CalendarCtrl]).controller("AssignmentTribeCtrl",["$scope","$routeParams","tribesHttp","labelsHttp","platformsHttp","assignmentsHttp","assignmentHttp","SynergyModels",AssignmentTribeCtrl]).controller("StatisticsCtrl",["$scope","statisticsHttp","$routeParams","SynergyUtils","SynergyModels","SynergyHandlers","SynergyIssue",StatisticsCtrl]).controller("AssignmentCommentsCtrl",["$scope","$routeParams","assignmentHttp","SynergyUtils",AssignmentCommentsCtrl]).controller("ReviewCtrl",["$scope","$routeParams","reviewHttp","SynergyUtils","SynergyModels",ReviewCtrl]).controller("AdminReviewsCtrl",["$scope","reviewHttp",AdminReviewsCtrl]).controller("AdminProjectsCtrl",["$scope","projectsHttp","projectHttp","$location","SynergyModels",AdminProjectsCtrl]).controller("RegisterCtrl",["$scope","registerHttp","SynergyModels",RegisterCtrl]).controller("LoginCtrl",["$scope","sessionHttp","$location",LoginCtrl]).controller("RecoverCtrl",["$scope","sessionHttp",RecoverCtrl]).controller("RunCoverageCtrl",["$scope","$routeParams","versionsHttp","specificationsHttp","TestRunCoverageHandler","VersionHandler","runHttp","specificationLengthHttp",RunCoverageCtrl]).controller("AdminProjectCtrl",["$scope","projectHttp","$routeParams","SynergyModels",AdminProjectCtrl])}(),angular.module("synergy.directives",[]).directive("login",["$http",function($http){return{restrict:"E",replace:!0,templateUrl:"partials/directives/loginBt.html",link:function(scope,element,attrs){}}}]).directive("calendar",["calendarFct",function(calendarFct){return{restrict:"E",replace:!0,templateUrl:"partials/directives/calendar.html",link:function(scope,element,attrs){var mainScope=scope;calendarFct.getEvents(scope,function(data){for(var events=[],i=0,max=data.length;i<max;i+=1)events.push({url:"#/run/"+data[i].id+"/v/1",title:data[i].title,start:new Date(data[i].start.substr(0,4),parseInt(data[i].start.substr(4,2),10)-1,data[i].start.substr(6,2)),end:new Date(data[i].end.substr(0,4),parseInt(data[i].end.substr(4,2),10)-1,data[i].end.substr(6,2))});mainScope.events=events},function(data){})}}}]).directive("sylabel",[function(){return{restrict:"E",replace:!0,scope:{keyword:"=label"},template:'<span><a href="#/label/{{keyword}}" class="nostyle"><span class="label label-{{keyword}}">{{keyword}}</span></a>&nbsp;</span>',link:function(scope,element,attrs){}}}]).directive("syissue",[function(){return{restrict:"E",template:'<span><a data-ng-hide="issue.resolution == \'NEW\' || issue.resolution == \'STARTED\' || issue.resolution == \'REOPENED\' || issue.resolution == \'\'" title="[{{issue.resolution}}] {{issue.title}}" href="{{izurl}}" class="nostyle">   <span class="label">{{issue.bugId}}</span></a><a data-ng-show="issue.resolution == \'NEW\' || issue.resolution == \'STARTED\' || issue.resolution == \'REOPENED\' || issue.resolution == \'\'" title="[{{issue.resolution}}] {{issue.title}}" href="{{izurl}}" class="nostyle">   <span class="label label-important">{{issue.bugId}}</span></a></span>',replace:!0,scope:{issue:"=issue",izurl:"=baseurl"},link:function(scope,element,attrs){}}}]).directive("syissueDetail",[function(){return{restrict:"E",template:'<div><span><a data-ng-hide="issue.resolution == \'NEW\' || issue.resolution == \'STARTED\' || issue.resolution == \'REOPENED\' || issue.resolution == \'\'" title="[{{issue.resolution}}]" href="{{izurl}}" class="nostyle">   <span class="label">#{{issue.bugId}}:&nbsp;{{issue.title}}</span></a><a data-ng-show="issue.resolution == \'NEW\' || issue.resolution == \'STARTED\' || issue.resolution == \'REOPENED\' || issue.resolution == \'\'" title="[{{issue.resolution}}]" href="{{izurl}}" class="nostyle">   <span class="label label-important">#{{issue.bugId}}:&nbsp;{{issue.title}}</span></a></span></div>',replace:!0,scope:{issue:"=issue",izurl:"=baseurl"},link:function(scope,element,attrs){}}}]).directive("unbindable",[function(){return{scope:!0}}]).directive("syspecificationsall",function(){return{restrict:"EA",replace:!0,scope:{data:"=data",projects:"=projects",defaultProduct:"=defaultProduct"},controller:function($scope){$scope.encodeURIComponent=function(s){return encodeURIComponent(s)},$scope.project="All",$scope.projectFilter=function(record){if("All"===$scope.project)return!0;for(var i=0,max=record.projects.length;i<max;i++)if(record.projects[i].name===$scope.project)return!0;return!1}},template:'<div><span data-ng-hide="projects.length ==2" style="font-size:14px">Filter by project </span><select data-ng-hide="projects.length ==2" data-ng-model="project" data-ng-options="p as p for p in projects"></select><table class="table table-condensed table-bordered table-hover"><thead><tr><th></th><th data-ng-repeat="d in data[0].specifications">{{d.version}}</th></tr></thead><tbody><tr data-ng-repeat="d in data|filter:projectFilter"><td><a href="#/title/{{encodeURIComponent(encodeURIComponent(d.simpleName))}}"> {{d.title}}&nbsp;<small style="color: #999">{{d._project}}</small></a></td><td data-ng-repeat="v in d.specifications"><span><small title="Role: {{v.ownerRole}}" class="owner_{{v.ownerRole}}">{{v.owner || ""}}</small></span></td></tr></tbody></table></div>'}}).directive("syspecifications",function(){return{restrict:"EA",replace:!0,scope:{data:"=data",projects:"=projects",defaultProduct:"=defaultProduct"},controller:function($scope){$scope.project="All",$scope.projectFilter=function(record){if("All"===$scope.project||!record.ext.hasOwnProperty("projects"))return!0;for(var i=0,max=record.ext.projects.length;i<max;i++)if(record.ext.projects[i].name===$scope.project)return!0;return!1}},template:'<div><span data-ng-hide="projects.length ==2" style="font-size:14px">Filter by project </span><select data-ng-hide="projects.length ==2" data-ng-model="project" data-ng-options="p as p for p in projects"></select><table><tr data-ng-repeat="spec in data|filter:projectFilter"><td style="vertical-align: central"><a href="#/specification/{{spec.id}}">&rightarrow;&nbsp;{{spec.title}}&nbsp;<small style="color: #999">{{spec._project}}</small></a>&nbsp;&nbsp;</td></tr></table></div>'}}).directive("onEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which?(scope.$apply(function(){scope.$eval(attrs.onEnter)}),event.preventDefault()):0===event.which||0===event.charCode||event.ctrlKey||event.metaKey||event.altKey||scope.$$phase||scope.$apply(function(){scope.$eval(attrs.onType)})})}}).directive("typeaheads",function($timeout,$location){return{restrict:"AEC",replace:!0,scope:{items:"=",prompt:"@",title:"@",subtitle:"@",model:"=",onSelect:"&",enter:"&",type:"&"},link:function(scope,elem,attrs){scope.handleSelection=function(selectedItem){scope.model="",scope.selected=!0,$location.path(selectedItem.link)},scope.selected=!0,elem.bind("keydown keypress",function(event){13===event.which?($timeout(function(){scope.enter()},10),scope.$apply(function(){scope.selected=!0})):27===event.which||8===event.which?scope.$apply(function(){scope.selected=!0}):0===event.which||0===event.charCode||event.ctrlKey||event.metaKey||event.altKey||($timeout(function(){scope.type()},1),scope.$apply(function(){scope.selected=!1}))})},template:'<div><div class="navbar-search dropdown"><input type="search" class="search-query" ng-model="model" placeholder="{{prompt}}" ng-keydown="selected=!selected"/><br/><ul class="typeahead dropdown-menu" data-ng-hide="selected || items.length < 1"  id="typeahead_search"><li ng-repeat="item in items |filter:model" ng-click="handleSelection(item)" ><a>{{item.title}}</a></li></ul></div></div>'}}),angular.module("infinite-scroll",[]).directive("infiniteScroll",["$rootScope","$window","$timeout",function(i,n,e){return{link:function(t,l,o){var r,c,f,a;return n=angular.element(n),f=0,null!=o.infiniteScrollDistance&&t.$watch(o.infiniteScrollDistance,function(i){return f=parseInt(i,10)}),a=!0,r=!1,null!=o.infiniteScrollDisabled&&t.$watch(o.infiniteScrollDisabled,function(i){return(a=!i)&&r?(r=!1,c()):void 0}),c=function(){var c,u,d;return d=n.height()+n.scrollTop(),c=l.offset().top+l.height()-d,(u=n.height()*f>=c)&&a?i.$$phase?t.$eval(o.infiniteScroll):t.$apply(o.infiniteScroll):u?r=!0:void 0},n.on("scroll",c),t.$on("$destroy",function(){return n.off("scroll",c)}),e(function(){return o.infiniteScrollImmediateCheck?t.$eval(o.infiniteScrollImmediateCheck)?c():void 0:c()},0)}}}]),angular.module("ngProgress.provider",["ngProgress.directive"]).provider("ngProgress",function(){this.autoStyle=!0,this.count=0,this.height="2px",this.color="#0e90d2",this.$get=["$document","$window","$compile","$rootScope","$timeout",function(a,b,c,d,e){var f=this.count,g=this.height,h=this.color,i=d,j=a.find("body"),k=c("<ng-progress></ng-progress>")(i);j.append(k),i.count=f,void 0!==g&&k.eq(0).children().css("height",g),void 0!==h&&(k.eq(0).children().css("background-color",h),k.eq(0).children().css("color",h));var l=0;return{start:function(){this.show();var a=this;l=setInterval(function(){if(isNaN(f))clearInterval(l),f=0,a.hide();else{var b=100-f;f+=.15*Math.pow(1-Math.sqrt(b),2),a.updateCount(f)}},200)},updateCount:function(a){i.count=a,i.$$phase||i.$apply()},height:function(a){return void 0!==a&&(g=a,i.height=g,i.$$phase||i.$apply()),g},color:function(a){return void 0!==a&&(h=a,i.color=h,i.$$phase||i.$apply()),h},hide:function(){k.children().css("opacity","0");var a=this;e(function(){k.children().css("width","0%"),e(function(){a.show()},500)},500)},show:function(){e(function(){k.children().css("opacity","1")},100)},status:function(){return f},stop:function(){clearInterval(l)},set:function(a){return this.show(),this.updateCount(a),f=a,clearInterval(l),f},css:function(a){return k.children().css(a)},reset:function(){return clearInterval(l),f=0,this.updateCount(f),0},complete:function(){f=100,this.updateCount(f);var a=this;return e(function(){a.hide(),e(function(){f=0,a.updateCount(f)},500)},1e3),f}}}],this.setColor=function(a){return void 0!==a&&(this.color=a),this.color},this.setHeight=function(a){return void 0!==a&&(this.height=a),this.height}}),angular.module("ngProgress.directive",[]).directive("ngProgress",["$window","$rootScope",function(a,b){return{replace:!0,restrict:"E",link:function(a,c){b.$watch("count",function(b){(void 0!==b||null!==b)&&(a.counter=b,c.eq(0).children().css("width",b+"%"))}),b.$watch("color",function(b){(void 0!==b||null!==b)&&(a.color=b,c.eq(0).children().css("background-color",b),c.eq(0).children().css("color",b))}),b.$watch("height",function(b){(void 0!==b||null!==b)&&(a.height=b,c.eq(0).children().css("height",b))})},template:'<div id="ngProgress-container"><div id="ngProgress"></div></div>'}}]),angular.module("ngProgress",["ngProgress.directive","ngProgress.provider"]),angular.module("synergy.test",[]).factory("synergyTest",["$http",function($http){return{test:function($scope){window.console.log($scope.SYNERGY)}}}]),angular.module("synergy.http",[]).factory("specificationsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.latest=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specifications",{mode:"latest",limit:10}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,version,onSuccess,onFail){version=0<version.length?{version:version}:{},$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specifications",version),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.filter=function($scope,filter,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specifications",{query:filter,mode:"filter"}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("versionsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,useCache,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("versions",{}),{cache:useCache,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("versions",{all:1}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("specificationLengthHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,query,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("versionLength",{}),JSON.stringify(query)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("versionHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.edit=function($scope,version,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("version",{}),JSON.stringify(version)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,versionId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("version",{id:versionId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,version,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("version",{}),JSON.stringify(version)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("userHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.edit=function($scope,user,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("user",{action:"editUser"}),JSON.stringify(user)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,username,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("user",{user:username}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,user,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("user",{}),JSON.stringify(user)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.toggleFavorite=function($scope,specification,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("user",{action:"toggleFavorite"}),JSON.stringify(specification)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,username,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("user",{username:username})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.resetProfileImg=function($scope,userId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("profile_img",{id:userId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("specificationHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.remove=function($scope,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("specification",{id:specificationId})}).success(function(result,status){$timeout(function(){onSuccess(result,status)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.requestOwnership=function($scope,request,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("specification_request",{}),JSON.stringify(request)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,specification,isMinorEdit,keepSimpleNameTrack,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("specification",{id:specification.id,minorEdit:isMinorEdit,keepSimpleName:keepSimpleNameTrack}),JSON.stringify(specification)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,specification,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("specification",{mode:"create"}),JSON.stringify(specification)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getFull=function($scope,useCache,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specification",{view:"cont",id:specificationId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getFullAlias=function($scope,useCache,simpleName,simpleVersion,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specification",{view:"contAlias",id:-1,simpleName:simpleName,simpleVersion:simpleVersion}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,useCache,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specification",{id:specificationId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.clone=function($scope,specificationId,newName,clonedVersion,onSuccess,onFail){window.document.body.style.cursor="wait";var spec={newName:newName,version:clonedVersion};$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("specification",{mode:"clone",id:specificationId}),JSON.stringify(spec)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("suiteHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.remove=function($scope,suiteId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("suite",{id:suiteId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,useCache,suiteId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("suite",{id:suiteId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeCase=function($scope,suiteId,caseId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("suite",{id:suiteId,caseId:caseId,action:"deleteCase"})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.addCase=function($scope,suiteId,caseId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("suite",{id:suiteId,caseId:caseId,action:"addCase"})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,suite,isMinorEdit,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("suite",{id:suite.id,minorEdit:isMinorEdit}),JSON.stringify(suite)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,suite,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("suite",{id:suite.id}),JSON.stringify(suite)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("casesHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getMatching=function($scope,filter,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("cases",{case:filter}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("caseHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,useCache,caseId,suiteId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("case",{id:caseId,suite:suiteId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,testCase,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("case",{}),JSON.stringify(testCase)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,mode,testCase,isMinorEdit,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("case",{id:testCase.id,action:"editCase",mode:mode,minorEdit:isMinorEdit}),JSON.stringify(testCase)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("runsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getLatest=function($scope,limit,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("runs",{mode:"latest",limit:limit}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),window.console.log("____"+typeof onFail),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,page,onSuccess,onFail,cache){cache=void 0!==cache&&cache,$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("runs",{page:page}),{timeout:$scope.SYNERGY.httpTimeout,cache:cache}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("runHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,runId,onSuccess,onFail){this._get($scope,runId,onSuccess,onFail,"full")},this._get=function($scope,runId,onSuccess,onFail,mode){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run",{id:runId,mode:mode}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getBlobs=function($scope,runId,onSuccess,onFail){this._get($scope,runId,onSuccess,onFail,"blob")},this.getSpecifications=function($scope,runId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run_specifications",{testRunId:runId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.sendNotifications=function($scope,runId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run_notifications",{id:runId,mode:"full"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getUserCentric=function($scope,runId,onSuccess,onFail){this._get($scope,runId,onSuccess,onFail,"peruser")},this.getOverview=function($scope,useCache,runId,onSuccess,onFail){this._get($scope,runId,onSuccess,onFail,"simple")},this.remove=function($scope,runId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("run",{id:runId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,run,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("run",{id:run.id}),JSON.stringify(run)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.freezeRun=function($scope,runId,freeze,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("run",{id:runId,mode:"freeze",freeze:freeze}),JSON.stringify({})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,run,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("run",{}),JSON.stringify(run)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("assignmentHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("assignment",{id:assignmentId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.checkExists=function($scope,assignment){return $scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignment_exists",{}),JSON.stringify(assignment),{timeout:$scope.SYNERGY.httpTimeout})},this.getComments=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("assignment_comments",{id:assignmentId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,assignmentId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("assignment",{id:assignmentId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeByLeader=function($scope,assignmentId,explanation,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("assignment",{id:assignmentId}),headers:{"Synergy-comment":encodeURIComponent(explanation)}}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.start=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("assignment",{mode:"start",id:assignmentId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getCommentTypes=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("comments",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.restart=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.get($scope.SYNERGY.server.buildURL("assignment",{mode:"restart",id:assignmentId,datetime:(new Date).toMysqlFormat()}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.alterBugs=function($scope,assignmentId,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.put($scope.SYNERGY.server.buildURL("assignment_bugs",{id:assignmentId,datetime:(new Date).toMysqlFormat()}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.submitResults=function($scope,assignmentId,results,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.put($scope.SYNERGY.server.buildURL("assignment",{id:assignmentId,datetime:(new Date).toMysqlFormat()}),JSON.stringify(results)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.resolveComments=function($scope,comments,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("assignment_comments",{}),JSON.stringify(comments)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,assignment,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignment",{}),JSON.stringify(assignment)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createVolunteer=function($scope,assignment,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignment",{volunteer:!0}),JSON.stringify(assignment)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("usersHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,page,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("users",{page:page}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.retireUsersWithRole=function($scope,roleName,onSuccess,onFail){$scope.busyModeOn(),$http({method:"PUT",url:$scope.SYNERGY.server.buildURL("users",{role:roleName})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.importUsers=function($scope,sourceUrl,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("users",{}),JSON.stringify({url:sourceUrl})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("users",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getMatching=function($scope,username,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("users",{user:username}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("attachmentHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getAttachmentsForSpecification=function($scope,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"GET",url:$scope.SYNERGY.server.buildURL("attachments",{id:specificationId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeRunAttachment=function($scope,attachmentId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("run_attachment",{id:attachmentId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeSpecAttachment=function($scope,attachmentId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("attachment",{id:attachmentId,specificationId:specificationId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("labelHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.findCases=function($scope,label,page,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("label",{page:page,label:encodeURIComponent(label)}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("label",{}),JSON.stringify(label)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("label",{}),JSON.stringify(label)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("labelsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getMatching=function($scope,label,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("labels",{label:label}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("labels",{all:1}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createForSuite=function($scope,suiteId,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("labels",{id:suiteId}),JSON.stringify({label:label})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeFromSuite=function($scope,suiteId,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("labels",{id:suiteId}),JSON.stringify({label:label})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("imageHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getImagesForCase=function($scope,caseId,suiteId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"GET",url:$scope.SYNERGY.server.buildURL("images",{id:caseId,suiteId:suiteId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,imageId,suiteId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("image",{id:imageId,suiteId:suiteId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("tribeHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,useCache,tribeId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("tribe",{id:tribeId}),{cache:useCache,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.revokeMembership=function($scope,username,tribeId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("tribe",{id:tribeId,username:username,action:"removeMember"})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.newMembership=function($scope,user,tribeId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("tribe",{id:tribeId,action:"addMember"}),JSON.stringify(user)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,tribe,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribe",{}),JSON.stringify(tribe)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,tribeId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("tribe",{id:tribeId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,tribe,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("tribe",{id:tribe.id,action:"editTribe"}),JSON.stringify(tribe)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.addSpecification=function($scope,tribeId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribe_specification",{id:tribeId,specificationId:specificationId}),JSON.stringify({})).success(function(result){$timeout(function(){onSuccess(result,specificationId)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeSpecification=function($scope,tribeId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("tribe_specification",{id:tribeId,specificationId:specificationId})}).success(function(result){$timeout(function(){onSuccess(result,parseInt(specificationId,10))},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("platformsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail,cache){cache=void 0!==cache&&cache,$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("platforms",{}),{timeout:$scope.SYNERGY.httpTimeout,cache:cache}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getMatching=function($scope,filter,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("platforms",{query:filter,mode:"filter"}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("platformHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.remove=function($scope,platformId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("platform",{id:platformId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,platform,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("platform",{id:platform.id}),JSON.stringify(platform)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,platform,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("platform",{}),JSON.stringify(platform)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("tribesHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail,cache){$scope.busyModeOn(),cache=void 0!==cache&&cache,$http.get($scope.SYNERGY.server.buildURL("tribes",{}),{timeout:$scope.SYNERGY.httpTimeout,cache:cache}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getDetailed=function($scope,username,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("tribes",{mode:"full",leader:username}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getTribesForRun=function($scope,username,testRunId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run_tribes",{leader:username,testRunId:testRunId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.importTribes=function($scope,sourceUrl,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribes",{}),JSON.stringify({url:sourceUrl})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("sessionHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{login:1}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.info=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.infoConditional=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{return:1}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.infoConditionalPromise=function(url){return $http.get(url,{cache:!1})},this.infoConditionalCookie=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{return:2}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.login=function($scope,credentials,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("session",{}),"username="+credentials.username+"&password="+credentials.password,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.resetPassword=function($scope,username,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("session",{}),JSON.stringify({username:username})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.logout=function($scope,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("session",{})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("settingsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("configuration",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,configuration,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("configuration",{}),JSON.stringify(configuration)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("calendarHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getEvents=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("events",{}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("aboutHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("about",{}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("searchHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,term,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("search",{search:encodeURIComponent(term)}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getFewSpecifications=function($scope,term,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("search",{search:encodeURIComponent(term),specifications:15,suites:0}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("productsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("products",{}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("assignmentsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.createForTribes=function($scope,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribe_assignments",{}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createForUsers=function($scope,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignments",{mode:"user"}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignments",{mode:"matrix"}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("logHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("log",{})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("log",{})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("databaseHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getTables=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("db",{what:"tables"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getColumns=function($scope,table,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("db",{what:"table",table:table}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.listTable=function($scope,table,limit,order,orderBy,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("db",{what:"list",table:table,limit:limit,order:order,orderBy:orderBy}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("jobHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.resolve=function($scope,job,onSuccess,onFail){$http({method:"JSONP",url:job.jobUrl+"JSON_CALLBACK",cache:!1}).success(function(data){data.id=job.id,onSuccess(data)}).error(function(data){onFail({result:"ABORTED",fullDisplayName:"Job not found",id:job.id,url:job.jobUrl})})},this.create=function($scope,job,onSuccess,onFail){$scope.busyModeOn(),window.document.body.style.cursor="wait",$http.post($scope.SYNERGY.server.buildURL("job",{}),JSON.stringify(job)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,jobId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("job",{id:jobId,specificationId:specificationId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("issueHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.create=function($scope,issue,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("issue",{}),JSON.stringify(issue)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,issue,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("issue",{}),JSON.stringify(issue)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("revisionsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.listRevisions=function($scope,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("revisions",{id:specificationId,mode:"list"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getRevisions=function($scope,idA,idB,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("revisions",{specification:specificationId,id1:idA,id2:idB,mode:"compare"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("sanitizerHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getSanitizedInput=function($scope,data,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("sanitizer",{}),JSON.stringify({data:data}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("statisticsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.get=function($scope,testRunId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("statistics",{id:testRunId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getPeriod=function($scope,testRunId,period,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("statistics_filter",{id:testRunId}),JSON.stringify(period)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getArchive=function($scope,testRunId,fallBackUrl,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn();var url=fallBackUrl?$scope.SYNERGY.server.buildURL("statistics_fallback",{})+"run"+testRunId+"/statistics.json":$scope.SYNERGY.server.buildURL("statistics_archived",{})+"run"+testRunId+"/statistics.json";url+="?d="+Date.now(),$http.get(url,{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("reviewHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.submitResults=function($scope,assignmentId,results,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.put($scope.SYNERGY.server.buildURL("review_assignment",{id:assignmentId,datetime:(new Date).toMysqlFormat()}),JSON.stringify(results)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createVolunteer=function($scope,assignment,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("review_assignment",{volunteer:!0}),JSON.stringify(assignment)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,assignmentId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("review_assignment",{id:assignmentId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,id,mode,onSuccess,onFail){$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.get($scope.SYNERGY.server.buildURL("review_assignment",{id:id,mode:mode,datetime:(new Date).toMysqlFormat()}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.list=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("reviews",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.listNotStarted=function($scope,testRunId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("reviews",{id:testRunId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.importFromUrl=function($scope,url,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("reviews",{}),JSON.stringify({url:url})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,newReview,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("review",{}),JSON.stringify(newReview)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("projectsHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("projects",{}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("projectHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.edit=function($scope,project,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("project",{}),JSON.stringify(project)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,projectId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("project",{id:projectId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,project,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("project",{}),JSON.stringify(project)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,id,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("project",{id:id}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("registerHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.doRegister=function($scope,registration,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("register",{}),JSON.stringify(registration)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}($http,$timeout)}]).factory("sessionService",[function(){var _session=null;return{setSession:function(s){_session=s},clearSession:function(){_session=null},getToken:function(){return null!==_session&&_session.hasOwnProperty("token")?_session.token:null}}}]).factory("SynergyApp",[function(){var synergyApp=null;return{setApp:function(s){synergyApp=s},getApp:function(){return synergyApp}}}]).factory("SessionRenewalFactory",["SynergyApp","$http",function(SynergyApp,$http){var intervalId=-1,TOKEN_LENGTH=32,token=null,counter=0,sessionRenewalHttp={};function reset(){window.clearInterval(intervalId),counter=0,intervalId=-1,token=null}function checkForNewLogin(){counter++,sessionRenewalHttp.get(SynergyApp.getApp().server.buildURL("sso",{token:token}),function(){reset()},function(){100<counter&&reset()})}function getRedirectUrl(){var url=window.location.href.substring(0,window.location.href.indexOf("#"));if(url=url.endsWith(".html")?url.substring(0,url.lastIndexOf("/")+1):url,url+="login.html?token="+(token=function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<TOKEN_LENGTH;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text+(new Date).getTime()}()),SynergyApp.getApp().useSSO)return SynergyApp.getApp().getLoginRedirectUrl(SynergyApp.getApp().ssoLoginUrl,url);throw new Error("Not implemented")}return{openLoginDialog:function(response){response,$("#myModalLabel").text("Please login"),$("#modal-body").html("<a href='"+getRedirectUrl()+"' target='_blank'>Click to login</a>"),$("#myModal").hasClass("in")||$("#myModal").modal("toggle"),intervalId=window.setInterval(checkForNewLogin,2e3)}}}]).factory("sessionRenewalHttp",["$http","$timeout",function($http,$timeout){return new function($http,$timeout){this.test=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("refresh",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function(url,token,onSuccess,onFail){$http.get(url).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$timeout(function(){onFail(data,status)},10)})}}($http,$timeout)}]).factory("specificationCache",[function(){var currentSpecification=null,currentProject=null;function getSuiteEstimation(suite){for(var time=0,i=0,max=suite.testCases.length;i<max;i++)time+=suite.testCases[i].duration;return time}return{getCurrentSpecificationId:function(){return null!==currentSpecification?parseInt(currentSpecification.id,10):-1},setCurrentSpecification:function(spec,project){currentSpecification=spec,currentProject=project},getCurrentSpecification:function(){return currentSpecification},resetCurrentSpecification:function(){currentProject=currentSpecification=null},getCurrentProjectName:function(){return null!==currentProject?currentProject.name:null},getCurrentProject:function(){return currentProject},getCurrentSuite:function(suiteId){if(currentSpecification)for(var i=0,max=currentSpecification.testSuites.length;i<max;i++)if(currentSpecification.testSuites[i].id===suiteId){var s=currentSpecification.testSuites[i];return s.version=currentSpecification.version,s.specificationTitle=currentSpecification.title,s.estimation=getSuiteEstimation(s),s}return null},getCurrentCase:function(caseId,suiteId){if(currentSpecification)for(var i=0,max=currentSpecification.testSuites.length;i<max;i++)if(currentSpecification.testSuites[i].id===suiteId)for(var s=currentSpecification.testSuites[i],j=0,max2=s.testCases.length;j<max2;j++)if(s.testCases[j].id===caseId){var c=s.testCases[j];return c.version=currentSpecification.version,c.specificationTitle=currentSpecification.title,c.suiteTitle=s.title,c.specificationId=currentSpecification.id,c}return null}}}]),angular.module("synergy.filters",[]).filter("assignmentFilter",function(){return function(items,sortConfig){return items&&(window.console.log(items.length),window.console.log(sortConfig)),items}}).filter("addCaseStatus",function(){return function(text,opt){var i;return $.each(opt.scope.allCases,function(index,item){if(item.caseId===opt.item.caseId&&item.suiteId===opt.item.suiteId)return i=index,!1}),angular.element("select#"+opt.selectId+" > option[value='"+i+"']").attr("class","case"+opt.item.result),text}}).filter("stillValidIssues",function(){return function(issues){if(void 0===issues)return issues;for(var filtered=[],i=0,max=issues.length;i<max;i++)!0===issues[i].isStillValid&&filtered.push(issues[i]);return filtered}}),angular.module("synergy.handlers",["synergy.utils"]).factory("SynergyHandlers",["SynergyUtils",function(SynergyUtils){var Synergy={interfaces:{},control:{}};return Synergy.interfaces.observer={listeners:[],subscribe:function(callback,event){},publish:function(data,$scope,event){},unsubscribe:function(fn,event){}},Synergy.interfaces.logger={level:{INFO:2,DEBUG:1},printLevel:2,title:"",msg:"",style:"alert-info",print:!1,printMessage:function(title,msg,style){},log:function(title,msg,level,style){},error:function(title,msg,level,style){}},Synergy.interfaces.server={init:function(endpoints){this.endpoints=endpoints},endpoints:{},buildURL:function(endpoint,parameters){}},Synergy.control.FileUploader=function(acceptedTypes,dropElementID,uploadLimit,url,onSuccess,onFail){this.event=null,this.url=url,this.file={};var self=this,dropbox=window.document.getElementById(dropElementID);function dragEnter(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0}function dragExit(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0}function dragOver(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0}function drop(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0;var files=evt.dataTransfer.files;0<files.length&&(files[0].size>uploadLimit?onFail("File Too Large","Maximum allowed size is "+uploadLimit/1e6+" MB","INFO","alert-error"):fileIsValid(files[0])?handleFile(files[0]):onFail("Unsupported file","Supported formats are "+printAccepted(),"INFO","alert-error"))}function printAccepted(){for(var s="",i=0,max=acceptedTypes.length;i<max;i+=1)s+=acceptedTypes[i]+" ";return s}function fileIsValid(file){if(acceptedTypes.length<1)return!0;for(var i=0,max=acceptedTypes.length;i<max;i+=1)if(file.type===acceptedTypes[i])return!0;return!1}function showTitleDialog(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0,self.event=evt,self.file=0<self.event.dataTransfer.files.length?self.event.dataTransfer.files[0]:{},$("#addImageModal").modal("toggle")}function handleFile(file){$("#progressContainer").attr("class","progress");var xhr=new window.XMLHttpRequest;xhr.open("POST",self.url,!0),xhr.onerror=function(){onFail("Upload failed","","INFO","alert-error"),onFail("Upload failed",this.responseText,"DEBUG","alert-error")},xhr.onreadystatechange=function(e){4===xhr.readyState&&(200===xhr.status?onSuccess("Done","Upload finished","INFO","alert-success",file.name,xhr.responseText):(onFail("Upload failed","","INFO","alert-error"),onFail("Upload failed",this.responseText+":"+this.status,"DEBUG","alert-error")))},xhr.upload.addEventListener("progress",function(event){var loaded=parseInt(event.loaded/event.total*100);$("#progressBar").css("width",loaded+"%")},!1);var formData=new window.FormData;formData.append("myfile",file),xhr.send(formData)}null!==dropbox&&(dropbox.addEventListener?(dropbox.addEventListener("dragenter",dragEnter,!1),dropbox.addEventListener("dragexit",dragExit,!1),dropbox.addEventListener("dragover",dragOver,!1),dropbox.addEventListener("drop",drop,!1)):(dropbox.attachEvent("ondragenter",dragEnter),dropbox.attachEvent("ondragexit",dragExit),dropbox.attachEvent("ondragover",dragOver),dropbox.attachEvent("ondrop",drop))),this.uploadFileFromFileChooser=function(fdid){var file=window.document.getElementById(fdid).files[0];file&&(file.size>uploadLimit?onFail("File Too Large","Maximum allowed size is "+uploadLimit/1e6+" MB","INFO","alert-error"):handleFile(file))},this.uploadImage=function(url){self.url=url;self.event.dataTransfer.files.length;self.file&&(self.file>uploadLimit?onFail("File Too Large","Maximum allowed size is "+uploadLimit/1e6+" MB","INFO","alert-error"):fileIsValid(self.file)?handleFile(self.file):onFail("Unsupported file","Supported formats are "+printAccepted(),"INFO","alert-error"))},this.initForImages=function(container){var dropbox=window.document.getElementById(container);null!==dropbox&&(dropbox.addEventListener("dragenter",dragEnter,!1),dropbox.addEventListener("dragexit",dragExit,!1),dropbox.addEventListener("dragover",dragOver,!1),dropbox.addEventListener("drop",showTitleDialog,!1))}},Synergy.control.SynergyLogger=function(){},Synergy.control.SynergyLogger.prototype=Object.create(Synergy.interfaces.logger),Synergy.control.SynergyLogger.prototype.printMessage=function(title,msg,style){this.style=style||"alert-info",this.title=title,this.msg=msg.substring(0,200<msg.length?200:msg.length),this.date=Date()},Synergy.control.SynergyLogger.prototype.showMsg=function(title,msg,style){this.style=style||"alert-info",this.title=title,this.msg=msg,this.print=!0},Synergy.control.SynergyLogger.prototype.log=function(title,msg,level,style){window.console&&window.console.log&&window.console.log(title+": "+msg),this.level[level]>=this.printLevel&&(this.print=!0,this.printMessage(title,msg,style))},Synergy.control.SynergyLogger.prototype.logHTTPError=function(data,status,headers,config){window.console.error("Action failed >> "),data&&0<data.length&&window.console.error(data),window.console.error("HTTP Status code: "+status),window.console.error(config),window.console.error(" <<")},Synergy.control.SynergyLogger.prototype.error=function(title,msg,level,style){window.console&&window.console.error&&window.console.error(title+": "+msg),this.level[level]>=this.printLevel&&(this.print=!0,this.printMessage(title,msg,style))},Synergy.control.SynergyObserver=function(){},Synergy.control.SynergyObserver.prototype=Object.create(Synergy.interfaces.observer),Synergy.control.SynergyObserver.prototype.subscribe=function(callback,event){event=event||"any",void 0===this.listeners[event]&&(this.listeners[event]=[]),this.listeners[event].push(callback)},Synergy.control.SynergyObserver.prototype.publish=function(data,$scope,event){event=event||"any";for(var subs=this.listeners[event]||[],i=0,max=subs.length;i<max;i+=1)subs[i]($scope,data,event)},Synergy.control.SynergyObserver.prototype.unsubscribe=function(fn,event){event=event||"any";for(var subs=this.listeners[event]||[],i=0,max=subs.length;i<max;i+=1)subs[i]===fn&&subs.splice(i,1)},Synergy.control.SynergyServer=function(endpoints){var self=this;this.endpoints=endpoints,this.patterns={php:function(endpoint,parameters){var url="";for(var parameter in parameters)if(parameters.hasOwnProperty(parameter))try{url+="&"+parameter+"="+encodeURIComponent(parameters[parameter])}catch(e){window.console.error(e)}return 1<url.length?self.endpoints[endpoint]+"?"+url:self.endpoints[endpoint]}}},Synergy.control.SynergyServer.prototype=Object.create(Synergy.interfaces.server),Synergy.control.SynergyServer.prototype.preferredPattern="php",Synergy.control.SynergyServer.prototype.buildURL=function(endpoint,parameters){return this.patterns[this.preferredPattern].call(void 0,endpoint,parameters)},Synergy.control.ArchiveDataFilter=function(allData){var filteredAssignments={};this.allData=allData,this.allData.testRun=SynergyUtils.shallowClone(allData.testRun),this.allData.testRun.membersCount=0,this.allData.testRun.completed=0,this.allData.testRun.total=0;var allIssues=SynergyUtils.shallowCloneArray(allData.issues);this.allData.issues=[];var self=this;function addAssignment(user,assignment,username){if(!filteredAssignments.hasOwnProperty(username)){filteredAssignments[username]={name:user.name,tribes:[],assignments:[]};for(var i=0,max=user.tribes.length;i<max;i++)filteredAssignments[username].tribes[i]=SynergyUtils.shallowClone(user.tribes[i]);self.allData.testRun.membersCount++}self.allData.testRun.total+=assignment.totalCases,self.allData.testRun.completed+=assignment.completedCases,filteredAssignments[username].assignments.push(assignment),function(assignment){if(assignment.issues.length<1)return;for(var _id,matchingFullIssue,filterA=function(e){return e.bugId===_id},i=0,max=assignment.issues.length;i<max;i++)_id=parseInt(assignment.issues[i],10),self.allData.issues.filter(filterA).length<1&&0<(matchingFullIssue=allIssues.filter(filterA)).length&&self.allData.issues.push(matchingFullIssue[0])}(assignment)}function lastUpdatedToTimestamp(d){if(d.length<1)return-1;try{var _d=new Date,_split=d.split(" ");_d.setUTCFullYear(parseInt(_split[2],10)),_d.setUTCMonth(SynergyUtils.monthsNames.shortName.indexOf(_split[1])),_d.setUTCDate(parseInt(_split[0],10));var _split2=_split[3].split(":");return _d.setUTCHours(parseInt(_split2[0],10)),_d.setUTCMinutes(parseInt(_split2[1],10)),_d.setUTCSeconds(parseInt(_split2[2],10)),_d.getTime()}catch(e){return-1}}this.getData=function(start,stop){var _user,_lu;for(var key in this.allData.assigneesOverview)if(this.allData.assigneesOverview.hasOwnProperty(key))for(var i=0,max=(_user=this.allData.assigneesOverview[key]).assignments.length;i<max;i++)_user.assignments[i].hasOwnProperty("lastUpdated")&&start<=(_lu=lastUpdatedToTimestamp(_user.assignments[i].lastUpdated))&&_lu<=stop&&addAssignment(_user,_user.assignments[i],key);for(var _reviews=[],ii=0,maxx=this.allData.reviews.length;ii<maxx;ii++)this.allData.reviews[ii].hasOwnProperty("lastUpdated")&&start<=(_lu=lastUpdatedToTimestamp(this.allData.reviews[ii].lastUpdated))&&_lu<=stop&&_reviews.push(this.allData.reviews[ii]);return this.allData.reviews=_reviews,this.allData.assigneesOverview=filteredAssignments,this.allData}},Synergy.control}]).factory("SynergyIssue",[function(){var Issue={RunIssuesCollector:function(){this.issuesStats={total:0,opened:0,P1:0,P2:0,P3:0,P4:0,unknown:0,P1Issues:[],P2Issues:[],P3Issues:[],P4Issues:[],unknownIssues:[],unresolvedIssues:[]},this.issues={},this.addIssue=function(issue){this.issues[issue.bugId+"_"]||(this.issuesStats.total++,this.issuesStats[issue.priority]++,"resolved"!==issue.status.toLowerCase()&&"closed"!==issue.status.toLowerCase()&&"verified"!==issue.status.toLowerCase()&&"unknown"!==issue.status.toLowerCase()&&(this.issuesStats.opened++,this.issuesStats.unresolvedIssues.push(issue)),this.issues[issue.bugId+"_"]=issue,this.issuesStats[issue.priority+"Issues"].push(issue))},this.addIssues=function(bugs){for(var i=0,max=bugs.length;i<max;i++)this.addIssue(bugs[i])}}};return Issue}]).factory("TestRunCoverageHandler",["VersionHandler",function(versionHandler){function TestRunCoverageHandler(){}function getMatchingInfo(specificationId,matchingSpecs){for(var i=0,max=matchingSpecs.length;i<max;i++)if(matchingSpecs[i].specificationId===specificationId)return matchingSpecs[i];return null}function isAssigmentForAnyVersion(assignmentVersion,selectedVersions){for(var i=0,max=selectedVersions.length;i<max;i++)if(selectedVersions[i].name===assignmentVersion)return!0;return!1}function generateResults(platforms){for(var o={},i=0,max=platforms.length;i<max;i++)o[platforms[i].name]={totalCases:0,finishedCases:0};return o}return TestRunCoverageHandler.prototype.getLatestMatchingSpecification=function(specificationContainer,selectedVersions,platforms){for(var maxIndex=-1,allMatchingIds=[],allMatchingVersions=[],matching=[],j=0,maxj=selectedVersions.length;j<maxj;j++){for(var i=0,max=specificationContainer.specifications.length;i<max;i++)if(versionHandler.getVersionFloatValue(specificationContainer.specifications[i].version)===selectedVersions[j].floatValue&&-1!==specificationContainer.specifications[i].id){maxIndex=i;break}if(-1!==maxIndex)break}return-1===maxIndex?null:(specificationContainer.specifications.forEach(function(s){-1!==s.id&&(allMatchingIds.push(s.id),allMatchingVersions.push(s.version),matching.push({specificationId:s.id,version:s.version}))}),{id:specificationContainer.specifications[maxIndex].id,isVisible:!0,title:specificationContainer.title,version:specificationContainer.specifications[maxIndex].version,coverage:generateResults(platforms),matchingIds:allMatchingIds,matchingVersions:allMatchingVersions,matching:matching})},TestRunCoverageHandler.prototype.collectSpecificationsTotalsPerPlatform=function(specifications,assignments,platforms,selectedVersions){for(var foundInfo,platformsMap=function(platforms){for(var obj={},i=0,max=platforms.length;i<max;i++)obj[platforms[i].name]=platforms[i];return obj}(platforms),i=0,max=specifications.length;i<max;i++)for(var j=0,maxj=assignments.length;j<maxj;j++)specifications[i].isVisible&&platformsMap[assignments[j].platform].isVisible&&null!==(foundInfo=getMatchingInfo(assignments[j].specificationId,specifications[i].matching))&&isAssigmentForAnyVersion(foundInfo.version,selectedVersions)&&(specifications[i].coverage[assignments[j].platform].totalCases+=assignments[j].total,specifications[i].coverage[assignments[j].platform].finishedCases+=assignments[j].completed);return specifications},TestRunCoverageHandler.prototype.getSpecificationTotalAcrossPlatforms=function(specifications,platforms){for(var results=[],totalCases=0,finishedCases=0,i=0,max=specifications.length;i<max;i++){for(var j=finishedCases=totalCases=0,maxj=platforms.length;j<maxj;j++)platforms[j].isVisible&&specifications[i].isVisible&&(totalCases+=specifications[i].coverage[platforms[j].name].totalCases,finishedCases+=specifications[i].coverage[platforms[j].name].finishedCases);results.push({totalCases:totalCases,finishedCases:finishedCases})}return results},TestRunCoverageHandler.prototype.resetColumn=function(specifications,platforms){for(var i=0,max=specifications.length;i<max;i++){specifications[i].total.totalCases=0;for(var j=specifications[i].total.finishedCases=0,maxj=platforms.length;j<maxj;j++)specifications[i].coverage[platforms[j].name].totalCases=0,specifications[i].coverage[platforms[j].name].finishedCases=0}return specifications},TestRunCoverageHandler.prototype.getTotalRow=function(specifications,platforms){for(var results=generateResults(platforms),i=0,max=specifications.length;i<max;i++)for(var j=0,maxj=platforms.length;j<maxj;j++)specifications[i].coverage.hasOwnProperty(platforms[j].name)&&specifications[i].isVisible&&platforms[j].isVisible&&(results[platforms[j].name].totalCases+=specifications[i].coverage[platforms[j].name].totalCases,results[platforms[j].name].finishedCases+=specifications[i].coverage[platforms[j].name].finishedCases);return results},TestRunCoverageHandler.prototype.getTotals=function(specifications,platforms){for(var totals={totalCases:0,finishedCases:0},i=0,max=specifications.length;i<max;i++)for(var j=0,maxj=platforms.length;j<maxj;j++)platforms[j].isVisible&&specifications[i].isVisible&&(totals.totalCases+=specifications[i].coverage[platforms[j].name].totalCases,totals.finishedCases+=specifications[i].coverage[platforms[j].name].finishedCases);return totals},TestRunCoverageHandler.prototype.getEmptySpecifications=function(specifications,specificationSizeCache){for(var obj={ids:[]},i=0,max=specifications.length;i<max;i++)for(var platform in specifications[i].coverage)specifications[i].coverage.hasOwnProperty(platform)&&0===specifications[i].coverage[platform].totalCases&&!specificationSizeCache.hasOwnProperty(specifications[i].id+"")&&obj.ids.indexOf(specifications[i].id)<0&&obj.ids.push(specifications[i].id);return obj},TestRunCoverageHandler.prototype.addCaseCounts=function(specifications,sizeMap){for(var i=0,max=specifications.length;i<max;i++)for(var platform in specifications[i].coverage)specifications[i].coverage.hasOwnProperty(platform)&&0===specifications[i].coverage[platform].totalCases&&(specifications[i].coverage[platform].totalCases+=sizeMap[specifications[i].id]);return specifications},new TestRunCoverageHandler}]).factory("VersionHandler",[function(){function VersionHandler(){}var VERSION_PATTERN=/(^\d+\.)(.*)/;return VersionHandler.prototype.getVersionFloatValue=function(version){var result=VERSION_PATTERN.exec(version);if(null!==result&&3<=result.length){var end=result[2].replace(/\./g,"");return parseFloat(result[1]+end)}return parseFloat(version)},new VersionHandler}]),angular.module("synergy.models",[]).factory("SynergyModels",[function(){var Models={Project:function(id,name){this.id=id,this.name=name,this.multiViewLink=null,this.viewLink=null,this.reportLink=null,this.bugTrackingSystem="other"},Registration:function(username,email,firstname,lastname){this.username=username,this.firstname=firstname,this.lastname=lastname,this.email=email,this.password=null}};return Models.UserReviewStats=function(){var data={};this.addReview=function(review){data.hasOwnProperty(review.username)||function(review){data[review.username]={username:review.username,name:review.userDisplayName,weight:0,timeTaken:0,comments:0,total:0,completed:0}}(review),data[review.username].total++,review.isFinished&&data[review.username].completed++,data[review.username].comments+=review.numberOfComments,data[review.username].weight+=review.weight,data[review.username].timeTaken+=review.timeTaken},this.finish=function(){var _indexed=[];for(var r in data)if(data.hasOwnProperty(r)){var _hours=Math.floor(data[r].timeTaken/60);data[r].prettyTime=(0<_hours?_hours+" hours and ":"")+data[r].timeTaken%60+" minutes",_indexed.push(data[r])}return _indexed}},Models.Product=function(name,components){this.name=name,this.components=components.map(function(e){return new Models.Component(e)})},Models.Component=function(name){this.name=name},Models.ReviewAssignment=function(username,reviewUrl){this.username=username,this.reviewUrl=reviewUrl,this.testRunId=-1,this.comments=[],this.id=-1,this.owner="",this.title="",this.isFinished=!1,this.timeTaken=0,this.weight=0},Models.ReviewComment=function(reviewUrl){this.reviewUrl=reviewUrl,this.text="",this.elements=[],this.addElement=function(xpath,elementName){this.elements.push(xpath)},this.removeElement=function(xpath){for(var i=0,max=this.elements.length;i<max;i++)if(this.elements[i]===xpath)return void this.elements.splice(i,1)}},Models.Specification=function(title,description,version,owner,id){this.title=title,this.desc=description,this.version=version,this.owner=owner,this.id=id,this.isFavorite=0,this.simpleName="";var self=this;this.testSuites=[],this.setSimpleName=function(simple){self.simpleName=simple},this.ext={}},Models.Suite=function(title,description,product,component,id){this.title=title,this.desc=description,this.product=product,this.component=component,this.specificationId=-1,this.id=id,this.order=-1,this.testCases=[]},Models.TestCase=function(title,steps,result,duration,id){this.title=title,this.steps=steps,this.result=result,this.duration=duration,this.orginalDuration=duration,this.id=id,this.suiteId=-1,this.version="",this.order=-1},Models.Tribe=function(name,description,leaderUsername,id){this.name=name,this.description=description,this.leaderUsername=leaderUsername,this.id=id},Models.TribeRunStats=function(name,id,tribeSpecs){Models.Tribe.call(this,name,"","",parseInt(id,10)),this.testers=[],this.time=0,this.prettyTime="0 minutes",this.testedTotal=0,this.passed=0,this.passedRate=0,this.users=0,this.productivity=0;var specificationIds=[],self=this;!function(){for(var i=0,max=tribeSpecs.length;i<max;i++)if(parseInt(self.id,10)===parseInt(tribeSpecs[i].id,10)){for(var j=0,max2=tribeSpecs[i].specificationIds.length;j<max2;j++)specificationIds.push(parseInt(tribeSpecs[i].specificationIds[j],10));return}}(),this.addAssignment=function(assignments){for(var totalTime=0,passedCases=0,completedCases=0,i=0,max=assignments.length;i<max;i++)-1<specificationIds.indexOf(assignments[i].specificationId)&&0<assignments[i].completedCases&&(assignments[i].totalCases,totalTime+=assignments[i].totalTime,passedCases+=assignments[i].passedCases,completedCases+=assignments[i].completedCases);if(0<completedCases){this.users++,this.testedTotal+=completedCases,this.productivity=Math.round(10*this.testedTotal/this.users)/10,this.time+=totalTime;var _hours=Math.floor(this.time/60);this.passed+=passedCases,this.prettyTime=(0<_hours?_hours+" hours and ":"")+this.time%60+" minutes",this.passedRate=Math.round(1e3*this.passed/this.testedTotal)/10||0}}},Models.User=function(firstName,lastName,username,role,id,oldUsername){this.id=id,this.email=null,this.firstName=firstName,this.lastName=lastName,this.username=username,this.role=role,this.oldUsername=oldUsername||this.username,this.emailNotifications=!0,this.password=null},Models.Version=function(name,id,isObsolete){this.name=name,this.id=id,this.isObsolete=isObsolete},Models.TestRun=function(title,description,start,end,id){this.title=title,this.desc=description,this.start=start,this.end=end,this.id=id,this.notifications=-1,this.projectId=-1,this.projectName=null,this.setNotifications=function(n){return this.notifications=n,this}},Models.TestAssignment=function(platformId,username,labelId,specificationId,id){this.username=username,this.tribeId=-1,this.testRunId=-1,this.platformId=platformId,this.specificationId=specificationId,this.labelId=labelId,this.id=id},Models.Platform=function(name,id,isActive){this.name=name,this.id=id,this.isActive=isActive},Models.Job=function(jobUrl,specificationId,id){this.id=id,this.specificationId=specificationId,this.jobUrl=jobUrl},Models.OwnershipRequest=function(specificationId,authorUsername,text){this.text=text,this.specificationId=specificationId,this.authorUsername=authorUsername},Models.SpecificationContainer=function(id){this.id=id,this.data={},this.add=function(specification){this.data.hasOwnProperty(specification.versionId)||(this.data[specification.versionId]={id:specification.id,title:specification.title})},this.get=function(versionId){return this.data[versionId]}},Models}]),angular.module("synergy.utils",[]).factory("SynergyUtils",[function(){var Util={monthsNames:{fullName:["January","February","March","April","May","June","July","August","September","October","November","December"],shortName:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},UTCToLocal:function(d,shortMonthName){try{var _yearMonthDay,_time,_d=new Date,_split=d.split(" ");switch(_split.length){case 2:case 3:(_yearMonthDay=_split[0].split("-")).forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)}),(_time=_split[1].split(":")).forEach(function(item,index){_time[index]=parseInt(item,10)});break;case 5:var _m=Util.monthsNames.shortName.indexOf(_split[1]);_m<0&&(_m=Util.monthsNames.fullName.indexOf(_split[1])),(_yearMonthDay=[parseInt(_split[2],10),_m,parseInt(_split[0],10)])[1]++,_split=_split[3].split(":"),_time=[parseInt(_split[0],10),parseInt(_split[1],10),parseInt(_split[2],10)];break;default:return d}return _d.setUTCFullYear(_yearMonthDay[0]),_d.setUTCMonth(_yearMonthDay[1]-1),_d.setUTCDate(_yearMonthDay[2]),_d.setUTCHours(_time[0]),_d.setUTCMinutes(_time[1]),_d.setUTCSeconds(_time[2]),_d.getDate()+" "+(shortMonthName?Util.monthsNames.shortName[_d.getMonth()]:Util.monthsNames.fullName[_d.getMonth()])+" "+_d.getFullYear()+" "+(_d.getHours()<10?"0"+_d.getHours():_d.getHours())+":"+(_d.getMinutes()<10?"0"+_d.getMinutes():_d.getMinutes())+":"+(_d.getSeconds()<10?"0"+_d.getSeconds():_d.getSeconds())}catch(e){return d}},UTCToDate:function(d){try{var _yearMonthDay,_time,_d=new Date,_split=d.split(" ");switch(_split.length){case 2:case 3:(_yearMonthDay=_split[0].split("-")).forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)}),(_time=_split[1].split(":")).forEach(function(item,index){_time[index]=parseInt(item,10)});break;case 5:var _m=Util.monthsNames.shortName.indexOf(_split[1]);_m<0&&(_m=Util.monthsNames.fullName.indexOf(_split[1])),(_yearMonthDay=[parseInt(_split[2],10),_m,parseInt(_split[0],10)])[1]++,_split=_split[3].split(":"),_time=[parseInt(_split[0],10),parseInt(_split[1],10),parseInt(_split[2],10)];break;default:return d}return _d.setUTCFullYear(_yearMonthDay[0]),_d.setUTCMonth(_yearMonthDay[1]-1),_d.setUTCDate(_yearMonthDay[2]),_d.setUTCHours(_time[0]),_d.setUTCMinutes(_time[1]),_d.setUTCSeconds(_time[2]),_d}catch(e){return null}},UTCToLocalDateTime:function(d,shortMonthName){try{var _yearMonthDay,_time,_d=new Date,_split=d.split(" ");switch(_split.length){case 2:case 3:(_yearMonthDay=_split[0].split("-")).forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)}),(_time=_split[1].split(":")).forEach(function(item,index){_time[index]=parseInt(item,10)});break;case 5:var _m=Util.monthsNames.shortName.indexOf(_split[1]);_m<0&&(_m=Util.monthsNames.fullName.indexOf(_split[1])),(_yearMonthDay=[parseInt(_split[2],10),_m,parseInt(_split[0],10)])[1]++,_split=_split[3].split(":"),_time=[parseInt(_split[0],10),parseInt(_split[1],10),parseInt(_split[2],10)];break;default:return d}return _d.setUTCFullYear(_yearMonthDay[0]),_d.setUTCMonth(_yearMonthDay[1]-1),_d.setUTCDate(_yearMonthDay[2]),_d.setUTCHours(_time[0]),_d.setUTCMinutes(_time[1]),_d.setUTCSeconds(_time[2]),_d.getFullYear()+"-"+(_d.getMonth()+1<10?"0"+(_d.getMonth()+1):_d.getMonth()+1)+"-"+_d.getDate()+" "+(_d.getHours()<10?"0"+_d.getHours():_d.getHours())+":"+(_d.getMinutes()<10?"0"+_d.getMinutes():_d.getMinutes())+":"+(_d.getSeconds()<10?"0"+_d.getSeconds():_d.getSeconds())}catch(e){return d}},localToUTC:function(d){try{var _d=new Date,_split=d.split(" "),_yearMonthDay=_split[0].split("-");_yearMonthDay.forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)});var _time=_split[1].split(":");return _time.forEach(function(item,index){_time[index]=parseInt(item,10)}),_d.setFullYear(_yearMonthDay[0]),_d.setMonth(_yearMonthDay[1]-1),_d.setDate(_yearMonthDay[2]),_d.setHours(_time[0]),_d.setMinutes(_time[1]),_d.setSeconds(_time[2]),_d.getUTCFullYear()+"-"+(_d.getUTCMonth()+1<10?"0"+(_d.getUTCMonth()+1):_d.getUTCMonth()+1)+"-"+(_d.getUTCDate()<10?"0"+_d.getUTCDate():_d.getUTCDate())+" "+(_d.getUTCHours()<10?"0"+_d.getUTCHours():_d.getUTCHours())+":"+(_d.getUTCMinutes()<10?"0"+_d.getUTCMinutes():_d.getUTCMinutes())+":"+(_d.getUTCSeconds()<10?"0"+_d.getUTCSeconds():_d.getUTCSeconds())}catch(e){return d}},localToUTCTimestamp:function(d){try{var _d=new Date,_split=d.split(" "),_yearMonthDay=_split[0].split("-");_yearMonthDay.forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)});var _time=_split[1].split(":");return _time.forEach(function(item,index){_time[index]=parseInt(item,10)}),_d.setFullYear(_yearMonthDay[0]),_d.setMonth(_yearMonthDay[1]-1),_d.setDate(_yearMonthDay[2]),_d.setHours(_time[0]),_d.setMinutes(_time[1]),_d.setSeconds(_time[2]),_d.getTime()}catch(e){return d}},shallowClone:function(original){var _n={};for(var i in original)original.hasOwnProperty(i)&&(_n[i]=original[i]);return _n},shallowCloneArray:function(originalArray){for(var _n=[],i=0,max=originalArray.length;i<max;i++)_n[i]=Util.shallowClone(originalArray[i]);return _n},definedNotNull:function(obj){return null!=obj},ProgressChart:function(data,colors,labels,canvasId){var canvas=window.document.getElementById(canvasId),dimensions={width:canvas.width,height:canvas.height},wRation=.25,radius=.4*dimensions.width/2;if(canvas.getContext){for(var context=canvas.getContext("2d"),i=0,max=data.length;i<max;i++)data[i]=Math.round(10*data[i])/10;context.clearRect(0,0,canvas.width,canvas.height),function(context){for(var counter=0,i=0;i<data.length;i++)isNaN(data[i])||(context.fillStyle=colors[i],context.beginPath(),context.moveTo(dimensions.width*wRation,dimensions.height/2),context.arc(dimensions.width*wRation,dimensions.height/2,radius,counter,counter+2*Math.PI*(data[i]/100),!1),context.fill(),counter+=2*Math.PI*(data[i]/100))}(context),function(context){context.moveTo(dimensions.width*wRation,dimensions.height/2),context.beginPath(),context.arc(dimensions.width*wRation,dimensions.height/2,.7*radius,0,2*Math.PI,!0),context.fillStyle="#ffffff",context.fill()}(context),function(context){var totalOffset=20,leftOffset=dimensions.width*wRation*1.1+radius;context.textAlign="left",context.font="1em Helvetica",context.fillStyle="#333";for(var i=0,max=data.length;i<max;i++)0<labels[i].length&&!isNaN(data[i])&&(context.fillText(data[i]+"% "+labels[i],leftOffset,dimensions.height/2-radius+totalOffset),totalOffset+=20)}(context)}else canvas.style.display="none"},versionToNumber:function(version){var _p,VER_REG=/(^\d+\.)(.*)/,match=version.match(VER_REG);return match?(_p=match[2].replace(/\./g,""),parseFloat(version.replace(VER_REG,match[1]+_p))):parseFloat(version)}};return Util}]);