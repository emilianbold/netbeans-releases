/*! Synergy 2014-03-04 */
"use strict";function Synergy(){var synergy=this;this.version="0.5",this.hostname=window.location.hostname,this.baseURL=this.hostname+"/synergy",this.viewIssueBase="http://netbeans.org/bugzilla/show_bug.cgi?id=",this.issues=new function(){var reportURL="https://netbeans.org/bugzilla/enter_bug.cgi?",viewURL="https://netbeans.org/bugzilla/buglist.cgi?bug_id=";this.viewLink=function(issues){for(var _i,url=viewURL,processed=[],i=0,max=issues.length;max>i;i++)_i=issues[i].bugId||issues[i],processed.indexOf(_i)<0&&(url+=_i+",",processed.push(_i));return url===viewURL?"":url},this.viewLinkObjects=function(issues){var _i,url=viewURL,processed=[];for(var i in issues)issues.hasOwnProperty(i)&&(_i=issues[i].bugId||issues[i],processed.indexOf(_i)<0&&(url+=_i+",",processed.push(_i)));return url===viewURL?"":url},this.reportLink=function(product,component,version,summary){var url=reportURL;return Synergy.util.definedNotNull(product)&&"unknown"!==product&&0!==parseInt(product,10)&&(url+="product="+encodeURIComponent(product),Synergy.util.definedNotNull(component)&&"unknown"!==component&&(url+="&component="+encodeURIComponent(component)),url+="&version="+version,url+="&short_desc="+encodeURIComponent(summary)),url}},this.assignmentPage=20,this.commentsPage=30,this.adminRoles=["admin","manager"],this.publisher=new Synergy.control.SynergyObserver,this.logger=new Synergy.control.SynergyLogger,this.httpTimeout=6e4,this.product="NetBeans",this.trackCaseDuration=!0,this.baseImageURL="../../images/",this.defaultCookiesExpiration=432e5,this.uploadFileLimit=2e7,this.modal={modal:"#myModal",modalBody:"#modal-body",modalHeader:"#myModalLabel",update:function(header,body){$(this.modalHeader).text(header),$(this.modalBody).text(body)},show:function(){$(this.modal).modal("toggle")}},this.server=new Synergy.control.SynergyServer({db:"../../../server/api/db.php",specifications:"../../../server/api/specifications.php",specification:"../../../server/api/specification.php",session:"../../../server/api/login.php",assignment:"../../../server/api/assignment.php",assignments:"../../../server/api/assignments.php",tribe_assignments:"../../../server/api/tribe_assignments.php",attachment:"../../../server/api/attachment.php",attachments:"../../../server/api/attachments.php",run_attachment:"../../../server/api/run_attachment.php",favorites:"../../../server/api/favorites.php",favorite:"../../../server/api/favorite.php",suite:"../../../server/api/suite.php","case":"../../../server/api/case.php",cases:"../../../server/api/cases.php",job:"../../../server/api/job.php",label:"../../../server/api/label.php",labels:"../../../server/api/labels.php",log:"../../../server/api/log.php",user:"../../../server/api/user.php",profile_img:"../../../server/api/profile_img.php",users:"../../../server/api/users.php",tribe:"../../../server/api/tribe.php",tribe_specification:"../../../server/api/tribe_specification.php",tribes:"../../../server/api/tribes.php",versions:"../../../server/api/versions.php",version:"../../../server/api/version.php",platform:"../../../server/api/platform.php",platforms:"../../../server/api/platforms.php",runs:"../../../server/api/runs.php",image:"../../../server/api/image.php",images:"../../../server/api/images.php",issue:"../../../server/api/issue.php",proxy:"../../../server/api/proxy.php",run:"../../../server/api/run.php",run_notifications:"../../../server/api/run_notifications.php",events:"../../../server/api/events.php",configuration:"../../../server/api/configuration.php",about:"../../../server/api/about.php",sanitizer:"../../../server/api/sanitizer.php",search:"../../../server/api/search.php",products:"../../../server/api/products.php",revisions:"../../../server/api/revisions.php",statistics:"../../../server/api/statistics.php",statistics_archived:"../../server/data/test_runs/",statistics_fallback:"../../server/archive/test_runs_data/",statistics_filter:"../../../server/api/statistics_filter.php",comments:"../../../server/api/comments.php",assignment_comments:"../../../server/api/assignment_comments.php",specification_request:"../../../server/api/specification_request.php"}),this.session={isLoggedIn:!1,username:"",firstName:"",lastName:"",role:"",created:"",session_id:"",cookieIsValid:function(creationTime){return(new Date).getTime()-parseInt(creationTime,10)<synergy.defaultCookiesExpiration},hideLoginForm:function(){$("#synergy_login_form").css("display","none"),$("#synergy_login_form_log").css("display","none")},showUserMenu:function(username){$("#usermenu_user").html(username+'&nbsp;<b class="caret" id="userCaret"></b>'),$("#synergy_usermenu").css("display","block")},showLoginForm:function(){$("#synergy_login_form").css("display","block")},hideUserMenu:function(){$("#synergy_usermenu").css("display","none")},hasAdminRights:function(){return"undefined"!=typeof synergy.session&&"undefined"!=typeof synergy.session.role&&synergy.adminRoles.indexOf(synergy.session.role)>-1?!0:!1},createUserMenu:function(){$("#synergy_session").append('<ul class="nav pull-right"><li class="dropdown"><a href="#" class="dropdown-toggle btn-primary" data-toggle="dropdown" style="color: white">'+synergy.session.username+' <b class="caret"></b></a><ul class="dropdown-menu"><li><a href="#favorites">Favorites</a></li><li><span ng-click="logout();">Logout</span></li></ul></li></ul>')}},this.util={toIndexedArray:function(data){var _a=[];for(var i in data)data.hasOwnProperty(i)&&_a.push(data[i]);return _a},setCookie:function(name,value){var date=new Date;date.setTime(date.getTime()+synergy.defaultCookiesExpiration);var expires="; expires="+date.toGMTString();document.cookie=name+"="+value+expires+"; path=/"},scrollTo:function(elementID){for(var positionX=0,positionY=0,navbar=document.getElementById("navbar-top"),element=document.getElementById(elementID);null!==element;)positionX+=element.offsetLeft,positionY+=element.offsetTop,element=element.offsetParent;window.scrollTo(positionX,positionY-navbar.offsetHeight)},getCookie:function(name){for(var name=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(name))return c.substring(name.length,c.length)}},deleteCookie:function(name){document.cookie=name+"=;; path=/"},encodeHTML:function(){function htmlEncode(value){return $("<div/>").text(value).html()}var pre=$("pre");pre.html(htmlEncode(pre.html()))}},this.cache={put:function(key,value){if(window.localStorage){window.localStorage.removeItem(key);try{window.localStorage.setItem(key,JSON.stringify(value))}catch(e){(22===e.code||21===e.code||20===e.code)&&(this.drop(),window.localStorage.setItem(key,JSON.stringify(value)))}}},drop:function(){for(var i=0,max=window.localStorage.length;max>i;i++)window.localStorage.removeItem(window.localStorage.key(0))},clear:function(key){window.localStorage&&window.localStorage.removeItem(key)},get:function(key){return window.localStorage?JSON.parse(window.localStorage.getItem(key)):null}},this.ssoLoginUrl="https://netbeans.org/people/login?original_uri=",this.ssoLogoutUrl="https://netbeans.org/people/logout?original_uri=",this.getLoginRedirectUrl=function(url){return encodeURI(url+"?revalidate=1")},this.getLogoutRedirectUrl=function(url){return encodeURI(url+"?revalidate=1")}}function SynergyCtrl($scope,$location,sessionFct,$cookieStore,$timeout,ngProgress){$scope.SYNERGY=new Synergy,$scope.SYNERGY.publisher.subscribe(function($scope,data,event){new SampleSubscriber($scope,data,event)},"specListLoaded"),$scope.location=$location,$scope.$on("$routeChangeStart",function(){$scope.SYNERGY.logger.print=!1}),$scope.username="",$scope.password="",$scope.searchedItem="",$scope.role="",$scope.cookieChecked=!1,$scope.isLoggedIn=!1,$scope.breadcrumbs=[],$scope.busyBrand="",$scope.showWaitDialog=function(){$scope.SYNERGY.modal.update("Processing data...","Please wait"),$scope.SYNERGY.modal.show()},$scope.toggleBusyBrand=function(){$scope.busyBrand=$scope.busyBrand.length>0?"":"brand_busy"},$scope.getLocalTime=function(dateString,useShortMonth){return Synergy.util.UTCToLocal(dateString,useShortMonth)},$scope.getLocalDateTime=function(dateString){return Synergy.util.UTCToLocalDateTime(dateString)},$scope.getUTCTime=function(dateString){return Synergy.util.localToUTC(dateString)},$scope.generalHttpFactoryError=function(data){$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error")},$scope.busyModeOn=function(){$scope.busyBrand="brand_busy",ngProgress.set(0),$timeout(function(){ngProgress.status()<90&&ngProgress.set(ngProgress.status()+Math.round(6*Math.random()+5))},50),window.document.body.style.cursor="wait"},$scope.$on("possibleTimeout",function(){$scope.SYNERGY.logger.error("Uknown response","Seems like timeout occurred, please try to reload page","DEBUG")}),$scope.$on("busyMode",function(event,args){args?$scope.busyBrand="brand_busy":(window.document.body.style.cursor="default",$scope.busyBrand="",ngProgress.complete(100))}),$scope.init=function(callback){var _c=$cookieStore.get("session");if($scope.cookieChecked&&_c&&$scope.SYNERGY.session.cookieIsValid(_c.created)){var session=_c;$scope.SYNERGY.session.hideLoginForm(),$scope.SYNERGY.session.showUserMenu(session.username),$scope.SYNERGY.session.isLoggedIn=!0,$scope.SYNERGY.session.username=session.username,$scope.SYNERGY.session.role=session.role,$scope.SYNERGY.session.lastName=session.hasOwnProperty("lastName")&&session.lastName.length>0?session.lastName:"",$scope.SYNERGY.session.firstName=session.hasOwnProperty("firstName")&&session.firstName.length>0?session.firstName:"",$scope.role=session.role,$scope.SYNERGY.session.session_id=session.session_id,$scope.SYNERGY.session.created=session.created,$timeout(callback,0)}else sessionFct.infoConditional($scope,function(data){$scope.cookieChecked=!0,$scope.SYNERGY.session.hideLoginForm(),$scope.SYNERGY.session.showUserMenu(data.username),$scope.SYNERGY.session.isLoggedIn=!0,$scope.SYNERGY.session.username=data.username,$scope.SYNERGY.session.lastName=data.lastName,$scope.SYNERGY.session.firstName=data.firstName,$scope.SYNERGY.session.role=data.role,$scope.role=data.role,$scope.SYNERGY.session.session_id=data.session_id,$scope.SYNERGY.session.created=data.created,$cookieStore.put("session",{firstName:data.firstName,lastName:data.lastName,username:data.username,role:data.role,created:1e3*parseInt(data.created,10),session_id:data.session_id}),callback()},function(){$cookieStore.remove("session"),$scope.cookieChecked=!1,$scope.SYNERGY.session.hideUserMenu(),callback()})},$scope.login=function(){sessionFct.get($scope,function(data){$scope.SYNERGY.session.isLoggedIn=!0,$scope.SYNERGY.session.username=data.username,$scope.SYNERGY.session.role=data.role,$scope.role=data.role,$scope.SYNERGY.session.lastName=data.lastName,$scope.SYNERGY.session.firstName=data.firstName,$scope.SYNERGY.session.created=1e3*parseInt(data.created,10),$scope.SYNERGY.session.session_id=data.session_id,$scope.SYNERGY.session.hideLoginForm(),$scope.SYNERGY.session.showUserMenu(data.username),$cookieStore.put("session",{username:data.username,role:data.role,created:1e3*parseInt(data.created,10),session_id:data.session_id}),window.location.reload()},function(data,status){switch($scope.SYNERGY.logger.log("Action failed",data+":"+status,"DEBUG","alert-error"),status=parseInt(status,10)){case 307:window.location.href=$scope.SYNERGY.ssoLoginUrl+$scope.SYNERGY.getLoginRedirectUrl(window.location.href);break;case 400:$scope.SYNERGY.logger.log("Login failed",data,"INFO","alert-error");break;default:$scope.SYNERGY.logger.log("Login failed","Incorrect credentials, please try again ","INFO","alert-error")}})},$scope.logout=function(){$cookieStore.remove("session"),$scope.SYNERGY.session.isLoggedIn=!1,$scope.SYNERGY.session.username="",$scope.SYNERGY.session.lastName="",$scope.SYNERGY.session.firstName="",$scope.SYNERGY.session.role="",$scope.role="",$scope.SYNERGY.session.created=-1,$scope.SYNERGY.session.session_id="",$scope.SYNERGY.session.showLoginForm(),$scope.SYNERGY.session.hideUserMenu(),sessionFct.logout($scope,function(){window.location.href=$scope.SYNERGY.getLogoutRedirectUrl($scope.SYNERGY.ssoLogoutUrl+encodeURI(window.location.href))},function(data){$scope.SYNERGY.logger.log("Logout failed",data.toString(),"INFO","alert-error")})},$scope.$on("updateNavbar",function(event,args){try{$("ul#navbar li").each(function(){"active"===$(this).attr("class")&&$(this).attr("class","")})}catch(e){}try{$("ul#navbar li#"+args.item).attr("class","active")}catch(e){}}),$scope.$on("updateBreadcrumbs",function(event,args){if(5===$scope.breadcrumbs.length){for(var i=0;5>i;i++)if("undefined"!=typeof $scope.breadcrumbs[i]&&$scope.breadcrumbs[i].title===args.title)return;for(var i=0;4>i;i++)$scope.breadcrumbs[i]=$scope.breadcrumbs[i+1];$scope.breadcrumbs[4]=args}else{for(var i=0;4>i;i++)if("undefined"!=typeof $scope.breadcrumbs[i]&&$scope.breadcrumbs[i].title===args.title)return;"undefined"!=typeof $scope.breadcrumbs[$scope.breadcrumbs.length]||"undefined"!=typeof $scope.breadcrumbs[$scope.breadcrumbs.length-1]&&$scope.breadcrumbs[$scope.breadcrumbs.length-1].title===args.title||($scope.breadcrumbs[$scope.breadcrumbs.length]=args)}}),$scope.synergySearch=function(){$location.path("search/"+$scope.searchedItem)},$scope.encodeURIComponent=function(s){return encodeURIComponent(s)}}function SearchCtrl($scope,$routeParams,searchFct){$scope.searched=$routeParams.search,$scope.results=[],$scope.escapedSearched=decodeURIComponent($scope.searched),$scope.fetch=function(){searchFct.get($scope,$scope.searched,function(data){$scope.results=data},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.printResult=function(item){switch(item.type){case"specification":return'<a href="#specification/'+item.id+'">'+item.title+" ("+$scope.SYNERGY.product+" "+item.version+")</a>";case"suite":return'<a href="#suite/'+item.id+'">'+item.title+"</a>"}};var self=$scope;$scope.init(function(){self.fetch()})}function SpecPoolCtrl($scope,$routeParams,specificationsFct,versionsFct){$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.specs=[],$scope.version=$routeParams.id||null,$scope.versions=[],$scope.orderProp="title",$scope.rights=0,$scope.isLoggedIn="undefined"!=typeof $scope.SYNERGY.session.session_id&&$scope.SYNERGY.session.session_id.length>1?1:0;var cache={};$scope.fetch=function(){$scope.isLoggedIn="undefined"!=typeof $scope.SYNERGY.session.session_id&&$scope.SYNERGY.session.session_id.length>1?1:0,"undefined"!=typeof $scope.SYNERGY.session.session_id&&$scope.SYNERGY.session.session_id.length>1&&($scope.rights=1),versionsFct.get($scope,!0,function(data){data.unshift({id:-1,name:"all"}),$scope.versions=data,$scope.version=$scope.version||data[0].name,specificationsFct.get($scope,$scope.version,function(data){$scope.specs=data,cache[$scope.version]=data,$scope.$emit("updateBreadcrumbs",{link:"specifications",title:"Test Specifications"})},function(data,status){404!==parseInt(status,10)?$scope.SYNERGY.logger.log("Action failed",data.toString(),"INFO","alert-error"):$scope.SYNERGY.logger.log("","No results","INFO")})},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()}),$scope.filter=function(){return $scope.specs=[],cache.hasOwnProperty($scope.version)?void($scope.specs=cache[$scope.version]):void specificationsFct.get($scope,$scope.version,function(data){$scope.specs=data,cache[$scope.version]=data,$scope.$emit("updateBreadcrumbs",{link:"specifications",title:"Test Specifications"})},function(data,status){404!==parseInt(status,10)?$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"):$scope.SYNERGY.logger.log("","No results","INFO")})}}function HomeCtrl($scope,specificationsFct,runsFct){$scope.runs={testRuns:[]},$scope.specs=[],$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.fetch=function(){runsFct.getLatest($scope,7,function(data){"undefined"!=typeof data.testRuns&&($scope.runs=data)},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}),specificationsFct.latest($scope,function(result){$scope.specs=result,$scope.SYNERGY.publisher.publish(1,$scope,"specListLoaded")},function(data){$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})};var self=$scope;$scope.init(function(){self.fetch()})}function RunCtrl($scope,utils,$location,$routeParams,runFct,assignmentFct,attachmentFct){function collectFilterData(data){for(var assignees=[],platforms=[],specifications=[],tribes=[],i=0,max=data.assignments.length;max>i;i++){assignees.indexOf(data.assignments[i].userDisplayName)<0&&assignees.push(data.assignments[i].userDisplayName),specifications.indexOf(data.assignments[i].specification)<0&&specifications.push(data.assignments[i].specification),platforms.indexOf(data.assignments[i].platform)<0&&platforms.push(data.assignments[i].platform);for(var j=0,max2=data.assignments[i].tribes.length;max2>j;j++)tribes.indexOf(data.assignments[i].tribes[j])<0&&tribes.push(data.assignments[i].tribes[j])}assignees.push("All"),assignees.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),specifications.push("All"),specifications.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),tribes.push("All"),tribes.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),platforms.push("All"),platforms.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),$scope.assignees=assignees,$scope.platforms=platforms,$scope.specifications=specifications,$scope.tribes=tribes}function countResults(run){var result={failed:0,passed:0,skipped:0};if(Synergy.util.definedNotNull(run)&&Synergy.util.definedNotNull(run.assignments)){for(var i=0,max=run.assignments.length;max>i;i++)_coverage[run.assignments[i].platform]||(_coverage[run.assignments[i].platform]={total:0,completed:0,name:run.assignments[i].platform}),issueCollector.addIssues(run.assignments[i].issues),_coverage[run.assignments[i].platform].total+=parseInt(run.assignments[i].total,10),_coverage[run.assignments[i].platform].completed+=parseInt(run.assignments[i].completed,10),result.failed+=Math.floor(run.assignments[i].failed),result.passed+=Math.floor(run.assignments[i].passed),result.skipped+=Math.floor(run.assignments[i].skipped);var t=(result.failed+result.passed+result.skipped)/100;if(t>0){var f=Math.floor(10*result.failed/t)/10,p=Math.round(10*result.passed/t)/10;Synergy.util.ProgressChart([p,f,Math.round(10*(100-(f+p)))/10],["#62c462","#ee5f5b","#c67605"],["passed","failed","skipped"],"canvas1")}}for(var j in _coverage)_coverage.hasOwnProperty(j)&&(_coverage[j].progress=Math.round(1e3*(_coverage[j].completed/_coverage[j].total))/10);$scope.coverage=_coverage,Synergy.util.ProgressChart([issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100),100-issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100)],["#ccc","#62c462"],["Unresolved","Resolved"],"issuesResolution"),Synergy.util.ProgressChart([issueCollector.issuesStats.P1/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P2/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P3/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P4/(issueCollector.issuesStats.total/100)],["#ee5f5b","#f89406","#fbeed5","#ccc"],["P1 ("+issueCollector.issuesStats.P1+")","P2 ("+issueCollector.issuesStats.P2+")","P3 ("+issueCollector.issuesStats.P3+")","P4 ("+issueCollector.issuesStats.P4+")"],"issuesPriority"),$scope.allIssues=issueCollector.issues,$scope.unresolvedIssues=issueCollector.issuesStats.unresolvedIssues,$scope.P1Issues=issueCollector.issuesStats.P1Issues,$scope.P2Issues=issueCollector.issuesStats.P2Issues,$scope.P3Issues=issueCollector.issuesStats.P3Issues}function resetFilters(){$scope.sortConfig={property:["id"],descending:[!1]},$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1},platform:{desc:!1,asc:!1}}}$scope.$emit("updateNavbar",{item:"nav_runs"}),$scope.$emit("updateBreadcrumbs",{link:"runs",title:"Test Runs"}),$scope.id=$routeParams.id||-1,$scope.run={},$scope.rights=0;var currentActionId=-1,currentAction="";$scope.username=$scope.SYNERGY.session.username||"",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("run_attachment",{}),$scope.isLoading=!1,$scope.tribes=[];var leaderIsRemoving=!1;$scope.explainModal="",$scope.filter={assignee:"All",specification:"All",platform:"All",tribe:"All"};var issueCollector=new Synergy.Issue.RunIssuesCollector;$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.specifications=[],$scope.assignees=[],$scope.pageSize=$scope.SYNERGY.assignmentPage;var _coverage={};$scope.coverage={},$scope.sortConfig={property:["id"],descending:[!1]},$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1},platform:{desc:!1,asc:!1}},$scope.fetch=function(){$scope.username=$scope.SYNERGY.session.username||"",runFct.get($scope,$scope.id,function(data){countResults(data),$scope.run=data,collectFilterData(data),$scope.$emit("updateBreadcrumbs",{link:"run/"+$scope.id+"/v/1",title:$scope.run.title}),Synergy.util.ProgressChart([data.completed/data.total*100,100-data.completed/data.total*100],["#08c","#ccc"],["completed",""],"canvas2");try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError)},$scope.assignessFilter=function(assignmentRecord){return $scope.filter.assignee&&"All"!==$scope.filter.assignee&&assignmentRecord.userDisplayName!==$scope.filter.assignee?!1:$scope.filter.specification&&"All"!==$scope.filter.specification&&assignmentRecord.specification!==$scope.filter.specification?!1:$scope.filter.platform&&"All"!==$scope.filter.platform&&assignmentRecord.platform!==$scope.filter.platform?!1:$scope.filter.tribe&&"All"!==$scope.filter.tribe&&assignmentRecord.tribes.indexOf($scope.filter.tribe)<0?!1:!0},$scope.createCoverageChart=function(c){try{Synergy.util.ProgressChart([c.progress,100-c.progress],["#08c","#ccc"],["finished",""],"coverage"+c.name)}catch(e){}},$scope.nextPage=function(){$scope.isLoading=!0,$scope.pageSize+=$scope.SYNERGY.assignmentPage,$scope.isLoading=!1},$scope.changeSorting=function(prop,order){var _p=prop;if(prop=order?prop:"-"+prop,$scope.sortConfig.property.indexOf(_p)>-1||$scope.sortConfig.property.indexOf("-"+_p)>-1){var i=$scope.sortConfig.property.indexOf(_p);if(0>i&&(i=$scope.sortConfig.property.indexOf("-"+_p)),$scope.sortConfig.descending[i]===order)$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(i,1),$scope.orderingProperties[_p].desc=!1,$scope.orderingProperties[_p].asc=!1,0===$scope.sortConfig.property.length&&resetFilters();else{$scope.orderingProperties[_p].desc=!$scope.orderingProperties[_p].desc,$scope.orderingProperties[_p].asc=!$scope.orderingProperties[_p].asc;var _orig={descending:!$scope.sortConfig.descending[i],property:$scope.sortConfig.property[i]};$scope.sortConfig.descending.splice(i,1),$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(0,0,_orig.descending),0===_orig.property.indexOf("-")?$scope.sortConfig.property.splice(0,0,_orig.property.substring(1,_orig.property.length)):$scope.sortConfig.property.splice(0,0,"-"+_orig.property)}}else 1===$scope.sortConfig.property.length&&"id"===$scope.sortConfig.property[0]?$scope.sortConfig={property:[prop],descending:[order]}:($scope.sortConfig.property.splice(0,0,prop),$scope.sortConfig.descending.splice(0,0,order)),$scope.orderingProperties[_p].desc=!order,$scope.orderingProperties[_p].asc=order},$scope.startAssignment=function(mode,assignmentId){2===parseInt(mode,10)?($("#deleteModalLabel").text("Restart assignment?"),$("#deleteModalBody").html("<p>Do you really want to restart this assignment? All saved progress will be lost as if you never started it. If you want to Continue saved assignment, please use 'Play' button instead</p>"),$("#deleteModal").modal("toggle"),currentAction="restartAssignment",currentActionId=assignmentId):$location.path("/assignment/"+assignmentId+"/v/"+mode)},$scope.performRun=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete test run?"),$("#deleteModalBody").html("<p>Do you really want to delete test run?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteRun";break;case"notify":$("#deleteModalLabel").text("Send notifications?"),$("#deleteModalBody").html("<p>Do you really want to send email notifications to testers with incomplete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="notify";break;case"freeze":var target=$scope.run.isActive?0:1;runFct.freezeRun($scope,$scope.id,target,function(){$scope.run.isActive=target,$scope.SYNERGY.logger.log("Done","Test run "+(1===target?"unfrozen":"frozen"),"INFO","alert-success")},$scope.generalHttpFactoryError);break;default:$location.path("/administration/run/"+$scope.id+"/"+action)}},$scope.performAssignment=function(action,id,createdBy){if("delete"!==action)$location.path("suite/"+id+"/"+action);else switch(action){case"delete":currentAction="deleteAssignment",currentActionId=id,leaderIsRemoving=3===createdBy?!0:!1,$("#deleteModalLabel").text("Delete test assignment?"),$("#deleteModalBody").html("<p>Do you really want to delete test assignment?</p>"),$("#deleteModal").modal("toggle")}},$scope.deleteAssignment=function(){if(leaderIsRemoving){if($("#explainModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||$scope.explanation.length<1)return;assignmentFct.removeByLeader($scope,currentActionId,$scope.explanation,function(){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}else{if("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;assignmentFct.remove($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}},$scope.performAction=function(){switch(currentAction){case"restartAssignment":$("#deleteModal").modal("toggle"),$location.path("/assignment/"+currentActionId+"/v/2");break;case"deleteAssignment":$("#deleteModal").modal("toggle"),leaderIsRemoving?$("#explainModal").modal("toggle"):$scope.deleteAssignment();break;case"notify":$("#deleteModal").modal("toggle"),runFct.sendNotifications($scope,$scope.id,function(data){$scope.SYNERGY.logger.log("Done",data,"INFO","alert-success")},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")});break;case"deleteRun":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;runFct.remove($scope,$scope.id,function(){$scope.SYNERGY.modal.update("Test run removed",""),$scope.SYNERGY.modal.show(),$location.path("/runs")},function(data){$scope.SYNERGY.modal.update("Action failed",""),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.SYNERGY.modal.show()});break;case"deleteAttachment":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;attachmentFct.removeRunAttachment($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success"),$scope.fetch()},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}};var self=$scope;$scope.init(function(){self.fetch()}),new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)})}function RunCtrlUser($scope,utils,$location,$routeParams,runFct,assignmentFct,attachmentFct){function resetFilters(){$scope.sortConfig={property:["id"],descending:[!1]},$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1}}}function buildAssignments(){var result={failed:0,passed:0,skipped:0},assignees=[],specs=[];tribes=[];var allResolved,prettyAssignments=[];for(var username in $scope.run.assignments)if($scope.run.assignments.hasOwnProperty(username)){var user=$scope.run.assignments[username],line={assignments:[]};for(var a in user.assignments){var assignment=user.assignments[a];line.userDisplayName=assignment.userDisplayName,line.username=assignment.username,line.specificationId=assignment.specificationId,line.label=assignment.label,line.labelId=assignment.labelId,line.specification=assignment.specification,line.tribes=assignment.tribes,assignees.indexOf(line.userDisplayName)<0&&assignees.push(line.userDisplayName),specs.indexOf(line.specification)<0&&specs.push(line.specification),getTribes(assignment),assignment.total=parseInt(assignment.total,10),assignment.completed=parseInt(assignment.completed,10),assignment.failedColor="#62c462",allResolved=allIssuesResolved(assignment.issues),parseInt(assignment.failed,10)>0&&!allResolved&&(assignment.failedColor="#ee5f5b"),assignment.progress=assignment.total>0?Math.round(1e3*assignment.completed/assignment.total)/10:100,assignment.info=allResolved&&100===assignment.progress?"finished":assignment.info;var _t=assignment.started.length>0?"Started: "+assignment.started:"";_t+=assignment.lastUpdated.length>0?"; Last updated: "+assignment.lastUpdated:"",assignment.tooltip=_t,assignment.issuesLink=assignment.issues.length>0?"<a style='color: "+assignment.failedColor+"; font-weight: bold' href='"+$scope.SYNERGY.issues.viewLink(assignment.issues)+"'>"+assignment.issues.length+" failed</a>&nbsp;":"&nbsp;",line.assignments[$scope.platforms.indexOf(assignment.platform)]=assignment,_coverage[$scope.platforms.indexOf(assignment.platform)]||(_coverage[$scope.platforms.indexOf(assignment.platform)]={total:0,completed:0,name:assignment.platform}),_coverage[$scope.platforms.indexOf(assignment.platform)].total+=parseInt(assignment.total,10),_coverage[$scope.platforms.indexOf(assignment.platform)].completed+=parseInt(assignment.completed,10),result.failed+=Math.floor(assignment.failed),result.passed+=Math.floor(assignment.passed),result.skipped+=Math.floor(assignment.skipped)}for(var p=0,maxp=$scope.platforms.length;maxp>p;p++)line.assignments[p]||(line.assignments[p]={_hidden:new Date});prettyAssignments.push(line)}assignees.push("All"),assignees.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),specs.push("All"),specs.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),tribes.push("All"),tribes.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),$scope.assignees=assignees,$scope.specifications=specs,$scope.tribes=tribes,countResults(result),$scope.prettyAssignments=prettyAssignments,Synergy.util.ProgressChart([issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100),100-issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100)],["#ccc","#62c462"],["Unresolved","Resolved"],"issuesResolution"),Synergy.util.ProgressChart([issueCollector.issuesStats.P1/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P2/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P3/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P4/(issueCollector.issuesStats.total/100)],["#ee5f5b","#f89406","#fbeed5","#ccc"],["P1 ("+issueCollector.issuesStats.P1+")","P2 ("+issueCollector.issuesStats.P2+")","P3 ("+issueCollector.issuesStats.P3+")","P4 ("+issueCollector.issuesStats.P4+")"],"issuesPriority"),$scope.allIssues=issueCollector.issues,$scope.unresolvedIssues=issueCollector.issuesStats.unresolvedIssues,$scope.P1Issues=issueCollector.issuesStats.P1Issues,$scope.P2Issues=issueCollector.issuesStats.P2Issues,$scope.P3Issues=issueCollector.issuesStats.P3Issues
}function allIssuesResolved(issues){for(var result=!0,i=0,max=issues.length;max>i;i++)issueCollector.addIssue(issues[i]),"resolved"!==issues[i].status.toLowerCase()&&"closed"!==issues[i].status.toLowerCase()&&"verified"!==issues[i].status.toLowerCase()&&(result=!1);return result}function getTribes(assignment){for(var i=0,max=assignment.tribes.length;max>i;i++)tribes.indexOf(assignment.tribes[i])<0&&tribes.push(assignment.tribes[i])}function getPlatforms(){for(var username in $scope.run.assignments)if($scope.run.assignments.hasOwnProperty(username)){var user=$scope.run.assignments[username];for(var assignment in user.assignments)$scope.platforms.indexOf(user.assignments[assignment].platform)<0&&$scope.platforms.push(user.assignments[assignment].platform)}$scope.platforms.sort()}function countResults(result){var t=(result.failed+result.passed+result.skipped)/100;if(t>0){var f=Math.floor(10*result.failed/t)/10,p=Math.round(10*result.passed/t)/10;Synergy.util.ProgressChart([p,f,Math.round(10*(100-(f+p)))/10],["#62c462","#ee5f5b","#c67605"],["passed","failed","skipped"],"canvas1")}for(var i=0,max=_coverage.length;max>i;i++)_coverage[i].progress=Math.round(1e3*(_coverage[i].completed/_coverage[i].total))/10;$scope.coverage=_coverage}$scope.$emit("updateNavbar",{item:"nav_runs"}),$scope.id=$routeParams.id||-1,$scope.platforms=[],$scope.run={},$scope.rights=0;var leaderIsRemoving=!1;$scope.explainModal="";var currentActionId=-1,currentAction="";$scope.username=$scope.SYNERGY.session.username||"",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("run_attachment",{}),$scope.assignees=[],$scope.specifications=[],$scope.tribes=[];var tribes=[];$scope.filter={assignee:"All",specification:"All",tribe:"All"},$scope.coverage=[];var _coverage=[];$scope.isLoading=!1,$scope.pageSize=$scope.SYNERGY.assignmentPage,$scope.sortConfig={property:["id"],descending:[!1]},$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.orderingProperties={userDisplayName:{desc:!1,asc:!1},specification:{desc:!1,asc:!1}};var issueCollector=new Synergy.Issue.RunIssuesCollector;$scope.fetch=function(){$scope.isLoading=!0,$scope.username=$scope.SYNERGY.session.username||"",runFct.getUserCentric($scope,$scope.id,function(data){$scope.run=data,$scope.$emit("updateBreadcrumbs",{link:"run/"+$scope.id+"/v/2",title:$scope.run.title}),getPlatforms(),buildAssignments(),Synergy.util.ProgressChart([data.completed/data.total*100,100-data.completed/data.total*100],["#08c","#ccc"],["completed",""],"canvas2");try{data.controls.length>0&&($scope.rights=1)}catch(e){}$scope.isLoading=!1},$scope.generalHttpFactoryError)},$scope.assignessFilter=function(assignmentRecord){return $scope.filter.assignee&&"All"!==$scope.filter.assignee&&assignmentRecord.userDisplayName!==$scope.filter.assignee?!1:$scope.filter.specification&&"All"!==$scope.filter.specification&&assignmentRecord.specification!==$scope.filter.specification?!1:$scope.filter.tribe&&"All"!==$scope.filter.tribe&&assignmentRecord.tribes.indexOf($scope.filter.tribe)<0?!1:!0},$scope.nextPage=function(){$scope.isLoading=!0,$scope.pageSize+=$scope.SYNERGY.assignmentPage,$scope.isLoading=!1},$scope.changeSorting=function(prop,order){var _p=prop;if(prop=order?prop:"-"+prop,$scope.sortConfig.property.indexOf(_p)>-1||$scope.sortConfig.property.indexOf("-"+_p)>-1){var i=$scope.sortConfig.property.indexOf(_p);if(0>i&&(i=$scope.sortConfig.property.indexOf("-"+_p)),$scope.sortConfig.descending[i]===order)$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(i,1),$scope.orderingProperties[_p].desc=!1,$scope.orderingProperties[_p].asc=!1,0===$scope.sortConfig.property.length&&resetFilters();else{$scope.orderingProperties[_p].desc=!$scope.orderingProperties[_p].desc,$scope.orderingProperties[_p].asc=!$scope.orderingProperties[_p].asc;var _orig={descending:!$scope.sortConfig.descending[i],property:$scope.sortConfig.property[i]};$scope.sortConfig.descending.splice(i,1),$scope.sortConfig.property.splice(i,1),$scope.sortConfig.descending.splice(0,0,_orig.descending),0===_orig.property.indexOf("-")?$scope.sortConfig.property.splice(0,0,_orig.property.substring(1,_orig.property.length)):$scope.sortConfig.property.splice(0,0,"-"+_orig.property)}}else 1===$scope.sortConfig.property.length&&"id"===$scope.sortConfig.property[0]?$scope.sortConfig={property:[prop],descending:[order]}:($scope.sortConfig.property.splice(0,0,prop),$scope.sortConfig.descending.splice(0,0,order)),$scope.orderingProperties[_p].desc=!order,$scope.orderingProperties[_p].asc=order},$scope.createCoverageChart=function(c){try{Synergy.util.ProgressChart([c.progress,100-c.progress],["#08c","#ccc"],["finished",""],"coverage"+c.name)}catch(e){}},$scope.startAssignment=function(mode,assignmentId){2===parseInt(mode,10)?($("#deleteModalLabel").text("Restart assignment?"),$("#deleteModalBody").html("<p>Do you really want to restart this assignment? All saved progress will be lost as if you never started it. If you want to Continue saved assignment, please use 'Play' button instead</p>"),$("#deleteModal").modal("toggle"),currentAction="restartAssignment",currentActionId=assignmentId):$location.path("/assignment/"+assignmentId+"/v/"+mode)},$scope.performRun=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete test run?"),$("#deleteModalBody").html("<p>Do you really want to delete test run?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteRun";break;case"notify":$("#deleteModalLabel").text("Send notifications?"),$("#deleteModalBody").html("<p>Do you really want to send email notifications to testers with incomplete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="notify";break;case"freeze":var target=$scope.run.isActive?0:1;runFct.freezeRun($scope,$scope.id,target,function(){$scope.run.isActive=target,1===target?$scope.SYNERGY.logger.log("Done","Test run unfrozen","INFO","alert-success"):$scope.SYNERGY.logger.log("Done","Test run frozen","INFO","alert-success")},$scope.generalHttpFactoryError);break;default:$location.path("/administration/run/"+$scope.id+"/"+action)}},$scope.performAttachment=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete attachment?"),$("#deleteModalBody").html("<p>Do you really want to delete attachment?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteAttachment",currentActionId=id}},$scope.forwardToCreateAssignment=function(){$location.path("/administration/assignment/create/run/"+$scope.id)},$scope.forwardToCreateMatrixAssignment=function(){$location.path("/administration/assignment/creatematrix/run/"+$scope.id)},$scope.performAssignment=function(action,id,createdBy){if("delete"!==action)$location.path("suite/"+id+"/"+action);else switch(action){case"delete":leaderIsRemoving=3===createdBy?!0:!1,$("#deleteModalLabel").text("Delete test assignment?"),$("#deleteModalBody").html("<p>Do you really want to delete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteAssignment",currentActionId=id}},$scope.deleteAssignment=function(){if(leaderIsRemoving){if($("#explainModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||$scope.explanation.length<1)return;assignmentFct.removeByLeader($scope,currentActionId,$scope.explanation,function(){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}else{if("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;assignmentFct.remove($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Assignment deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}},$scope.performAction=function(){switch(currentAction){case"restartAssignment":$("#deleteModal").modal("toggle"),$location.path("/assignment/"+currentActionId+"/v/2");break;case"deleteAssignment":$("#deleteModal").modal("toggle"),leaderIsRemoving?$("#explainModal").modal("toggle"):$scope.deleteAssignment();break;case"notify":$("#deleteModal").modal("toggle"),runFct.sendNotifications($scope,$scope.id,function(data){$scope.SYNERGY.logger.log("Done",data,"INFO","alert-success")},$scope.generalHttpFactoryError);break;case"deleteRun":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;runFct.remove($scope,$scope.id,function(){$scope.SYNERGY.modal.update("Test run removed",""),$scope.SYNERGY.modal.show(),$location.path("/runs")},function(data){$scope.SYNERGY.modal.update("Action failed",""),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.SYNERGY.modal.show()});break;case"deleteAttachment":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;attachmentFct.removeRunAttachment($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success"),$scope.fetch()},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}};var self=$scope;$scope.init(function(){self.fetch()}),new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)})}function SpecificationCtrl($scope,utils,$location,$routeParams,versionsFct,specificationFct,suiteFct,attachmentFct,usersFct,jobFct,userFct,sanitizerFct,labelsFct){function getRemovalUsers(){for(var _l="",i=0,max=$scope.specification.ext.removalRequests.length;max>i;i++)_l+=$scope.specification.ext.removalRequests[i].username+", ";$scope.removalUsers=1===_l.length?"":_l.substr(0,_l.length-2)}function getAction(){var url=window.location.href,stringId=$scope.id+"",_s=url.lastIndexOf("/"+$scope.id+"/")+stringId.length+2,_e=url.indexOf("/",_s),action=_e>-1?url.substring(_s,_e):url.substring(_s,url.length);return"v"===action?url.indexOf($scope.id+"/v/1")>-1?"1":"2":action}function loadSpecificationFromAlias(){self.simpleName=decodeURIComponent(decodeURIComponent(self.simpleName)),specificationFct.getFullAlias($scope,!1,self.simpleName,self.simpleVersion,function(data){$scope.specification=data,$scope.labels=getLabels(data),$scope.newname=data.title,$scope.id=data.id,resolveContinuousJobs(data.ext.continuous_integration),$scope.$emit("updateBreadcrumbs",{link:"specification/"+data.id+"/v/2",title:data.title});try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError)}function getLabels(data){for(var labels=[],realLabels=[],i=0,max=data.testSuites.length;max>i;i++)for(var j=0,max2=data.testSuites[i].testCases.length;max2>j;j++)for(var k=0,max3=data.testSuites[i].testCases[j].keywords.length;max3>k;k++)labels.indexOf(data.testSuites[i].testCases[j].keywords[k])<0&&(labels.push(data.testSuites[i].testCases[j].keywords[k]),realLabels.push(data.testSuites[i].testCases[j].keywords[k]));return labels.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),realLabels.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1}),$scope.realLabels=realLabels,$scope.realLabels.length>0&&($scope.removeLabel=$scope.realLabels[0]),labels.push("All"),labels}function resolveContinuousJobs(jobs){if($scope.readOnlyJobs=[],Synergy.util.definedNotNull(jobs))for(var i=0,max=jobs.length;max>i;i++)jobFct.resolve($scope,jobs[i],function(data){$scope.readOnlyJobs.push(data)},function(data){$scope.SYNERGY.logger.log("Failed to load data",data,"DEBUG","alert-error")})}function removeLabels(){if(!($scope.removeLabel.length<1)){var id=parseInt(currentActionId,10);labelsFct.removeFromSuite($scope,currentActionId,$scope.removeLabel,function(){$scope.SYNERGY.logger.log("Done","Labels removed","INFO","alert-success");for(var i=0,max=$scope.specification.testSuites.length;max>i;i++)if(parseInt($scope.specification.testSuites[i].id,10)===id){for(var j=0,max2=$scope.specification.testSuites[i].testCases.length;max2>j;j++){var index=$scope.specification.testSuites[i].testCases[j].keywords.indexOf($scope.removeLabel);index>-1&&$scope.specification.testSuites[i].testCases[j].keywords.splice(index,1)}break}$scope.labels=getLabels($scope.specification)},$scope.generalHttpFactoryError),$("#addLabelsModal").modal("toggle")}}function addLabels(){if(!($scope.newLabel.length<1)){var id=parseInt(currentActionId,10);labelsFct.createForSuite($scope,currentActionId,$scope.newLabel,function(){$scope.SYNERGY.logger.log("Done","Labels added","INFO","alert-success");for(var i=0,max=$scope.specification.testSuites.length;max>i;i++)if(parseInt($scope.specification.testSuites[i].id,10)===id){for(var j=0,max2=$scope.specification.testSuites[i].testCases.length;max2>j;j++)$scope.specification.testSuites[i].testCases[j].keywords.indexOf($scope.newLabel)<0&&$scope.specification.testSuites[i].testCases[j].keywords.push($scope.newLabel);break}$scope.labels=getLabels($scope.specification)},$scope.generalHttpFactoryError),$("#addLabelsModal").modal("toggle")}}var self=this;$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.specification={},$scope.refreshCodemirror=!1,$scope.id=$routeParams.id||-1,$scope.rights=0,$scope.readOnlyJobs=[],$scope.users=[],$scope.filename="",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("attachment",{}),$scope.versions=[],$scope.version="",$scope.newLabel="",$scope.removeLabel="",self.simpleName=$routeParams.simpleName||"",self.simpleVersion=$routeParams.simpleVersion||"",self.originalSimpleName="",$scope.keepSimpleNameTrack=!0,$scope.filterLabel=$routeParams.label||"All",$scope.labels=[],$scope.realLabels=[],$scope.removalUsers="",$scope.requestMsg="";var currentAction="",currentActionId=-1,currentSuiteId=-1;$scope.fetch=function(useCache){if(self.simpleName.length>0)return void loadSpecificationFromAlias();if(window.location.href.indexOf("/title/")>-1)return void $location.path("");switch(getAction()){case"create":versionsFct.get($scope,!0,function(data){$scope.versions=data,$scope.version=data[0].name||"",$scope.refreshCodemirror=!0},$scope.generalHttpFactoryError);break;case"1":if($scope.id<0)return;specificationFct.get($scope,useCache,$scope.id,function(data){$scope.specification=data,$scope.newname=data.title,resolveContinuousJobs(data.ext.continuous_integration),getRemovalUsers(),$scope.$emit("updateBreadcrumbs",{link:"specification/"+$scope.id+"/v/1",title:data.title});try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;case"2":if($scope.id<0)return;specificationFct.getFull($scope,useCache,$scope.id,function(data){$scope.specification=data,getRemovalUsers(),$scope.labels=getLabels(data),$scope.newname=data.title,resolveContinuousJobs(data.ext.continuous_integration),$scope.$emit("updateBreadcrumbs",{link:"specification/"+$scope.id+"/v/2",title:data.title});try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;default:if($scope.id<0)return;if("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)break;specificationFct.get($scope,!1,$scope.id,function(data){if(self.originalSimpleName=data.simpleName,$scope.refreshCodemirror=!0,Synergy.util.definedNotNull(data.ext.continuous_integration))for(var j=0,max=data.ext.continuous_integration.length;max>j;j++)data.ext.continuous_integration[j].jobUrl=data.ext.continuous_integration[j].jobUrl.substring(0,data.ext.continuous_integration[j].jobUrl.indexOf("/lastCompletedBuild"));$scope.$emit("updateBreadcrumbs",{link:"specification/"+$scope.id,title:data.title});try{data.controls.length>0&&($scope.rights=1)}catch(e){}$scope.specification=data,$scope.specification.originalOwner=data.owner,usersFct.getAll($scope,function(data){$scope.users=data.users},$scope.generalHttpFactoryError)},$scope.generalHttpFactoryError)}},$scope.hasLabel=function(testCase){if(!$scope.filterLabel||"All"===$scope.filterLabel)return!0;for(var i=0,max=testCase.keywords.length;max>i;i++)if(testCase.keywords[i]===$scope.filterLabel)return!0;return!1},$scope.loadPreview=function(){var _t="<h1>"+($scope.specification.title||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.specification.desc||"")+"</div>";sanitizerFct.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.toggleFavorite=function(){var target=parseInt($scope.specification.isFavorite,10)>0?0:1,spec=new Synergy.model.Specification("","","","",$scope.id);spec.isFavorite=target,userFct.toggleFavorite($scope,spec,function(){$scope.specification.isFavorite=target,0===target?$scope.SYNERGY.logger.log("Done","Specification removed from favorites","INFO","alert-success"):$scope.SYNERGY.logger.log("Done","Specification added to favorites","INFO","alert-success")},$scope.generalHttpFactoryError)},$scope.performAttachment=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete attachment?"),$("#deleteModalBody").html("<p>Do you really want to delete attachment?</p>"),$("#modal_confirm_ok").attr("ng-click","deleteAttachment()"),$("#deleteModal").modal("toggle"),currentAction="deleteAttachment",currentActionId=id;break;default:$location.path("specification_attachment/"+id+"/"+action)}},$scope.showJobsModal=function(){$("#jobsModal").modal("toggle")},$scope.removeJob=function(jobId){jobFct.remove($scope,jobId,$scope.specification.id,function(){for(var i=0,max=$scope.specification.ext.continuous_integration.length;max>i;i++)if($scope.specification.ext.continuous_integration[i].id===jobId){$scope.specification.ext.continuous_integration.splice(i,1);break}$scope.SYNERGY.modal.update("Job removed",""),$scope.SYNERGY.modal.show()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.addJob=function(){var job=new Synergy.model.Job($scope.jobToBeAdded,$scope.id,-1);jobFct.create($scope,job,function(){$scope.specification.ext.continuous_integration.push(job),$scope.SYNERGY.modal.update("Job added",""),$scope.SYNERGY.modal.show()},$scope.generalHttpFactoryError)},$scope.clone=function(){"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||($scope.newname||($scope.newname=$scope.specification.title),$scope.newname.length<1||$scope.cloneVersion.length<1?($scope.SYNERGY.modal.update("Missing parameters","Please add a new name and version"),$scope.SYNERGY.modal.show()):specificationFct.clone($scope,currentActionId,$scope.newname,$scope.cloneVersion,function(newLink){var id=newLink.substring(newLink.indexOf("=")+1);$scope.SYNERGY.logger.log("Done","Specification created, see "+window.location.hostname+window.location.pathname+"#/specification/"+id,"INFO","alert-success")},$scope.generalHttpFactoryError))},$scope.performSuite=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete test suite?"),$("#deleteModalBody").html("<p>Do you really want to delete test suite?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteSuite",currentActionId=id;break;case"labels":$("#addLabelsModal").modal("toggle"),currentAction="labels",currentActionId=id;break;default:$location.path("suite/"+id+"/"+action)}},$scope.performCase=function(action,id,suiteId){switch(action){case"delete":$("#deleteModalLabel").text("Delete test case?"),$("#deleteModalBody").html("<p>This will only remove reference to this test case in this suite. Continue?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteCase",currentActionId=id,currentSuiteId=suiteId}},$scope.deleteCase=function(){$("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||suiteFct.removeCase($scope,currentSuiteId,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Test Case removed from test suite","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.performAction=function(labelMode){switch(currentAction){case"deleteAttachment":$scope.deleteAttachment();break;case"cloneSpecification":$scope.clone();break;case"ownershipRequest":specificationFct.requestOwnership($scope,new Synergy.model.OwnershipRequest($scope.id,$scope.SYNERGY.session.username,$scope.requestMsg),function(){$scope.SYNERGY.logger.log("Done","Request has been sent to owner","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError);break;case"deleteSpecification":$scope.deleteSpecification();break;case"deleteSuite":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;suiteFct.remove($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Test suite deleted","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError);break;case"deleteCase":$scope.deleteCase();break;case"labels":"add"===labelMode?addLabels():removeLabels()}},$scope.deleteAttachment=function(){if($("#deleteModal").modal("toggle"),!("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){var toBeRemoved=currentActionId;attachmentFct.removeSpecAttachment($scope,currentActionId,$scope.specification.id,function(){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success");for(var i=0,max=$scope.specification.attachments.length;max>i;i++)if($scope.specification.attachments[i].id===toBeRemoved)return void $scope.specification.attachments.splice(i,1)},function(data){$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}},$scope.performSpecification=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete specification?"),$("#deleteModalBody").html("<p>Do you really want to delete specification?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteSpecification";break;case"clone":currentActionId=$scope.id,currentAction="cloneSpecification",versionsFct.get($scope,!0,function(data){$scope.versions=data,$("#dupliciteSpecModal").modal("toggle")},$scope.generalHttpFactoryError);break;case"ownershipRequest":if($scope.SYNERGY.session.username.length<1)return;$("#ownershipRequestModal").modal("toggle"),currentActionId=$scope.id,currentAction="ownershipRequest";break;default:$location.path("specification/"+$scope.specification.id+"/"+action)}},$scope.cancel=function(){window.history.back()},$scope.deleteSpecification=function(){$("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||specificationFct.remove($scope,$scope.specification.id,function(data,status){202===status?($scope.SYNERGY.logger.log("Done","Request to remove this specification has been sent to owner","INFO","alert-success"),$scope.specification.ext.removalRequests.push({username:$scope.SYNERGY.session.username}),getRemovalUsers()):($scope.SYNERGY.modal.update("Specification deleted",""),$scope.SYNERGY.modal.show(),$location.path("specifications"))},$scope.generalHttpFactoryError)},$scope.save=function(){if(!("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){var spec=new Synergy.model.Specification($scope.specification.title,$scope.specification.desc,"",$scope.specification.owner,$scope.specification.id);return spec.setSimpleName($scope.specification.simpleName),$scope.myForm.$invalid||"undefined"==typeof spec.desc||spec.desc.length<0?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void specificationFct.edit($scope,spec,$scope.minorEdit?!0:!1,$scope.keepSimpleNameTrack,function(){$scope.SYNERGY.modal.update("Specification updated",""),$scope.SYNERGY.modal.show(),$location.path("specification/"+$scope.specification.id)},$scope.generalHttpFactoryError)}},$scope.create=function(){if(!("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){if($scope.myForm.$invalid||"undefined"==typeof $scope.specification.desc||$scope.specification.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var spec=new Synergy.model.Specification($scope.specification.title,$scope.specification.desc,$scope.version,"",-1);spec.setSimpleName($scope.specification.title),specificationFct.create($scope,spec,function(data){$scope.SYNERGY.modal.update("Specification created","");var id=data.substring(data.indexOf("=")+1,data.length-1);$location.path("specification/"+id),$scope.SYNERGY.modal.show()},$scope.generalHttpFactoryError)}},new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("attachment",{id:$scope.id,type:"specification"}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,attachmentFct.getAttachmentsForSpecification($scope,$scope.specification.id,function(data){$scope.specification.attachments=data},function(data){$scope.SYNERGY.logger.log("Failed to refresh list of attachments",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error");try{$scope.$$phase||$scope.$apply()}catch(e){}})},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error"),$scope.SYNERGY.logger.log(title,msg,level,style);try{$scope.$$phase||$scope.$apply()}catch(e){}}),$scope.uploadFile=function(){new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("attachment",{id:$scope.id,type:"specification"}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,attachmentFct.getAttachmentsForSpecification($scope,$scope.specification.id,function(data){$scope.specification.attachments=data},function(data){$scope.SYNERGY.logger.log("Failed to refresh list of attachments",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error");try{$scope.$$phase||$scope.$apply()}catch(e){}})},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error"),$scope.SYNERGY.logger.log(title,msg,level,style);try{$scope.$$phase||$scope.$apply()}catch(e){}}).uploadFileFromFileChooser("fileToUpload")};var scope=$scope;$scope.init(function(){scope.fetch(!0)})}function SuiteCtrl($scope,utils,$location,$routeParams,$timeout,specificationFct,suiteFct,casesFct,productsFct,sanitizerFct){function setLastSuiteOrder(data){try{$scope.suite.order=data.testSuites[data.testSuites.length-1].order+1||1}catch(e){$scope.suite.order=1}}function loadProducts(){productsFct.get($scope,function(data){if(data.length>0){for(var p=[],j=0,max2=data.length;max2>j;j++)p.push(new Synergy.model.Product(data[j].name,data[j].components));$scope.products=p,$scope.availableProducts=!0;var oldPreferences=$scope.SYNERGY.cache.get("product_component");if(oldPreferences&&"unknown"===$scope.suite.product&&"unknown"===$scope.suite.component){for(var i=0,max=$scope.products.length;max>i;i++)if(data[i].name===oldPreferences.product)return $scope.suite.product=$scope.products[i],$scope.suite.component=oldPreferences.component,setComponent(i),void($scope.oldNotification="Selected product/component are based on previously used values and do not match actual settings of this suite")}else for(var i=0,max=$scope.products.length;max>i;i++)if(data[i].name===$scope.suite.product)return $scope.suite.product=$scope.products[i],void setComponent(i);$scope.suite.product=$scope.products[0],setComponent(0)}},$scope.generalHttpFactoryError)}function setComponent(productIndex){$scope.components=$scope.products[productIndex].components;for(var i=0,max=$scope.components.length;max>i;i++)if($scope.components[i].name===$scope.suite.component)return void($scope.suite.component=$scope.components[i]);$scope.suite.component=$scope.components[0]}$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.suite={},$scope.refreshCodemirror=!1,$scope.id=$routeParams.id||-1,$scope.rights=0,$scope.c_version=$routeParams.version||"",$scope.c_specificationId=$routeParams.specification||"",$scope.c_specification={},$scope.case_suggestions=[],$scope.caseToBeAdded="",$scope.availableProducts=!1,$scope.products=[],$scope.oldNotification="",$scope.components=[];var currentAction="",currentActionId=-1;$scope.fetch=function(){var action=window.location+"";switch(action=action.substring(action.lastIndexOf("/")+1)){case"create":parseInt($scope.c_specificationId,10)>0&&specificationFct.get($scope,!0,$scope.c_specificationId,function(data){setLastSuiteOrder(data),$scope.c_specification=data,loadProducts()},$scope.generalHttpFactoryError);break;case"1":if($scope.id<0)return;suiteFct.get($scope,!0,$scope.id,function(data){$scope.suite=data,$scope.$emit("updateBreadcrumbs",{link:"suite/"+$scope.id+"/v/1",title:data.title});try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;default:if($scope.id<0)return;if("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)break;suiteFct.get($scope,!1,$scope.id,function(data){$scope.suite=data,$scope.refreshCodemirror=!0;try{data.controls.length>0&&($scope.rights=1)}catch(e){}loadProducts()},$scope.generalHttpFactoryError)}},$scope.loadPreview=function(){var _t="<h1>"+($scope.suite.title||"")+"</h1><h3>Setup</h3><div class='well'>"+($scope.suite.desc||"")+"</div>";sanitizerFct.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.productChanged=function(){for(var i=0,max=$scope.products.length;max>i;i++)if($scope.products[i].name===$scope.suite.product.name){$scope.suite.product=$scope.products[i],setComponent(i);break}},$scope.performCase=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete test case?"),$("#deleteModalBody").html("<p>This will only remove reference to this test case in this suite. Continue?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteCase",currentActionId=id;break;default:$location.path("case/"+id+"/suite/"+$scope.id+"/"+action)}},$scope.performAction=function(){switch(currentAction){case"deleteCase":$scope.deleteCase();break;case"deleteSuite":$scope.deleteSuite()}},$scope.deleteCase=function(){$("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||suiteFct.removeCase($scope,$scope.suite.id,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Test Case removed from test suite","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.addCase=function(caseId){$("#addCaseModal").modal("toggle"),suiteFct.addCase($scope,$scope.id,caseId,function(){$scope.SYNERGY.logger.log("Done","Test Case added to test suite","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.performSuite=function(action){switch(action){case"delete":$("#deleteModalLabel").text("Delete test suite?"),$("#deleteModalBody").html("<p>Do you really want to delete test suite?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteSuite";break;default:$location.path("suite/"+$scope.suite.id+"/"+action)}},$scope.cancel=function(){window.history.back()},$scope.deleteSuite=function(){$("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||suiteFct.remove($scope,$scope.suite.id,function(){$scope.SYNERGY.modal.update("Test Suite deleted",""),$scope.SYNERGY.modal.show(),$location.path("specification/"+$scope.suite.specificationId)
},$scope.generalHttpFactoryError)},$scope.save=function(){if(!("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){if($scope.myForm.$invalid||$scope.myForm2.$invalid||"undefined"==typeof $scope.suite.desc||$scope.suite.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var product=$scope.availableProducts?$scope.suite.product.name:$scope.suite.product,suite=new Synergy.model.Suite($scope.suite.title,$scope.suite.desc,product,$scope.suite.component.name,$scope.suite.id);suite.order=$scope.suite.order,suiteFct.edit($scope,suite,$scope.minorEdit?!0:!1,function(){$scope.SYNERGY.modal.update("Test Suite updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError),$scope.availableProducts&&$scope.SYNERGY.cache.put("product_component",{product:$scope.suite.product.name,component:$scope.suite.component.name})}},$scope.create=function(){if($scope.suite.specificationId=$scope.c_specificationId,$scope.myForm.$invalid||$scope.myForm2.$invalid||"undefined"==typeof $scope.suite.desc||$scope.suite.desc.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();if(!("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){var product=$scope.availableProducts?$scope.suite.product.name:$scope.suite.product,suite=new Synergy.model.Suite($scope.suite.title,$scope.suite.desc,product,$scope.suite.component.name,-1);suite.order=$scope.suite.order,suite.specificationId=$scope.suite.specificationId,suiteFct.create($scope,suite,function(){$scope.SYNERGY.modal.update("Test Suite created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError),$scope.availableProducts&&$scope.SYNERGY.cache.put("product_component",{product:$scope.suite.product.name,component:$scope.suite.component})}},$scope.showAddCaseModal=function(){$scope.case_suggestions=[],$scope.caseToBeAdded="",$("#addCaseModal").modal("toggle")},$scope.filterCases=function(){$timeout(function(){casesFct.getMatching($scope,$scope.caseToBeAdded,function(data){$scope.case_suggestions=data},$scope.generalHttpFactoryError)},600)};var self=$scope;$scope.init(function(){self.fetch()})}function CaseCtrl($scope,utils,$location,$routeParams,suiteFct,caseFct,imageFct,issueFct,labelFct,sanitizerFct){function setLastCaseOrder(data){try{$scope.testCase.order=data.testCases[data.testCases.length-1].order+1||1}catch(e){$scope.testCase.order=1}}$scope.$emit("updateNavbar",{item:"nav_specs"}),$scope.testCase={},$scope.refreshCodemirror=!1,$scope.id=$routeParams.id||-1,$scope.parentSuite=$routeParams.parent||-1,$scope.rights=0;var currentAction="",currentActionId=-1;$scope.labelToBeAdded="",$scope.preview=$scope.parentSuite<0?1:0,$scope.c_suite={};var originalDuration=0;$scope.loadPreview=function(){var _t="<h1>"+($scope.testCase.title||"")+"</h1><h3>Steps</h3><div>"+($scope.testCase.steps||"")+"</div><h3>Expected result:</h3><div class='result well'>"+($scope.testCase.result||"")+"</div>";sanitizerFct.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.fetch=function(useCache){var action=window.location+"";switch(action=action.substring(action.lastIndexOf("/")+1)){case"create":$scope.testCase.steps="<ol>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<ol>",$scope.testCase.duration=1,parseInt($scope.parentSuite,10)>0&&suiteFct.get($scope,useCache,$scope.parentSuite,function(data){setLastCaseOrder(data),$scope.c_suite=data},$scope.generalHttpFactoryError);break;case"1":if($scope.id<0)return;caseFct.get($scope,useCache,$scope.id,$scope.parentSuite,function(data){$scope.testCase=data,$scope.$emit("updateBreadcrumbs",{link:"case/"+$scope.id+"/suite/"+$scope.parentSuite+"/v/1",title:data.title});try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError);break;default:if($scope.id<0)return;if("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)break;caseFct.get($scope,!1,$scope.id,$scope.parentSuite,function(data){$scope.testCase=data,$scope.refreshCodemirror=!0,$scope.testCase.suiteId=$scope.parentSuite,originalDuration=parseInt(data.duration,10);try{data.controls.length>0&&($scope.rights=1)}catch(e){}},$scope.generalHttpFactoryError)}},$scope.create=function(){if(!(parseInt($scope.parentSuite,10)<1)){if($scope.myForm.$invalid||$scope.myForm2.$invalid||"undefined"==typeof $scope.testCase.steps||typeof $scope.testCase.steps.length<0||"undefined"==typeof $scope.testCase.result||typeof $scope.testCase.result.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var testCase=new Synergy.model.TestCase($scope.testCase.title,$scope.testCase.steps,$scope.testCase.result,$scope.testCase.duration,-1);testCase.suiteId=$scope.parentSuite,testCase.order=$scope.testCase.order,"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||caseFct.create($scope,testCase,function(){$scope.SYNERGY.modal.update("Test Case created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)}},$scope.performAction=function(){switch(currentAction){case"deleteCase":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1||$scope.parentSuite<1)return;suiteFct.removeCase($scope,$scope.parentSuite,$scope.id,function(){$scope.SYNERGY.modal.update("Test Case removed from test suite",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError);break;case"deleteImage":var idToBeRemoved=currentActionId;$("#deleteImageModal").modal("toggle"),imageFct.remove($scope,currentActionId,$scope.parentSuite,function(){$scope.SYNERGY.logger.log("Done","Image removed","INFO","alert-success");for(var i=0,max=$scope.testCase.images.length;max>i;i++)if($scope.testCase.images[i].id===idToBeRemoved)return void $scope.testCase.images.splice(i,1)},$scope.generalHttpFactoryError)}},$scope.performCase=function(action){if(!($scope.parentSuite<0))switch(action){case"delete":$("#deleteModalLabel").text("Delete test case?"),$("#deleteModalBody").html("<p>This will only remove reference to this test case in this suite. Continue?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteCase";break;default:$location.path("case/"+$scope.testCase.id+"/suite/"+$scope.parentSuite+"/"+action)}},$scope.performImage=function(action,id){if(!($scope.parentSuite<0))switch(action){case"delete":$("#deleteImageModalLabel").text("Delete image?"),$("#deleteImageModalBody").html("<p>This will delete image from this test case. Continue?</p>"),$("#deleteImageModal").modal("toggle"),currentAction="deleteImage",currentActionId=id;break;default:$location.path("image/"+id+"/"+action)}},$scope.cancel=function(){window.history.back()},$scope.save=function(mode){if(!("undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)){if($scope.myForm.$invalid||$scope.myForm2.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var t_case=new Synergy.model.TestCase($scope.testCase.title,$scope.testCase.steps,$scope.testCase.result,$scope.testCase.duration,$scope.testCase.id);t_case.suiteId=$scope.parentSuite,t_case.order=$scope.testCase.order,t_case.orginalDuration=originalDuration,caseFct.edit($scope,mode,t_case,$scope.minorEdit?!0:!1,function(){$scope.SYNERGY.modal.update("Test Case updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)}},$scope.showAddIssueModal=function(){$scope.issueToBeAdded="",$("#addIssueModal").modal("toggle")},$scope.addIssue=function(){issueFct.create($scope,{testCaseId:$scope.testCase.id,id:$scope.issueToBeAdded},function(){$scope.SYNERGY.logger.log("Issue added","","INFO","alert-success"),$scope.testCase.issues.push({bugId:parseInt($scope.issueToBeAdded,10),title:"",resolution:"",id:-1})},$scope.generalHttpFactoryError)},$scope.removeIssue=function(id){issueFct.remove($scope,{testCaseId:$scope.testCase.id,id:id},function(){$scope.SYNERGY.logger.log("Issue removed","","INFO","alert-success");for(var i=0,max=$scope.testCase.issues.length;max>i;i++)if($scope.testCase.issues[i].bugId===id)return void $scope.testCase.issues.splice(i,1)},$scope.generalHttpFactoryError)},$scope.showAddLabelModal=function(){$scope.labelToBeAdded="",$("#addLabelModal").modal("toggle")},$scope.addLabel=function(){labelFct.create($scope,{label:$scope.labelToBeAdded,testCaseId:$scope.testCase.id,suiteId:$scope.parentSuite},function(){$scope.SYNERGY.logger.log("Label added","","INFO","alert-success"),$scope.testCase.keywords.push($scope.labelToBeAdded.toLowerCase())},$scope.generalHttpFactoryError)},$scope.removeLabel=function(label){labelFct.remove($scope,{label:label,testCaseId:$scope.testCase.id,suiteId:$scope.parentSuite},function(){$scope.SYNERGY.logger.log("Label removed","","INFO","alert-success"),$scope.testCase.keywords.splice($scope.testCase.keywords.indexOf(label),1)},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch(!0)});var fu=new Synergy.control.FileUploader([],"fakeID",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("image",{id:$scope.id,suiteId:$scope.parentSuite,title:encodeURIComponent($scope.imageTitle)}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,imageFct.getImagesForCase($scope,$scope.testCase.id,$scope.parentSuite,function(data){$scope.testCase.images=data},function(data){$scope.SYNERGY.logger.log("Unable to refresh list of images","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},function(title,msg,level,style){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error"),$scope.SYNERGY.logger.log(title,msg,level,style);try{$scope.$$phase||$scope.$apply()}catch(e){}});fu.initForImages("dropbox"),$scope.uploadFile=function(){fu.uploadImage($scope.SYNERGY.server.buildURL("image",{id:$scope.id,suiteId:$scope.parentSuite,title:encodeURIComponent($scope.imageTitle)}))}}function ProfileCtrl($scope,$routeParams,userFct){$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.user={authorOf:[],membership:[],favorites:[],assignments:[]},$scope.username=$routeParams.user||"",$scope.rights=0,$scope.isLoggedIn="undefined"!=typeof $scope.SYNERGY.session.session_id&&$scope.SYNERGY.session.session_id.length>1?1:0,$scope.fetch=function(){$scope.isLoggedIn="undefined"!=typeof $scope.SYNERGY.session.session_id&&$scope.SYNERGY.session.session_id.length>1?1:0;var action=window.location+"";action=action.substring(action.lastIndexOf("/")+1),$scope.username.length<1&&("undefined"!=typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length>1)&&($scope.username=$scope.SYNERGY.session.username),$scope.username.length<1||userFct.get($scope,$scope.username,function(data){$scope.user=data,$scope.username===$scope.SYNERGY.session.username&&($scope.rights=1),$scope.$emit("updateBreadcrumbs",{link:"user/"+$scope.username,title:$scope.username})},$scope.generalHttpFactoryError)},$scope.editName=function(){if(1===$scope.rights){var _u=new Synergy.model.User($scope.user.firstName,$scope.user.lastName,$scope.user.username,"",-1);_u.emailNotifications=$scope.user.emailNotifications,userFct.edit($scope,_u,function(){$scope.SYNERGY.logger.log("Done","updated","INFO","alert-success")},$scope.generalHttpFactoryError)}},$scope.toggleFavorite=function(id){var spec={id:id,isFavorite:0};userFct.toggleFavorite($scope,spec,function(){$scope.SYNERGY.logger.log("Done","Specification removed from favorites","INFO","alert-success");for(var k=0,max=$scope.user.favorites.length;max>k;k+=1)if(parseInt($scope.user.favorites[k].id,10)===parseInt(id,10))return void $scope.user.favorites.splice(k,1)},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()}),$scope.uploadFile=function(){new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("profile_img",{id:$scope.user.id}),function(title,msg,level,style,fileName,newSrc){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.user.profileImg=newSrc;try{$scope.$$phase||$scope.$apply()}catch(e){}},function(title,msg){$scope.SYNERGY.logger.log("Action failed",msg,"INFO","alert-error");try{$scope.$$phase||$scope.$apply()}catch(e){}}).uploadFileFromFileChooser("fileToUpload")},$scope.resetFile=function(){userFct.resetProfileImg($scope,$scope.user.id,function(data){$scope.user.profileImg=data},$scope.generalHttpFactoryError)}}function LabelFilterCtrl($scope,$routeParams,labelFct){$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.result={},$scope.label=$routeParams.label||"",$scope.page=$routeParams.page||1,$scope.next=0,$scope.prev=0,$scope.nextPage=1,$scope.prevPage=1,$scope.fetch=function(){$scope.label.length>0&&labelFct.findCases($scope,$scope.label,$scope.page,function(data){$scope.result=data,$scope.$emit("updateBreadcrumbs",{link:"label/"+$scope.label+"/page/1",title:$scope.label}),$scope.next=data.nextUrl.length>1?1:0,$scope.prev=data.prevUrl.length>1?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function TribeCtrl($scope,$location,$routeParams,$timeout,usersFct,tribeFct,sanitizerFct,specificationsFct){function loadSpecifications(){specificationsFct.get($scope,"allRaw",function(data){for(var d=[],i=0,max=data.length;max>i;i+=1)d[i]={title:data[i].title,version:data[i].version,value:data[i].title+" ("+$scope.SYNERGY.product+" "+data[i].version+")",id:data[i].id};$scope.specifications=d},$scope.generalHttpFactoryError)}function findSpecification(id){for(var i=0,max=$scope.specifications.length;max>i;i++)if($scope.specifications[i].id===id)return i;return-1}function loadUsers(){$scope.users.length>0||($scope.loadingUsers=!0,usersFct.getAll($scope,function(data){if(Synergy.util.definedNotNull(data)&&Synergy.util.definedNotNull(data.users))for(var i=0,max=data.users.length;max>i;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.loadingUsers=!1,$scope.users=data.users},function(data){$scope.SYNERGY.logger.log("Action failed","Unable to load list of users","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}))}$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.tribe={},$scope.id=$routeParams.id||-1,$scope.rights=0,$scope.refreshCodemirror=!1;var currentAction="",currentId="";$scope.suggestions=[],$scope.users_suggestions=[],$scope.userToBeAdded="pepa",$scope.specifications=[],$scope.newSpecification=-1,$scope.users=[],$scope.loadingUsers=!1,$scope.toggleMembers=!1,$scope.fetch=function(){var action=window.location+"";action=action.substring(action.lastIndexOf("/")+1),$scope.id>0&&tribeFct.get($scope,!1,$scope.id,function(data){$scope.tribe=data,$scope.refreshCodemirror=!0,$scope.$emit("updateBreadcrumbs",{link:"tribe/"+$scope.id,title:data.name}),$scope.tribe.controls.length>0&&($scope.rights=1),"edit"===action&&(loadSpecifications(),loadUsers())},$scope.generalHttpFactoryError)},$scope.loadPreview=function(){var _t="<h1>"+($scope.tribe.name||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.tribe.description||"")+"</div>";sanitizerFct.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.addSpecification=function(){for(var _index=parseInt($scope.newSpecification),i=0,max=$scope.tribe.ext.specifications.length;max>i;i++)if(parseInt($scope.tribe.ext.specifications[i].id)===_index)return void $scope.SYNERGY.logger.log("Oops","Specification already added to tribe","INFO","alert-info");tribeFct.addSpecification($scope,$scope.id,$scope.newSpecification,function(data,specificationId){$scope.SYNERGY.logger.log("Done","Specification added to tribe","INFO","alert-success");var matchingIndex=findSpecification(parseInt(specificationId,10));matchingIndex>0&&$scope.tribe.ext.specifications.push($scope.specifications[matchingIndex])},$scope.generalHttpFactoryError)},$scope.removeSpecification=function(specificationId){tribeFct.removeSpecification($scope,$scope.id,specificationId,function(data,specificationId){$scope.SYNERGY.logger.log("Done","Specification removed from tribe","INFO","alert-success");for(var i=0,max=$scope.tribe.ext.specifications.length;max>i;i++)if(parseInt($scope.tribe.ext.specifications[i].id,10)===specificationId)return void $scope.tribe.ext.specifications.splice(i,1)},$scope.generalHttpFactoryError)},$scope.removeFromTribe=function(username){$("#deleteModalLabel").text("Remove user from tribe?"),$("#deleteModalBody").html("<p>Do you really want to revoke user's membership?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteUser",currentId=username},$scope.performRemoveFromTribe=function(username){$("#deleteModal").modal("toggle"),tribeFct.revokeMembership($scope,username,$scope.id,function(){$scope.SYNERGY.logger.log("Done","User removed from tribe","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.performAction=function(){switch(currentAction){case"deleteUser":$scope.performRemoveFromTribe(currentId)}},$scope.performTribeAction=function(action){"delete"!==action&&$location.path("tribe/"+$scope.id+"/"+action)},$scope.cancel=function(){window.history.back()},$scope.save=function(){if($scope.myForm.$invalid||$scope.myForm2.$invalid||"undefined"==typeof $scope.tribe.description||$scope.tribe.description.length<0)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var tribe=new Synergy.model.Tribe($scope.tribe.name,$scope.tribe.description,$scope.tribe.leaderUsername,$scope.tribe.id);tribeFct.edit($scope,tribe,function(){$scope.SYNERGY.modal.update("Tribe updated",""),$scope.SYNERGY.modal.show(),$location.path("tribe/"+$scope.tribe.id)},$scope.generalHttpFactoryError)},$scope.addUser=function(){tribeFct.newMembership($scope,{username:$scope.userToBeAdded},$scope.tribe.id,function(){$scope.SYNERGY.logger.log("Done","User added to tribe","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.showAddUserModal=function(){$scope.toggleMembers=!$scope.toggleMembers,loadUsers()};var self=$scope;$scope.init(function(){self.fetch()})}function RunsCtrl($scope,$routeParams,runsFct){$scope.runs=[],$scope.page=$routeParams.page||1,$scope.next=0,$scope.prev=0,$scope.nextPage=1,$scope.prevPage=1,$scope.fetch=function(){$scope.$emit("updateBreadcrumbs",{link:"runs",title:"Test Runs"}),$scope.$emit("updateNavbar",{item:"nav_runs"}),runsFct.get($scope,$scope.page,function(data){$scope.runs=data,$scope.next=data.nextUrl.length>1?1:0,$scope.prev=data.prevUrl.length>1?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AssignmentCtrl($scope,$routeParams,assignmentFct){function collectCases(){for(var cases=[],i=0,max=$scope.assignment.specificationData.testSuites.length;max>i;i+=1)for(var j=0,max2=$scope.assignment.specificationData.testSuites[i].testCases.length;max2>j;j+=1){var p=getProgressForCase($scope.assignment.specificationData.testSuites[i].testCases[j].id,$scope.assignment.specificationData.testSuites[i].id);cases.push({name:$scope.assignment.specificationData.testSuites[i].testCases[j].title+" ("+$scope.assignment.specificationData.testSuites[i].title+")"+(1===parseInt(p.finished,10)?" - ["+p.result+"]":""),caseId:$scope.assignment.specificationData.testSuites[i].testCases[j].id,suiteId:$scope.assignment.specificationData.testSuites[i].id,progress:p,result:p.result})}$scope.allCases=cases}function cachedDataExists(){return cachedData=$scope.SYNERGY.cache.get("assignment_progress_"+$scope.id),cachedData&&cachedData.date&&cachedData.progress?!0:!1}function parseData(caseStartIndex,suiteStartIndex){for(var _s,i=suiteStartIndex,max=$scope.assignment.progress.specification.testSuites.length;max>i;i+=1){_s=$scope.assignment.progress.specification.testSuites[i];for(var j=caseStartIndex,max2=_s.testCases.length;max2>j;j+=1)if(0===parseInt(_s.testCases[j].finished,10))return $scope.currentCaseId=parseInt(_s.testCases[j].id,10),$scope.currentSuiteId=parseInt(_s.id,10),printCase($scope.currentCaseId,$scope.currentSuiteId),$scope.suiteIndex=i,$scope.caseIndex=j,void((i!==suiteStartIndex||0===caseStartIndex&&0===suiteStartIndex)&&($scope.suiteSetupDisplayed=!0,$scope.toggleAction="hide"));caseStartIndex=0}$scope.timeLeft=0,$scope.sendResults()}function getTimeLeft(){for(var _s,i=0,max=$scope.assignment.progress.specification.testSuites.length;max>i;i+=1){_s=$scope.assignment.progress.specification.testSuites[i];for(var j=0,max2=_s.testCases.length;max2>j;j+=1)0!==parseInt(_s.testCases[j].finished,10)&&(timeFinished+=_s.testCases[j].hasOwnProperty("originalDuration")?parseInt(Math.round(_s.testCases[j].originalDuration),10):parseInt(Math.round(_s.testCases[j].duration),10))}$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished}function printCase(caseId,suiteId){if($scope.newIssue="",-1!==caseId){for(var i=0,max=$scope.assignment.specificationData.testSuites.length;max>i;i+=1)if(suiteId===parseInt($scope.assignment.specificationData.testSuites[i].id,10))for(var j=0,max2=$scope.assignment.specificationData.testSuites[i].testCases.length;max2>j;j+=1)if(caseId===parseInt($scope.assignment.specificationData.testSuites[i].testCases[j].id,10))return $scope.currentCase={title:$scope.assignment.specificationData.testSuites[i].testCases[j].title,caseId:$scope.assignment.specificationData.testSuites[i].testCases[j].id,suiteId:$scope.assignment.specificationData.testSuites[i].id,images:$scope.assignment.specificationData.testSuites[i].testCases[j].images,duration:parseInt($scope.assignment.specificationData.testSuites[i].testCases[j].duration,10),steps:$scope.assignment.specificationData.testSuites[i].testCases[j].steps,suiteTitle:$scope.assignment.specificationData.testSuites[i].title,result:$scope.assignment.specificationData.testSuites[i].testCases[j].result,issues:$scope.assignment.specificationData.testSuites[i].testCases[j].issues,suiteSetup:$scope.assignment.specificationData.testSuites[i].desc,product:$scope.assignment.specificationData.testSuites[i].product,comment:-1,commentFreeText:"",progress:getProgressForCase(caseId,suiteId),component:$scope.assignment.specificationData.testSuites[i].component},initValuesFromProgress(),void(started=(new Date).getTime())}else for(var i=0,max=$scope.assignment.specificationData.testSuites.length;max>i;i+=1)for(var j=0,max2=$scope.assignment.specificationData.testSuites[i].testCases.length;max2>j;j+=1)return $scope.suiteIndex=i,$scope.caseIndex=j,started=(new Date).getTime(),void($scope.currentCase={title:$scope.assignment.specificationData.testSuites[i].testCases[j].title,caseId:$scope.assignment.specificationData.testSuites[i].testCases[j].id,suiteId:$scope.assignment.specificationData.testSuites[i].id,images:$scope.assignment.specificationData.testSuites[i].testCases[j].images,duration:parseInt($scope.assignment.specificationData.testSuites[i].testCases[j].duration,10),steps:$scope.assignment.specificationData.testSuites[i].testCases[j].steps,suiteTitle:$scope.assignment.specificationData.testSuites[i].title,result:$scope.assignment.specificationData.testSuites[i].testCases[j].result,issues:$scope.assignment.specificationData.testSuites[i].testCases[j].issues,suiteSetup:$scope.assignment.specificationData.testSuites[i].desc,product:$scope.assignment.specificationData.testSuites[i].product,comment:-1,commentFreeText:"",progress:{finished:0,id:caseId,result:"",duration:0,issue:[],comment:-1,commentFreeText:""},component:$scope.assignment.specificationData.testSuites[i].component})}function initValuesFromProgress(){$scope.currentCase.progress.issue&&$scope.currentCase.progress.issue.length>0&&($scope.newIssue=$scope.currentCase.progress.issue.join(" ")),$scope.currentCase.progress.comment&&$scope.currentCase.progress.comment>0&&($scope.currentCase.comment=$scope.currentCase.progress.comment,$scope.currentCase.commentFreeText=$scope.currentCase.progress.hasOwnProperty("commentFreeText")?$scope.currentCase.progress.commentFreeText:"")}function getProgressForCase(caseId,suiteId){for(var i=0,max=$scope.assignment.progress.specification.testSuites.length;max>i;i++)if(parseInt($scope.assignment.progress.specification.testSuites[i].id,10)===parseInt(suiteId,10))for(var j=0,max2=$scope.assignment.progress.specification.testSuites[i].testCases.length;max2>j;j++)if(parseInt($scope.assignment.progress.specification.testSuites[i].testCases[j].id,10)===parseInt(caseId,10))return $scope.assignment.progress.specification.testSuites[i].testCases[j];return{finished:0,id:caseId,result:"",duration:0,issue:[],comment:-1}}$scope.$emit("updateNavbar",{item:"nav_home"}),$scope.assignment={},$scope.currentCase={},$scope.currentCaseId=-1,$scope.currentSuiteId=-1,$scope.id=$routeParams.id||-1,$scope.mode=$routeParams.mode||2,$scope.timeLeft=0,$scope.suiteIndex=0,$scope.caseIndex=0,$scope.casesFinished=0,$scope.newIssue="",$scope.attachmentBase=$scope.SYNERGY.server.buildURL("attachment",{});var timeFinished=0;$scope.failedAttempt=!1;var started=0,cachedData={};$scope.cacheDate={},$scope.comments=[],$scope.allCases=[],$scope.suiteSetupDisplayed=!1,$scope.toggleAction="display",$scope.caseToPrint={},$scope.fetch=function(){if($scope.id>0){if(cachedDataExists())return $scope.cacheDate=cachedData.date,void $("#attemptModal").modal("toggle");switch(assignmentFct.getCommentTypes($scope,function(data){data.push({name:"No comment",id:-1}),$scope.comments=data},$scope.generalHttpFactoryError),$scope.mode){case"1":assignmentFct.start($scope,$scope.id,function(data){$scope.assignment=data,getTimeLeft(),collectCases(),$scope.casesFinished=parseInt(100*(parseInt(data.completed,10)/parseInt(data.total,10)),10)||0,parseData(0,0,0),$scope.caseToPrint=$scope.allCases.filter(function(e){return e.caseId===$scope.currentCase.caseId&&e.suiteId===$scope.currentCase.suiteId})[0]},$scope.generalHttpFactoryError);break;case"2":assignmentFct.restart($scope,$scope.id,function(data){$scope.assignment=data,$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10),collectCases(),$scope.casesFinished=parseInt(100*(parseInt(data.completed,10)/parseInt(data.total,10)),10)||0,parseData(0,0,0),$scope.caseToPrint=$scope.allCases.filter(function(e){return e.caseId===$scope.currentCase.caseId&&e.suiteId===$scope.currentCase.suiteId})[0]},$scope.generalHttpFactoryError)}}},$scope.traverseCase=function(){var oldSuiteId=$scope.currentSuiteId;$scope.currentCaseId=parseInt($scope.caseToPrint.caseId,10),$scope.currentSuiteId=parseInt($scope.caseToPrint.suiteId,10);for(var _s,i=0,max=$scope.assignment.progress.specification.testSuites.length;max>i;i+=1)if(_s=$scope.assignment.progress.specification.testSuites[i],parseInt(_s.id,10)===parseInt($scope.caseToPrint.suiteId,10))for(var j=0,max2=_s.testCases.length;max2>j;j+=1)parseInt(_s.testCases[j].id,10)===parseInt($scope.caseToPrint.caseId,10)&&($scope.suiteIndex=i,$scope.caseIndex=j);oldSuiteId!==$scope.currentSuiteId&&($scope.suiteSetupDisplayed=!0,$scope.toggleAction="hide"),printCase($scope.currentCaseId,$scope.currentSuiteId)},$scope.toggleSetup=function(){$scope.toggleAction=$scope.suiteSetupDisplayed?"display":"hide",$scope.suiteSetupDisplayed=!$scope.suiteSetupDisplayed},$scope.sendCached=function(send){send?($("#attemptModal").modal("toggle"),$scope.assignment.progress=cachedData.progress,$scope.sendResults()):($scope.SYNERGY.cache.clear("assignment_progress_"+$scope.id),$scope.fetch())},$scope.sendResults=function(){$scope.failedAttempt&&$("#deleteModal").modal("toggle"),$scope.showWaitDialog(),assignmentFct.submitResults($scope,$scope.id,$scope.assignment.progress,function(){$scope.SYNERGY.modal.update("Results submitted","Thank you for testing"),$scope.SYNERGY.modal.show(),$scope.SYNERGY.cache.clear("assignment_progress_"+$scope.id),$scope.assignment={},$scope.currentCase={},$scope.currentCaseId=-1,$scope.currentSuiteId=-1,$scope.id=$routeParams.id||-1,$scope.mode=$routeParams.mode||2,$scope.timeLeft=0,$scope.suiteIndex=0,$scope.caseIndex=0,$scope.casesFinished=0,$scope.newIssue="",$scope.failedAttempt=!1,window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.failedAttempt||($scope.failedAttempt=!0,$("#deleteModal").modal("toggle")),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})},$scope.next=function(result){if(parseInt($scope.assignment.completed,10)===parseInt($scope.assignment.total,10))return $scope.SYNERGY.modal.update("Testing finished",""),void $scope.SYNERGY.modal.show();var alreadyTested=1===parseInt($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished,10)?!0:!1;switch(result){case"passed":alreadyTested||($scope.assignment.completed++,$scope.casesFinished=parseInt(100*(parseInt($scope.assignment.completed,10)/parseInt($scope.assignment.total,10)),10),timeFinished+=$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].hasOwnProperty("originalDuration")?parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration),10):parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration),10),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished);var timeTaken=(new Date).getTime()-started;$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished=1,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].result=result,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].comment=$scope.currentCase.comment,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].commentFreeText=-1!==$scope.currentCase.comment?$scope.currentCase.commentFreeText.substr(0,100):"",$scope.SYNERGY.trackCaseDuration||(timeTaken=6e4*$scope.currentCase.duration),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue="",$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration=timeTaken,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration=$scope.currentCase.duration,parseData($scope.caseIndex+1,$scope.suiteIndex,$scope.currentCase.duration);break;case"failed":if(!($scope.newIssue.length>0))return $scope.SYNERGY.modal.update("Missing issue number",""),void $scope.SYNERGY.modal.show();alreadyTested||($scope.assignment.completed++,$scope.casesFinished=parseInt(100*(parseInt($scope.assignment.completed,10)/parseInt($scope.assignment.total,10)),10),timeFinished+=$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].hasOwnProperty("originalDuration")?parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration),10):parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration),10),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished);
var timeTaken=(new Date).getTime()-started;$scope.SYNERGY.trackCaseDuration||(timeTaken=6e4*$scope.currentCase.duration),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue=$scope.newIssue.split(" "),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished=1,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].result=result,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration=timeTaken,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration=$scope.currentCase.duration,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].comment=$scope.currentCase.comment,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].commentFreeText=-1!==$scope.currentCase.comment?$scope.currentCase.commentFreeText.substr(0,100):"",parseData($scope.caseIndex+1,$scope.suiteIndex,$scope.currentCase.duration);break;case"skipped":if(-1===$scope.currentCase.comment)return $scope.SYNERGY.modal.update("Missing reason for skipping","Please select comment using the combo box below Skip button"),void $scope.SYNERGY.modal.show();alreadyTested||($scope.assignment.completed++,$scope.casesFinished=parseInt(100*(parseInt($scope.assignment.completed,10)/parseInt($scope.assignment.total,10)),10),timeFinished+=$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].hasOwnProperty("originalDuration")?parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration),10):parseInt(Math.round($scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].duration),10),$scope.timeLeft=parseInt($scope.assignment.specificationData.estimation,10)-timeFinished),$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].issue="",$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].finished=1,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].result=result,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].originalDuration=$scope.currentCase.duration,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].comment=$scope.currentCase.comment,$scope.assignment.progress.specification.testSuites[$scope.suiteIndex].testCases[$scope.caseIndex].commentFreeText=-1!==$scope.currentCase.comment?$scope.currentCase.commentFreeText.substr(0,100):"",parseData($scope.caseIndex+1,$scope.suiteIndex,$scope.currentCase.duration)}$scope.SYNERGY.cache.put("assignment_progress_"+$scope.id,{date:(new Date).toString(),progress:$scope.assignment.progress}),collectCases(),$scope.caseToPrint=$scope.allCases.filter(function(e){return e.caseId===$scope.currentCase.caseId&&e.suiteId===$scope.currentCase.suiteId})[0],$scope.SYNERGY.util.scrollTo("caseTitle")};var self=$scope;$scope.init(function(){self.fetch()})}function AdminHomeCtrl($scope){!$scope.SYNERGY.session.hasAdminRights()}function AdminVersionCtrl($scope,versionsFct,versionFct){$scope.versions=[],$scope.versionAffectedId=0,$scope.versionAffected="",$scope.newname="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&versionsFct.getAll($scope,function(data){$scope.versions=data},$scope.generalHttpFactoryError)},$scope.perform=function(action,versionId,version,isObsolete){switch(action){case"edit":$scope.newname=version,$scope.isObsolete=1===parseInt(isObsolete,10)?!0:!1,$scope.versionAffectedId=versionId,$scope.versionAffected=version,$("#editVersionModal").modal("toggle");break;case"create":$scope.newname="",$("#createVersionModal").modal("toggle");break;case"delete":$scope.versionAffectedId=versionId,$scope.versionAffected=version,$("#deleteModal").modal("toggle")}},$scope.rename=function(){return $scope.myForm.$invalid?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void versionFct.edit($scope,new Synergy.model.Version($scope.newname,$scope.versionAffectedId,$scope.isObsolete),function(){$scope.SYNERGY.logger.log("Done","Version renamed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.remove=function(){$("#deleteModal").modal("toggle"),versionFct.remove($scope,$scope.versionAffectedId,function(){$scope.SYNERGY.logger.log("Done","Version removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.create=function(){return $scope.myForm2.$invalid?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void versionFct.create($scope,new Synergy.model.Version($scope.newname,-1,!1),function(){$scope.SYNERGY.logger.log("Done","Version created","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminPlatformsCtrl($scope,platformsFct,platformFct){$scope.platforms=[],$scope.platformAffectedId=0,$scope.platformAffected="",$scope.newname="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&platformsFct.get($scope,function(data){$scope.platforms=data},$scope.generalHttpFactoryError)},$scope.perform=function(action,platformId,platform,isActive){switch(action){case"edit":$scope.platformAffectedId=platformId,$scope.platformAffected=platform,$scope.newname=platform,$scope.isActive=1===parseInt(isActive,10)?!0:!1,$("#editPlatformModal").modal("toggle");break;case"create":$("#createPlatformModal").modal("toggle");break;case"delete":$scope.platformAffectedId=platformId,$scope.platformAffected=platform,$("#deleteModal").modal("toggle")}},$scope.remove=function(){$("#deleteModal").modal("toggle"),platformFct.remove($scope,$scope.platformAffectedId,function(){$scope.SYNERGY.logger.log("Done","Platform removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.rename=function(){return $scope.myForm.$invalid?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void platformFct.edit($scope,new Synergy.model.Platform($scope.newname,$scope.platformAffectedId,$scope.isActive),function(){$scope.SYNERGY.logger.log("Done","Platform renamed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.create=function(){return $scope.myForm2.$invalid?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void platformFct.create($scope,new Synergy.model.Platform($scope.newname,-1),function(){$scope.SYNERGY.logger.log("Done","Platform created","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminTribesCtrl($scope,$location,$timeout,usersFct,tribeFct,tribesFct,sanitizerFct){function loadUsers(){usersFct.getAll($scope,function(data){if(Synergy.util.definedNotNull(data)&&Synergy.util.definedNotNull(data.users))for(var i=0,max=data.users.length;max>i;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.users=data.users,Synergy.util.definedNotNull(data)&&data.users.length>0&&($scope.tribe.leaderUsername=data.users[0].displayName)},$scope.generalHttpFactoryError)}$scope.tribes=[],$scope.tribe={},$scope.tribeAffectedId=0,$scope.tribeAffected="",$scope.newname="",$scope.users=[],$scope.importTribesUrl="http://"+window.location.host+"/dashboard/web/a_tribes.php?export=true",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&(loadUsers(),tribesFct.get($scope,function(data){$scope.tribes=data},$scope.generalHttpFactoryError))},$scope.importTribes=function(){tribesFct.importTribes($scope,$scope.importTribesUrl,function(data){$scope.SYNERGY.logger.log("Done",data+" tribes imported","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.deleteTribe=function(){$("#deleteModal").modal("toggle"),tribeFct.remove($scope,$scope.tribeAffectedId,function(){$scope.SYNERGY.logger.log("Done","Tribe removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.perform=function(action){switch(action){case"create":$location.path("administration/tribes/"+action)}},$scope.deleteModal=function(id,tribe){$scope.tribeAffectedId=id,$scope.tribeAffected=tribe,$("#deleteModal").modal("toggle")},$scope.loadPreview=function(){var _t="<h1>"+($scope.tribe.name||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.tribe.description||"")+"</div>";sanitizerFct.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.create=function(){if($scope.myForm2.$invalid||$scope.myForm.$invalid)return $scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show();var tribe=new Synergy.model.Tribe($scope.tribe.name,$scope.tribe.description,$scope.tribe.leaderUsername,-1);tribeFct.create($scope,tribe,function(){$scope.SYNERGY.modal.update("Tribe created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminRunsCtrl($scope,$location,$routeParams,runsFct,runFct){function remove(){$("#deleteModal").modal("toggle"),runFct.remove($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Test run removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)}$scope.runs=[],$scope.page=$routeParams.page||1,$scope.orderProp="title",$scope.next=0,$scope.prev=0,$scope.nextPage=1,$scope.prevPage=1;var currentActionId=-1,currentAction="";$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&runsFct.get($scope,$scope.page,function(data){$scope.runs=data,$scope.next=data.nextUrl.length>1?1:0,$scope.prev=data.prevUrl.length>1?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)},$scope.perform=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete test run?"),$("#deleteModalBody").html("<p>This action will also delete all test assignments for this test run. Do you want to continue?</p>"),$("#deleteModal").modal("toggle"),currentActionId=id,currentAction="delete";break;case"notify":$("#deleteModalLabel").text("Send notifications?"),$("#deleteModalBody").html("<p>Do you really want to send email notifications to testers with incomplete test assignment?</p>"),$("#deleteModal").modal("toggle"),currentAction="notify",currentActionId=id;break;case"freeze":var _run=$scope.runs.testRuns.filter(function(e){return e.id===id})[0],target=_run.isActive?0:1;runFct.freezeRun($scope,id,target,function(){_run=$scope.runs.testRuns.filter(function(e){return e.id===id})[0],_run.isActive=target,$scope.SYNERGY.logger.log("Done","Test run "+(1===target?"unfrozen":"frozen"),"INFO","alert-success")},$scope.generalHttpFactoryError);break;default:$location.path("administration/run/"+id+"/"+action)}},$scope.performAction=function(){switch(currentAction){case"delete":remove();break;case"notify":$("#deleteModal").modal("toggle"),runFct.sendNotifications($scope,currentActionId,function(data){$scope.SYNERGY.logger.log("Done",data,"INFO","alert-success")},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}};var self=$scope;$scope.init(function(){self.fetch()})}function AdminRunCtrl($scope,$routeParams,runFct,$location,attachmentFct,sanitizerFct){$scope.attachmentBase=$scope.SYNERGY.server.buildURL("run_attachment",{}),$scope.refreshCodemirror=!1,$scope.testRun=new Synergy.model.TestRun("","","","",""),$scope.id=$routeParams.id||-1;var currentAction="",currentActionId=-1;try{$("#start").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"}),$("#end").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"})}catch(e){}$scope.loadPreview=function(){var _t="<h1>"+($scope.testRun.title||"")+"</h1><h3>Description</h3><div class='well'>"+($scope.testRun.desc||"")+"</div>";sanitizerFct.getSanitizedInput($scope,_t,function(data){$scope.preview=data},$scope.generalHttpFactoryError)},$scope.performAttachment=function(action,id){switch(action){case"delete":$("#deleteModalLabel").text("Delete attachment?"),$("#deleteModalBody").html("<p>Do you really want to delete attachment?</p>"),$("#deleteModal").modal("toggle"),currentAction="deleteAttachment",currentActionId=id}},$scope.performAction=function(){switch(currentAction){case"deleteAttachment":if($("#deleteModal").modal("toggle"),"undefined"==typeof $scope.SYNERGY.session.session_id||$scope.SYNERGY.session.session_id.length<1)return;attachmentFct.removeRunAttachment($scope,currentActionId,function(){$scope.SYNERGY.logger.log("Done","Attachment deleted","INFO","alert-success"),$scope.fetch()},function(data){$scope.SYNERGY.logger.log("Action failed","","INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error"),$scope.fetch()})}},$scope.cancel=function(){window.history.back()},$scope.create=function(){var start=$("#start").val(),stop=$("#end").val();return $scope.myForm.$invalid||start.length<1||stop.length<1?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void runFct.create($scope,new Synergy.model.TestRun($scope.testRun.title,$scope.testRun.desc,$scope.getUTCTime(start),$scope.getUTCTime(stop),$scope.id).setNotifications($scope.testRun.notifications),function(){$scope.SYNERGY.modal.update("Test run created",""),$scope.SYNERGY.modal.show(),$location.path("administration/runs/page/1")},$scope.generalHttpFactoryError)},$scope.edit=function(){var start=$("#start").val(),stop=$("#end").val();return $scope.myForm.$invalid||start.length<1||stop.length<1?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void runFct.edit($scope,new Synergy.model.TestRun($scope.testRun.title,$scope.testRun.desc,$scope.getUTCTime(start),$scope.getUTCTime(stop),$scope.id).setNotifications($scope.testRun.notifications),function(){$scope.SYNERGY.modal.update("Test run updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)},$scope.uploadFile=function(){new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)}).uploadFileFromFileChooser("fileToUpload")},$scope.validDates=function(){return $scope.testRun.start=$("#start").val(),$scope.testRun.stop=$("#end").val(),$scope.testRun.start.length<1||$scope.testRun.stop.length<1?!1:!0},$scope.fetch=function(){if($scope.SYNERGY.session.hasAdminRights()){var action=window.location+"";switch(action=action.substring(action.lastIndexOf("/")+1)){case"edit":if($scope.id<0)return;runFct.getOverview($scope,!1,$scope.id,function(data){$scope.testRun=data,$scope.testRun.start=$scope.getLocalDateTime($scope.testRun.start),$scope.testRun.end=$scope.getLocalDateTime($scope.testRun.end),$scope.refreshCodemirror=!0},$scope.generalHttpFactoryError)}}},new Synergy.control.FileUploader([],"dropbox",$scope.SYNERGY.uploadFileLimit,$scope.SYNERGY.server.buildURL("run_attachment",{id:$scope.id}),function(title,msg,level,style,fileName){$scope.SYNERGY.logger.log(title,msg,level,style),$scope.fileName=fileName,$scope.fetch()},function(title,msg,level,style){$scope.SYNERGY.logger.log(title,msg,level,style)});var self=$scope;$scope.init(function(){self.fetch()})}function AdminMatrixAssignmentCtrl($scope,$routeParams,assignmentsFct,usersFct,labelsFct,platformsFct,tribesFct,versionsFct){function loadVersions(){versionsFct.get($scope,!1,function(data){$scope.versions=data,$scope.ready++},$scope.generalHttpFactoryError)}function loadPlatforms(){platformsFct.get($scope,function(data){$scope.platforms=data,$scope.ready++},$scope.generalHttpFactoryError)}function loadUsers(){usersFct.getAll($scope,function(data){if(Synergy.util.definedNotNull(data)&&Synergy.util.definedNotNull(data.users))for(var i=0,max=data.users.length;max>i;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.ready++,$scope.users=data.users},$scope.generalHttpFactoryError)}function loadLabels(){labelsFct.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.labels=data},$scope.generalHttpFactoryError)}function userAlreadySelected(username){for(var i=0,max=$scope.assignment.users.length;max>i;i++)if(username===$scope.assignment.users[i].username)return!0;return!1}function tribeAlreadySelected(tribeID){for(var i=0,max=$scope.assignment.tribes.length;max>i;i++)if(tribeID===$scope.assignment.tribes[i].id)return!0;return!1}function platformAlreadySelected(platformID){for(var i=0,max=$scope.assignment.platforms.length;max>i;i++)if(platformID===$scope.assignment.platforms[i].id)return!0;return!1}function getDisplayName(username){for(var i=0,max=$scope.users.length;max>i;i++)if($scope.users[i].username===username)return $scope.users[i].displayName;return"oops"}function getTribeName(tribeID){for(var i=0,max=$scope.tribes.length;max>i;i++)if($scope.tribes[i].id===tribeID)return $scope.tribes[i].name;return"oops"}function getPlatformName(platformID){for(var i=0,max=$scope.platforms.length;max>i;i++)if($scope.platforms[i].id===platformID)return $scope.platforms[i].name;return"oops"}$scope.assignment={platforms:[],users:[],tribes:[],runId:$routeParams.id},$scope.selectedPlatforms=[],$scope.platforms=[],$scope.platformId=-1,$scope.ready=0,$scope.fetch=function(){loadPlatforms(),loadLabels(),loadUsers(),loadVersions(),tribesFct.get($scope,function(data){$scope.tribes=data,$scope.ready++},$scope.generalHttpFactoryError)},$scope.create=function(){return $scope.assignment.users.length<1&&$scope.assignment.tribes.length<1||$scope.platforms.length<1?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):($scope.showWaitDialog(),void assignmentsFct.create($scope,$scope.assignment,function(){$scope.SYNERGY.modal.update("Assignment created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed for users ",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}))},$scope.addSelectedPlatform=function(){$scope.platformId&&!platformAlreadySelected(parseInt($scope.platformId,10))&&($scope.assignment.platforms.push({id:parseInt($scope.platformId,10),name:getPlatformName(parseInt($scope.platformId,10))}),$scope.platformId=-1)},$scope.addSelectedTribe=function(){$scope.tribeId&&!tribeAlreadySelected(parseInt($scope.tribeId,10))&&($scope.assignment.tribes.push({id:parseInt($scope.tribeId,10),name:getTribeName(parseInt($scope.tribeId,10))}),$scope.tribeId=-1)},$scope.addSelectedUser=function(){$scope.username&&!userAlreadySelected($scope.username)&&($scope.assignment.users.push({username:$scope.username,displayName:getDisplayName($scope.username)}),$scope.username="")},$scope.removeSelectedPlatform=function(platformID){for(var i=0,max=$scope.assignment.platforms.length;max>i;i++)if(platformID===$scope.assignment.platforms[i].id)return $scope.assignment.platforms.splice(i,1),void($scope.platformId=-1)},$scope.removeSelectedTribe=function(tribeId){for(var i=0,max=$scope.assignment.tribes.length;max>i;i++)if(tribeId===$scope.assignment.tribes[i].id)return $scope.assignment.tribes.splice(i,1),void($scope.tribesId=-1)},$scope.removeSelectedUser=function(username){for(var i=0,max=$scope.assignment.users.length;max>i;i++)if(username===$scope.assignment.users[i].username)return $scope.assignment.users.splice(i,1),void($scope.username=-1)},$scope.cancel=function(){window.history.back()};var self=$scope;$scope.init(function(){self.fetch()})}function AdminAssignmentCtrl($scope,$timeout,$routeParams,specificationsFct,assignmentsFct,usersFct,labelsFct,platformsFct){function loadPlatforms(){platformsFct.get($scope,function(data){$scope.platforms=data,$scope.ready++,Synergy.util.definedNotNull(data)&&data.length>0&&($scope.value.platform=data[0])},$scope.generalHttpFactoryError)}function loadLabels(){labelsFct.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.labels=data,$scope.value.label=data[data.length-1]},$scope.generalHttpFactoryError)}function loadUsers(){usersFct.getAll($scope,function(data){if(Synergy.util.definedNotNull(data)&&data.users)for(var i=0,max=data.users.length;max>i;i++)data.users[i].displayName=data.users[i].firstName+" "+data.users[i].lastName+" ("+data.users[i].username+")";$scope.ready++,$scope.users=data.users,Synergy.util.definedNotNull(data)&&data.users.length>0&&($scope.value.user=$scope.users[0])},$scope.generalHttpFactoryError)}function loadSpecifications(){specificationsFct.get($scope,"allRaw",function(data){$scope.specifications=[];for(var i=0,max=data.length;max>i;i+=1)$scope.specifications[i]={value:data[i].title+" ("+$scope.SYNERGY.product+" "+data[i].version+")",info:"<a href='#/specification/"+data[i].id+"'>view</a>",id:data[i].id,type:"specification",version:data[i].version};$scope.value.specification=$scope.specifications[0],$scope.ready++},$scope.generalHttpFactoryError)}$scope.testRunId=$routeParams.id,$scope.assignments=[],$scope.platforms=[],$scope.users=[],$scope.ready=0,$scope.value={},$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&(loadPlatforms(),loadUsers(),loadLabels(),loadSpecifications())};var self=$scope;$scope.init(function(){self.fetch()}),$scope.addAssignment=function(){if(!$scope.value.specification)return void $scope.SYNERGY.logger.showMsg("Oops","No specification selected (maybe tribe does not have any specification?)","alert-error");var assignment=new Synergy.model.TestAssignment($scope.value.platform.id,$scope.value.user.username,$scope.value.label.id);assignment.specificationId=$scope.value.specification.id,assignment.testRunId=$scope.testRunId,assignment.display={user:$scope.value.user.firstName+" "+$scope.value.user.lastName,label:$scope.value.label.label,platform:$scope.value.platform.name,specification:$scope.value.specification.value},$scope.assignments.push(assignment)},$scope.removeAssignment=function(index){$scope.assignments.splice(index,1)},$scope.cancel=function(){window.history.back()},$scope.create=function(){$scope.showWaitDialog(),assignmentsFct.createForUsers($scope,$scope.assignments,function(){$scope.SYNERGY.modal.update("Assignments created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed ",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}}function AdminUsersCtrl($scope,$location,$routeParams,userFct,usersFct){$scope.users=[],$scope.page=$routeParams.page||1;var currentUser="";$scope.importUsersUrl="http://"+window.location.host+"/dashboard/web/a_netcatusers.php",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&usersFct.get($scope,$scope.page,function(data){$scope.users=data.users,$scope.next=data.nextUrl.length>1?1:0,$scope.prev=data.prevUrl.length>1?1:0,$scope.nextPage=parseInt($scope.page,10)+1,$scope.prevPage=parseInt($scope.page,10)-1},$scope.generalHttpFactoryError)},$scope.importUsers=function(){usersFct.importUsers($scope,$scope.importUsersUrl,function(data){$scope.SYNERGY.logger.log("Done",data+" users imported","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.perform=function(action,username){if("delete"!==action)$location.path("administration/user/"+username+"/"+action);else switch(action){case"delete":$("#deleteModal").modal("toggle"),currentUser=username}},$scope.newuser=function(){$location.path("administration/user/-1/create")},$scope.deleteUser=function(){$("#deleteModal").modal("toggle"),userFct.remove($scope,currentUser,function(){$scope.SYNERGY.logger.log("Done","User removed","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminUserCtrl($scope,$routeParams,userFct){$scope.user={},$scope.username=$routeParams.username||"",this.oldUsername="";var self=this;$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&"-1"!==$scope.username&&userFct.get($scope,$scope.username,function(data){self.oldUsername=$scope.username,$scope.user=data},$scope.generalHttpFactoryError)},$scope.cancel=function(){window.history.back()},$scope.save=function(){return $scope.myForm.$invalid?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void userFct.create($scope,new Synergy.model.User($scope.user.firstName,$scope.user.lastName,$scope.user.username,$scope.user.role,-1),function(){$scope.SYNERGY.modal.update("User created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)},$scope.edit=function(){return $scope.myForm.$invalid?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):void userFct.edit($scope,new Synergy.model.User($scope.user.firstName,$scope.user.lastName,$scope.user.username,$scope.user.role,-1,self.oldUsername),function(){$scope.SYNERGY.modal.update("User updated",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminSettingCtrl($scope,settingsFct){$scope.settings=[],$scope.newValue="",$scope.newDesc="",$scope.newKey="",$scope.fetch=function(){$scope.SYNERGY.session.hasAdminRights()&&settingsFct.get($scope,function(data){$scope.settings=data},$scope.generalHttpFactoryError)},$scope.save=function(){for(var i=0,limit=$scope.settings.length;limit>i;i+=1)if($scope.settings[i].value.length<1)return void $scope.SYNERGY.logger.log("Missing value: ",$scope.settings[i].key,"INFO","alert-error");settingsFct.edit($scope,$scope.settings,function(){$scope.SYNERGY.logger.log("Done","Settings updated","INFO","alert-success"),$scope.fetch()},$scope.generalHttpFactoryError)},$scope.addSetting=function(){$scope.settings.push({value:$scope.newValue,label:$scope.newDesc,key:$scope.newKey}),$scope.newValue=$scope.newDesc=$scope.newKey=""};var self=$scope;$scope.init(function(){self.fetch()})}function AboutCtrl($scope,aboutFct){$scope.$emit("updateNavbar",{item:"nav_empty"}),$scope.statistics=[],$scope.fetch=function(){aboutFct.get($scope,function(data){$scope.$emit("updateBreadcrumbs",{link:"about",title:"About"}),$scope.statistics=data},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function TribesCtrl($scope,$location,$timeout,tribesFct){$scope.$emit("updateNavbar",{item:"nav_empty"}),$scope.tribes=[],$scope.fetch=function(){tribesFct.get($scope,function(data){$scope.tribes=data,$scope.$emit("updateBreadcrumbs",{link:"tribes",title:"Tribes"})},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminLogCtrl($scope,logFct){$scope.logContent="",$scope.fetch=function(){logFct.get($scope,function(data){$scope.logContent=data},$scope.generalHttpFactoryError)},$scope.deleteLog=function(){logFct.remove($scope,function(){$scope.logContent="",$scope.SYNERGY.logger.log("Deleted","","INFO","alert-info")},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AdminDatabaseCtrl($scope,databaseFct){$scope.order="ASC",$scope.tables=[],$scope.columns=[],$scope.orderBy="",$scope.data=[],$scope.limit=10,$scope.selectedTable="",$scope.fetch=function(){databaseFct.getTables($scope,function(data){$scope.tables=data},$scope.generalHttpFactoryError)},$scope.loadTable=function(){databaseFct.getColumns($scope,$scope.selectedTable,function(data){$scope.columns=data,$scope.orderBy=data[0]},$scope.generalHttpFactoryError)},$scope.show=function(){databaseFct.listTable($scope,$scope.selectedTable,$scope.limit||10,$scope.order,$scope.orderBy||"id",function(data){$scope.data=data},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function AssignmentVolunteerCtrl($scope,$timeout,$routeParams,specificationsFct,assignmentFct,usersFct,labelsFct,platformsFct,tribesFct,versionsFct){function loadPlatforms(){platformsFct.get($scope,function(data){$scope.platforms=data,$scope.ready++,Synergy.util.definedNotNull(data)&&data.length>0&&($scope.assignment.platform=data[0].id)},$scope.generalHttpFactoryError)}function loadVersions(){versionsFct.get($scope,!1,function(data){$scope.versions=data,$scope.ready++,Synergy.util.definedNotNull(data)&&data.length>0&&($scope.selectedVersion=data[0].name,$scope.filter())},$scope.generalHttpFactoryError)}function loadLabels(){labelsFct.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.labels=data,$scope.assignment.label=data[data.length-1].id},$scope.generalHttpFactoryError)}function loadSpecifications(){specificationsFct.get($scope,"allRaw",function(data){$scope.specifications=[];for(var i=0,max=data.length;max>i;i+=1)$scope.specifications[i]={value:data[i].title,info:"<a href='#/specification/"+data[i].id+"'>view</a>",id:data[i].id,type:"specification",version:data[i].version};$scope.filter(),$scope.ready++},$scope.generalHttpFactoryError)}$scope.suggestions=[],$scope.specifications=[],$scope.assignment={testRun:$routeParams.id,username:"",tribe:-1,specification:"",label:"",platform:"",specificationId:"",labelId:"",platformId:""},$scope.platforms=[],$scope.ready=0,$scope.fetch=function(){loadPlatforms(),loadLabels(),loadVersions(),loadSpecifications()},$scope.filter=function(){for(var matching=[],i=0,max=$scope.specifications.length;max>i;i++)$scope.selectedVersion===$scope.specifications[i].version&&matching.push($scope.specifications[i]);$scope.suggestions=matching};var self=$scope;$scope.init(function(){self.fetch()}),$scope.cancel=function(){window.history.back()},$scope.create=function(){var assignment=new Synergy.model.TestAssignment($scope.assignment.platform,$scope.SYNERGY.session.username,$scope.assignment.label);return assignment.specificationId=$scope.assignment.specificationId,assignment.testRunId=$scope.assignment.testRun,$scope.assignment.specificationId.length<1||assignment.platformId.length<1?($scope.SYNERGY.modal.update("Missing required fields",""),void $scope.SYNERGY.modal.show()):$scope.assignedToUser&&assignment.username.length<1||$scope.assignedToTribe&&$scope.assignment.tribe.id<1?($scope.SYNERGY.modal.update("Missing assignee",""),void $scope.SYNERGY.modal.show()):assignment.labelId.length<1&&$scope.assignment.label.length>0?($scope.SYNERGY.modal.update("Label does not exist",""),void $scope.SYNERGY.modal.show()):($scope.showWaitDialog(),void assignmentFct.createVolunteer($scope,assignment,function(){$scope.SYNERGY.modal.update("Assignment created",""),$scope.SYNERGY.modal.show(),window.history.back()},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")}))}}function RevisionCtrl($scope,$routeParams,revisionsFct){function diffRevisions(rev1,rev2){var base=difflib.stringAsLines(rev1.content),newtxt=difflib.stringAsLines(rev2.content),sm=new difflib.SequenceMatcher(base,newtxt),opcodes=sm.get_opcodes(),diffoutputdiv=$("#diffoutput");diffoutputdiv.html(""),diffoutputdiv.append(diffview.buildView({baseTextLines:base,newTextLines:newtxt,opcodes:opcodes,baseTextName:$scope.getLocalTime(rev1.date,!0)+"("+rev1.author+")",newTextName:$scope.getLocalTime(rev2.date,!0)+"("+rev2.author+")",contextSize:null,viewType:1}))
}$scope.revisions=[],$scope.specificationId=$routeParams.id,$scope.fetch=function(){revisionsFct.listRevisions($scope,$scope.specificationId,function(data){$scope.revisions=data},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()}),$scope.compareRevisions=function(){revisionsFct.getRevisions($scope,$scope.choiceA,$scope.choiceB,$scope.specificationId,function(data){diffRevisions(data[0],data[1])},$scope.generalHttpFactoryError)}}function CalendarCtrl($scope){$scope.$emit("updateBreadcrumbs",{link:"calendar",title:"Calendar"})}function AssignmentTribeCtrl($scope,$routeParams,tribesFct,labelsFct,platformsFct,assignmentsFct){function loadPlatforms(){platformsFct.get($scope,function(data){$scope.platforms=data,$scope.value.platform=data[0],$scope.ready++},$scope.generalHttpFactoryError)}function loadLabels(){labelsFct.getAll($scope,function(data){$scope.ready++,data.push({label:"None",id:"-1"}),$scope.value.label=data[data.length-1],$scope.labels=data},$scope.generalHttpFactoryError)}function loadTribes(){tribesFct.getDetailed($scope,$scope.SYNERGY.session.username,function(data){$scope.tribes=data,$scope.selectedTribe=data[0],$scope.value.user=data[0].members[0],data[0].ext.specifications&&($scope.value.specification=data[0].ext.specifications[0]),$scope.ready++},$scope.generalHttpFactoryError)}$scope.tribes=[],$scope.platforms=[],$scope.labels=[],$scope.ready=0,$scope.value={},$scope.assignments=[],$scope.runId=$routeParams.id,$scope.fetch=function(){loadTribes(),loadLabels(),loadPlatforms()},$scope.addAssignment=function(){if(!$scope.value.specification)return void $scope.SYNERGY.logger.showMsg("Oops","No specification selected (maybe tribe does not have any specification?)","alert-error");var assignment=new Synergy.model.TestAssignment($scope.value.platform.id,$scope.value.user.username,$scope.value.label.id);assignment.specificationId=$scope.value.specification.id,assignment.testRunId=$scope.runId,assignment.tribeId=$scope.selectedTribe.id,assignment.display={tribe:$scope.selectedTribe.name,user:$scope.value.user.firstName+" "+$scope.value.user.lastName,label:$scope.value.label.label,platform:$scope.value.platform.name,specification:$scope.value.specification.title+" ("+$scope.SYNERGY.product+" "+$scope.value.specification.version+")"},$scope.assignments.push(assignment)},$scope.filterTribe=function(){$scope.value.user=$scope.selectedTribe.members[0],$scope.selectedTribe.ext.specifications&&($scope.value.specification=$scope.selectedTribe.ext.specifications[0])},$scope.removeAssignment=function(index){$scope.assignments.splice(index,1)},$scope.cancel=function(){window.history.back()},$scope.create=function(){assignmentsFct.createForTribes($scope,$scope.assignments,function(){$scope.SYNERGY.modal.update("Assignments created",""),$scope.SYNERGY.modal.show(),window.history.back()},$scope.generalHttpFactoryError)};var self=$scope;$scope.init(function(){self.fetch()})}function StatisticsCtrl($scope,statisticsFct,$routeParams){function filterArchivedData(start,stop){start=Synergy.util.localToUTCTimestamp(start),stop=Synergy.util.localToUTCTimestamp(stop),$scope.data=new Synergy.control.ArchiveDataFilter(Synergy.util.shallowClone(archivedData)).getData(start,stop),tribesSpecs=$scope.data.tribes,evaluateComputedData($scope.data)}function evaluateComputedData(data){var computed={};computed.testers=getTesters(data),computed.testers=computed.testers.filter(function(t){return t.completedCases>0}),computed.testersCount=computed.testers.length,computed.time=Math.floor(totalCounts.timeToComplete/60)+" hours and "+totalCounts.timeToComplete%60+" minutes",computed.completedRelative=Math.round(1e3*data.testRun.completed/data.testRun.total)/10||0,computed.passRate=Math.round(1e3*totalCounts.passed/data.testRun.completed)/10||0,$scope.tribes=getTribesData(data),$scope.issuesUrl=$scope.SYNERGY.issues.viewLink(data.issues),$scope.issueColor=getIssueColor(data.issues);var issueCollector=new Synergy.Issue.RunIssuesCollector;issueCollector.addIssues(data.issues),$scope.unresolvedIssues=issueCollector.issuesStats.unresolvedIssues,$scope.P1Issues=issueCollector.issuesStats.P1Issues,$scope.P2Issues=issueCollector.issuesStats.P2Issues,$scope.P3Issues=issueCollector.issuesStats.P3Issues,$scope.computed=computed,Synergy.util.ProgressChart([issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100),100-issueCollector.issuesStats.opened/(issueCollector.issuesStats.total/100)],["#ccc","#62c462"],["Unresolved","Resolved"],"issuesResolution"),Synergy.util.ProgressChart([issueCollector.issuesStats.P1/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P2/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P3/(issueCollector.issuesStats.total/100),issueCollector.issuesStats.P4/(issueCollector.issuesStats.total/100)],["#ee5f5b","#f89406","#fbeed5","#ccc"],["P1 ("+issueCollector.issuesStats.P1+")","P2 ("+issueCollector.issuesStats.P2+")","P3 ("+issueCollector.issuesStats.P3+")","P4 ("+issueCollector.issuesStats.P4+")"],"issuesPriority"),printCharts()}function printCharts(){Synergy.util.ProgressChart([$scope.computed.completedRelative,100-$scope.computed.completedRelative],["#08c","#ccc"],["Executed cases","Pending cases"],"canvas1"),Synergy.util.ProgressChart([$scope.computed.passRate,100-$scope.computed.passRate],["#62c462","#ccc"],["Passed cases","Other cases"],"canvas2")}function getIssueColor(issues){for(var sums={P1:0,P2:0,P3:0,P4:0},i=0,max=issues.length;max>i;i++)sums[issues[i].priority]++;return sums.P1>0?"bugs-error":1===sums.P2?"bugs-warning":sums.P2>1?"bugs-orange":"bugs-success"}function getTesters(data){if(totalCounts.passed=0,totalCounts.timeToComplete=0,!data.assigneesOverview)return[];var testers=[],_hours=0;for(var i in data.assigneesOverview)if(_hours=0,data.assigneesOverview.hasOwnProperty(i)){for(var t={completedCases:0,username:i,name:data.assigneesOverview[i].name,time:0,prettyTime:""},k=0,max3=data.assigneesOverview[i].assignments.length;max3>k;k++)totalCounts.timeToComplete+=data.assigneesOverview[i].assignments[k].totalTime,t.time+=data.assigneesOverview[i].assignments[k].totalTime,totalCounts.passed+=parseInt(data.assigneesOverview[i].assignments[k].passedCases,10),t.completedCases+=parseInt(data.assigneesOverview[i].assignments[k].completedCases,10);_hours=Math.floor(t.time/60),t.prettyTime=(_hours>0?_hours+" hours and ":"")+t.time%60+" minutes",testers.push(t)}return testers}function getTribesData(data){if(data.assigneesOverview){var _t,assignments=data.assigneesOverview,tribes={};for(var i in assignments)if(assignments.hasOwnProperty(i))for(var j=0,max2=assignments[i].tribes.length;max2>j;j++)_t=assignments[i].tribes[j],tribes[_t.name]||(tribes[_t.name]=new Synergy.model.TribeRunStats(_t.name,_t.id,tribesSpecs)),tribes[_t.name].addAssignment(assignments[i].assignments);return $scope.SYNERGY.util.toIndexedArray(tribes)}}$scope.id=$routeParams.id,$scope.timeView="all",$scope.inArchive=window.location.href.indexOf("archive")>0?!0:!1;var archivedData={};$scope.orderProp={prop:"time",descending:!0};try{$("#start").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"}),$("#end").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss"})}catch(e){}$scope.P1Issues=[],$scope.P2Issues=[],$scope.P3Issues=[],$scope.unresolvedIssues=[],$scope.allIssues=[],$scope.orderPropU={prop:"time",descending:!0};var cache={};$scope.tribes=[];var tribesSpecs=[];$scope.data={},$scope.computed={};var totalCounts={},fallback=!1;$scope.fetch=function(){$scope.inArchive?statisticsFct.getArchive($scope,$scope.id,fallback,function(data){$scope.data=data,archivedData=data,tribesSpecs=data.tribes,evaluateComputedData(data)},function(data,status){return 404!==status||fallback?($scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),void $scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")):($scope.SYNERGY.logger.log("Opps","Statistics not found, trying alternative way","INFO","alert-warning"),fallback=!0,void self.fetch())}):statisticsFct.get($scope,$scope.id,function(data){cache=data,$scope.data=data,tribesSpecs=data.tribes,evaluateComputedData(data)},$scope.generalHttpFactoryError)},$scope.getAllTimeData=function(){"all"===$scope.timeView?($scope.data=cache,tribesSpecs=cache.tribes,evaluateComputedData(cache)):($("#start").val(""),$("#end").val(""))},$scope.filterStatistics=function(){var start=$("#start").val(),stop=$("#end").val();return start.length<1||stop.length<1?void $scope.SYNERGY.logger.log("Missing data","Please specify both 'from' and 'to' time periods","INFO","alert-error"):void($scope.inArchive?filterArchivedData(start,stop):statisticsFct.getPeriod($scope,$scope.id,{from:$scope.getUTCTime(start),to:$scope.getUTCTime(stop)},function(data){$scope.data=data,tribesSpecs=data.tribes,evaluateComputedData(data)},$scope.generalHttpFactoryError))},$scope.sortTribes=function(prop){$scope.orderProp.prop===prop?$scope.orderProp.descending=!$scope.orderProp.descending:$scope.orderProp={prop:prop,descending:!0}},$scope.sortUsers=function(prop){$scope.orderPropU.prop===prop?$scope.orderPropU.descending=!$scope.orderPropU.descending:$scope.orderPropU={prop:prop,descending:!0}};var self=$scope;$scope.init(function(){self.fetch()})}function AssignmentCommentsCtrl($scope,$routeParams,assignmentFct){function collectFilters(data){for(var cases=[],specifications=[],reporters=[],comments=[],status=[],resolvers=[],i=0,max=data.comments.length;max>i;i++)cases.indexOf(data.comments[i].caseTitle)<0&&cases.push(data.comments[i].caseTitle),specifications.indexOf(data.comments[i].specificationTitle)<0&&specifications.push(data.comments[i].specificationTitle),reporters.indexOf(data.comments[i].authorDisplayName)<0&&reporters.push(data.comments[i].authorDisplayName),status.indexOf(data.comments[i].resolution)<0&&status.push(data.comments[i].resolution),Synergy.util.definedNotNull(data.comments[i].resolverDisplayName)&&resolvers.indexOf(data.comments[i].resolverDisplayName)<0&&resolvers.push(data.comments[i].resolverDisplayName),comments.indexOf(data.comments[i].commentText)<0&&comments.push(data.comments[i].commentText);var sortFnc=function(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a===b?0:a>b?1:-1};cases.sort(sortFnc),cases.push("All"),specifications.sort(sortFnc),specifications.push("All"),reporters.sort(sortFnc),reporters.push("All"),comments.sort(sortFnc),comments.push("All"),status.sort(sortFnc),status.push("All"),resolvers.sort(sortFnc),resolvers.push("All"),$scope.filters={cases:cases,specifications:specifications,reporters:reporters,comments:comments,status:status,resolvers:resolvers}}function findSimilarComments(comment){var similars=[];duplicatesFull=[];for(var i=0,max=$scope.data.comments.length;max>i;i++)$scope.data.comments[i].caseId===comment.caseId&&$scope.data.comments[i].id!==comment.id&&$scope.data.comments[i].suiteId===comment.suiteId&&$scope.data.comments[i].commentText===comment.commentText&&"new"===$scope.data.comments[i].resolution&&(duplicatesFull.push($scope.data.comments[i]),similars.push({id:$scope.data.comments[i].id}));return similars}$scope.id=$routeParams.id||-1,$scope.filters={},$scope.isLoading=!1,$scope.pageSize=$scope.SYNERGY.commentsPage,$scope.filter={"case":"All",specification:"All",reporter:"All",resolver:"All",comment:"All",status:"All"},$scope.duplicates=[];var duplicatesFull=[],commentToBeResolved={};$scope.fetch=function(){$scope.id<0||assignmentFct.getComments($scope,$scope.id,function(data){$scope.data=data,collectFilters(data)},$scope.generalHttpFactoryError)},$scope.nextPage=function(){$scope.isLoading=!0,$scope.pageSize+=$scope.SYNERGY.commentsPage,$scope.isLoading=!1};var self=$scope;$scope.init(function(){self.fetch()}),$scope.commentFilter=function(comment){return $scope.filter["case"]&&"All"!==$scope.filter["case"]&&comment.caseTitle!==$scope.filter["case"]?!1:$scope.filter.specification&&"All"!==$scope.filter.specification&&comment.specificationTitle!==$scope.filter.specification?!1:$scope.filter.reporter&&"All"!==$scope.filter.reporter&&comment.authorDisplayName!==$scope.filter.reporter?!1:$scope.filter.comment&&"All"!==$scope.filter.comment&&comment.commentText!==$scope.filter.comment?!1:$scope.filter.status&&"All"!==$scope.filter.status&&comment.resolution!==$scope.filter.status?!1:$scope.filter.resolver&&"All"!==$scope.filter.resolver&&comment.resolverDisplayName!==$scope.filter.resolver?!1:!0},$scope.resolveComment=function(comment){commentToBeResolved=comment,$scope.duplicates=findSimilarComments(comment),duplicatesFull.push(comment),0===$scope.duplicates.length?$scope.resolveContinue(!1):$("#resolveModal").modal("toggle")},$scope.resolveContinue=function(resolveDuplicates){resolveDuplicates&&$scope.duplicates.push({id:commentToBeResolved.id}),$scope.showWaitDialog(),assignmentFct.resolveComments($scope,resolveDuplicates?$scope.duplicates:[{id:commentToBeResolved.id}],function(){if($scope.showWaitDialog(),resolveDuplicates){for(var i=0,max=duplicatesFull.length;max>i;i++)duplicatesFull[i].resolution="resolved",duplicatesFull[i].resolverUsername=$scope.SYNERGY.session.username,duplicatesFull[i].resolverDisplayName=$scope.SYNERGY.session.firstName+" "+$scope.SYNERGY.session.lastName;$("#resolveModal").modal("toggle")}else duplicatesFull[duplicatesFull.length-1].resolution="resolved",duplicatesFull[duplicatesFull.length-1].resolverUsername=$scope.SYNERGY.session.username,duplicatesFull[duplicatesFull.length-1].resolverDisplayName=$scope.SYNERGY.session.firstName+" "+$scope.SYNERGY.session.lastName;$scope.SYNERGY.logger.log("Done","Comments resolved","INFO","alert-success")},function(data){$scope.SYNERGY.modal.show(),$scope.SYNERGY.logger.log("Action failed",data,"INFO","alert-error"),$scope.SYNERGY.logger.log("Action failed",data.toString(),"DEBUG","alert-error")})}}function SampleSubscriber($scope,data,event){window.console.log("Received: "+event)}function UserFct($http,$timeout){this.edit=function($scope,user,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("user",{action:"editUser"}),JSON.stringify(user)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,username,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("user",{user:username}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,user,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("user",{}),JSON.stringify(user)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.toggleFavorite=function($scope,specification,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("user",{action:"toggleFavorite"}),JSON.stringify(specification)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,username,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("user",{username:username})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.resetProfileImg=function($scope,userId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("profile_img",{id:userId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function VersionFct($http,$timeout){this.edit=function($scope,version,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("version",{}),JSON.stringify(version)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,versionId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("version",{id:versionId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,version,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("version",{}),JSON.stringify(version)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function VersionsFct($http,$timeout){this.get=function($scope,useCache,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("versions",{}),{cache:useCache,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("versions",{all:1}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SpecificationsFct($http,$timeout){this.latest=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specifications",{mode:"latest",limit:10}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,version,onSuccess,onFail){version=version.length>0?{version:version}:{},$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specifications",version),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.filter=function($scope,filter,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specifications",{query:filter,mode:"filter"}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SpecificationFct($http,$timeout){this.remove=function($scope,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("specification",{id:specificationId})}).success(function(result,status){$timeout(function(){onSuccess(result,status)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.requestOwnership=function($scope,request,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("specification_request",{}),JSON.stringify(request)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,specification,isMinorEdit,keepSimpleNameTrack,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("specification",{id:specification.id,minorEdit:isMinorEdit,keepSimpleName:keepSimpleNameTrack}),JSON.stringify(specification)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,specification,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("specification",{mode:"create"}),JSON.stringify(specification)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getFull=function($scope,useCache,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specification",{view:"cont",id:specificationId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getFullAlias=function($scope,useCache,simpleName,simpleVersion,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specification",{view:"contAlias",id:-1,simpleName:simpleName,simpleVersion:simpleVersion}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,useCache,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("specification",{id:specificationId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.clone=function($scope,specificationId,newName,clonedVersion,onSuccess,onFail){window.document.body.style.cursor="wait";var spec={newName:newName,version:clonedVersion};$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("specification",{mode:"clone",id:specificationId}),JSON.stringify(spec)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SuiteFct($http,$timeout){this.remove=function($scope,suiteId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("suite",{id:suiteId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,useCache,suiteId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("suite",{id:suiteId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeCase=function($scope,suiteId,caseId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("suite",{id:suiteId,caseId:caseId,action:"deleteCase"})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.addCase=function($scope,suiteId,caseId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("suite",{id:suiteId,caseId:caseId,action:"addCase"})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,suite,isMinorEdit,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("suite",{id:suite.id,minorEdit:isMinorEdit}),JSON.stringify(suite)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,suite,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("suite",{id:suite.id}),JSON.stringify(suite)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function CasesFct($http,$timeout){this.getMatching=function($scope,filter,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("cases",{"case":filter}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function CaseFct($http,$timeout){this.get=function($scope,useCache,caseId,suiteId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("case",{id:caseId,suite:suiteId}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,testCase,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("case",{}),JSON.stringify(testCase)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,mode,testCase,isMinorEdit,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("case",{id:testCase.id,action:"editCase",mode:mode,minorEdit:isMinorEdit}),JSON.stringify(testCase)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function RunsFct($http,$timeout){this.getLatest=function($scope,limit,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("runs",{mode:"latest",limit:limit}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),console.log("____"+typeof onFail),$timeout(function(){onFail(data,status)},100)})},this.get=function($scope,page,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("runs",{page:page}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function RunFct($http,$timeout){this.get=function($scope,runId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run",{id:runId,mode:"full"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.sendNotifications=function($scope,runId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run_notifications",{id:runId,mode:"full"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getUserCentric=function($scope,runId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run",{id:runId,mode:"peruser"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getOverview=function($scope,useCache,runId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("run",{id:runId,mode:"simple"}),{cache:useCache,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,runId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("run",{id:runId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,run,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("run",{id:run.id}),JSON.stringify(run)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.freezeRun=function($scope,runId,freeze,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("run",{id:runId,mode:"freeze",freeze:freeze}),JSON.stringify({})).success(function(result){$timeout(function(){onSuccess(result)
},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,run,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("run",{}),JSON.stringify(run)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function AssignmentFct($http,$timeout){this.get=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("assignment",{id:assignmentId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getComments=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("assignment_comments",{id:assignmentId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,assignmentId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("assignment",{id:assignmentId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeByLeader=function($scope,assignmentId,explanation,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("assignment",{id:assignmentId}),headers:{"Synergy-comment":encodeURIComponent(explanation)}}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.start=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("assignment",{mode:"start",id:assignmentId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getCommentTypes=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("comments",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.restart=function($scope,assignmentId,onSuccess,onFail){$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.get($scope.SYNERGY.server.buildURL("assignment",{mode:"restart",id:assignmentId,datetime:(new Date).toMysqlFormat()}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.submitResults=function($scope,assignmentId,results,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.defaults.headers.common["Synergy-Timestamp"]=encodeURIComponent((new Date).toMysqlFormat()),$http.put($scope.SYNERGY.server.buildURL("assignment",{id:assignmentId,datetime:(new Date).toMysqlFormat()}),JSON.stringify(results)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.resolveComments=function($scope,comments,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("assignment_comments",{}),JSON.stringify(comments)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,assignment,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignment",{}),JSON.stringify(assignment)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createVolunteer=function($scope,assignment,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignment",{volunteer:!0}),JSON.stringify(assignment)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function UsersFct($http,$timeout){this.get=function($scope,page,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("users",{page:page}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.importUsers=function($scope,sourceUrl,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("users",{}),JSON.stringify({url:sourceUrl})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("users",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getMatching=function($scope,username,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("users",{user:username}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function AttachmentFct($http,$timeout){this.getAttachmentsForSpecification=function($scope,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"GET",url:$scope.SYNERGY.server.buildURL("attachments",{id:specificationId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeRunAttachment=function($scope,attachmentId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("run_attachment",{id:attachmentId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeSpecAttachment=function($scope,attachmentId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("attachment",{id:attachmentId,specificationId:specificationId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function LabelFct($http,$timeout){this.findCases=function($scope,label,page,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("label",{page:page,label:encodeURIComponent(label)}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("label",{}),JSON.stringify(label)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("label",{}),JSON.stringify(label)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function LabelsFct($http,$timeout){this.getMatching=function($scope,label,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("labels",{label:label}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getAll=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("labels",{all:1}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createForSuite=function($scope,suiteId,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("labels",{id:suiteId}),JSON.stringify({label:label})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeFromSuite=function($scope,suiteId,label,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("labels",{id:suiteId}),JSON.stringify({label:label})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function ImageFct($http,$timeout){this.getImagesForCase=function($scope,caseId,suiteId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"GET",url:$scope.SYNERGY.server.buildURL("images",{id:caseId,suiteId:suiteId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,imageId,suiteId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("image",{id:imageId,suiteId:suiteId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function TribeFct($http,$timeout){this.get=function($scope,useCache,tribeId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("tribe",{id:tribeId}),{cache:useCache,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.revokeMembership=function($scope,username,tribeId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("tribe",{id:tribeId,username:username,action:"removeMember"})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.newMembership=function($scope,user,tribeId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("tribe",{id:tribeId,action:"addMember"}),JSON.stringify(user)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,tribe,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribe",{}),JSON.stringify(tribe)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,tribeId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("tribe",{id:tribeId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,tribe,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("tribe",{id:tribe.id,action:"editTribe"}),JSON.stringify(tribe)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.addSpecification=function($scope,tribeId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribe_specification",{id:tribeId,specificationId:specificationId}),JSON.stringify({})).success(function(result){$timeout(function(){onSuccess(result,specificationId)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.removeSpecification=function($scope,tribeId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("tribe_specification",{id:tribeId,specificationId:specificationId})}).success(function(result){$timeout(function(){onSuccess(result,parseInt(specificationId,10))},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function PlatformsFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("platforms",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getMatching=function($scope,filter,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("platforms",{query:filter,mode:"filter"}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function PlatformFct($http,$timeout){this.remove=function($scope,platformId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("platform",{id:platformId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,platform,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("platform",{id:platform.id}),JSON.stringify(platform)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,platform,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("platform",{}),JSON.stringify(platform)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function TribesFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("tribes",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getDetailed=function($scope,username,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("tribes",{mode:"full",leader:username}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.importTribes=function($scope,sourceUrl,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribes",{}),JSON.stringify({url:sourceUrl})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SessionFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{login:1}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.info=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.infoConditional=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{"return":1}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.infoConditionalCookie=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("session",{"return":2}),{cache:!1,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.login=function($scope,credentials,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("session",{}),"username="+credentials.username+"&password="+credentials.password,{headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.logout=function($scope,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("session",{})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SettingsFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("configuration",{}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.edit=function($scope,configuration,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("configuration",{}),JSON.stringify(configuration)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function CalendarFct($http,$timeout){this.getEvents=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("events",{}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function AboutFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("about",{}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SearchFct($http,$timeout){this.get=function($scope,term,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("search",{search:encodeURIComponent(term)}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function ProductsFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("products",{}),{cache:!0,timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function AssignmentsFct($http,$timeout){this.createForTribes=function($scope,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("tribe_assignments",{}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.createForUsers=function($scope,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignments",{mode:"user"}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.create=function($scope,data,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("assignments",{mode:"matrix"}),JSON.stringify(data)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function LogFct($http,$timeout){this.get=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("log",{})).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("log",{})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function DatabaseFct($http,$timeout){this.getTables=function($scope,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("db",{what:"tables"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getColumns=function($scope,table,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("db",{what:"table",table:table}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.listTable=function($scope,table,limit,order,orderBy,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("db",{what:"list",table:table,limit:limit,order:order,orderBy:orderBy}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function JobFct($http,$timeout){this.resolve=function($scope,job,onSuccess,onFail){$http({method:"JSONP",url:job.jobUrl+"JSON_CALLBACK",cache:!1}).success(function(data){data.id=job.id,onSuccess(data)}).error(function(){onFail({result:"ABORTED",fullDisplayName:"Job not found",id:job.id,url:job.jobUrl})})},this.create=function($scope,job,onSuccess,onFail){$scope.busyModeOn(),window.document.body.style.cursor="wait",$http.post($scope.SYNERGY.server.buildURL("job",{}),JSON.stringify(job)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,jobId,specificationId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http({method:"DELETE",url:$scope.SYNERGY.server.buildURL("job",{id:jobId,specificationId:specificationId})}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function IssueFct($http,$timeout){this.create=function($scope,issue,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("issue",{}),JSON.stringify(issue)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.remove=function($scope,issue,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.put($scope.SYNERGY.server.buildURL("issue",{}),JSON.stringify(issue)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function RevisionsFct($http,$timeout){this.listRevisions=function($scope,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("revisions",{id:specificationId,mode:"list"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getRevisions=function($scope,idA,idB,specificationId,onSuccess,onFail){$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("revisions",{specification:specificationId,id1:idA,id2:idB,mode:"compare"}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SanitizerFct($http,$timeout){this.getSanitizedInput=function($scope,data,onSuccess,onFail){$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("sanitizer",{}),JSON.stringify({data:data}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function StatisticsFct($http,$timeout){this.get=function($scope,testRunId,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.get($scope.SYNERGY.server.buildURL("statistics",{id:testRunId}),{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)
},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getPeriod=function($scope,testRunId,period,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn(),$http.post($scope.SYNERGY.server.buildURL("statistics_filter",{id:testRunId}),JSON.stringify(period)).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})},this.getArchive=function($scope,testRunId,fallBackUrl,onSuccess,onFail){window.document.body.style.cursor="wait",$scope.busyModeOn();var url=fallBackUrl?$scope.SYNERGY.server.buildURL("statistics_fallback",{})+"run"+testRunId+"/statistics.json":$scope.SYNERGY.server.buildURL("statistics_archived",{})+"run"+testRunId+"/statistics.json";$http.get(url,{timeout:$scope.SYNERGY.httpTimeout}).success(function(result){$timeout(function(){onSuccess(result)},0)}).error(function(data,status,headers,config){$scope.SYNERGY.logger.logHTTPError(data,status,headers,config),$timeout(function(){onFail(data,status)},100)})}}function SampleSubscriber(){}var synergy_module=angular.module("synergy",["ui.codemirror","infinite-scroll","ui.select2","ngCookies","ngProgress","ui.bootstrap"]).config(function($provide,$routeProvider,$httpProvider){$provide.factory("MyHttpInterceptor",function($q,$rootScope){return function(promise){return promise.then(function(response){return $rootScope.$broadcast("busyMode",!1),window.document.body.style.cursor="default",response},function(response){return $rootScope.$broadcast("busyMode",!1),0===parseInt(response.status,10)&&$rootScope.$broadcast("possibleTimeout",!1),window.document.body.style.cursor="default",$q.reject(response)})}}),$httpProvider.interceptors?$httpProvider.interceptors.push("MyHttpInterceptor"):$httpProvider.responseInterceptors.push("MyHttpInterceptor"),$provide.factory("utils",function(){var u={};return u.escape=function(s){return encodeURIComponent(s)},u}),$provide.factory("issue",function($http){return{getIssue:function(id,$scope){$http.get($scope.SYNERGY.server.buildURL("issue",{id:id})).success(function(data){return data}).error(function(data){window.console.log("Issue "+id+" not found: "+data)})}}}),$routeProvider.when("/specifications/:id",{templateUrl:"../../app/partials/public/view/specpool.html?v=1393952531932",controller:SpecPoolCtrl}),$routeProvider.when("/statistics/:id",{templateUrl:"../../app/partials/public/view/statistics.html?v=1393952531932",controller:StatisticsCtrl}),$routeProvider.when("/statistics/:id/archive",{templateUrl:"../../app/partials/public/view/statistics.html?v=1393952531932",controller:StatisticsCtrl}),$routeProvider.when("/search/:search",{templateUrl:"../../app/partials/public/view/search.html?v=1393952531932",controller:SearchCtrl}),$routeProvider.when("/specifications",{templateUrl:"../../app/partials/public/view/specpool.html?v=1393952531932",controller:SpecPoolCtrl}),$routeProvider.when("/specification/:id/create",{templateUrl:"../../app/partials/public/create/specification.html?v=1393952531932",controller:SpecificationCtrl}),$routeProvider.when("/specification/:id/edit",{templateUrl:"../../app/partials/public/edit/specification.html?v=1393952531932",controller:SpecificationCtrl}),$routeProvider.when("/specification/:id/v/1",{templateUrl:"../../app/partials/public/view/specification_view_1.html?v=1393952531932",controller:SpecificationCtrl}),$routeProvider.when("/specification/:id/v/2",{templateUrl:"../../app/partials/public/view/specification_view_2.html?v=1393952531932",controller:SpecificationCtrl}),$routeProvider.when("/specification/:id/v/2/:label",{templateUrl:"../../app/partials/public/view/specification_view_2.html?v=1393952531932",controller:SpecificationCtrl}),$routeProvider.when("/title/:simpleName/:simpleVersion",{templateUrl:"../../app/partials/public/view/specification_view_2.html?v=1393952531932",controller:SpecificationCtrl}),$routeProvider.when("/title/:simpleName/",{redirectTo:"/title/:simpleName/latest"}),$routeProvider.when("/specification/:id",{redirectTo:"/specification/:id/v/2"}),$routeProvider.when("/suite/:id/:specification/:version/create",{templateUrl:"../../app/partials/public/create/suite.html?v=1393952531932",controller:SuiteCtrl}),$routeProvider.when("/suite/:id/edit",{templateUrl:"../../app/partials/public/edit/suite.html?v=1393952531932",controller:SuiteCtrl}),$routeProvider.when("/suite/:id/v/1",{templateUrl:"../../app/partials/public/view/suite.html?v=1393952531932",controller:SuiteCtrl}),$routeProvider.when("/suite/:id",{redirectTo:"/suite/:id/v/1"}),$routeProvider.when("/case/:id/suite/:parent/edit",{templateUrl:"../../app/partials/public/edit/case.html?v=1393952531932",controller:CaseCtrl}),$routeProvider.when("/case/:id/suite/:parent/create",{templateUrl:"../../app/partials/public/create/case.html?v=1393952531932",controller:CaseCtrl}),$routeProvider.when("/case/:id/suite/:parent/v/1",{templateUrl:"../../app/partials/public/view/case.html?v=1393952531932",controller:CaseCtrl}),$routeProvider.when("/assignment_comments/:id",{templateUrl:"../../app/partials/public/view/assignment_comments.html?v=1393952531932",controller:AssignmentCommentsCtrl}),$routeProvider.when("/case/:id/suite/:parent",{redirectTo:"/case/:id/suite/:parent/v/1"}),$routeProvider.when("/case/:id",{redirectTo:"/case/:id/suite/-1/v/1"}),$routeProvider.when("/run/:id/v/1",{templateUrl:"../../app/partials/public/view/run_view_1.html?v=1393952531932",controller:RunCtrl}),$routeProvider.when("/run/:id/v/2",{templateUrl:"../../app/partials/public/view/run_view_2.html?v=1393952531932",controller:RunCtrlUser}),$routeProvider.when("/run/:id",{redirectTo:"/run/:id/v/2"}),$routeProvider.when("/runs/page/:page",{templateUrl:"../../app/partials/public/view/runs.html?v=1393952531932",controller:RunsCtrl}),$routeProvider.when("/runs",{redirectTo:"/runs/page/1"}),$routeProvider.when("/user",{templateUrl:"../../app/partials/public/view/profile.html?v=1393952531932",controller:ProfileCtrl}),$routeProvider.when("/user/:user",{templateUrl:"../../app/partials/public/view/profile.html?v=1393952531932",controller:ProfileCtrl}),$routeProvider.when("/label/:label/page/:page",{templateUrl:"../../app/partials/public/view/label.html?v=1393952531932",controller:LabelFilterCtrl}),$routeProvider.when("/label/:label",{redirectTo:"/label/:label/page/1"}),$routeProvider.when("/tribe/:id/edit",{templateUrl:"../../app/partials/public/edit/tribe.html?v=1393952531932",controller:TribeCtrl}),$routeProvider.when("/tribe/:id/view",{templateUrl:"../../app/partials/public/view/tribe.html?v=1393952531932",controller:TribeCtrl}),$routeProvider.when("/tribes",{templateUrl:"../../app/partials/public/view/tribes.html?v=1393952531932",controller:TribesCtrl}),$routeProvider.when("/calendar",{templateUrl:"../../app/partials/directives/calendar.html?v=1393952531932",controller:CalendarCtrl}),$routeProvider.when("/tribe/:id",{redirectTo:"/tribe/:id/view"}),$routeProvider.when("/",{templateUrl:"../../app/partials/public/view/home.html?v=1393952531932",controller:HomeCtrl}),$routeProvider.when("/assignment/:id/v/:mode",{templateUrl:"../../app/partials/public/view/assignment.html?v=1393952531932",controller:AssignmentCtrl}),$routeProvider.when("/assignment/create/run/:id",{templateUrl:"../../app/partials/public/create/assignment.html?v=1393952531932",controller:AssignmentVolunteerCtrl}),$routeProvider.when("/assignment/create/tribe/run/:id",{templateUrl:"../../app/partials/public/create/assignment_tribe.html?v=1393952531932",controller:AssignmentTribeCtrl}),$routeProvider.when("/about",{templateUrl:"../../app/partials/public/view/about.html?v=1393952531932",controller:AboutCtrl}),$routeProvider.when("/revisions/:id",{templateUrl:"../../app/partials/public/view/revisions.html?v=1393952531932",controller:RevisionCtrl}),$routeProvider.when("/administration",{templateUrl:"../../app/partials/admin/view/home.html?v=1393952531932",controller:AdminHomeCtrl}),$routeProvider.when("/administration/versions",{templateUrl:"../../app/partials/admin/view/versions.html?v=1393952531932",controller:AdminVersionCtrl}),$routeProvider.when("/administration/runs/page/:page",{templateUrl:"../../app/partials/admin/view/runs.html?v=1393952531932",controller:AdminRunsCtrl}),$routeProvider.when("/administration/run/-1/create",{templateUrl:"../../app/partials/admin/create/run.html?v=1393952531932",controller:AdminRunCtrl}),$routeProvider.when("/administration/assignment/create/run/:id",{templateUrl:"../../app/partials/admin/create/assignment.html?v=1393952531932",controller:AdminAssignmentCtrl}),$routeProvider.when("/administration/assignment/creatematrix/run/:id",{templateUrl:"../../app/partials/admin/create/matrix_assignment.html?v=1393952531932",controller:AdminMatrixAssignmentCtrl}),$routeProvider.when("/administration/run/:id/edit",{templateUrl:"../../app/partials/admin/edit/run.html?v=1393952531932",controller:AdminRunCtrl}),$routeProvider.when("/administration/runs",{redirectTo:"/administration/runs/page/1"}),$routeProvider.when("/administration/tribes/create",{templateUrl:"../../app/partials/admin/create/tribe.html?v=1393952531932",controller:AdminTribesCtrl}),$routeProvider.when("/administration/tribes",{templateUrl:"../../app/partials/admin/view/tribes.html?v=1393952531932",controller:AdminTribesCtrl}),$routeProvider.when("/administration/platforms",{templateUrl:"../../app/partials/admin/view/platforms.html?v=1393952531932",controller:AdminPlatformsCtrl}),$routeProvider.when("/administration/users/page/:page",{templateUrl:"../../app/partials/admin/view/users.html?v=1393952531932",controller:AdminUsersCtrl}),$routeProvider.when("/administration/user/:username/edit",{templateUrl:"../../app/partials/admin/edit/user.html?v=1393952531932",controller:AdminUserCtrl}),$routeProvider.when("/administration/user/:username/create",{templateUrl:"../../app/partials/admin/create/user.html?v=1393952531932",controller:AdminUserCtrl}),$routeProvider.when("/administration/users",{redirectTo:"/administration/users/page/1"}),$routeProvider.when("/administration/setting",{templateUrl:"../../app/partials/admin/view/settings.html?v=1393952531932",controller:AdminSettingCtrl}),$routeProvider.when("/administration/log",{templateUrl:"../../app/partials/admin/view/log.html?v=1393952531932",controller:AdminLogCtrl}),$routeProvider.when("/administration/database",{templateUrl:"../../app/partials/admin/view/database.html?v=1393952531932",controller:AdminDatabaseCtrl}),$routeProvider.otherwise({redirectTo:"/"})});synergy_module.run(function($rootScope){$rootScope.$on("handleEmit",function(event,args){$rootScope.$broadcast("handleBroadcast",args)})}),synergy_module.filter("assignmentFilter",function(){return function(items,sortConfig){return items&&(window.console.log(items.length),window.console.log(sortConfig)),items}}).filter("addCaseStatus",function(){return function(text,opt){var i;$.each(opt.scope.allCases,function(index,item){return item.caseId===opt.item.caseId&&item.suiteId===opt.item.suiteId?(i=index,!1):void 0});var elem=angular.element("select#"+opt.selectId+" > option[value='"+i+"']");return elem.attr("class","case"+opt.item.result),text}}),String.prototype.endsWith=function(s){return this.length>=s.length&&this.substr(this.length-s.length)==s},synergy_module.directive("login",["$http",function(){return{restrict:"E",replace:!0,templateUrl:"../../app/partials/directives/loginBt.html",link:function(){}}}]).directive("calendar",["calendarFct",function(calendarFct){return{restrict:"E",replace:!0,templateUrl:"../../app/partials/directives/calendar.html",link:function(scope){var mainScope=scope;calendarFct.getEvents(scope,function(data){for(var events=[],i=0,max=data.length;max>i;i+=1)events.push({url:"#/run/"+data[i].id+"/v/1",title:data[i].title,start:new Date(data[i].start.substr(0,4),parseInt(data[i].start.substr(4,2),10)-1,data[i].start.substr(6,2)),end:new Date(data[i].end.substr(0,4),parseInt(data[i].end.substr(4,2),10)-1,data[i].end.substr(6,2))});mainScope.events=events},function(){})}}}]).directive("sylabel",[function(){return{restrict:"E",replace:!0,scope:{keyword:"=label"},template:'<span><a href="#/label/{{keyword}}" class="nostyle"><span class="label label-{{keyword}}">{{keyword}}</span></a>&nbsp;</span>',link:function(){}}}]).directive("syissue",[function(){return{restrict:"E",template:'<span><a data-ng-hide="issue.resolution == \'NEW\' || issue.resolution == \'STARTED\' || issue.resolution == \'REOPENED\' || issue.resolution == \'\'" title="[{{issue.resolution}}] {{issue.title}}" href="{{izurl}}{{issue.bugId}}" class="nostyle">   <span class="label">{{issue.bugId}}</span></a><a data-ng-show="issue.resolution == \'NEW\' || issue.resolution == \'STARTED\' || issue.resolution == \'REOPENED\' || issue.resolution == \'\'" title="[{{issue.resolution}}] {{issue.title}}" href="{{izurl}}{{issue.bugId}}" class="nostyle">   <span class="label label-important">{{issue.bugId}}</span></a></span>',replace:!0,scope:{issue:"=issue",izurl:"=baseurl"},link:function(){}}}]).directive("unbindable",[function(){return{scope:!0}}]).directive("syspecificationsall",function(){return{restrict:"E",replace:!0,scope:{data:"=data"},link:function(scope,elem){scope.$watch("data",function(){elem.empty(),$(elem).empty();var table='<table class="table table-condensed table-bordered table-hover"><thead><tr><th></th>',headerRow="",body="";angular.forEach(scope.data,function(d){var versions="";headerRow="";for(var i=0,max=d.specifications.length;max>i;i++)versions+="<td><span><small>"+(d.specifications[i].owner||"")+"</small></span></td>",headerRow+="<th>"+d.specifications[i].version+"</th>";body+='<tr><td> <a href="#/title/'+encodeURIComponent(encodeURIComponent(d.simpleName))+'/"> '+d.title+"</a></td>"+versions+"</tr>"}),table+=headerRow+"</tr></thead><tbody>"+body+"</tbody></table>",elem.html(table)})}}}).directive("syspecifications",function(){return{restrict:"E",replace:!0,scope:{data:"=data"},link:function(scope,elem){scope.$watch("data",function(){elem.empty(),$(elem).empty();var table="<table>",body="";angular.forEach(scope.data,function(spec){body+='<tr><td style="vertical-align: central"><a href="#/specification/'+spec.id+'">&rightarrow;&nbsp;'+spec.title+"</a>&nbsp;&nbsp;</td></tr>"}),table+=body+"</table>",elem.html(table)})}}}).directive("onEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.onEnter)}),event.preventDefault())})}}),angular.module("infinite-scroll",[]).directive("infiniteScroll",["$rootScope","$window","$timeout",function(i,n,e){return{link:function(t,l,o){var r,c,f,a;return n=angular.element(n),f=0,null!=o.infiniteScrollDistance&&t.$watch(o.infiniteScrollDistance,function(i){return f=parseInt(i,10)}),a=!0,r=!1,null!=o.infiniteScrollDisabled&&t.$watch(o.infiniteScrollDisabled,function(i){return a=!i,a&&r?(r=!1,c()):void 0}),c=function(){var e,c,u,d;return d=n.height()+n.scrollTop(),e=l.offset().top+l.height(),c=e-d,u=n.height()*f>=c,u&&a?i.$$phase?t.$eval(o.infiniteScroll):t.$apply(o.infiniteScroll):u?r=!0:void 0},n.on("scroll",c),t.$on("$destroy",function(){return n.off("scroll",c)}),e(function(){return o.infiniteScrollImmediateCheck?t.$eval(o.infiniteScrollImmediateCheck)?c():void 0:c()},0)}}}]),angular.module("ngProgress.provider",["ngProgress.directive"]).provider("ngProgress",function(){this.autoStyle=!0,this.count=0,this.height="2px",this.color="#0e90d2",this.$get=["$document","$window","$compile","$rootScope","$timeout",function(a,b,c,d,e){var f=this.count,g=this.height,h=this.color,i=d,j=a.find("body"),k=c("<ng-progress></ng-progress>")(i);j.append(k),i.count=f,void 0!==g&&k.eq(0).children().css("height",g),void 0!==h&&(k.eq(0).children().css("background-color",h),k.eq(0).children().css("color",h));var l=0;return{start:function(){this.show();var a=this;l=setInterval(function(){if(isNaN(f))clearInterval(l),f=0,a.hide();else{var b=100-f;f+=.15*Math.pow(1-Math.sqrt(b),2),a.updateCount(f)}},200)},updateCount:function(a){i.count=a,i.$$phase||i.$apply()},height:function(a){return void 0!==a&&(g=a,i.height=g,i.$$phase||i.$apply()),g},color:function(a){return void 0!==a&&(h=a,i.color=h,i.$$phase||i.$apply()),h},hide:function(){k.children().css("opacity","0");var a=this;e(function(){k.children().css("width","0%"),e(function(){a.show()},500)},500)},show:function(){e(function(){k.children().css("opacity","1")},100)},status:function(){return f},stop:function(){clearInterval(l)},set:function(a){return this.show(),this.updateCount(a),f=a,clearInterval(l),f},css:function(a){return k.children().css(a)},reset:function(){return clearInterval(l),f=0,this.updateCount(f),0},complete:function(){f=100,this.updateCount(f);var a=this;return e(function(){a.hide(),e(function(){f=0,a.updateCount(f)},500)},1e3),f}}}],this.setColor=function(a){return void 0!==a&&(this.color=a),this.color},this.setHeight=function(a){return void 0!==a&&(this.height=a),this.height}}),angular.module("ngProgress.directive",[]).directive("ngProgress",["$window","$rootScope",function(a,b){var c={replace:!0,restrict:"E",link:function(a,c){b.$watch("count",function(b){(void 0!==b||null!==b)&&(a.counter=b,c.eq(0).children().css("width",b+"%"))}),b.$watch("color",function(b){(void 0!==b||null!==b)&&(a.color=b,c.eq(0).children().css("background-color",b),c.eq(0).children().css("color",b))}),b.$watch("height",function(b){(void 0!==b||null!==b)&&(a.height=b,c.eq(0).children().css("height",b))})},template:'<div id="ngProgress-container"><div id="ngProgress"></div></div>'};return c}]),angular.module("ngProgress",["ngProgress.directive","ngProgress.provider"]),synergy_module.factory("synergyTest",["$http",function(){return{test:function($scope){window.console.log($scope.SYNERGY)}}}]),synergy_module.factory("specificationsFct",["$http","$timeout",function($http,$timeout){return new SpecificationsFct($http,$timeout)}]).factory("versionsFct",["$http","$timeout",function($http,$timeout){return new VersionsFct($http,$timeout)}]).factory("versionFct",["$http","$timeout",function($http,$timeout){return new VersionFct($http,$timeout)}]).factory("userFct",["$http","$timeout",function($http,$timeout){return new UserFct($http,$timeout)}]).factory("specificationFct",["$http","$timeout",function($http,$timeout){return new SpecificationFct($http,$timeout)}]).factory("suiteFct",["$http","$timeout",function($http,$timeout){return new SuiteFct($http,$timeout)}]).factory("casesFct",["$http","$timeout",function($http,$timeout){return new CasesFct($http,$timeout)}]).factory("caseFct",["$http","$timeout",function($http,$timeout){return new CaseFct($http,$timeout)}]).factory("runsFct",["$http","$timeout",function($http,$timeout){return new RunsFct($http,$timeout)}]).factory("runFct",["$http","$timeout",function($http,$timeout){return new RunFct($http,$timeout)}]).factory("assignmentFct",["$http","$timeout",function($http,$timeout){return new AssignmentFct($http,$timeout)}]).factory("usersFct",["$http","$timeout",function($http,$timeout){return new UsersFct($http,$timeout)}]).factory("attachmentFct",["$http","$timeout",function($http,$timeout){return new AttachmentFct($http,$timeout)}]).factory("labelFct",["$http","$timeout",function($http,$timeout){return new LabelFct($http,$timeout)}]).factory("labelsFct",["$http","$timeout",function($http,$timeout){return new LabelsFct($http,$timeout)}]).factory("imageFct",["$http","$timeout",function($http,$timeout){return new ImageFct($http,$timeout)}]).factory("tribeFct",["$http","$timeout",function($http,$timeout){return new TribeFct($http,$timeout)}]).factory("platformsFct",["$http","$timeout",function($http,$timeout){return new PlatformsFct($http,$timeout)}]).factory("platformFct",["$http","$timeout",function($http,$timeout){return new PlatformFct($http,$timeout)}]).factory("tribesFct",["$http","$timeout",function($http,$timeout){return new TribesFct($http,$timeout)}]).factory("sessionFct",["$http","$timeout",function($http,$timeout){return new SessionFct($http,$timeout)}]).factory("settingsFct",["$http","$timeout",function($http,$timeout){return new SettingsFct($http,$timeout)}]).factory("calendarFct",["$http","$timeout",function($http,$timeout){return new CalendarFct($http,$timeout)}]).factory("aboutFct",["$http","$timeout",function($http,$timeout){return new AboutFct($http,$timeout)}]).factory("searchFct",["$http","$timeout",function($http,$timeout){return new SearchFct($http,$timeout)}]).factory("productsFct",["$http","$timeout",function($http,$timeout){return new ProductsFct($http,$timeout)}]).factory("assignmentsFct",["$http","$timeout",function($http,$timeout){return new AssignmentsFct($http,$timeout)}]).factory("logFct",["$http","$timeout",function($http,$timeout){return new LogFct($http,$timeout)}]).factory("databaseFct",["$http","$timeout",function($http,$timeout){return new DatabaseFct($http,$timeout)}]).factory("jobFct",["$http","$timeout",function($http,$timeout){return new JobFct($http,$timeout)}]).factory("issueFct",["$http","$timeout",function($http,$timeout){return new IssueFct($http,$timeout)}]).factory("revisionsFct",["$http","$timeout",function($http,$timeout){return new RevisionsFct($http,$timeout)}]).factory("sanitizerFct",["$http","$timeout",function($http,$timeout){return new SanitizerFct($http,$timeout)}]).factory("statisticsFct",["$http","$timeout",function($http,$timeout){return new StatisticsFct($http,$timeout)}]),"function"!=typeof Object.create&&!function(){var F=function(){};Object.create=function(o){if(arguments.length>1)throw Error("Second argument not supported");if(null===o)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof o)throw TypeError("Argument must be an object");return F.prototype=o,new F}}(),Array.prototype.filter||(Array.prototype.filter=function(fun){if(void 0===this||null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var res=[],thisArg=arguments.length>=2?arguments[1]:void 0,i=0;len>i;i++)if(i in t){var val=t[i];fun.call(thisArg,val,i,t)&&res.push(val)}return res}),Synergy.interfaces={},Synergy.control={},Synergy.interfaces.observer={listeners:[],subscribe:function(){},publish:function(){},unsubscribe:function(){}},Synergy.interfaces.logger={level:{INFO:2,DEBUG:1},printLevel:2,title:"",msg:"",style:"alert-info",print:!1,printMessage:function(){},log:function(){},error:function(){}},Synergy.interfaces.server={init:function(endpoints){this.endpoints=endpoints},endpoints:{},buildURL:function(){}},Synergy.control.FileUploader=function(acceptedTypes,dropElementID,uploadLimit,url,onSuccess,onFail){function dragEnter(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0}function dragExit(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0}function dragOver(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0}function showTitleDialog(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0,self.event=evt,self.file=self.event.dataTransfer.files.length>0?self.event.dataTransfer.files[0]:{},$("#addImageModal").modal("toggle")}function drop(evt){evt.stopPropagation(),evt.preventDefault(),evt.cancelBubble=!0;var files=evt.dataTransfer.files,count=files.length;count>0&&(files[0].size>uploadLimit?onFail("File Too Large","Maximum allowed size is "+uploadLimit/1e6+" MB","INFO","alert-error"):fileIsValid(files[0])?handleFile(files[0]):onFail("Unsupported file","Supported formats are "+printAccepted(),"INFO","alert-error"))}function printAccepted(){for(var s="",i=0,max=acceptedTypes.length;max>i;i+=1)s+=acceptedTypes[i]+" ";return s}function fileIsValid(file){if(acceptedTypes.length<1)return!0;for(var i=0,max=acceptedTypes.length;max>i;i+=1)if(file.type===acceptedTypes[i])return!0;return!1}function handleFile(file){$("#progressContainer").attr("class","progress");var xhr=new XMLHttpRequest;xhr.open("POST",self.url,!0),xhr.onerror=function(){onFail("Upload failed","","INFO","alert-error"),onFail("Upload failed",this.responseText,"DEBUG","alert-error")},xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?onSuccess("Done","Upload finished","INFO","alert-success",file.name,xhr.responseText):(onFail("Upload failed","","INFO","alert-error"),onFail("Upload failed",this.responseText+":"+this.status,"DEBUG","alert-error")))},xhr.upload.addEventListener("progress",function(event){var loaded=parseInt(event.loaded/event.total*100);$("#progressBar").css("width",loaded+"%")},!1);var formData=new FormData;formData.append("myfile",file),xhr.send(formData)}this.event=null,this.url=url,this.file={};var self=this,dropbox=document.getElementById(dropElementID);null!==dropbox&&(dropbox.addEventListener?(dropbox.addEventListener("dragenter",dragEnter,!1),dropbox.addEventListener("dragexit",dragExit,!1),dropbox.addEventListener("dragover",dragOver,!1),dropbox.addEventListener("drop",drop,!1)):(dropbox.attachEvent("ondragenter",dragEnter),dropbox.attachEvent("ondragexit",dragExit),dropbox.attachEvent("ondragover",dragOver),dropbox.attachEvent("ondrop",drop))),this.uploadFileFromFileChooser=function(fdid){var file=document.getElementById(fdid).files[0];file&&(file.size>uploadLimit?onFail("File Too Large","Maximum allowed size is "+uploadLimit/1e6+" MB","INFO","alert-error"):handleFile(file))},this.uploadImage=function(url){self.url=url;var files=self.event.dataTransfer.files;files.length,self.file&&(self.file>uploadLimit?onFail("File Too Large","Maximum allowed size is "+uploadLimit/1e6+" MB","INFO","alert-error"):fileIsValid(self.file)?handleFile(self.file):onFail("Unsupported file","Supported formats are "+printAccepted(),"INFO","alert-error"))},this.initForImages=function(container){var dropbox=window.document.getElementById(container);null!==dropbox&&(dropbox.addEventListener("dragenter",dragEnter,!1),dropbox.addEventListener("dragexit",dragExit,!1),dropbox.addEventListener("dragover",dragOver,!1),dropbox.addEventListener("drop",showTitleDialog,!1))}},Synergy.control.SynergyLogger=function(){},Synergy.control.SynergyLogger.prototype=Object.create(Synergy.interfaces.logger),Synergy.control.SynergyLogger.prototype.printMessage=function(title,msg,style){this.style=style||"alert-info",this.title=title,this.msg=msg.substring(0,msg.length>200?200:msg.length),this.date=Date()},Synergy.control.SynergyLogger.prototype.showMsg=function(title,msg,style){this.style=style||"alert-info",this.title=title,this.msg=msg,this.print=!0},Synergy.control.SynergyLogger.prototype.log=function(title,msg,level,style){window.console&&window.console.log&&window.console.log(title+": "+msg),this.level[level]>=this.printLevel&&(this.print=!0,this.printMessage(title,msg,style))},Synergy.control.SynergyLogger.prototype.logHTTPError=function(data,status,headers,config){window.console.error("Action failed >> "),data&&data.length>0&&window.console.error(data),window.console.error("HTTP Status code: "+status),window.console.error(config),window.console.error(" <<")},Synergy.control.SynergyLogger.prototype.error=function(title,msg,level,style){window.console&&window.console.error&&window.console.error(title+": "+msg),this.level[level]>=this.printLevel&&(this.print=!0,this.printMessage(title,msg,style))},Synergy.control.SynergyObserver=function(){},Synergy.control.SynergyObserver.prototype=Object.create(Synergy.interfaces.observer),Synergy.control.SynergyObserver.prototype.subscribe=function(callback,event){event=event||"any","undefined"==typeof this.listeners[event]&&(this.listeners[event]=[]),this.listeners[event].push(callback)},Synergy.control.SynergyObserver.prototype.publish=function(data,$scope,event){event=event||"any";for(var subs=this.listeners[event]||[],i=0,max=subs.length;max>i;i+=1)subs[i]($scope,data,event)},Synergy.control.SynergyObserver.prototype.unsubscribe=function(fn,event){event=event||"any";for(var subs=this.listeners[event]||[],i=0,max=subs.length;max>i;i+=1)subs[i]===fn&&subs.splice(i,1)},Synergy.control.SynergyServer=function(endpoints){var self=this;this.endpoints=endpoints,this.patterns={php:function(endpoint,parameters){var url="";for(var parameter in parameters)try{url+="&"+parameter+"="+encodeURIComponent(parameters[parameter])}catch(e){console.error(e)}return url.length>1?self.endpoints[endpoint]+"?"+url:self.endpoints[endpoint]}}},Synergy.control.SynergyServer.prototype=Object.create(Synergy.interfaces.server),Synergy.control.SynergyServer.prototype.preferredPattern="php",Synergy.control.SynergyServer.prototype.buildURL=function(endpoint,parameters){return this.patterns[this.preferredPattern].call(void 0,endpoint,parameters)},Synergy.control.ArchiveDataFilter=function(allData){function addAssignment(user,assignment,username){if(!filteredAssignments.hasOwnProperty(username)){filteredAssignments[username]={name:user.name,tribes:[],assignments:[]};for(var i=0,max=user.tribes.length;max>i;i++)filteredAssignments[username].tribes[i]=Synergy.util.shallowClone(user.tribes[i])}filteredAssignments[username].assignments.push(assignment)}function lastUpdatedToTimestamp(d){if(d.length<1)return-1;try{var _d=new Date,_split=d.split(" ");_d.setUTCFullYear(parseInt(_split[2],10)),_d.setUTCMonth(Synergy.util.monthsNames.shortName.indexOf(_split[1])),_d.setUTCDate(parseInt(_split[0],10));var _split2=_split[3].split(":");return _d.setUTCHours(parseInt(_split2[0],10)),_d.setUTCMinutes(parseInt(_split2[1],10)),_d.setUTCSeconds(parseInt(_split2[2],10)),_d.getTime()}catch(e){return-1}}var filteredAssignments={};this.allData=allData,this.getData=function(start,stop){var _user,_lu;for(var key in this.allData.assigneesOverview)if(this.allData.assigneesOverview.hasOwnProperty(key)){_user=this.allData.assigneesOverview[key];for(var i=0,max=_user.assignments.length;max>i;i++)_user.assignments[i].hasOwnProperty("lastUpdated")&&(_lu=lastUpdatedToTimestamp(_user.assignments[i].lastUpdated),_lu>=start&&stop>=_lu&&addAssignment(_user,_user.assignments[i],key))}return this.allData.assigneesOverview=filteredAssignments,this.allData}},Synergy.model={},Synergy.model.Specification=function(title,description,version,owner,id){this.title=title,this.desc=description,this.version=version,this.owner=owner,this.id=id,this.isFavorite=0,this.simpleName="";var self=this;this.testSuites=[],this.setSimpleName=function(simple){self.simpleName=simple}},Synergy.model.Suite=function(title,description,product,component,id){this.title=title,this.desc=description,this.product=product,this.component=component,this.specificationId=-1,this.id=id,this.order=-1,this.testCases=[]},Synergy.model.TestCase=function(title,steps,result,duration,id){this.title=title,this.steps=steps,this.result=result,this.duration=duration,this.orginalDuration=duration,this.id=id,this.suiteId=-1,this.version="",this.order=-1},Synergy.model.Tribe=function(name,description,leaderUsername,id){this.name=name,this.description=description,this.leaderUsername=leaderUsername,this.id=id},Synergy.model.TribeRunStats=function(name,id,tribeSpecs){function filterSpecifications(){for(var i=0,max=tribeSpecs.length;max>i;i++)if(parseInt(self.id,10)===parseInt(tribeSpecs[i].id,10)){for(var j=0,max2=tribeSpecs[i].specificationIds.length;max2>j;j++)specificationIds.push(parseInt(tribeSpecs[i].specificationIds[j],10));return}}Synergy.model.Tribe.call(this,name,"","",parseInt(id,10)),this.testers=[],this.time=0,this.prettyTime="0 minutes",this.testedTotal=0,this.passed=0,this.passedRate=0,this.users=0,this.productivity=0;var specificationIds=[],self=this;filterSpecifications(),this.addAssignment=function(assignments){for(var totalCases=0,totalTime=0,passedCases=0,completedCases=0,i=0,max=assignments.length;max>i;i++)specificationIds.indexOf(assignments[i].specificationId)>-1&&assignments[i].completedCases>0&&(totalCases+=assignments[i].totalCases,totalTime+=assignments[i].totalTime,passedCases+=assignments[i].passedCases,completedCases+=assignments[i].completedCases);if(completedCases>0){this.users++,this.testedTotal+=completedCases,this.productivity=Math.round(10*this.testedTotal/this.users)/10,this.time+=totalTime;var _hours=Math.floor(this.time/60);this.passed+=passedCases,this.prettyTime=(_hours>0?_hours+" hours and ":"")+this.time%60+" minutes",this.passedRate=Math.round(1e3*this.passed/this.testedTotal)/10||0}}},Synergy.model.User=function(firstName,lastName,username,role,id,oldUsername){this.id=id,this.firstName=firstName,this.lastName=lastName,this.username=username,this.role=role,this.oldUsername=oldUsername||this.username,this.emailNotifications=!0
},Synergy.model.Version=function(name,id,isObsolete){this.name=name,this.id=id,this.isObsolete=isObsolete},Synergy.model.TestRun=function(title,description,start,end,id){this.title=title,this.desc=description,this.start=start,this.end=end,this.id=id,this.notifications=-1,this.setNotifications=function(n){return this.notifications=n,this}},Synergy.model.TestAssignment=function(platformId,username,labelId,specificationId,id){this.username=username,this.tribeId=-1,this.testRunId=-1,this.platformId=platformId,this.specificationId=specificationId,this.labelId=labelId,this.id=id},Synergy.model.Platform=function(name,id,isActive){this.name=name,this.id=id,this.isActive=isActive},Synergy.model.Job=function(jobUrl,specificationId,id){this.id=id,this.specificationId=specificationId,this.jobUrl=jobUrl},Synergy.model.OwnershipRequest=function(specificationId,authorUsername,text){this.text=text,this.specificationId=specificationId,this.authorUsername=authorUsername},Synergy.model.SpecificationContainer=function(id){this.id=id,this.data={},this.add=function(specification){this.data.hasOwnProperty(specification.versionId)||(this.data[specification.versionId]={id:specification.id,title:specification.title})},this.get=function(versionId){return this.data[versionId]}},Synergy.util={},Synergy.util.monthsNames={fullName:["January","February","March","April","May","June","July","August","September","October","November","December"],shortName:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},Synergy.util.UTCToLocal=function(d,shortMonthName){try{var _d=new Date,_split=d.split(" ");switch(_split.length){case 2:case 3:var _yearMonthDay=_split[0].split("-");_yearMonthDay.forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)});var _time=_split[1].split(":");_time.forEach(function(item,index){_time[index]=parseInt(item,10)});break;case 5:var _yearMonthDay=[parseInt(_split[2],10),Synergy.util.monthsNames.shortName.indexOf(_split[1])||Synergy.util.monthsNames.fullName.indexOf(_split[1]),parseInt(_split[0],10)];_yearMonthDay[1]++,_split=_split[3].split(":");var _time=[parseInt(_split[0],10),parseInt(_split[1],10),parseInt(_split[2],10)];break;default:return d}return _d.setUTCFullYear(_yearMonthDay[0]),_d.setUTCMonth(_yearMonthDay[1]-1),_d.setUTCDate(_yearMonthDay[2]),_d.setUTCHours(_time[0]),_d.setUTCMinutes(_time[1]),_d.setUTCSeconds(_time[2]),_d.getDate()+" "+(shortMonthName?Synergy.util.monthsNames.shortName[_d.getMonth()]:Synergy.util.monthsNames.fullName[_d.getMonth()])+" "+_d.getFullYear()+" "+(_d.getHours()<10?"0"+_d.getHours():_d.getHours())+":"+(_d.getMinutes()<10?"0"+_d.getMinutes():_d.getMinutes())+":"+(_d.getSeconds()<10?"0"+_d.getSeconds():_d.getSeconds())}catch(e){return d}},Synergy.util.UTCToLocalDateTime=function(d){try{var _d=new Date,_split=d.split(" ");switch(_split.length){case 2:case 3:var _yearMonthDay=_split[0].split("-");_yearMonthDay.forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)});var _time=_split[1].split(":");_time.forEach(function(item,index){_time[index]=parseInt(item,10)});break;case 5:var _yearMonthDay=[parseInt(_split[2],10),Synergy.util.monthsNames.shortName.indexOf(_split[1])||Synergy.util.monthsNames.fullName.indexOf(_split[1]),parseInt(_split[0],10)];_yearMonthDay[1]++,_split=_split[3].split(":");var _time=[parseInt(_split[0],10),parseInt(_split[1],10),parseInt(_split[2],10)];break;default:return d}return _d.setUTCFullYear(_yearMonthDay[0]),_d.setUTCMonth(_yearMonthDay[1]-1),_d.setUTCDate(_yearMonthDay[2]),_d.setUTCHours(_time[0]),_d.setUTCMinutes(_time[1]),_d.setUTCSeconds(_time[2]),_d.getFullYear()+"-"+(_d.getMonth()+1<10?"0"+(_d.getMonth()+1):_d.getMonth()+1)+"-"+_d.getDate()+" "+(_d.getHours()<10?"0"+_d.getHours():_d.getHours())+":"+(_d.getMinutes()<10?"0"+_d.getMinutes():_d.getMinutes())+":"+(_d.getSeconds()<10?"0"+_d.getSeconds():_d.getSeconds())}catch(e){return d}},Synergy.util.localToUTC=function(d){try{var _d=new Date,_split=d.split(" "),_yearMonthDay=_split[0].split("-");_yearMonthDay.forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)});var _time=_split[1].split(":");return _time.forEach(function(item,index){_time[index]=parseInt(item,10)}),_d.setFullYear(_yearMonthDay[0]),_d.setMonth(_yearMonthDay[1]-1),_d.setDate(_yearMonthDay[2]),_d.setHours(_time[0]),_d.setMinutes(_time[1]),_d.setSeconds(_time[2]),_d.getUTCFullYear()+"-"+(_d.getUTCMonth()+1<10?"0"+(_d.getUTCMonth()+1):_d.getUTCMonth()+1)+"-"+(_d.getUTCDate()<10?"0"+_d.getUTCDate():_d.getUTCDate())+" "+(_d.getUTCHours()<10?"0"+_d.getUTCHours():_d.getUTCHours())+":"+(_d.getUTCMinutes()<10?"0"+_d.getUTCMinutes():_d.getUTCMinutes())+":"+(_d.getUTCSeconds()<10?"0"+_d.getUTCSeconds():_d.getUTCSeconds())}catch(e){return d}},Synergy.util.localToUTCTimestamp=function(d){try{var _d=new Date,_split=d.split(" "),_yearMonthDay=_split[0].split("-");_yearMonthDay.forEach(function(item,index){_yearMonthDay[index]=parseInt(item,10)});var _time=_split[1].split(":");return _time.forEach(function(item,index){_time[index]=parseInt(item,10)}),_d.setFullYear(_yearMonthDay[0]),_d.setMonth(_yearMonthDay[1]-1),_d.setDate(_yearMonthDay[2]),_d.setHours(_time[0]),_d.setMinutes(_time[1]),_d.setSeconds(_time[2]),_d.getTime()}catch(e){return d}},Synergy.util.shallowClone=function(original){var _n={};for(var i in original)original.hasOwnProperty(i)&&(_n[i]=original[i]);return _n},Synergy.util.shallowCloneArray=function(originalArray){for(var _n=[],i=0,max=originalArray.length;max>i;i++)_n[i]=Synergy.util.shallowClone(originalArray[i]);return _n},Synergy.util.definedNotNull=function(obj){return"undefined"!=typeof obj&&null!==obj},Synergy.util.ProgressChart=function(data,colors,labels,canvasId){function addLegend(){var topOffset=20,totalOffset=topOffset,leftOffset=dimensions.width*wRation*1.1+radius;context.textAlign="left",context.font="1em Helvetica",context.fillStyle="#333";for(var i=0,max=data.length;max>i;i++)labels[i].length>0&&!isNaN(data[i])&&(context.fillText(data[i]+"% "+labels[i],leftOffset,dimensions.height/2-radius+totalOffset),totalOffset+=topOffset)}function drawOuterCircle(){for(var counter=0,i=0;i<data.length;i++)isNaN(data[i])||(context.fillStyle=colors[i],context.beginPath(),context.moveTo(dimensions.width*wRation,dimensions.height/2),context.arc(dimensions.width*wRation,dimensions.height/2,radius,counter,counter+2*Math.PI*(data[i]/100),!1),context.fill(),counter+=2*Math.PI*(data[i]/100))}function drawInnerCircle(){context.moveTo(dimensions.width*wRation,dimensions.height/2),context.beginPath(),context.arc(dimensions.width*wRation,dimensions.height/2,.7*radius,0,2*Math.PI,!0),context.fillStyle="#ffffff",context.fill()}var canvas=document.getElementById(canvasId),dimensions={width:canvas.width,height:canvas.height},wRation=.25,ratio=.4,radius=ratio*dimensions.width/2;if(!canvas.getContext)return void(context.style.display="none");for(var context=canvas.getContext("2d"),i=0,max=data.length;max>i;i++)data[i]=Math.round(10*data[i])/10;context.clearRect(0,0,canvas.width,canvas.height),drawOuterCircle(),drawInnerCircle(),addLegend()},Date.prototype.toMysqlFormat=function(){function twoDigits(d){return d>=0&&10>d?"0"+d.toString():d>-10&&0>d?"-0"+(-1*d).toString():d.toString()}return this.getUTCFullYear()+"-"+twoDigits(1+this.getUTCMonth())+"-"+twoDigits(this.getUTCDate())+" "+twoDigits(this.getUTCHours())+":"+twoDigits(this.getUTCMinutes())+":"+twoDigits(this.getUTCSeconds())},Synergy.Issue={},Synergy.Issue.RunIssuesCollector=function(){this.issuesStats={total:0,opened:0,P1:0,P2:0,P3:0,P4:0,P1Issues:[],P2Issues:[],P3Issues:[],P4Issues:[],unresolvedIssues:[]},this.issues={},this.addIssue=function(issue){this.issues[issue.bugId+"_"]||(this.issuesStats.total++,this.issuesStats[issue.priority]++,"resolved"!==issue.status.toLowerCase()&&"closed"!==issue.status.toLowerCase()&&"verified"!==issue.status.toLowerCase()&&(this.issuesStats.opened++,this.issuesStats.unresolvedIssues.push(issue)),this.issues[issue.bugId+"_"]=issue,this.issuesStats[issue.priority+"Issues"].push(issue))},this.addIssues=function(bugs){for(var i=0,max=bugs.length;max>i;i++){var issue=bugs[i];this.issues[issue.bugId+"_"]||(this.issuesStats.total++,this.issuesStats[issue.priority]++,"resolved"!==issue.status.toLowerCase()&&"closed"!==issue.status.toLowerCase()&&"verified"!==issue.status.toLowerCase()&&(this.issuesStats.opened++,this.issuesStats.unresolvedIssues.push(issue)),this.issues[issue.bugId+"_"]=issue,this.issuesStats[issue.priority+"Issues"].push(issue))}}},Synergy.model.Product=function(name,components){this.name=name,this.components=components.map(function(e){return new Synergy.model.Component(e)})},Synergy.model.Component=function(name){this.name=name};